<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.34" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.34</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.34">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Users</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Usage Tips</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-generated-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generated Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Contributing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL in Depth</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/dev-model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference (note: outdated)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-25.94074054728752</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-25.94074054728752</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -3.5659   -4.6716    -4.31612   -5.50181   …  -6.31276  -8.3294   -6.7817
 -0.16648  -0.382828  -0.150638   0.023916      1.68925   1.89741  -0.259609
  2.04432   4.44874    4.49433    6.305         4.43329   5.58601   6.8536</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.99259    1.00904
 -0.0147458  0.984834
  4.98524    1.00705</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip830">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip830)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip831">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip830)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip832">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip832)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip832)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip832)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip832)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip832)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip832)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1539.93 2640.76,1539.93 "></polyline>
<polyline clip-path="url(#clip832)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1229.87 2640.76,1229.87 "></polyline>
<polyline clip-path="url(#clip832)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,919.801 2640.76,919.801 "></polyline>
<polyline clip-path="url(#clip832)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,609.737 2640.76,609.737 "></polyline>
<polyline clip-path="url(#clip832)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,299.672 2640.76,299.672 "></polyline>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip830)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip830)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip830)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip830)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip830)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip830)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip830)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip830)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip830)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip830)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip830)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip830)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip830)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip830)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1539.93 170.644,1539.93 "></polyline>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1229.87 170.644,1229.87 "></polyline>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,919.801 170.644,919.801 "></polyline>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,609.737 170.644,609.737 "></polyline>
<polyline clip-path="url(#clip830)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,299.672 170.644,299.672 "></polyline>
<path clip-path="url(#clip830)" d="M49.5521 1540.38 L79.2279 1540.38 L79.2279 1544.32 L49.5521 1544.32 L49.5521 1540.38 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip830)" d="M99.8991 1538.07 Q96.7509 1538.07 94.8991 1540.22 Q93.0704 1542.37 93.0704 1546.12 Q93.0704 1549.85 94.8991 1552.02 Q96.7509 1554.18 99.8991 1554.18 Q103.047 1554.18 104.876 1552.02 Q106.728 1549.85 106.728 1546.12 Q106.728 1542.37 104.876 1540.22 Q103.047 1538.07 99.8991 1538.07 M109.181 1523.41 L109.181 1527.67 Q107.422 1526.84 105.617 1526.4 Q103.834 1525.96 102.075 1525.96 Q97.4454 1525.96 94.9917 1529.08 Q92.5612 1532.21 92.2139 1538.53 Q93.5797 1536.52 95.6398 1535.45 Q97.7 1534.36 100.177 1534.36 Q105.385 1534.36 108.394 1537.53 Q111.427 1540.68 111.427 1546.12 Q111.427 1551.45 108.279 1554.66 Q105.131 1557.88 99.8991 1557.88 Q93.9037 1557.88 90.7325 1553.3 Q87.5612 1548.69 87.5612 1539.96 Q87.5612 1531.77 91.45 1526.91 Q95.3389 1522.02 101.89 1522.02 Q103.649 1522.02 105.431 1522.37 Q107.237 1522.72 109.181 1523.41 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip830)" d="M50.3623 1230.32 L80.0381 1230.32 L80.0381 1234.25 L50.3623 1234.25 L50.3623 1230.32 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip830)" d="M104.297 1228.51 Q107.654 1229.23 109.529 1231.5 Q111.427 1233.77 111.427 1237.1 Q111.427 1242.21 107.908 1245.02 Q104.39 1247.82 97.9083 1247.82 Q95.7324 1247.82 93.4176 1247.38 Q91.126 1246.96 88.6723 1246.1 L88.6723 1241.59 Q90.6167 1242.72 92.9315 1243.3 Q95.2463 1243.88 97.7695 1243.88 Q102.168 1243.88 104.459 1242.15 Q106.774 1240.41 106.774 1237.1 Q106.774 1234.04 104.621 1232.33 Q102.492 1230.59 98.6722 1230.59 L94.6445 1230.59 L94.6445 1226.75 L98.8574 1226.75 Q102.306 1226.75 104.135 1225.39 Q105.964 1224 105.964 1221.4 Q105.964 1218.74 104.066 1217.33 Q102.191 1215.9 98.6722 1215.9 Q96.7509 1215.9 94.5519 1216.31 Q92.3528 1216.73 89.7139 1217.61 L89.7139 1213.44 Q92.376 1212.7 94.6908 1212.33 Q97.0287 1211.96 99.0889 1211.96 Q104.413 1211.96 107.515 1214.39 Q110.617 1216.8 110.617 1220.92 Q110.617 1223.79 108.973 1225.78 Q107.33 1227.75 104.297 1228.51 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip830)" d="M99.4824 905.6 Q95.8713 905.6 94.0426 909.164 Q92.2371 912.706 92.2371 919.836 Q92.2371 926.942 94.0426 930.507 Q95.8713 934.048 99.4824 934.048 Q103.117 934.048 104.922 930.507 Q106.751 926.942 106.751 919.836 Q106.751 912.706 104.922 909.164 Q103.117 905.6 99.4824 905.6 M99.4824 901.896 Q105.293 901.896 108.348 906.502 Q111.427 911.086 111.427 919.836 Q111.427 928.562 108.348 933.169 Q105.293 937.752 99.4824 937.752 Q93.6723 937.752 90.5936 933.169 Q87.538 928.562 87.538 919.836 Q87.538 911.086 90.5936 906.502 Q93.6723 901.896 99.4824 901.896 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip830)" d="M104.297 608.382 Q107.654 609.1 109.529 611.368 Q111.427 613.637 111.427 616.97 Q111.427 622.086 107.908 624.887 Q104.39 627.688 97.9083 627.688 Q95.7324 627.688 93.4176 627.248 Q91.126 626.831 88.6723 625.975 L88.6723 621.461 Q90.6167 622.595 92.9315 623.174 Q95.2463 623.753 97.7695 623.753 Q102.168 623.753 104.459 622.017 Q106.774 620.28 106.774 616.97 Q106.774 613.915 104.621 612.202 Q102.492 610.466 98.6722 610.466 L94.6445 610.466 L94.6445 606.623 L98.8574 606.623 Q102.306 606.623 104.135 605.257 Q105.964 603.868 105.964 601.276 Q105.964 598.614 104.066 597.202 Q102.191 595.767 98.6722 595.767 Q96.7509 595.767 94.5519 596.183 Q92.3528 596.6 89.7139 597.48 L89.7139 593.313 Q92.376 592.572 94.6908 592.202 Q97.0287 591.832 99.0889 591.832 Q104.413 591.832 107.515 594.262 Q110.617 596.669 110.617 600.79 Q110.617 603.66 108.973 605.651 Q107.33 607.618 104.297 608.382 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip830)" d="M99.8991 297.809 Q96.7509 297.809 94.8991 299.962 Q93.0704 302.114 93.0704 305.864 Q93.0704 309.591 94.8991 311.767 Q96.7509 313.92 99.8991 313.92 Q103.047 313.92 104.876 311.767 Q106.728 309.591 106.728 305.864 Q106.728 302.114 104.876 299.962 Q103.047 297.809 99.8991 297.809 M109.181 283.156 L109.181 287.415 Q107.422 286.582 105.617 286.142 Q103.834 285.702 102.075 285.702 Q97.4454 285.702 94.9917 288.827 Q92.5612 291.952 92.2139 298.272 Q93.5797 296.258 95.6398 295.193 Q97.7 294.105 100.177 294.105 Q105.385 294.105 108.394 297.276 Q111.427 300.424 111.427 305.864 Q111.427 311.188 108.279 314.406 Q105.131 317.623 99.8991 317.623 Q93.9037 317.623 90.7325 313.04 Q87.5612 308.434 87.5612 299.707 Q87.5612 291.512 91.45 286.651 Q95.3389 281.767 101.89 281.767 Q103.649 281.767 105.431 282.114 Q107.237 282.462 109.181 283.156 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip832)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1288.35 224.541,1295.1 226.891,1447.21 229.242,1374.48 231.592,1312.04 233.943,1541.31 236.293,1490.11 238.644,1557.36 240.994,1440.11 243.345,1519.82 245.695,1421.81 248.046,1523.02 250.396,1470.66 252.747,1607.19 255.097,1579.99 257.448,1464.59 259.798,1465.37 262.148,1414.98 264.499,1512.16 266.849,1419.6 269.2,1473.72 271.55,1566.67 273.901,1322.45 276.251,1298.1 278.602,1373.12 280.952,1388.58 283.303,1605.7 285.653,1493.65 288.004,1516.63 290.354,1335.37 292.705,1332.01 295.055,1569.06 297.406,1406.76 299.756,1440.08 302.107,1376.22 304.457,1470.8 306.807,1425.48 309.158,1370.61 311.508,1528.98 313.859,1419.51 316.209,1498 318.56,1426.24 320.91,1286.86 323.261,1638.58 325.611,1572.13 327.962,1449.28 330.312,1557.5 332.663,1328.13 335.013,1339.68 337.364,1323.54 339.714,1581.83 342.065,1630.1 344.415,1474.64 346.765,1587.62 349.116,1412.23 351.466,1284.38 353.817,1498.27 356.167,1299.94 358.518,1353.74 360.868,1421.27 363.219,1436.92 365.569,1361.96 367.92,1419.44 370.27,1513.67 372.621,1654.32 374.971,1369.27 377.322,1483.07 379.672,1380.31 382.023,1438.12 384.373,1536.28 386.724,1665.21 389.074,1569.51 391.424,1485.92 393.775,1436.28 396.125,1373.41 398.476,1567.24 400.826,1465.19 403.177,1294.11 405.527,1221.9 407.878,1555.14 410.228,1546.63 412.579,1445.94 414.929,1442.42 417.28,1408.81 419.63,1431.78 421.981,1417.17 424.331,1338.68 426.682,1370.5 429.032,1425.65 431.382,1412.35 433.733,1299.29 436.083,1231.63 438.434,1457.06 440.784,1524.93 443.135,1510.9 445.485,1261.53 447.836,1424.27 450.186,1402.21 452.537,1616.58 454.887,1506.49 457.238,1571.14 459.588,1646.99 461.939,1503.34 464.289,1411.8 466.64,1357.43 468.99,1237.85 471.341,1382.45 473.691,1466.96 476.041,1398.08 478.392,1342.11 480.742,1484.22 483.093,1358.82 485.443,1549.05 487.794,1442.48 490.144,1697.51 492.495,1491.16 494.845,1410.58 497.196,1457.06 499.546,1597.26 501.897,1325.13 504.247,1399.61 506.598,1370.69 508.948,1453.61 511.299,1426.5 513.649,1507.24 515.999,1288.02 518.35,1401.59 520.7,1484.66 523.051,1613.39 525.401,1473.9 527.752,1427.46 530.102,1435.51 532.453,1293.37 534.803,1577.38 537.154,1387.92 539.504,1538.35 541.855,1514.24 544.205,1148.96 546.556,1494.36 548.906,1610.66 551.257,1371.43 553.607,1466.43 555.958,1307.65 558.308,1498.35 560.658,1423.53 563.009,1347.55 565.359,1319.1 567.71,1377.1 570.06,1474.29 572.411,1465.02 574.761,1342.24 577.112,1248.85 579.462,1557.72 581.813,1289.37 584.163,1433.76 586.514,1335.27 588.864,1312.92 591.215,1471.31 593.565,1302.01 595.916,1580.52 598.266,1317.52 600.616,1340 602.967,1379.25 605.317,1466.49 607.668,1407.61 610.018,1413.09 612.369,1324.46 614.719,1454.58 617.07,1347.61 619.42,1545.38 621.771,1596.35 624.121,1544.5 626.472,1374.54 628.822,1612.24 631.173,1434.36 633.523,1380.33 635.874,1493.52 638.224,1472.04 640.575,1362.82 642.925,1471.1 645.275,1452.62 647.626,1422.05 649.976,1436.15 652.327,1458.69 654.677,1441.07 657.028,1499.44 659.378,1435.28 661.729,1318.43 664.079,1529.5 666.43,1615.16 668.78,1548.28 671.131,1351.43 673.481,1444.63 675.832,1405.03 678.182,1372.97 680.533,1394.56 682.883,1346.46 685.233,1398.78 687.584,1321.61 689.934,1345.98 692.285,1357.21 694.635,1351.33 696.986,1622.15 699.336,1486.75 701.687,1368.02 704.037,1477 706.388,1490.85 708.738,1513.49 711.089,1220.07 713.439,1213.88 715.79,1537.69 718.14,1454.98 720.491,1615.92 722.841,1505.6 725.192,1431.18 727.542,1347.67 729.892,1355.83 732.243,1389.59 734.593,1580.63 736.944,1643.27 739.294,1444.92 741.645,1305.09 743.995,1441.92 746.346,1514.05 748.696,1455.63 751.047,1418.27 753.397,1423.66 755.748,1606.6 758.098,1341.13 760.449,1429.4 762.799,1613.48 765.15,1557.83 767.5,1448.11 769.85,1513.41 772.201,1322.45 774.551,1479.45 776.902,1430.08 779.252,1459.8 781.603,1463.82 783.953,1372.22 786.304,1337.57 788.654,1247.02 791.005,1327.1 793.355,1549.92 795.706,1513.14 798.056,1353.99 800.407,1389.81 802.757,1360.73 805.108,1552.21 807.458,1334.37 809.809,1476.24 812.159,1243.23 814.509,1367.85 816.86,1554.55 819.21,1444.43 821.561,1417.4 823.911,1477.66 826.262,1447.18 828.612,1322.67 830.963,1483.4 833.313,1464.3 835.664,1450.36 838.014,1421 840.365,1453.33 842.715,1391.37 845.066,1299.24 847.416,1471.36 849.767,1419.75 852.117,1314.59 854.467,1524.69 856.818,1588.88 859.168,1363.64 861.519,1422.34 863.869,1505.04 866.22,1452.63 868.57,1528.92 870.921,1381.05 873.271,1523.76 875.622,1511.86 877.972,1549.82 880.323,1526.61 882.673,1346.07 885.024,1205.63 887.374,1489.45 889.725,1494.28 892.075,1285.49 894.426,1251.99 896.776,1535.12 899.126,1534.25 901.477,1455.73 903.827,1568.39 906.178,1476.6 908.528,1565.91 910.879,1308.65 913.229,1556.39 915.58,1497.93 917.93,1393.36 920.281,1534.39 922.631,1546.22 924.982,1323.35 927.332,1217.41 929.683,1231.7 932.033,1355.5 934.384,1227.54 936.734,1443.74 939.084,1424.22 941.435,1377.86 943.785,1411.05 946.136,1535.19 948.486,1607.75 950.837,1602.35 953.187,1375.07 955.538,1358.54 957.888,1336.87 960.239,1399.61 962.589,1539.48 964.94,1573.38 967.29,1392.4 969.641,1523.12 971.991,1488.11 974.342,1371.09 976.692,1247.87 979.043,1294.75 981.393,1509.29 983.743,1507.41 986.094,1553.38 988.444,1320.53 990.795,1599.89 993.145,1328.6 995.496,1439.87 997.846,1405.99 1000.2,1454 1002.55,1428.82 1004.9,1592.63 1007.25,1482.12 1009.6,1147.21 1011.95,1467.34 1014.3,1549.12 1016.65,1417.09 1019,1600.47 1021.35,1511.26 1023.7,1592.27 1026.05,1398.8 1028.4,1413.34 1030.75,1390.48 1033.1,1536.46 1035.45,1440.78 1037.8,1309.36 1040.15,1188.84 1042.51,1342.58 1044.86,1348.54 1047.21,1443.31 1049.56,1467.96 1051.91,1423.47 1054.26,1329.91 1056.61,1383.9 1058.96,1321.71 1061.31,1335.23 1063.66,1504.58 1066.01,1436.29 1068.36,1384.35 1070.71,1390.84 1073.06,1517.82 1075.41,1507.65 1077.76,1424.68 1080.11,1496.36 1082.46,1646.18 1084.81,1487.53 1087.16,1402.26 1089.51,1392.9 1091.87,1364.7 1094.22,1423.73 1096.57,1447.22 1098.92,1525.29 1101.27,1421.06 1103.62,1321.97 1105.97,1189.44 1108.32,1411.97 1110.67,1236.79 1113.02,1401.97 1115.37,1502.38 1117.72,1336.35 1120.07,1489.13 1122.42,1440.96 1124.77,1325.83 1127.12,1261.54 1129.47,1526.46 1131.82,1599.56 1134.17,1406.46 1136.52,1528.41 1138.87,1537.83 1141.23,1328.55 1143.58,1234.06 1145.93,1464.86 1148.28,1538.06 1150.63,1277.69 1152.98,1500.8 1155.33,1504.51 1157.68,1400.03 1160.03,1272.46 1162.38,1382.46 1164.73,1429.93 1167.08,1454.3 1169.43,1413.28 1171.78,1414.07 1174.13,1286.96 1176.48,1355.02 1178.83,1381.14 1181.18,1291.91 1183.53,1297.88 1185.88,1297.86 1188.23,1360.74 1190.59,1348.28 1192.94,1487.15 1195.29,1302.49 1197.64,1565.86 1199.99,1514.52 1202.34,1428.18 1204.69,1355.92 1207.04,1391.96 1209.39,1216.65 1211.74,1592.8 1214.09,1324.73 1216.44,1475.76 1218.79,1517.45 1221.14,1359.54 1223.49,1307.1 1225.84,1351.41 1228.19,1495.76 1230.54,1644.76 1232.89,1501.44 1235.24,1554.07 1237.59,1493.59 1239.94,1341.68 1242.3,1384.77 1244.65,1429.71 1247,1402.06 1249.35,1297.84 1251.7,1496.84 1254.05,1543.49 1256.4,1451.74 1258.75,1394.43 1261.1,1366.16 1263.45,1585.19 1265.8,1439.98 1268.15,1478.35 1270.5,1501.74 1272.85,1523.57 1275.2,1549.04 1277.55,1340.07 1279.9,1302.37 1282.25,1510.98 1284.6,1313.92 1286.95,1444.81 1289.3,1444.21 1291.66,1467.48 1294.01,1515.97 1296.36,1521.51 1298.71,1338.26 1301.06,1466.23 1303.41,1604.12 1305.76,1591.35 1308.11,1347.92 1310.46,1512.96 1312.81,1363.62 1315.16,1303.01 1317.51,1689.8 1319.86,1504.68 1322.21,1559.1 1324.56,1434.28 1326.91,1285.92 1329.26,1505.39 1331.61,1540.72 1333.96,1343.12 1336.31,1413.98 1338.66,1434.64 1341.02,1467.83 1343.37,1383.01 1345.72,1372.56 1348.07,1510.31 1350.42,1352.68 1352.77,1530.77 1355.12,1601.85 1357.47,1547.93 1359.82,1398.3 1362.17,1321.61 1364.52,1414.51 1366.87,1461.48 1369.22,1468.28 1371.57,1561.84 1373.92,1452.18 1376.27,1563.94 1378.62,1515.83 1380.97,1431.57 1383.32,1361.83 1385.67,1442.76 1388.02,1264.43 1390.38,1653.75 1392.73,1501.03 1395.08,1432.83 1397.43,1557.16 1399.78,1409.61 1402.13,1613.67 1404.48,1317.24 1406.83,1401.46 1409.18,1542.87 1411.53,1340.84 1413.88,1361.58 1416.23,1389.18 1418.58,1514.24 1420.93,1352.4 1423.28,1555.07 1425.63,1483.35 1427.98,1438.59 1430.33,1361.61 1432.68,1486.76 1435.03,1285.87 1437.38,1448.5 1439.74,1200.73 1442.09,1544.54 1444.44,1344.62 1446.79,1558.21 1449.14,1497.43 1451.49,1608.72 1453.84,1445.17 1456.19,1183.61 1458.54,1547.22 1460.89,1250.52 1463.24,1512.57 1465.59,1473.47 1467.94,1453.45 1470.29,1503.75 1472.64,1389.55 1474.99,1439.38 1477.34,1444.43 1479.69,1437.21 1482.04,1481.33 1484.39,1539.73 1486.74,1503.28 1489.1,1461.73 1491.45,1557.48 1493.8,1297.73 1496.15,1419.98 1498.5,1413.91 1500.85,1517.84 1503.2,1372.25 1505.55,1412.68 1507.9,1392.05 1510.25,1289 1512.6,1332.11 1514.95,1520.95 1517.3,1356.04 1519.65,1712.33 1522,1588.32 1524.35,1338.15 1526.7,1344.73 1529.05,1342.03 1531.4,1355.87 1533.75,1460.35 1536.1,1330.91 1538.45,1506.47 1540.81,1502.04 1543.16,1505.68 1545.51,1448.23 1547.86,1568.82 1550.21,1357.3 1552.56,1530.99 1554.91,1232.57 1557.26,1688.6 1559.61,1464.4 1561.96,1462.68 1564.31,1529.58 1566.66,1267.35 1569.01,1349.52 1571.36,1505.69 1573.71,1520.9 1576.06,1459.59 1578.41,1613.86 1580.76,1492.05 1583.11,1474.14 1585.46,1231.89 1587.81,1381.15 1590.17,1244.15 1592.52,1471.94 1594.87,1401 1597.22,1544.23 1599.57,1328.75 1601.92,1319.7 1604.27,1342.11 1606.62,1292.91 1608.97,1258.66 1611.32,1402.38 1613.67,1327.33 1616.02,1478.63 1618.37,1487.87 1620.72,1555.16 1623.07,1411.43 1625.42,1468.17 1627.77,1392.94 1630.12,1322.03 1632.47,1450.57 1634.82,1430.58 1637.17,1503.65 1639.53,1424.8 1641.88,1449.19 1644.23,1307.29 1646.58,1245.74 1648.93,1501.9 1651.28,1416.77 1653.63,1345.78 1655.98,1377.78 1658.33,1386.86 1660.68,1463.93 1663.03,1388.46 1665.38,1412.08 1667.73,1368.64 1670.08,1364.32 1672.43,1526.68 1674.78,1334.36 1677.13,1356.76 1679.48,1542.45 1681.83,1436.26 1684.18,1378.25 1686.53,1410.51 1688.89,1491.18 1691.24,1630.97 1693.59,1404.36 1695.94,1549.09 1698.29,1461.54 1700.64,1282.93 1702.99,1394.87 1705.34,1387.6 1707.69,1412.47 1710.04,1398.82 1712.39,1637.15 1714.74,1404 1717.09,1352.72 1719.44,1484.17 1721.79,1443.46 1724.14,1381.87 1726.49,1445.22 1728.84,1516.88 1731.19,1319.14 1733.54,1451.44 1735.89,1479.57 1738.25,1456.23 1740.6,1259.6 1742.95,1426.84 1745.3,1462.02 1747.65,1496.2 1750,1402.81 1752.35,1441.39 1754.7,1460.49 1757.05,1566.38 1759.4,1471.62 1761.75,1586.87 1764.1,1446.14 1766.45,1396.9 1768.8,1456.54 1771.15,1467.89 1773.5,1349.94 1775.85,1568.74 1778.2,1642.11 1780.55,1363.54 1782.9,1440.04 1785.25,1563.15 1787.6,1231.94 1789.96,1515.51 1792.31,1424.91 1794.66,1361.04 1797.01,1701.36 1799.36,1599.47 1801.71,1272.83 1804.06,1431.9 1806.41,1556.74 1808.76,1406.12 1811.11,1490.83 1813.46,1278.86 1815.81,1432.5 1818.16,1336.89 1820.51,1427.17 1822.86,1422.12 1825.21,1427.59 1827.56,1751.15 1829.91,1355.8 1832.26,1498.71 1834.61,1402.07 1836.96,1390.18 1839.32,1522.33 1841.67,1371.2 1844.02,1271.17 1846.37,1467.23 1848.72,1397.56 1851.07,1386.68 1853.42,1318.89 1855.77,1503.84 1858.12,1299.74 1860.47,1319.75 1862.82,1611.69 1865.17,1285.53 1867.52,1429.9 1869.87,1320.64 1872.22,1479.63 1874.57,1717.05 1876.92,1360.26 1879.27,1409.79 1881.62,1382.78 1883.97,1403.39 1886.32,1652.35 1888.68,1512.63 1891.03,1213.96 1893.38,1454.07 1895.73,1488.46 1898.08,1431.34 1900.43,1381.73 1902.78,1372.81 1905.13,1351.06 1907.48,1306.88 1909.83,1349.98 1912.18,1518.96 1914.53,1426.48 1916.88,1537.82 1919.23,1474.59 1921.58,1256.04 1923.93,1337.29 1926.28,1487.41 1928.63,1548.87 1930.98,1374.54 1933.33,1435.83 1935.68,1427.07 1938.04,1380.58 1940.39,1538.12 1942.74,1438.88 1945.09,1368.6 1947.44,1525.37 1949.79,1350.05 1952.14,1438.55 1954.49,1572.26 1956.84,1231.7 1959.19,1319.35 1961.54,1219.88 1963.89,1522.49 1966.24,1359.78 1968.59,1508.28 1970.94,1550.74 1973.29,1453.11 1975.64,1258.79 1977.99,1414.77 1980.34,1647.42 1982.69,1304.29 1985.04,1570.44 1987.4,1369.23 1989.75,1476.81 1992.1,1429.79 1994.45,1409.76 1996.8,1477.14 1999.15,1325.44 2001.5,1587.86 2003.85,1480.4 2006.2,1348.25 2008.55,1445.71 2010.9,1158.92 2013.25,1343.52 2015.6,1372.05 2017.95,1589.59 2020.3,1513.2 2022.65,1312.25 2025,1347.37 2027.35,1515.83 2029.7,1328.42 2032.05,1370.99 2034.4,1490.01 2036.76,1432.69 2039.11,1485.81 2041.46,1398.26 2043.81,1537.84 2046.16,1486.24 2048.51,1487.58 2050.86,1392.76 2053.21,1412.52 2055.56,1351.17 2057.91,1363.26 2060.26,1421.03 2062.61,1274.77 2064.96,1300.17 2067.31,1325.98 2069.66,1424.04 2072.01,1412.25 2074.36,1386.76 2076.71,1335.65 2079.06,1514.15 2081.41,1327.01 2083.76,1450.2 2086.11,1528.42 2088.47,1450.5 2090.82,1424.25 2093.17,1580.87 2095.52,1423.56 2097.87,1373.97 2100.22,1538.76 2102.57,1524.22 2104.92,1409.89 2107.27,1602.27 2109.62,1643.29 2111.97,1322.5 2114.32,1454.3 2116.67,1709.82 2119.02,1513.66 2121.37,1559.57 2123.72,1459.07 2126.07,1621.56 2128.42,1482.82 2130.77,1365.76 2133.12,1390.8 2135.47,1480.75 2137.83,1354.18 2140.18,1475.4 2142.53,1444.16 2144.88,1400.59 2147.23,1479.68 2149.58,1556.99 2151.93,1609.51 2154.28,1702.86 2156.63,1501.8 2158.98,1559.71 2161.33,1446.47 2163.68,1341.64 2166.03,1296.66 2168.38,1400.87 2170.73,1560.02 2173.08,1541.31 2175.43,1302.21 2177.78,1516.99 2180.13,1474.3 2182.48,1309.28 2184.83,1549.72 2187.19,1453.89 2189.54,1476.66 2191.89,1524.23 2194.24,1420.14 2196.59,1395.77 2198.94,1371.47 2201.29,1589.3 2203.64,1380.81 2205.99,1428.91 2208.34,1380.44 2210.69,1432.09 2213.04,1419.92 2215.39,1502.33 2217.74,1445.02 2220.09,1384.1 2222.44,1471.92 2224.79,1311.55 2227.14,1664.31 2229.49,1437.41 2231.84,1446.05 2234.19,1480.46 2236.55,1438.15 2238.9,1384.35 2241.25,1367.93 2243.6,1488.09 2245.95,1239.92 2248.3,1484.84 2250.65,1470.1 2253,1284.97 2255.35,1488.64 2257.7,1341.76 2260.05,1504.4 2262.4,1302.47 2264.75,1553.47 2267.1,1537.21 2269.45,1477.89 2271.8,1573.34 2274.15,1599.2 2276.5,1527.7 2278.85,1372.07 2281.2,1243.54 2283.55,1423.21 2285.91,1376.37 2288.26,1474.38 2290.61,1396.58 2292.96,1435.17 2295.31,1454.2 2297.66,1447.03 2300.01,1483.73 2302.36,1448.95 2304.71,1419.64 2307.06,1451.21 2309.41,1382.73 2311.76,1436.44 2314.11,1390.4 2316.46,1246.43 2318.81,1485.27 2321.16,1518.65 2323.51,1487.73 2325.86,1450.47 2328.21,1289.84 2330.56,1326.55 2332.91,1363.48 2335.27,1440.34 2337.62,1511.25 2339.97,1554.08 2342.32,1479.26 2344.67,1376.3 2347.02,1444.43 2349.37,1367.26 2351.72,1367.68 2354.07,1574.94 2356.42,1500.72 2358.77,1456.3 2361.12,1248.07 2363.47,1418.4 2365.82,1396.13 2368.17,1541.87 2370.52,1397.96 2372.87,1212.94 2375.22,1314.54 2377.57,1543.94 2379.92,1402.38 2382.27,1559.07 2384.62,1429.25 2386.98,1378.69 2389.33,1352.96 2391.68,1509.78 2394.03,1404.47 2396.38,1313.83 2398.73,1296.07 2401.08,1403.85 2403.43,1386.03 2405.78,1352.11 2408.13,1503.96 2410.48,1365.64 2412.83,1458.28 2415.18,1500.31 2417.53,1519.65 2419.88,1595.45 2422.23,1428.76 2424.58,1442.88 2426.93,1531.48 2429.28,1468.99 2431.63,1377.36 2433.98,1502.62 2436.34,1535.21 2438.69,1640.06 2441.04,1402.32 2443.39,1326.14 2445.74,1252.51 2448.09,1458.67 2450.44,1416.33 2452.79,1497.47 2455.14,1472.28 2457.49,1410.46 2459.84,1376.16 2462.19,1404.17 2464.54,1470.02 2466.89,1448.69 2469.24,1427.19 2471.59,1401.95 2473.94,1347.02 2476.29,1398.04 2478.64,1484.02 2480.99,1347.4 2483.34,1648.91 2485.7,1373.31 2488.05,1502.53 2490.4,1413.52 2492.75,1266.13 2495.1,1524.59 2497.45,1506.47 2499.8,1667.1 2502.15,1423.43 2504.5,1425.79 2506.85,1372.9 2509.2,1235.04 2511.55,1567.39 2513.9,1539.44 2516.25,1543.96 2518.6,1521.24 2520.95,1506.67 2523.3,1408.22 2525.65,1432.68 2528,1273.25 2530.35,1531.45 2532.7,1275.45 2535.06,1583.2 2537.41,1359.23 2539.76,1441.35 2542.11,1433.56 2544.46,1308.84 2546.81,1277.33 2549.16,1415.98 2551.51,1384.62 2553.86,1492.95 2556.21,1373.37 2558.56,1510.02 2560.91,1636.71 2563.26,1441.14 2565.61,1706.19 2567.96,1570.05 2570.31,1576.54 "></polyline>
<polyline clip-path="url(#clip832)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,937.007 224.541,947.344 226.891,782.961 229.242,751.418 231.592,979.457 233.943,901.832 236.293,1007.28 238.644,958.323 240.994,919.473 243.345,916.169 245.695,1043.72 248.046,919.416 250.396,924.317 252.747,997.229 255.097,819.901 257.448,1154.79 259.798,865.804 262.148,852.734 264.499,811.488 266.849,1043.52 269.2,1003.37 271.55,974.154 273.901,898.653 276.251,933.214 278.602,778.734 280.952,1043.65 283.303,771.385 285.653,840.253 288.004,1187.05 290.354,1075.64 292.705,992.926 295.055,837.748 297.406,932.352 299.756,899.515 302.107,792.704 304.457,947.262 306.807,1025.99 309.158,953.249 311.508,1110.39 313.859,838.999 316.209,1098.77 318.56,823.394 320.91,830.015 323.261,934.29 325.611,957.087 327.962,795.068 330.312,749.048 332.663,964.967 335.013,982.48 337.364,1025.14 339.714,887.461 342.065,943.161 344.415,874.387 346.765,1070.98 349.116,912.888 351.466,947.613 353.817,979.524 356.167,921.492 358.518,862.454 360.868,711.129 363.219,847.219 365.569,854.805 367.92,927.015 370.27,1051.13 372.621,1028.02 374.971,908.469 377.322,861.053 379.672,933.581 382.023,929.943 384.373,853.074 386.724,914.571 389.074,877.59 391.424,919.833 393.775,867.235 396.125,998.701 398.476,808.534 400.826,893.498 403.177,869.015 405.527,893.607 407.878,1217.64 410.228,840.753 412.579,896.581 414.929,873.38 417.28,997.123 419.63,872.618 421.981,879.081 424.331,963.559 426.682,841.982 429.032,770.151 431.382,1054.31 433.733,812.324 436.083,729.581 438.434,733.744 440.784,951.807 443.135,1054.47 445.485,807.285 447.836,899.102 450.186,877.343 452.537,812.353 454.887,895.159 457.238,980.95 459.588,922.023 461.939,1050.99 464.289,880.071 466.64,808.393 468.99,1103.4 471.341,836.644 473.691,908.909 476.041,914.819 478.392,796.162 480.742,981.722 483.093,853.691 485.443,838.949 487.794,1005.65 490.144,909.349 492.495,944.526 494.845,930.593 497.196,812.076 499.546,861.915 501.897,1075.29 504.247,1020.88 506.598,904.991 508.948,1057.69 511.299,875.469 513.649,1130.15 515.999,869.253 518.35,694.659 520.7,895.46 523.051,908.284 525.401,886.429 527.752,961.643 530.102,1118.4 532.453,906.432 534.803,957.969 537.154,742.566 539.504,784.585 541.855,859.57 544.205,933.298 546.556,930.576 548.906,998.578 551.257,1024 553.607,890.923 555.958,742.812 558.308,1129.64 560.658,897.611 563.009,935.39 565.359,887.422 567.71,1130.99 570.06,899.577 572.411,949.2 574.761,746.427 577.112,968.319 579.462,1028.59 581.813,1006.45 584.163,981.831 586.514,867.495 588.864,913.246 591.215,1030.26 593.565,881.578 595.916,915.238 598.266,1115.77 600.616,733.215 602.967,921.644 605.317,795.165 607.668,1078.66 610.018,966.95 612.369,964.925 614.719,837.222 617.07,1056.46 619.42,1170.72 621.771,970.435 624.121,898.29 626.472,869.321 628.822,875.96 631.173,854.027 633.523,984.761 635.874,956.391 638.224,866.678 640.575,758.037 642.925,934.543 645.275,1021.26 647.626,869.521 649.976,1004.88 652.327,850.999 654.677,1034.64 657.028,970.122 659.378,1003.2 661.729,976.394 664.079,976.262 666.43,847.512 668.78,1009.49 671.131,979.681 673.481,1012.03 675.832,765.345 678.182,906.345 680.533,825.528 682.883,865.546 685.233,841.332 687.584,812.283 689.934,788.679 692.285,957.4 694.635,1150.94 696.986,1006.44 699.336,852.888 701.687,898.97 704.037,790.192 706.388,862.125 708.738,842.775 711.089,1110.05 713.439,852.798 715.79,749.948 718.14,1147.67 720.491,917.937 722.841,959.017 725.192,865.647 727.542,988.94 729.892,933.947 732.243,924.211 734.593,886.2 736.944,890.404 739.294,921.231 741.645,981.487 743.995,981.392 746.346,884.801 748.696,855.696 751.047,967.684 753.397,978.419 755.748,906.998 758.098,874.06 760.449,893.839 762.799,1059.9 765.15,686.57 767.5,900.023 769.85,986.364 772.201,1028.73 774.551,967.001 776.902,971.07 779.252,826.794 781.603,897.331 783.953,809.188 786.304,926.685 788.654,792.465 791.005,1117.12 793.355,856.337 795.706,1143.95 798.056,1067.48 800.407,958.695 802.757,954.281 805.108,932.578 807.458,1046.39 809.809,876.638 812.159,950.129 814.509,922.736 816.86,828.607 819.21,1011.79 821.561,1036 823.911,913.149 826.262,868.58 828.612,914.583 830.963,874.714 833.313,853.529 835.664,1098.99 838.014,784.881 840.365,951.52 842.715,843.522 845.066,1133.23 847.416,794.292 849.767,1018.97 852.117,1075.32 854.467,1193.84 856.818,946.351 859.168,1028.85 861.519,1011.64 863.869,752.401 866.22,906.554 868.57,904.931 870.921,985.195 873.271,929.133 875.622,775.691 877.972,722.251 880.323,996.943 882.673,986.926 885.024,753.178 887.374,890.676 889.725,1028.12 892.075,1105.37 894.426,921.519 896.776,842.483 899.126,971.445 901.477,958.449 903.827,981.311 906.178,879.66 908.528,804.892 910.879,832.107 913.229,845.072 915.58,869.309 917.93,747.439 920.281,874.296 922.631,847.425 924.982,836.145 927.332,1010.73 929.683,845.956 932.033,1029.09 934.384,845.996 936.734,987.703 939.084,931.798 941.435,821.722 943.785,800.88 946.136,813.274 948.486,822.233 950.837,873.3 953.187,767.643 955.538,1099.97 957.888,800.748 960.239,1014.31 962.589,952.327 964.94,872.462 967.29,1059.38 969.641,895.843 971.991,1073.22 974.342,1039.61 976.692,904.271 979.043,982.586 981.393,853.945 983.743,962.635 986.094,1047.83 988.444,988.151 990.795,867.471 993.145,919.726 995.496,1129.49 997.846,882.75 1000.2,1092.52 1002.55,1192.51 1004.9,557.956 1007.25,845.018 1009.6,915.161 1011.95,856.246 1014.3,886.171 1016.65,989.685 1019,882.052 1021.35,880.146 1023.7,749.606 1026.05,902.262 1028.4,1082.57 1030.75,765.146 1033.1,948.467 1035.45,957.274 1037.8,808.452 1040.15,1105.01 1042.51,885.086 1044.86,881.796 1047.21,1065.89 1049.56,876.243 1051.91,912.101 1054.26,798.248 1056.61,830.837 1058.96,798.376 1061.31,1014.83 1063.66,763.377 1066.01,790.503 1068.36,1075.89 1070.71,884.226 1073.06,813.775 1075.41,915.594 1077.76,880.881 1080.11,907.089 1082.46,840.665 1084.81,919.852 1087.16,948.835 1089.51,986.431 1091.87,875.682 1094.22,1063.68 1096.57,922.599 1098.92,981.631 1101.27,1044.91 1103.62,743.152 1105.97,967.555 1108.32,1080.24 1110.67,965.874 1113.02,910.801 1115.37,801.683 1117.72,1086.44 1120.07,963.968 1122.42,766.12 1124.77,990.62 1127.12,829.235 1129.47,852.593 1131.82,1130.54 1134.17,1018.98 1136.52,828.662 1138.87,895.404 1141.23,1010.4 1143.58,814.728 1145.93,943.794 1148.28,990.661 1150.63,803.588 1152.98,845.077 1155.33,981.573 1157.68,1135.5 1160.03,933.297 1162.38,865.448 1164.73,779.247 1167.08,812.189 1169.43,976.87 1171.78,881.566 1174.13,1123.52 1176.48,856.244 1178.83,1032.16 1181.18,849.145 1183.53,982.046 1185.88,1021.07 1188.23,1034.23 1190.59,857.401 1192.94,751.926 1195.29,977.636 1197.64,843.861 1199.99,923.515 1202.34,857.985 1204.69,826.794 1207.04,964.429 1209.39,791.551 1211.74,954.515 1214.09,908.517 1216.44,915.158 1218.79,886.851 1221.14,782.978 1223.49,935.018 1225.84,879.063 1228.19,1161.88 1230.54,922.56 1232.89,971.686 1235.24,1079.22 1237.59,798.876 1239.94,908.929 1242.3,989.4 1244.65,946.846 1247,928.747 1249.35,1042.17 1251.7,915.266 1254.05,790.376 1256.4,886.587 1258.75,908.613 1261.1,1031.78 1263.45,913.21 1265.8,864.136 1268.15,867.779 1270.5,837.05 1272.85,1019.92 1275.2,920.673 1277.55,889.792 1279.9,980.246 1282.25,1052.84 1284.6,802.8 1286.95,995.189 1289.3,1063.5 1291.66,955.624 1294.01,938.712 1296.36,1072.1 1298.71,1077.9 1301.06,896.567 1303.41,1018.79 1305.76,846.914 1308.11,887.364 1310.46,905.507 1312.81,981.386 1315.16,803.771 1317.51,857.236 1319.86,961.911 1322.21,891.073 1324.56,1018.66 1326.91,908.087 1329.26,894.12 1331.61,861.102 1333.96,792.411 1336.31,1118.27 1338.66,898.557 1341.02,918.717 1343.37,805.09 1345.72,927.132 1348.07,809.67 1350.42,900.803 1352.77,987.93 1355.12,878.865 1357.47,663.214 1359.82,863.226 1362.17,1204.5 1364.52,873.718 1366.87,882.916 1369.22,778.001 1371.57,755.688 1373.92,1012.24 1376.27,828.63 1378.62,751.202 1380.97,1007.06 1383.32,790.358 1385.67,935.191 1388.02,851.797 1390.38,770.451 1392.73,911.396 1395.08,1012.77 1397.43,932.9 1399.78,835.361 1402.13,954.209 1404.48,988.208 1406.83,851.3 1409.18,901.176 1411.53,827.011 1413.88,952.14 1416.23,932.702 1418.58,892.311 1420.93,958.415 1423.28,993.919 1425.63,1182.49 1427.98,734.672 1430.33,1155.12 1432.68,819.928 1435.03,876.952 1437.38,1066.83 1439.74,826.644 1442.09,1076.56 1444.44,882.728 1446.79,812.519 1449.14,959.106 1451.49,990.325 1453.84,1093.2 1456.19,842.418 1458.54,1062.3 1460.89,813.216 1463.24,993.463 1465.59,789.003 1467.94,859.892 1470.29,921.332 1472.64,821.422 1474.99,1050.31 1477.34,940.889 1479.69,958.697 1482.04,870.87 1484.39,871.745 1486.74,898.645 1489.1,931.662 1491.45,968.207 1493.8,871.156 1496.15,667.624 1498.5,913.639 1500.85,838.263 1503.2,846.519 1505.55,1177.8 1507.9,945.98 1510.25,992.392 1512.6,799.205 1514.95,812.411 1517.3,945.166 1519.65,862.939 1522,1102 1524.35,1009.75 1526.7,989.358 1529.05,920.99 1531.4,869.92 1533.75,837.413 1536.1,881.238 1538.45,871.69 1540.81,1058.11 1543.16,754.729 1545.51,704.248 1547.86,814.528 1550.21,650.775 1552.56,925.111 1554.91,806.193 1557.26,937.318 1559.61,993.734 1561.96,806.565 1564.31,934.714 1566.66,838.998 1569.01,953.037 1571.36,927.169 1573.71,858.151 1576.06,956.704 1578.41,1019.3 1580.76,1027.97 1583.11,1006.77 1585.46,900.553 1587.81,1035.46 1590.17,731.745 1592.52,922.554 1594.87,982.951 1597.22,742.062 1599.57,948.223 1601.92,883.692 1604.27,1025.76 1606.62,1061.47 1608.97,891.626 1611.32,749.179 1613.67,792.353 1616.02,900.643 1618.37,947.839 1620.72,1115.37 1623.07,1011.22 1625.42,995.147 1627.77,1082.93 1630.12,806.407 1632.47,717.152 1634.82,930.675 1637.17,770.037 1639.53,962.714 1641.88,950.423 1644.23,759.08 1646.58,886.453 1648.93,727.667 1651.28,826.253 1653.63,864.991 1655.98,991.036 1658.33,929.538 1660.68,783.841 1663.03,717.796 1665.38,758.441 1667.73,870.752 1670.08,939.207 1672.43,955.547 1674.78,992.043 1677.13,953.305 1679.48,856.12 1681.83,942.092 1684.18,1134.79 1686.53,814.413 1688.89,890.172 1691.24,1027.83 1693.59,1182.74 1695.94,971.038 1698.29,1022.35 1700.64,977.798 1702.99,965.544 1705.34,813.498 1707.69,936.246 1710.04,692.597 1712.39,925.831 1714.74,1044.76 1717.09,893.751 1719.44,898.489 1721.79,791.491 1724.14,825.716 1726.49,946.807 1728.84,932.042 1731.19,754.045 1733.54,985.131 1735.89,830.472 1738.25,1022.24 1740.6,870.893 1742.95,926.504 1745.3,904.443 1747.65,902.347 1750,804.989 1752.35,931.327 1754.7,821.411 1757.05,955.576 1759.4,750.095 1761.75,888.693 1764.1,925.387 1766.45,924.91 1768.8,968.41 1771.15,938.523 1773.5,774.043 1775.85,881.985 1778.2,930.191 1780.55,896.197 1782.9,908.177 1785.25,896.308 1787.6,940.451 1789.96,1024.71 1792.31,957.226 1794.66,896.625 1797.01,820.434 1799.36,903.202 1801.71,948.651 1804.06,1055.03 1806.41,1055.16 1808.76,1105.77 1811.11,1101.25 1813.46,959.884 1815.81,935.27 1818.16,982.875 1820.51,895.587 1822.86,941.222 1825.21,950.981 1827.56,824.127 1829.91,903.291 1832.26,889.987 1834.61,947.147 1836.96,1088.63 1839.32,972.553 1841.67,1187.66 1844.02,892.926 1846.37,1000.32 1848.72,739.709 1851.07,696.56 1853.42,935.622 1855.77,922.549 1858.12,999.215 1860.47,974.361 1862.82,974.651 1865.17,736.059 1867.52,624.33 1869.87,866.509 1872.22,988.142 1874.57,938.237 1876.92,833.897 1879.27,947.181 1881.62,793.238 1883.97,975.872 1886.32,899.137 1888.68,900.65 1891.03,832.33 1893.38,856.315 1895.73,810.728 1898.08,1056.4 1900.43,752.963 1902.78,1002.97 1905.13,783.868 1907.48,909.921 1909.83,879.095 1912.18,1025.49 1914.53,923.838 1916.88,865.377 1919.23,1068.22 1921.58,773.6 1923.93,760.716 1926.28,1000.26 1928.63,974.613 1930.98,978.828 1933.33,949.584 1935.68,1164.53 1938.04,1041.52 1940.39,1036.47 1942.74,938.969 1945.09,799.866 1947.44,920.772 1949.79,975.997 1952.14,910.278 1954.49,930.485 1956.84,823.044 1959.19,1138.84 1961.54,963.651 1963.89,1044.87 1966.24,874.068 1968.59,976.478 1970.94,925.742 1973.29,719.501 1975.64,941.089 1977.99,842.716 1980.34,979.218 1982.69,1076.53 1985.04,866.082 1987.4,811.271 1989.75,1110.88 1992.1,967.121 1994.45,982.121 1996.8,927.133 1999.15,827.979 2001.5,700.542 2003.85,1011.53 2006.2,973.773 2008.55,891.049 2010.9,1008.26 2013.25,837.918 2015.6,1017.65 2017.95,848.412 2020.3,815.349 2022.65,951.091 2025,883.767 2027.35,1184.2 2029.7,956.296 2032.05,773.552 2034.4,811.372 2036.76,767.113 2039.11,905.655 2041.46,781.102 2043.81,1180.58 2046.16,781.082 2048.51,855.886 2050.86,911.502 2053.21,837.799 2055.56,757.904 2057.91,970.992 2060.26,812.534 2062.61,1029.72 2064.96,830.641 2067.31,791.521 2069.66,817.313 2072.01,953.926 2074.36,933.887 2076.71,778.677 2079.06,995.313 2081.41,938.212 2083.76,960.352 2086.11,948.198 2088.47,910.836 2090.82,991.494 2093.17,960.851 2095.52,873.295 2097.87,705.003 2100.22,944.692 2102.57,908.167 2104.92,921.981 2107.27,791.612 2109.62,818.617 2111.97,679.897 2114.32,1094.92 2116.67,991.175 2119.02,764.5 2121.37,836.904 2123.72,951.135 2126.07,829.075 2128.42,832.7 2130.77,809.259 2133.12,983.256 2135.47,953.946 2137.83,1032.33 2140.18,882.574 2142.53,937.9 2144.88,841.454 2147.23,1063.45 2149.58,1074.16 2151.93,895.141 2154.28,754.056 2156.63,1011.5 2158.98,967.887 2161.33,985.443 2163.68,1185.28 2166.03,750.221 2168.38,835.868 2170.73,938.771 2173.08,803.724 2175.43,965.93 2177.78,930.298 2180.13,990.594 2182.48,957.119 2184.83,963.217 2187.19,1151.01 2189.54,1070.44 2191.89,978.647 2194.24,876.279 2196.59,964.264 2198.94,1087.65 2201.29,908.064 2203.64,805.777 2205.99,1124.58 2208.34,834.068 2210.69,1074.75 2213.04,936.719 2215.39,740.053 2217.74,965.932 2220.09,1088.07 2222.44,939.421 2224.79,975.666 2227.14,908.183 2229.49,1100.49 2231.84,989.113 2234.19,963.014 2236.55,971.136 2238.9,1012.1 2241.25,954.544 2243.6,876.231 2245.95,897.187 2248.3,857.5 2250.65,973.163 2253,1016.41 2255.35,1056.31 2257.7,937.688 2260.05,1042.12 2262.4,1056.04 2264.75,841.228 2267.1,1052.21 2269.45,918.1 2271.8,1098.95 2274.15,621.588 2276.5,787.558 2278.85,932.489 2281.2,942.684 2283.55,834.007 2285.91,956.97 2288.26,849.295 2290.61,1079.07 2292.96,986.213 2295.31,839.396 2297.66,975.815 2300.01,972.449 2302.36,1030.1 2304.71,1015.99 2307.06,1074.82 2309.41,884.945 2311.76,832.185 2314.11,968.658 2316.46,966.634 2318.81,966.372 2321.16,1091.08 2323.51,1022.36 2325.86,657.798 2328.21,952.576 2330.56,864.51 2332.91,772.338 2335.27,1061.97 2337.62,860.234 2339.97,922.557 2342.32,921.154 2344.67,907.38 2347.02,1043.05 2349.37,914.266 2351.72,944.595 2354.07,1001.9 2356.42,794.913 2358.77,966.941 2361.12,869.208 2363.47,942.517 2365.82,886.938 2368.17,816.16 2370.52,1008.35 2372.87,1120.61 2375.22,1000.26 2377.57,959.72 2379.92,970.835 2382.27,1107.84 2384.62,936.964 2386.98,912.874 2389.33,1051.49 2391.68,867.379 2394.03,1003.99 2396.38,913.112 2398.73,918.899 2401.08,930.3 2403.43,817.172 2405.78,1123.57 2408.13,951.519 2410.48,830.751 2412.83,957.309 2415.18,876.414 2417.53,782.176 2419.88,821.329 2422.23,805.246 2424.58,742.762 2426.93,914 2429.28,1003.9 2431.63,841.644 2433.98,985.438 2436.34,826.329 2438.69,1008.42 2441.04,1044.74 2443.39,988.558 2445.74,865.323 2448.09,855.826 2450.44,925.345 2452.79,905.203 2455.14,932.689 2457.49,1052.64 2459.84,872.437 2462.19,1012.89 2464.54,1014.78 2466.89,818.799 2469.24,879.29 2471.59,911.264 2473.94,964.869 2476.29,1019.23 2478.64,1015 2480.99,914.411 2483.34,707.781 2485.7,879.423 2488.05,839.592 2490.4,1079.1 2492.75,797.672 2495.1,911.003 2497.45,922.608 2499.8,901.326 2502.15,1147.91 2504.5,867.125 2506.85,773.438 2509.2,890.037 2511.55,1070.45 2513.9,932.547 2516.25,839.639 2518.6,836.899 2520.95,794.781 2523.3,889.045 2525.65,1050.16 2528,1138.48 2530.35,799.703 2532.7,1001.99 2535.06,898.987 2537.41,1213.98 2539.76,931.07 2542.11,978.745 2544.46,719.976 2546.81,747.017 2549.16,1058.75 2551.51,1027.44 2553.86,965.408 2556.21,865.351 2558.56,943.597 2560.91,991.226 2563.26,805.835 2565.61,733.844 2567.96,1033.27 2570.31,907.31 "></polyline>
<polyline clip-path="url(#clip832)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,708.51 224.541,436.993 226.891,302.94 229.242,587.742 231.592,475.847 233.943,152.926 236.293,586.175 238.644,503.409 240.994,204.966 243.345,254.759 245.695,387.837 248.046,507.206 250.396,361.707 252.747,343.949 255.097,237.393 257.448,253.519 259.798,424.553 262.148,493.713 264.499,380.696 266.849,371.796 269.2,334.019 271.55,346.926 273.901,229.428 276.251,330.046 278.602,389.339 280.952,429.335 283.303,336.004 285.653,427.538 288.004,356.703 290.354,307.416 292.705,367.053 295.055,345.055 297.406,750.885 299.756,507.595 302.107,414.662 304.457,414.989 306.807,397.945 309.158,251.859 311.508,367.399 313.859,401.36 316.209,339.751 318.56,231.188 320.91,353.837 323.261,334.344 325.611,561.538 327.962,352.555 330.312,335.623 332.663,311.502 335.013,275.264 337.364,378.27 339.714,499.485 342.065,551.698 344.415,329.522 346.765,337.424 349.116,295.686 351.466,621.637 353.817,437.798 356.167,682.573 358.518,553.668 360.868,279.616 363.219,524.938 365.569,407.333 367.92,527.708 370.27,416.301 372.621,258.699 374.971,363.38 377.322,687.4 379.672,479.729 382.023,170.509 384.373,336.086 386.724,572.076 389.074,593.81 391.424,223.261 393.775,345.545 396.125,433.973 398.476,515.425 400.826,309.927 403.177,96.8724 405.527,314.178 407.878,553.423 410.228,225.573 412.579,362.085 414.929,235.753 417.28,271.82 419.63,426.71 421.981,276.643 424.331,325.743 426.682,296.988 429.032,438.613 431.382,378.251 433.733,435.996 436.083,268.752 438.434,119.485 440.784,523.649 443.135,435.515 445.485,481.492 447.836,212.187 450.186,383.957 452.537,462.52 454.887,269.831 457.238,431.343 459.588,264.671 461.939,278.182 464.289,467.788 466.64,148.636 468.99,370.355 471.341,190.822 473.691,481.999 476.041,495.386 478.392,408.885 480.742,368.81 483.093,376.111 485.443,554.13 487.794,277.334 490.144,510.951 492.495,249.916 494.845,431.593 497.196,356.049 499.546,569.009 501.897,495.973 504.247,440.787 506.598,413.602 508.948,476.608 511.299,301.472 513.649,411.863 515.999,285.145 518.35,397.243 520.7,453.703 523.051,330.429 525.401,435.023 527.752,401.282 530.102,459.322 532.453,363.712 534.803,465.136 537.154,379.734 539.504,434.398 541.855,511.298 544.205,501.51 546.556,402.925 548.906,502.053 551.257,354.095 553.607,348.737 555.958,431.84 558.308,319.3 560.658,571.094 563.009,378.923 565.359,394.622 567.71,505.187 570.06,383.071 572.411,360.799 574.761,334.054 577.112,303.259 579.462,342.144 581.813,433.795 584.163,426.796 586.514,338.694 588.864,635.59 591.215,539.238 593.565,333.419 595.916,343.828 598.266,489.684 600.616,547.291 602.967,466.809 605.317,406.291 607.668,323.917 610.018,346.286 612.369,556.143 614.719,422.145 617.07,480.438 619.42,386.548 621.771,449.934 624.121,250.445 626.472,360.412 628.822,486.086 631.173,556.306 633.523,384.424 635.874,355.63 638.224,416.41 640.575,421.397 642.925,540.203 645.275,444.696 647.626,444.036 649.976,412.576 652.327,466.813 654.677,385.279 657.028,276.166 659.378,436.966 661.729,596.223 664.079,267.228 666.43,293.435 668.78,360.22 671.131,317.902 673.481,502.946 675.832,412.847 678.182,499.79 680.533,398.836 682.883,386.652 685.233,157.568 687.584,307.398 689.934,420.244 692.285,486.962 694.635,440.615 696.986,249.372 699.336,490.931 701.687,320.418 704.037,451.849 706.388,327.774 708.738,329.883 711.089,243.77 713.439,392.948 715.79,282.97 718.14,548.504 720.491,459.198 722.841,257.598 725.192,444.204 727.542,471.86 729.892,483.179 732.243,340.057 734.593,397.413 736.944,376.815 739.294,472.051 741.645,316.064 743.995,470.739 746.346,441.763 748.696,540.26 751.047,297.478 753.397,361.787 755.748,520.808 758.098,422.165 760.449,329.06 762.799,397.219 765.15,390.649 767.5,493.695 769.85,321.452 772.201,547.473 774.551,419.014 776.902,421.691 779.252,413.247 781.603,322.982 783.953,628.427 786.304,346.671 788.654,500.213 791.005,420.671 793.355,442.075 795.706,489.589 798.056,429.938 800.407,376.157 802.757,334.636 805.108,332.602 807.458,411.61 809.809,446.576 812.159,517.022 814.509,460.027 816.86,575.303 819.21,418.616 821.561,416.077 823.911,372.723 826.262,330.448 828.612,440.112 830.963,348.381 833.313,468.301 835.664,433.523 838.014,415.491 840.365,301.187 842.715,520.461 845.066,432.378 847.416,441.075 849.767,384.647 852.117,334.023 854.467,371.166 856.818,441.207 859.168,585.895 861.519,487.427 863.869,511.596 866.22,451.942 868.57,504.218 870.921,391.436 873.271,630.104 875.622,458.808 877.972,346.914 880.323,330.655 882.673,587.554 885.024,416.857 887.374,392.688 889.725,385.154 892.075,467.875 894.426,380.283 896.776,306.764 899.126,394.323 901.477,439.864 903.827,384.528 906.178,319.827 908.528,498.519 910.879,442.797 913.229,426.831 915.58,408.099 917.93,446.193 920.281,402.483 922.631,385.754 924.982,497.154 927.332,401.757 929.683,531.266 932.033,219.697 934.384,537.216 936.734,278.621 939.084,270.88 941.435,395.696 943.785,324.845 946.136,570.175 948.486,363.729 950.837,367.301 953.187,537.475 955.538,375.03 957.888,394.158 960.239,468.297 962.589,481.397 964.94,592.988 967.29,225.034 969.641,382.329 971.991,285.475 974.342,456.738 976.692,416.283 979.043,564.683 981.393,318.533 983.743,472.677 986.094,578.037 988.444,495.356 990.795,433.17 993.145,383.981 995.496,325.686 997.846,539.267 1000.2,235.454 1002.55,521.017 1004.9,494.237 1007.25,318.843 1009.6,501.932 1011.95,367.241 1014.3,455.318 1016.65,558.577 1019,305.864 1021.35,321.221 1023.7,444.053 1026.05,299.023 1028.4,487.302 1030.75,306.106 1033.1,471.166 1035.45,244.056 1037.8,339.692 1040.15,414.186 1042.51,430.602 1044.86,258.982 1047.21,328.259 1049.56,535.555 1051.91,488.147 1054.26,298.502 1056.61,494.065 1058.96,331.334 1061.31,395.453 1063.66,466.278 1066.01,374.113 1068.36,448.417 1070.71,378.358 1073.06,556.274 1075.41,404.714 1077.76,356.357 1080.11,418.756 1082.46,504.545 1084.81,254.937 1087.16,515.524 1089.51,480.176 1091.87,475.409 1094.22,527.463 1096.57,571.653 1098.92,453.5 1101.27,398.947 1103.62,435.092 1105.97,177.969 1108.32,368.227 1110.67,459.265 1113.02,520.925 1115.37,320.937 1117.72,338.623 1120.07,595.781 1122.42,522.202 1124.77,398.185 1127.12,516.615 1129.47,445.401 1131.82,407.963 1134.17,230.196 1136.52,430.967 1138.87,356.706 1141.23,296.38 1143.58,629.876 1145.93,408.891 1148.28,445.46 1150.63,445.667 1152.98,210.311 1155.33,206.405 1157.68,408.56 1160.03,384.944 1162.38,310.669 1164.73,375.862 1167.08,374.19 1169.43,326.945 1171.78,360.741 1174.13,411.044 1176.48,521.133 1178.83,478.84 1181.18,326.797 1183.53,143.092 1185.88,321.725 1188.23,458.02 1190.59,350.189 1192.94,387.834 1195.29,445.172 1197.64,329.85 1199.99,293.065 1202.34,371.466 1204.69,234.59 1207.04,291.812 1209.39,364.618 1211.74,344.133 1214.09,376.441 1216.44,582.022 1218.79,476.368 1221.14,450.286 1223.49,431.991 1225.84,382.194 1228.19,536.5 1230.54,273.502 1232.89,362.177 1235.24,467.336 1237.59,348.664 1239.94,509.034 1242.3,504.697 1244.65,464.417 1247,440.302 1249.35,475.347 1251.7,505 1254.05,604.306 1256.4,314.749 1258.75,347.492 1261.1,377.171 1263.45,594.803 1265.8,468.066 1268.15,396.102 1270.5,205.051 1272.85,505.099 1275.2,714.463 1277.55,391.741 1279.9,278.911 1282.25,421.162 1284.6,271.264 1286.95,648.11 1289.3,443.229 1291.66,329.831 1294.01,352.452 1296.36,202.121 1298.71,331.631 1301.06,535.527 1303.41,532.709 1305.76,389.031 1308.11,373.799 1310.46,313.409 1312.81,224.649 1315.16,382.158 1317.51,126.277 1319.86,421.098 1322.21,514.97 1324.56,557.112 1326.91,398.308 1329.26,508.791 1331.61,383.878 1333.96,336.36 1336.31,432.224 1338.66,504.748 1341.02,451.203 1343.37,438.554 1345.72,393.366 1348.07,326.873 1350.42,385.433 1352.77,493.334 1355.12,453.605 1357.47,237.353 1359.82,390.866 1362.17,478.352 1364.52,367.05 1366.87,599.008 1369.22,268.56 1371.57,467.083 1373.92,509.677 1376.27,559.81 1378.62,428.011 1380.97,344.822 1383.32,390.953 1385.67,484.526 1388.02,339.733 1390.38,428.077 1392.73,444.822 1395.08,428.119 1397.43,527.885 1399.78,399.405 1402.13,304.515 1404.48,310.113 1406.83,242.239 1409.18,303.626 1411.53,502.711 1413.88,371.768 1416.23,401.181 1418.58,610.711 1420.93,523.269 1423.28,222.885 1425.63,257.159 1427.98,393.763 1430.33,418.323 1432.68,227.249 1435.03,316.586 1437.38,446.001 1439.74,507.528 1442.09,338.074 1444.44,451.758 1446.79,420.475 1449.14,438.757 1451.49,263.446 1453.84,312.944 1456.19,558.787 1458.54,387.148 1460.89,384.951 1463.24,375.73 1465.59,441.114 1467.94,475.039 1470.29,518.025 1472.64,578.68 1474.99,270.986 1477.34,545.18 1479.69,289.549 1482.04,451.454 1484.39,329.348 1486.74,479.146 1489.1,416.662 1491.45,301.495 1493.8,440.163 1496.15,577.035 1498.5,674.204 1500.85,428.806 1503.2,546.729 1505.55,303.792 1507.9,266.361 1510.25,313.55 1512.6,326.255 1514.95,448.932 1517.3,233.103 1519.65,471.034 1522,432.035 1524.35,456.475 1526.7,389.191 1529.05,370.89 1531.4,376.813 1533.75,415.548 1536.1,218.153 1538.45,500.653 1540.81,388.605 1543.16,531.911 1545.51,387.111 1547.86,305.511 1550.21,383.114 1552.56,314.961 1554.91,619.588 1557.26,594.735 1559.61,352.137 1561.96,289.426 1564.31,388.414 1566.66,479.896 1569.01,355.469 1571.36,473.257 1573.71,495.834 1576.06,341.248 1578.41,455.068 1580.76,370.424 1583.11,424.348 1585.46,271.969 1587.81,394.286 1590.17,368.639 1592.52,587.125 1594.87,387.505 1597.22,384.349 1599.57,511.847 1601.92,280.922 1604.27,425.459 1606.62,311.618 1608.97,427.527 1611.32,300.742 1613.67,383.412 1616.02,302.433 1618.37,284.85 1620.72,429.041 1623.07,286.387 1625.42,542.123 1627.77,360.267 1630.12,285.186 1632.47,242.451 1634.82,524.512 1637.17,256.619 1639.53,388.459 1641.88,357.297 1644.23,431.117 1646.58,358.278 1648.93,330.746 1651.28,310.627 1653.63,697.999 1655.98,275.195 1658.33,358.874 1660.68,178.083 1663.03,288.332 1665.38,475.801 1667.73,255.058 1670.08,443.033 1672.43,445.048 1674.78,414.239 1677.13,558.589 1679.48,622.094 1681.83,489.752 1684.18,404.014 1686.53,387.67 1688.89,203.507 1691.24,511.025 1693.59,550.316 1695.94,346.145 1698.29,376.852 1700.64,474.516 1702.99,463.488 1705.34,202.674 1707.69,275.331 1710.04,286.737 1712.39,130.386 1714.74,397.663 1717.09,473.044 1719.44,322.754 1721.79,421.516 1724.14,461.935 1726.49,429.832 1728.84,451.964 1731.19,435.719 1733.54,417.658 1735.89,224.464 1738.25,321.582 1740.6,447.926 1742.95,297.241 1745.3,415.55 1747.65,354.136 1750,495.236 1752.35,337.193 1754.7,319.637 1757.05,259.683 1759.4,251.966 1761.75,479.995 1764.1,316.728 1766.45,222.752 1768.8,403.682 1771.15,537.634 1773.5,422.244 1775.85,140.994 1778.2,250.666 1780.55,635.106 1782.9,317.029 1785.25,321.871 1787.6,363.114 1789.96,570.14 1792.31,474.609 1794.66,352.287 1797.01,388.564 1799.36,441.637 1801.71,367.045 1804.06,205.769 1806.41,399.082 1808.76,301.561 1811.11,402.087 1813.46,359.264 1815.81,508.961 1818.16,240.722 1820.51,515.23 1822.86,392.496 1825.21,440.507 1827.56,374.109 1829.91,496.881 1832.26,503.375 1834.61,547.997 1836.96,525.4 1839.32,341.715 1841.67,261.695 1844.02,472.952 1846.37,325.696 1848.72,369.159 1851.07,576.335 1853.42,226.193 1855.77,305.064 1858.12,303.662 1860.47,363.01 1862.82,381.871 1865.17,431.176 1867.52,357.358 1869.87,444.607 1872.22,485.307 1874.57,361.76 1876.92,366.65 1879.27,285.702 1881.62,287.737 1883.97,522.043 1886.32,438.611 1888.68,191.807 1891.03,462.443 1893.38,476.723 1895.73,485.441 1898.08,528.392 1900.43,342.744 1902.78,197.155 1905.13,616.771 1907.48,370.319 1909.83,490.411 1912.18,549.079 1914.53,252.081 1916.88,393.74 1919.23,185.247 1921.58,481.453 1923.93,306.494 1926.28,346.952 1928.63,411.153 1930.98,319.117 1933.33,289.586 1935.68,250.514 1938.04,398.448 1940.39,193.983 1942.74,283.928 1945.09,401.679 1947.44,460.035 1949.79,388.989 1952.14,204.835 1954.49,380.844 1956.84,424.072 1959.19,320.342 1961.54,352.276 1963.89,280.308 1966.24,497.709 1968.59,537.679 1970.94,411.885 1973.29,238.699 1975.64,270.646 1977.99,483.172 1980.34,409.672 1982.69,360.501 1985.04,368.923 1987.4,489.699 1989.75,445.579 1992.1,494.561 1994.45,298.041 1996.8,484.92 1999.15,433.271 2001.5,448.254 2003.85,449.277 2006.2,265.424 2008.55,286.076 2010.9,204.038 2013.25,573.936 2015.6,280.335 2017.95,327.885 2020.3,330.423 2022.65,443.185 2025,344.425 2027.35,485.973 2029.7,382.019 2032.05,429.18 2034.4,634.992 2036.76,446.254 2039.11,536.036 2041.46,486.695 2043.81,336.079 2046.16,411.861 2048.51,500.546 2050.86,364.237 2053.21,467.877 2055.56,517.807 2057.91,542.439 2060.26,340.928 2062.61,516.689 2064.96,611.868 2067.31,238.306 2069.66,397.269 2072.01,225.263 2074.36,324 2076.71,571.082 2079.06,282.136 2081.41,291.716 2083.76,310.222 2086.11,291.886 2088.47,355.403 2090.82,373.959 2093.17,286.807 2095.52,586.618 2097.87,424.172 2100.22,453.084 2102.57,425.95 2104.92,398.329 2107.27,185.753 2109.62,322.746 2111.97,341.338 2114.32,287.668 2116.67,466.752 2119.02,385.333 2121.37,317.744 2123.72,349.193 2126.07,501.092 2128.42,282.043 2130.77,355.386 2133.12,556.409 2135.47,335.478 2137.83,225.194 2140.18,416.32 2142.53,557.38 2144.88,352.617 2147.23,452.954 2149.58,419.811 2151.93,359.671 2154.28,378.371 2156.63,443.024 2158.98,418.804 2161.33,494.428 2163.68,318.043 2166.03,358.88 2168.38,532.379 2170.73,388.731 2173.08,425.939 2175.43,545.704 2177.78,240.505 2180.13,282.459 2182.48,466.034 2184.83,546.892 2187.19,417.407 2189.54,537.087 2191.89,451.06 2194.24,510.19 2196.59,362.489 2198.94,315.319 2201.29,506.549 2203.64,549.948 2205.99,247.971 2208.34,423.639 2210.69,473.791 2213.04,361.167 2215.39,482.474 2217.74,436.561 2220.09,559.561 2222.44,597.709 2224.79,294.058 2227.14,436.616 2229.49,344.837 2231.84,186.93 2234.19,224.863 2236.55,293.141 2238.9,494.256 2241.25,358.557 2243.6,532.653 2245.95,315.504 2248.3,382.786 2250.65,418.838 2253,514.408 2255.35,172.038 2257.7,419.687 2260.05,565.461 2262.4,333.793 2264.75,541.706 2267.1,428.099 2269.45,367.477 2271.8,408.052 2274.15,527.517 2276.5,384.468 2278.85,382.571 2281.2,319.159 2283.55,246.72 2285.91,325.831 2288.26,266.516 2290.61,443.244 2292.96,401.679 2295.31,457.096 2297.66,462.793 2300.01,396.925 2302.36,426.097 2304.71,488.76 2307.06,408.688 2309.41,513.124 2311.76,465.858 2314.11,318.064 2316.46,337.114 2318.81,406.734 2321.16,524.005 2323.51,477.113 2325.86,490.385 2328.21,202.298 2330.56,423.869 2332.91,349.032 2335.27,464.515 2337.62,325.208 2339.97,585.787 2342.32,529.979 2344.67,452.069 2347.02,441.461 2349.37,388.407 2351.72,316.588 2354.07,506.346 2356.42,368.351 2358.77,392.947 2361.12,417.806 2363.47,399.765 2365.82,448.24 2368.17,464.9 2370.52,278.338 2372.87,189.907 2375.22,290.925 2377.57,323.592 2379.92,468.996 2382.27,527.28 2384.62,392.074 2386.98,479.455 2389.33,410.494 2391.68,386.595 2394.03,326.016 2396.38,444.957 2398.73,546.634 2401.08,248.884 2403.43,204.849 2405.78,439.182 2408.13,409.46 2410.48,270.492 2412.83,460.172 2415.18,441.328 2417.53,394.391 2419.88,485.284 2422.23,303.685 2424.58,234.564 2426.93,357.13 2429.28,352.857 2431.63,371.036 2433.98,380.785 2436.34,558.217 2438.69,293.707 2441.04,623.145 2443.39,414.038 2445.74,344.839 2448.09,234.374 2450.44,470.491 2452.79,215.891 2455.14,240.946 2457.49,147.757 2459.84,510.346 2462.19,580.427 2464.54,401.566 2466.89,226.236 2469.24,494.295 2471.59,266.562 2473.94,576.084 2476.29,702.271 2478.64,399.054 2480.99,614.505 2483.34,536.042 2485.7,422.466 2488.05,471.804 2490.4,418.599 2492.75,370.03 2495.1,275.639 2497.45,449.094 2499.8,267.191 2502.15,556.511 2504.5,368.222 2506.85,512.734 2509.2,362.381 2511.55,480.731 2513.9,345.686 2516.25,440.848 2518.6,405.835 2520.95,500.935 2523.3,429.833 2525.65,344.327 2528,644.305 2530.35,388.327 2532.7,444.603 2535.06,428.425 2537.41,422.195 2539.76,364.205 2542.11,283.419 2544.46,344.005 2546.81,389.054 2549.16,330.369 2551.51,529.765 2553.86,436.38 2556.21,503.455 2558.56,459.888 2560.91,409.167 2563.26,209.983 2565.61,382.612 2567.96,514.557 2570.31,443.267 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -1.4762    -3.06931   -4.55276  …  -5.36012   -5.92784   -5.63522
 -0.130254  -0.318184   1.05683     -0.633289  -0.859246   0.922049
  3.62955    5.06513    4.89465      6.39727    5.26716    4.40155

[:, :, 2] =
 -3.26527  -2.33719   -3.511      …  -4.33903  -3.73813   -3.73813
 -1.16925  -0.316287   0.0290007     -0.3016    0.331952   0.331952
  4.78265   4.27117    3.83592        5.18395   4.48624    4.48624

[:, :, 3] =
 -2.5654   -4.63433  -5.63225   -3.39096   …  -4.24474   -3.70897  -3.86115
  2.0969    2.5345   -0.106067   0.722294      0.879964  -1.69087  -1.28242
  1.72276   1.61441   3.54756    5.16394       5.77245    4.7817    4.83318

[:, :, 4] =
 -2.34845  -4.39869   -3.52679  -3.83228   …  -5.70409  -4.55199   -4.37582
 -1.2977    0.280261   1.31037  -0.510402      1.39811  -0.686937   0.0214247
  3.52636   5.52615    6.09024   5.87876       6.57393   6.12381    3.50758</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.96255    1.00695
  0.0236237  0.98585
  4.98519    0.996628</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.62 seconds
Compute duration  = 2.62 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -4.9698    0.9969    0.0176   3197.8027   5353.4159    0.9999   ⋯
        x[2]   -0.0252    1.0221    0.0189   2914.0057   4581.6965    1.0000   ⋯
        x[3]    5.0200    1.0072    0.0179   3167.8531   5029.5930    1.0000   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.9281   -5.6399   -4.9671   -4.3127   -3.0040
        x[2]   -2.0158   -0.7181   -0.0302    0.6727    2.0020
        x[3]    3.0012    4.3493    5.0256    5.6911    6.9678</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.56 seconds
Compute duration  = 1.56 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.5028    0.1874    0.0028   4444.5868   5814.1519    1.0001   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1488    0.3645    0.5038    0.6422    0.8449</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.25 seconds
Compute duration  = 0.25 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk   ess_tail      rhat    ⋯
      Symbol   Float64   Float64   Float64     Float64    Float64   Float64    ⋯

           x    0.9968    0.0340    0.0009   1543.6625        NaN    1.0005    ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.9976    0.9976    0.9976    0.9976    0.9976</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(-0.5261411146662405, "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with -0.5261411146662405:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/nmUhn/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/nmUhn/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/compiler.jl:579 [inlined]
  [7] demo(__model__::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, __varinfo__::DynamicPPL.ThreadSafeVarInfo{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, Vector{Base.RefValue{Float64}}}, __context__::DynamicPPL.ValuesAsInModelContext{OrderedDict{Any, Any}, DynamicPPL.DefaultContext})
    @ Main.Notebook ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:593
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:973 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, context::DynamicPPL.ValuesAsInModelContext{OrderedDict{Any, Any}, DynamicPPL.DefaultContext})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:962
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/model.jl:892 [inlined]
 [11] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/values_as_in_model.jl:196 [inlined]
 [12] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/values_as_in_model.jl:195 [inlined]
 [13] getparams(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64})
    @ Turing.Inference ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:343
 [14] Turing.Inference.Transition(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, t::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:226
 [15] transition_to_turing
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:12 [inlined]
 [16] transition_to_turing(f::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, transition::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:17
 [17] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}; initial_state::Nothing, initial_params::Nothing, kwargs::@Kwargs{})
    @ Turing.Inference ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:141
 [18] step
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/abstractmcmc.jl:96 [inlined]
 [19] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:130 [inlined]
 [20] macro expansion
    @ ~/.julia/packages/AbstractMCMC/YrmkI/src/logging.jl:16 [inlined]
 [21] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/YrmkI/src/sample.jl:120
 [22] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/MjWTB/src/sampler.jl:93
 [23] sample
    @ ~/.julia/packages/DynamicPPL/MjWTB/src/sampler.jl:83 [inlined]
 [24] #sample#4
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:276 [inlined]
 [25] sample
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:267 [inlined]
 [26] #sample#3
    @ ~/.julia/packages/Turing/Bv30p/src/mcmc/Inference.jl:264 [inlined]
 [27] top-level scope
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:595</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.7 seconds
Compute duration  = 1.7 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²   10.3232    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x    1.1695    0.0000    0.0000        NaN        NaN       NaN     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²   10.3232   10.3232   10.3232   10.3232   10.3232
           x    1.1695    1.1695    1.1695    1.1695    1.1695</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.14 seconds
Compute duration  = 3.14 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.9090    0.6632    0.0521   182.3250   112.8095    1.0073     ⋯
           x   -0.0203    1.0739    0.0749   276.6466   136.3303    1.0046     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1041    0.3840    0.7748    1.2673    2.6736
           x   -2.7138   -0.3878    0.0086    0.4155    2.4400</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>