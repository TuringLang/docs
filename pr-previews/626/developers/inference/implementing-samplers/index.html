<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing Samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../developers/inference/variational-inference/index.html" rel="prev">
<link href="../../../assets/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-2fef5ea3f8957b3e4ecc936fc74692ca.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-8ca65573be89ab5a614a0758d6e79fa7.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-e4bf857d3af38d284e31ad2f58e22145.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../../site_libs/bootstrap/bootstrap-8ca65573be89ab5a614a0758d6e79fa7.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../tutorials/coin-flipping/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.39" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.39</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.39">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/variational-inference/index.html">Inference in Detail</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../core-functionality/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">User Guide</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/automatic-differentiation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/tracking-extra-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tracking Extra Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/sampler-visualisation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/troubleshooting/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Troubleshooting</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/coin-flipping/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-neural-networks/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/hidden-markov-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/infinite-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-time-series-analysis/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-processes-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Processes: Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-process-latent-variable-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contributing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL’s Compiler</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/design-overview/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design (Outdated)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL Contexts</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contexts/submodel-condition/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conditioning and fixing in submodels</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">Variable Transformations</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/distributions/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributions and the Jacobian</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/bijectors/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bijectors in MCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/dynamicppl/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variable transformations in DynamicPPL</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference in Detail</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/variational-inference/index.html">Inference in Detail</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing Samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-28.309853990037567</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-28.309853990037567</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -3.10423   -2.4511    -4.23342    …  -4.20401   -3.20144    -4.35675
 -0.359012   0.925479  -0.0603316      0.222843  -0.0503776   1.27521
  1.68509    2.20914    3.73094        6.21986    5.60282     6.18979</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.01344    0.990902
 -0.0142845  1.01214
  5.02029    0.992565</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip620">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip620)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip621">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip620)" d="M196.816 1800.78 L2640.76 1800.78 L2640.76 47.2441 L196.816 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip622">
    <rect x="196" y="47" width="2445" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip622)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="263.676,1800.78 263.676,47.2441 "></polyline>
<polyline clip-path="url(#clip622)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="840.654,1800.78 840.654,47.2441 "></polyline>
<polyline clip-path="url(#clip622)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1417.63,1800.78 1417.63,47.2441 "></polyline>
<polyline clip-path="url(#clip622)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1994.61,1800.78 1994.61,47.2441 "></polyline>
<polyline clip-path="url(#clip622)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2571.59,1800.78 2571.59,47.2441 "></polyline>
<polyline clip-path="url(#clip622)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1707.4 2640.76,1707.4 "></polyline>
<polyline clip-path="url(#clip622)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1456.23 2640.76,1456.23 "></polyline>
<polyline clip-path="url(#clip622)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1205.06 2640.76,1205.06 "></polyline>
<polyline clip-path="url(#clip622)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,953.889 2640.76,953.889 "></polyline>
<polyline clip-path="url(#clip622)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,702.72 2640.76,702.72 "></polyline>
<polyline clip-path="url(#clip622)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,451.55 2640.76,451.55 "></polyline>
<polyline clip-path="url(#clip622)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,200.38 2640.76,200.38 "></polyline>
<polyline clip-path="url(#clip620)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip620)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="263.676,1800.78 263.676,1781.88 "></polyline>
<polyline clip-path="url(#clip620)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="840.654,1800.78 840.654,1781.88 "></polyline>
<polyline clip-path="url(#clip620)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1417.63,1800.78 1417.63,1781.88 "></polyline>
<polyline clip-path="url(#clip620)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1994.61,1800.78 1994.61,1781.88 "></polyline>
<polyline clip-path="url(#clip620)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2571.59,1800.78 2571.59,1781.88 "></polyline>
<path clip-path="url(#clip620)" d="M263.676 1834 Q260.065 1834 258.236 1837.57 Q256.431 1841.11 256.431 1848.24 Q256.431 1855.34 258.236 1858.91 Q260.065 1862.45 263.676 1862.45 Q267.31 1862.45 269.116 1858.91 Q270.945 1855.34 270.945 1848.24 Q270.945 1841.11 269.116 1837.57 Q267.31 1834 263.676 1834 M263.676 1830.3 Q269.486 1830.3 272.542 1834.9 Q275.621 1839.49 275.621 1848.24 Q275.621 1856.96 272.542 1861.57 Q269.486 1866.15 263.676 1866.15 Q257.866 1866.15 254.787 1861.57 Q251.732 1856.96 251.732 1848.24 Q251.732 1839.49 254.787 1834.9 Q257.866 1830.3 263.676 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M804.346 1861.55 L820.666 1861.55 L820.666 1865.48 L798.721 1865.48 L798.721 1861.55 Q801.383 1858.79 805.967 1854.16 Q810.573 1849.51 811.754 1848.17 Q813.999 1845.65 814.879 1843.91 Q815.782 1842.15 815.782 1840.46 Q815.782 1837.71 813.837 1835.97 Q811.916 1834.23 808.814 1834.23 Q806.615 1834.23 804.161 1835 Q801.731 1835.76 798.953 1837.31 L798.953 1832.59 Q801.777 1831.46 804.231 1830.88 Q806.684 1830.3 808.721 1830.3 Q814.092 1830.3 817.286 1832.98 Q820.481 1835.67 820.481 1840.16 Q820.481 1842.29 819.67 1844.21 Q818.883 1846.11 816.777 1848.7 Q816.198 1849.37 813.096 1852.59 Q809.995 1855.78 804.346 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M830.527 1830.92 L848.883 1830.92 L848.883 1834.86 L834.809 1834.86 L834.809 1843.33 Q835.828 1842.98 836.846 1842.82 Q837.865 1842.64 838.883 1842.64 Q844.67 1842.64 848.05 1845.81 Q851.43 1848.98 851.43 1854.4 Q851.43 1859.97 847.957 1863.08 Q844.485 1866.15 838.166 1866.15 Q835.99 1866.15 833.721 1865.78 Q831.476 1865.41 829.069 1864.67 L829.069 1859.97 Q831.152 1861.11 833.374 1861.66 Q835.596 1862.22 838.073 1862.22 Q842.078 1862.22 844.416 1860.11 Q846.754 1858.01 846.754 1854.4 Q846.754 1850.78 844.416 1848.68 Q842.078 1846.57 838.073 1846.57 Q836.198 1846.57 834.323 1846.99 Q832.471 1847.4 830.527 1848.28 L830.527 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M870.642 1834 Q867.031 1834 865.203 1837.57 Q863.397 1841.11 863.397 1848.24 Q863.397 1855.34 865.203 1858.91 Q867.031 1862.45 870.642 1862.45 Q874.277 1862.45 876.082 1858.91 Q877.911 1855.34 877.911 1848.24 Q877.911 1841.11 876.082 1837.57 Q874.277 1834 870.642 1834 M870.642 1830.3 Q876.453 1830.3 879.508 1834.9 Q882.587 1839.49 882.587 1848.24 Q882.587 1856.96 879.508 1861.57 Q876.453 1866.15 870.642 1866.15 Q864.832 1866.15 861.754 1861.57 Q858.698 1856.96 858.698 1848.24 Q858.698 1839.49 861.754 1834.9 Q864.832 1830.3 870.642 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M1377.25 1830.92 L1395.61 1830.92 L1395.61 1834.86 L1381.53 1834.86 L1381.53 1843.33 Q1382.55 1842.98 1383.57 1842.82 Q1384.59 1842.64 1385.61 1842.64 Q1391.39 1842.64 1394.77 1845.81 Q1398.15 1848.98 1398.15 1854.4 Q1398.15 1859.97 1394.68 1863.08 Q1391.21 1866.15 1384.89 1866.15 Q1382.71 1866.15 1380.44 1865.78 Q1378.2 1865.41 1375.79 1864.67 L1375.79 1859.97 Q1377.88 1861.11 1380.1 1861.66 Q1382.32 1862.22 1384.8 1862.22 Q1388.8 1862.22 1391.14 1860.11 Q1393.48 1858.01 1393.48 1854.4 Q1393.48 1850.78 1391.14 1848.68 Q1388.8 1846.57 1384.8 1846.57 Q1382.92 1846.57 1381.05 1846.99 Q1379.19 1847.4 1377.25 1848.28 L1377.25 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M1417.37 1834 Q1413.75 1834 1411.93 1837.57 Q1410.12 1841.11 1410.12 1848.24 Q1410.12 1855.34 1411.93 1858.91 Q1413.75 1862.45 1417.37 1862.45 Q1421 1862.45 1422.81 1858.91 Q1424.63 1855.34 1424.63 1848.24 Q1424.63 1841.11 1422.81 1837.57 Q1421 1834 1417.37 1834 M1417.37 1830.3 Q1423.18 1830.3 1426.23 1834.9 Q1429.31 1839.49 1429.31 1848.24 Q1429.31 1856.96 1426.23 1861.57 Q1423.18 1866.15 1417.37 1866.15 Q1411.56 1866.15 1408.48 1861.57 Q1405.42 1856.96 1405.42 1848.24 Q1405.42 1839.49 1408.48 1834.9 Q1411.56 1830.3 1417.37 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M1447.53 1834 Q1443.92 1834 1442.09 1837.57 Q1440.28 1841.11 1440.28 1848.24 Q1440.28 1855.34 1442.09 1858.91 Q1443.92 1862.45 1447.53 1862.45 Q1451.16 1862.45 1452.97 1858.91 Q1454.8 1855.34 1454.8 1848.24 Q1454.8 1841.11 1452.97 1837.57 Q1451.16 1834 1447.53 1834 M1447.53 1830.3 Q1453.34 1830.3 1456.39 1834.9 Q1459.47 1839.49 1459.47 1848.24 Q1459.47 1856.96 1456.39 1861.57 Q1453.34 1866.15 1447.53 1866.15 Q1441.72 1866.15 1438.64 1861.57 Q1435.58 1856.96 1435.58 1848.24 Q1435.58 1839.49 1438.64 1834.9 Q1441.72 1830.3 1447.53 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M1952.89 1830.92 L1975.11 1830.92 L1975.11 1832.91 L1962.56 1865.48 L1957.68 1865.48 L1969.48 1834.86 L1952.89 1834.86 L1952.89 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M1984.27 1830.92 L2002.63 1830.92 L2002.63 1834.86 L1988.56 1834.86 L1988.56 1843.33 Q1989.58 1842.98 1990.59 1842.82 Q1991.61 1842.64 1992.63 1842.64 Q1998.42 1842.64 2001.8 1845.81 Q2005.18 1848.98 2005.18 1854.4 Q2005.18 1859.97 2001.7 1863.08 Q1998.23 1866.15 1991.91 1866.15 Q1989.74 1866.15 1987.47 1865.78 Q1985.22 1865.41 1982.82 1864.67 L1982.82 1859.97 Q1984.9 1861.11 1987.12 1861.66 Q1989.34 1862.22 1991.82 1862.22 Q1995.83 1862.22 1998.16 1860.11 Q2000.5 1858.01 2000.5 1854.4 Q2000.5 1850.78 1998.16 1848.68 Q1995.83 1846.57 1991.82 1846.57 Q1989.95 1846.57 1988.07 1846.99 Q1986.22 1847.4 1984.27 1848.28 L1984.27 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M2024.39 1834 Q2020.78 1834 2018.95 1837.57 Q2017.14 1841.11 2017.14 1848.24 Q2017.14 1855.34 2018.95 1858.91 Q2020.78 1862.45 2024.39 1862.45 Q2028.02 1862.45 2029.83 1858.91 Q2031.66 1855.34 2031.66 1848.24 Q2031.66 1841.11 2029.83 1837.57 Q2028.02 1834 2024.39 1834 M2024.39 1830.3 Q2030.2 1830.3 2033.26 1834.9 Q2036.33 1839.49 2036.33 1848.24 Q2036.33 1856.96 2033.26 1861.57 Q2030.2 1866.15 2024.39 1866.15 Q2018.58 1866.15 2015.5 1861.57 Q2012.45 1856.96 2012.45 1848.24 Q2012.45 1839.49 2015.5 1834.9 Q2018.58 1830.3 2024.39 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M2516.11 1861.55 L2523.75 1861.55 L2523.75 1835.18 L2515.44 1836.85 L2515.44 1832.59 L2523.71 1830.92 L2528.38 1830.92 L2528.38 1861.55 L2536.02 1861.55 L2536.02 1865.48 L2516.11 1865.48 L2516.11 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M2555.47 1834 Q2551.85 1834 2550.03 1837.57 Q2548.22 1841.11 2548.22 1848.24 Q2548.22 1855.34 2550.03 1858.91 Q2551.85 1862.45 2555.47 1862.45 Q2559.1 1862.45 2560.9 1858.91 Q2562.73 1855.34 2562.73 1848.24 Q2562.73 1841.11 2560.9 1837.57 Q2559.1 1834 2555.47 1834 M2555.47 1830.3 Q2561.28 1830.3 2564.33 1834.9 Q2567.41 1839.49 2567.41 1848.24 Q2567.41 1856.96 2564.33 1861.57 Q2561.28 1866.15 2555.47 1866.15 Q2549.66 1866.15 2546.58 1861.57 Q2543.52 1856.96 2543.52 1848.24 Q2543.52 1839.49 2546.58 1834.9 Q2549.66 1830.3 2555.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M2585.63 1834 Q2582.02 1834 2580.19 1837.57 Q2578.38 1841.11 2578.38 1848.24 Q2578.38 1855.34 2580.19 1858.91 Q2582.02 1862.45 2585.63 1862.45 Q2589.26 1862.45 2591.07 1858.91 Q2592.9 1855.34 2592.9 1848.24 Q2592.9 1841.11 2591.07 1837.57 Q2589.26 1834 2585.63 1834 M2585.63 1830.3 Q2591.44 1830.3 2594.49 1834.9 Q2597.57 1839.49 2597.57 1848.24 Q2597.57 1856.96 2594.49 1861.57 Q2591.44 1866.15 2585.63 1866.15 Q2579.82 1866.15 2576.74 1861.57 Q2573.68 1856.96 2573.68 1848.24 Q2573.68 1839.49 2576.74 1834.9 Q2579.82 1830.3 2585.63 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M2615.79 1834 Q2612.18 1834 2610.35 1837.57 Q2608.54 1841.11 2608.54 1848.24 Q2608.54 1855.34 2610.35 1858.91 Q2612.18 1862.45 2615.79 1862.45 Q2619.42 1862.45 2621.23 1858.91 Q2623.06 1855.34 2623.06 1848.24 Q2623.06 1841.11 2621.23 1837.57 Q2619.42 1834 2615.79 1834 M2615.79 1830.3 Q2621.6 1830.3 2624.65 1834.9 Q2627.73 1839.49 2627.73 1848.24 Q2627.73 1856.96 2624.65 1861.57 Q2621.6 1866.15 2615.79 1866.15 Q2609.98 1866.15 2606.9 1861.57 Q2603.84 1856.96 2603.84 1848.24 Q2603.84 1839.49 2606.9 1834.9 Q2609.98 1830.3 2615.79 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip620)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 196.816,47.2441 "></polyline>
<polyline clip-path="url(#clip620)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1707.4 215.714,1707.4 "></polyline>
<polyline clip-path="url(#clip620)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1456.23 215.714,1456.23 "></polyline>
<polyline clip-path="url(#clip620)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1205.06 215.714,1205.06 "></polyline>
<polyline clip-path="url(#clip620)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,953.889 215.714,953.889 "></polyline>
<polyline clip-path="url(#clip620)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,702.72 215.714,702.72 "></polyline>
<polyline clip-path="url(#clip620)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,451.55 215.714,451.55 "></polyline>
<polyline clip-path="url(#clip620)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,200.38 215.714,200.38 "></polyline>
<path clip-path="url(#clip620)" d="M50.5475 1707.85 L80.2233 1707.85 L80.2233 1711.79 L50.5475 1711.79 L50.5475 1707.85 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M89.1352 1690.12 L111.357 1690.12 L111.357 1692.11 L98.8111 1724.68 L93.9269 1724.68 L105.732 1694.05 L89.1352 1694.05 L89.1352 1690.12 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M120.478 1718.8 L125.362 1718.8 L125.362 1724.68 L120.478 1724.68 L120.478 1718.8 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M135.593 1690.12 L153.95 1690.12 L153.95 1694.05 L139.876 1694.05 L139.876 1702.53 Q140.894 1702.18 141.913 1702.02 Q142.931 1701.83 143.95 1701.83 Q149.737 1701.83 153.116 1705 Q156.496 1708.17 156.496 1713.59 Q156.496 1719.17 153.024 1722.27 Q149.552 1725.35 143.232 1725.35 Q141.056 1725.35 138.788 1724.98 Q136.542 1724.61 134.135 1723.87 L134.135 1719.17 Q136.218 1720.3 138.441 1720.86 Q140.663 1721.41 143.14 1721.41 Q147.144 1721.41 149.482 1719.31 Q151.82 1717.2 151.82 1713.59 Q151.82 1709.98 149.482 1707.87 Q147.144 1705.77 143.14 1705.77 Q141.265 1705.77 139.39 1706.18 Q137.538 1706.6 135.593 1707.48 L135.593 1690.12 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M49.5521 1456.68 L79.2279 1456.68 L79.2279 1460.62 L49.5521 1460.62 L49.5521 1456.68 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M89.3667 1438.95 L107.723 1438.95 L107.723 1442.88 L93.6491 1442.88 L93.6491 1451.36 Q94.6676 1451.01 95.6861 1450.85 Q96.7047 1450.66 97.7232 1450.66 Q103.51 1450.66 106.89 1453.83 Q110.269 1457 110.269 1462.42 Q110.269 1468 106.797 1471.1 Q103.325 1474.18 97.0056 1474.18 Q94.8297 1474.18 92.5612 1473.81 Q90.3158 1473.44 87.9084 1472.7 L87.9084 1468 Q89.9917 1469.13 92.2139 1469.69 Q94.4361 1470.25 96.913 1470.25 Q100.918 1470.25 103.256 1468.14 Q105.593 1466.03 105.593 1462.42 Q105.593 1458.81 103.256 1456.7 Q100.918 1454.6 96.913 1454.6 Q95.038 1454.6 93.163 1455.01 Q91.3112 1455.43 89.3667 1456.31 L89.3667 1438.95 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M119.482 1467.63 L124.367 1467.63 L124.367 1473.51 L119.482 1473.51 L119.482 1467.63 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M144.552 1442.03 Q140.941 1442.03 139.112 1445.59 Q137.306 1449.13 137.306 1456.26 Q137.306 1463.37 139.112 1466.94 Q140.941 1470.48 144.552 1470.48 Q148.186 1470.48 149.991 1466.94 Q151.82 1463.37 151.82 1456.26 Q151.82 1449.13 149.991 1445.59 Q148.186 1442.03 144.552 1442.03 M144.552 1438.32 Q150.362 1438.32 153.417 1442.93 Q156.496 1447.51 156.496 1456.26 Q156.496 1464.99 153.417 1469.6 Q150.362 1474.18 144.552 1474.18 Q138.741 1474.18 135.663 1469.6 Q132.607 1464.99 132.607 1456.26 Q132.607 1447.51 135.663 1442.93 Q138.741 1438.32 144.552 1438.32 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M50.5475 1205.51 L80.2233 1205.51 L80.2233 1209.45 L50.5475 1209.45 L50.5475 1205.51 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M94.3436 1218.4 L110.663 1218.4 L110.663 1222.34 L88.7186 1222.34 L88.7186 1218.4 Q91.3806 1215.65 95.9639 1211.02 Q100.57 1206.37 101.751 1205.02 Q103.996 1202.5 104.876 1200.77 Q105.779 1199.01 105.779 1197.32 Q105.779 1194.56 103.834 1192.83 Q101.913 1191.09 98.8111 1191.09 Q96.6121 1191.09 94.1584 1191.85 Q91.7278 1192.62 88.9501 1194.17 L88.9501 1189.45 Q91.7741 1188.31 94.2278 1187.73 Q96.6815 1187.15 98.7185 1187.15 Q104.089 1187.15 107.283 1189.84 Q110.478 1192.52 110.478 1197.02 Q110.478 1199.14 109.668 1201.07 Q108.881 1202.96 106.774 1205.56 Q106.195 1206.23 103.094 1209.45 Q99.9917 1212.64 94.3436 1218.4 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M120.478 1216.46 L125.362 1216.46 L125.362 1222.34 L120.478 1222.34 L120.478 1216.46 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M135.593 1187.78 L153.95 1187.78 L153.95 1191.71 L139.876 1191.71 L139.876 1200.19 Q140.894 1199.84 141.913 1199.68 Q142.931 1199.49 143.95 1199.49 Q149.737 1199.49 153.116 1202.66 Q156.496 1205.83 156.496 1211.25 Q156.496 1216.83 153.024 1219.93 Q149.552 1223.01 143.232 1223.01 Q141.056 1223.01 138.788 1222.64 Q136.542 1222.27 134.135 1221.53 L134.135 1216.83 Q136.218 1217.96 138.441 1218.52 Q140.663 1219.08 143.14 1219.08 Q147.144 1219.08 149.482 1216.97 Q151.82 1214.86 151.82 1211.25 Q151.82 1207.64 149.482 1205.53 Q147.144 1203.43 143.14 1203.43 Q141.265 1203.43 139.39 1203.84 Q137.538 1204.26 135.593 1205.14 L135.593 1187.78 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M99.3204 939.688 Q95.7093 939.688 93.8806 943.253 Q92.075 946.795 92.075 953.924 Q92.075 961.031 93.8806 964.595 Q95.7093 968.137 99.3204 968.137 Q102.955 968.137 104.76 964.595 Q106.589 961.031 106.589 953.924 Q106.589 946.795 104.76 943.253 Q102.955 939.688 99.3204 939.688 M99.3204 935.984 Q105.131 935.984 108.186 940.591 Q111.265 945.174 111.265 953.924 Q111.265 962.651 108.186 967.257 Q105.131 971.841 99.3204 971.841 Q93.5102 971.841 90.4315 967.257 Q87.376 962.651 87.376 953.924 Q87.376 945.174 90.4315 940.591 Q93.5102 935.984 99.3204 935.984 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M119.482 965.29 L124.367 965.29 L124.367 971.169 L119.482 971.169 L119.482 965.29 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M144.552 939.688 Q140.941 939.688 139.112 943.253 Q137.306 946.795 137.306 953.924 Q137.306 961.031 139.112 964.595 Q140.941 968.137 144.552 968.137 Q148.186 968.137 149.991 964.595 Q151.82 961.031 151.82 953.924 Q151.82 946.795 149.991 943.253 Q148.186 939.688 144.552 939.688 M144.552 935.984 Q150.362 935.984 153.417 940.591 Q156.496 945.174 156.496 953.924 Q156.496 962.651 153.417 967.257 Q150.362 971.841 144.552 971.841 Q138.741 971.841 135.663 967.257 Q132.607 962.651 132.607 953.924 Q132.607 945.174 135.663 940.591 Q138.741 935.984 144.552 935.984 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M94.3436 716.064 L110.663 716.064 L110.663 720 L88.7186 720 L88.7186 716.064 Q91.3806 713.31 95.9639 708.68 Q100.57 704.027 101.751 702.685 Q103.996 700.162 104.876 698.426 Q105.779 696.666 105.779 694.977 Q105.779 692.222 103.834 690.486 Q101.913 688.75 98.8111 688.75 Q96.6121 688.75 94.1584 689.514 Q91.7278 690.278 88.9501 691.828 L88.9501 687.106 Q91.7741 685.972 94.2278 685.393 Q96.6815 684.815 98.7185 684.815 Q104.089 684.815 107.283 687.5 Q110.478 690.185 110.478 694.676 Q110.478 696.805 109.668 698.727 Q108.881 700.625 106.774 703.217 Q106.195 703.889 103.094 707.106 Q99.9917 710.301 94.3436 716.064 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M120.478 714.12 L125.362 714.12 L125.362 720 L120.478 720 L120.478 714.12 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M135.593 685.44 L153.95 685.44 L153.95 689.375 L139.876 689.375 L139.876 697.847 Q140.894 697.5 141.913 697.338 Q142.931 697.152 143.95 697.152 Q149.737 697.152 153.116 700.324 Q156.496 703.495 156.496 708.912 Q156.496 714.49 153.024 717.592 Q149.552 720.671 143.232 720.671 Q141.056 720.671 138.788 720.3 Q136.542 719.93 134.135 719.189 L134.135 714.49 Q136.218 715.625 138.441 716.18 Q140.663 716.736 143.14 716.736 Q147.144 716.736 149.482 714.629 Q151.82 712.523 151.82 708.912 Q151.82 705.301 149.482 703.194 Q147.144 701.088 143.14 701.088 Q141.265 701.088 139.39 701.504 Q137.538 701.921 135.593 702.801 L135.593 685.44 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M89.3667 434.27 L107.723 434.27 L107.723 438.205 L93.6491 438.205 L93.6491 446.677 Q94.6676 446.33 95.6861 446.168 Q96.7047 445.983 97.7232 445.983 Q103.51 445.983 106.89 449.154 Q110.269 452.325 110.269 457.742 Q110.269 463.321 106.797 466.422 Q103.325 469.501 97.0056 469.501 Q94.8297 469.501 92.5612 469.131 Q90.3158 468.76 87.9084 468.02 L87.9084 463.321 Q89.9917 464.455 92.2139 465.01 Q94.4361 465.566 96.913 465.566 Q100.918 465.566 103.256 463.459 Q105.593 461.353 105.593 457.742 Q105.593 454.131 103.256 452.024 Q100.918 449.918 96.913 449.918 Q95.038 449.918 93.163 450.334 Q91.3112 450.751 89.3667 451.631 L89.3667 434.27 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M119.482 462.95 L124.367 462.95 L124.367 468.83 L119.482 468.83 L119.482 462.95 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M144.552 437.348 Q140.941 437.348 139.112 440.913 Q137.306 444.455 137.306 451.584 Q137.306 458.691 139.112 462.256 Q140.941 465.797 144.552 465.797 Q148.186 465.797 149.991 462.256 Q151.82 458.691 151.82 451.584 Q151.82 444.455 149.991 440.913 Q148.186 437.348 144.552 437.348 M144.552 433.645 Q150.362 433.645 153.417 438.251 Q156.496 442.835 156.496 451.584 Q156.496 460.311 153.417 464.918 Q150.362 469.501 144.552 469.501 Q138.741 469.501 135.663 464.918 Q132.607 460.311 132.607 451.584 Q132.607 442.835 135.663 438.251 Q138.741 433.645 144.552 433.645 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M89.1352 183.1 L111.357 183.1 L111.357 185.091 L98.8111 217.66 L93.9269 217.66 L105.732 187.035 L89.1352 187.035 L89.1352 183.1 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M120.478 211.78 L125.362 211.78 L125.362 217.66 L120.478 217.66 L120.478 211.78 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip620)" d="M135.593 183.1 L153.95 183.1 L153.95 187.035 L139.876 187.035 L139.876 195.507 Q140.894 195.16 141.913 194.998 Q142.931 194.813 143.95 194.813 Q149.737 194.813 153.116 197.984 Q156.496 201.155 156.496 206.572 Q156.496 212.151 153.024 215.253 Q149.552 218.331 143.232 218.331 Q141.056 218.331 138.788 217.961 Q136.542 217.59 134.135 216.85 L134.135 212.151 Q136.218 213.285 138.441 213.84 Q140.663 214.396 143.14 214.396 Q147.144 214.396 149.482 212.29 Q151.82 210.183 151.82 206.572 Q151.82 202.961 149.482 200.854 Q147.144 198.748 143.14 198.748 Q141.265 198.748 139.39 199.165 Q137.538 199.581 135.593 200.461 L135.593 183.1 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip622)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,1265.76 268.292,1402.6 270.6,1524.72 272.908,1493.46 275.216,1423.65 277.524,1356.81 279.832,1402.52 282.139,1339.07 284.447,1522.3 286.755,1619.74 289.063,1462.9 291.371,1470.26 293.679,1537.05 295.987,1408.65 298.295,1593.96 300.603,1498.81 302.911,1501.27 305.219,1489.66 307.527,1474.54 309.834,1282.94 312.142,1391.21 314.45,1628.35 316.758,1596.94 319.066,1493.81 321.374,1462.64 323.682,1488.54 325.99,1502.55 328.298,1361.84 330.606,1330.18 332.914,1346.43 335.221,1309.56 337.529,1393.3 339.837,1492.44 342.145,1410.27 344.453,1394.08 346.761,1391.26 349.069,1292.47 351.377,1466.91 353.685,1584.6 355.993,1622.73 358.301,1644.99 360.608,1387.85 362.916,1407.49 365.224,1413.07 367.532,1399.94 369.84,1298.94 372.148,1380.04 374.456,1385.24 376.764,1562.13 379.072,1562.46 381.38,1475.64 383.688,1366.79 385.996,1443.09 388.303,1438.64 390.611,1408.49 392.919,1297.32 395.227,1489.77 397.535,1555.71 399.843,1512.37 402.151,1475.3 404.459,1373.89 406.767,1362.82 409.075,1405.44 411.383,1398.06 413.69,1605.41 415.998,1316.59 418.306,1520.28 420.614,1353.37 422.922,1568.2 425.23,1471.67 427.538,1313.9 429.846,1535.01 432.154,1553 434.462,1476.45 436.77,1395.72 439.077,1391.44 441.385,1569.46 443.693,1508.84 446.001,1462.97 448.309,1553.46 450.617,1469.87 452.925,1289.73 455.233,1357.26 457.541,1451.25 459.849,1380.09 462.157,1357.52 464.465,1259.3 466.772,1365.65 469.08,1346.91 471.388,1433.01 473.696,1450.77 476.004,1428.39 478.312,1523.84 480.62,1498.68 482.928,1539.77 485.236,1478.86 487.544,1381.2 489.852,1537.25 492.159,1561.66 494.467,1285.22 496.775,1504.84 499.083,1451.11 501.391,1617.15 503.699,1481.01 506.007,1441.76 508.315,1456.17 510.623,1469.69 512.931,1478.08 515.239,1431.95 517.546,1358.29 519.854,1421.85 522.162,1422.8 524.47,1635.95 526.778,1392.38 529.086,1442.99 531.394,1408.39 533.702,1434.15 536.01,1465.5 538.318,1393.4 540.626,1567.84 542.933,1528.37 545.241,1565.94 547.549,1538.68 549.857,1485.38 552.165,1339.37 554.473,1292.28 556.781,1397.64 559.089,1594.93 561.397,1397.48 563.705,1375.54 566.013,1534.21 568.321,1508.4 570.628,1440.88 572.936,1486.56 575.244,1413.98 577.552,1335.99 579.86,1448.97 582.168,1279.21 584.476,1597.7 586.784,1389.73 589.092,1357.9 591.4,1543.26 593.708,1474.26 596.015,1281.93 598.323,1363.59 600.631,1439.64 602.939,1578.32 605.247,1450.83 607.555,1406.99 609.863,1503.09 612.171,1399.28 614.479,1564.76 616.787,1572.33 619.095,1357.57 621.402,1283.21 623.71,1490.46 626.018,1482.95 628.326,1369.26 630.634,1434.34 632.942,1544.04 635.25,1511.19 637.558,1401.32 639.866,1676.68 642.174,1393.68 644.482,1352.26 646.79,1472.66 649.097,1596.06 651.405,1393.16 653.713,1519.05 656.021,1543.39 658.329,1438.35 660.637,1300.83 662.945,1557.51 665.253,1376.81 667.561,1472.55 669.869,1499.71 672.177,1481.04 674.484,1308.67 676.792,1588.1 679.1,1554.42 681.408,1515.26 683.716,1550.85 686.024,1437.78 688.332,1512.85 690.64,1410.38 692.948,1450.66 695.256,1546.15 697.564,1461.15 699.871,1496.53 702.179,1257.79 704.487,1462.7 706.795,1571 709.103,1440.32 711.411,1284.5 713.719,1528.86 716.027,1601.27 718.335,1341.9 720.643,1297.23 722.951,1322.84 725.259,1425.93 727.566,1437.44 729.874,1508.48 732.182,1509.69 734.49,1320.64 736.798,1362.19 739.106,1419.68 741.414,1499.41 743.722,1414.41 746.03,1543.6 748.338,1405.83 750.646,1570.42 752.953,1426.37 755.261,1508.84 757.569,1322.45 759.877,1587.66 762.185,1465.89 764.493,1439.37 766.801,1392.47 769.109,1357.28 771.417,1439.67 773.725,1539.24 776.033,1723.99 778.34,1336.28 780.648,1372.09 782.956,1392.35 785.264,1402.09 787.572,1430.37 789.88,1581.87 792.188,1437.65 794.496,1541.47 796.804,1364.94 799.112,1530.75 801.42,1405.85 803.728,1585.86 806.035,1406.8 808.343,1366.53 810.651,1398.47 812.959,1351.74 815.267,1508.4 817.575,1475.34 819.883,1357.46 822.191,1367.78 824.499,1439.36 826.807,1433.97 829.115,1308.41 831.422,1501.48 833.73,1528.67 836.038,1511.36 838.346,1362.18 840.654,1333.47 842.962,1593.1 845.27,1368.98 847.578,1490.88 849.886,1436.82 852.194,1629.16 854.502,1507.9 856.809,1450.54 859.117,1494.22 861.425,1272.16 863.733,1399.23 866.041,1423.59 868.349,1404.53 870.657,1514.16 872.965,1451.27 875.273,1460.52 877.581,1571.22 879.889,1544.79 882.197,1715.96 884.504,1316.14 886.812,1576.22 889.12,1434.76 891.428,1451.85 893.736,1529.76 896.044,1378.95 898.352,1489.34 900.66,1439.24 902.968,1611.49 905.276,1596.68 907.584,1459.47 909.891,1289.73 912.199,1337.44 914.507,1456.85 916.815,1441.35 919.123,1406.44 921.431,1457.19 923.739,1613.86 926.047,1454.34 928.355,1571.87 930.663,1363.28 932.971,1279.73 935.278,1516.8 937.586,1543.7 939.894,1471.47 942.202,1365.83 944.51,1686.14 946.818,1517.05 949.126,1613.09 951.434,1552.72 953.742,1463.2 956.05,1492.75 958.358,1329.78 960.665,1498.02 962.973,1611.17 965.281,1436.06 967.589,1501.64 969.897,1452.08 972.205,1450.57 974.513,1557.32 976.821,1510.31 979.129,1271.42 981.437,1578.82 983.745,1319.29 986.053,1415.97 988.36,1460.25 990.668,1485.15 992.976,1343.67 995.284,1427.58 997.592,1413.68 999.9,1365.41 1002.21,1525.01 1004.52,1396.4 1006.82,1459.98 1009.13,1395.13 1011.44,1541.37 1013.75,1449.95 1016.06,1301.46 1018.36,1458.77 1020.67,1611.69 1022.98,1416.88 1025.29,1558.73 1027.59,1666.46 1029.9,1513.42 1032.21,1559.93 1034.52,1561.32 1036.83,1292.44 1039.13,1334.61 1041.44,1634.95 1043.75,1410.34 1046.06,1416.41 1048.37,1595.75 1050.67,1329.12 1052.98,1442.81 1055.29,1644.77 1057.6,1347.23 1059.91,1549.46 1062.21,1567.76 1064.52,1514.39 1066.83,1430.37 1069.14,1495.78 1071.45,1439.43 1073.75,1417.07 1076.06,1453.78 1078.37,1436.37 1080.68,1327.37 1082.98,1546.27 1085.29,1382.16 1087.6,1424.23 1089.91,1439.7 1092.22,1366.15 1094.52,1537.77 1096.83,1401.49 1099.14,1479.67 1101.45,1433.99 1103.76,1611.21 1106.06,1466.58 1108.37,1450.16 1110.68,1597.01 1112.99,1344.11 1115.3,1434 1117.6,1558.15 1119.91,1370.55 1122.22,1362.47 1124.53,1426.3 1126.84,1341.97 1129.14,1220.96 1131.45,1411.22 1133.76,1439.48 1136.07,1649.43 1138.37,1551.04 1140.68,1588.07 1142.99,1475.66 1145.3,1559.82 1147.61,1473.23 1149.91,1541.56 1152.22,1303.68 1154.53,1499.35 1156.84,1551.56 1159.15,1309.77 1161.45,1210.08 1163.76,1520.92 1166.07,1536.77 1168.38,1654.79 1170.69,1368.04 1172.99,1515.6 1175.3,1319.54 1177.61,1280.61 1179.92,1673.48 1182.23,1499.57 1184.53,1352.67 1186.84,1414.24 1189.15,1385.56 1191.46,1388.89 1193.76,1414.4 1196.07,1486.37 1198.38,1643.71 1200.69,1451.88 1203,1398.35 1205.3,1384.99 1207.61,1609.51 1209.92,1225.57 1212.23,1475.02 1214.54,1428 1216.84,1538.87 1219.15,1650.24 1221.46,1309.19 1223.77,1430.84 1226.08,1456.23 1228.38,1403.85 1230.69,1570.41 1233,1461.42 1235.31,1532.8 1237.61,1386.14 1239.92,1413.66 1242.23,1537.97 1244.54,1375.88 1246.85,1447.3 1249.15,1458.21 1251.46,1383.6 1253.77,1495.86 1256.08,1520.93 1258.39,1516.16 1260.69,1465.18 1263,1608.28 1265.31,1572.25 1267.62,1507.4 1269.93,1422.58 1272.23,1489.3 1274.54,1480.45 1276.85,1433.7 1279.16,1508.31 1281.47,1489.27 1283.77,1273.7 1286.08,1510.05 1288.39,1416.78 1290.7,1409.11 1293,1485.48 1295.31,1426.5 1297.62,1585.3 1299.93,1541.77 1302.24,1241.26 1304.54,1601.77 1306.85,1520.49 1309.16,1355.05 1311.47,1598.15 1313.78,1570.52 1316.08,1275.25 1318.39,1275.19 1320.7,1542.32 1323.01,1539.88 1325.32,1409.66 1327.62,1461.45 1329.93,1392.79 1332.24,1401.66 1334.55,1528.12 1336.86,1430.26 1339.16,1335.62 1341.47,1470.93 1343.78,1580.88 1346.09,1397.42 1348.39,1648.4 1350.7,1291.36 1353.01,1371.67 1355.32,1469 1357.63,1596.66 1359.93,1413.3 1362.24,1570.83 1364.55,1655.68 1366.86,1307.43 1369.17,1505.62 1371.47,1458.44 1373.78,1467.51 1376.09,1505.65 1378.4,1597.55 1380.71,1424.35 1383.01,1736.04 1385.32,1478.49 1387.63,1359.63 1389.94,1444.01 1392.24,1468.41 1394.55,1537.13 1396.86,1516.99 1399.17,1608.83 1401.48,1609.52 1403.78,1555.55 1406.09,1374.66 1408.4,1404.12 1410.71,1418.46 1413.02,1527.79 1415.32,1522.82 1417.63,1600.22 1419.94,1466.28 1422.25,1396.77 1424.56,1368.12 1426.86,1464.58 1429.17,1526.19 1431.48,1604.07 1433.79,1531.88 1436.1,1307.89 1438.4,1357.4 1440.71,1692.01 1443.02,1641.98 1445.33,1421.95 1447.63,1386.92 1449.94,1510.84 1452.25,1403.24 1454.56,1751.15 1456.87,1502.25 1459.17,1483.88 1461.48,1515.87 1463.79,1448.07 1466.1,1381.07 1468.41,1593.14 1470.71,1530.88 1473.02,1525.13 1475.33,1618.34 1477.64,1488.3 1479.95,1429.43 1482.25,1315.3 1484.56,1649.83 1486.87,1521.79 1489.18,1298.59 1491.49,1404.31 1493.79,1573.55 1496.1,1537.36 1498.41,1527.11 1500.72,1414.01 1503.02,1381.88 1505.33,1501.76 1507.64,1492.36 1509.95,1455.48 1512.26,1603.26 1514.56,1459.1 1516.87,1486.4 1519.18,1459.47 1521.49,1294.71 1523.8,1660.66 1526.1,1571.92 1528.41,1280.86 1530.72,1458.41 1533.03,1563.54 1535.34,1326.51 1537.64,1470.53 1539.95,1399.21 1542.26,1390.2 1544.57,1384.02 1546.88,1507.43 1549.18,1264.74 1551.49,1440.19 1553.8,1439.4 1556.11,1468.59 1558.41,1559.9 1560.72,1537.14 1563.03,1575.68 1565.34,1454.04 1567.65,1544.39 1569.95,1664.86 1572.26,1462.94 1574.57,1441.21 1576.88,1379.91 1579.19,1364.47 1581.49,1409.24 1583.8,1377 1586.11,1466.45 1588.42,1483.52 1590.73,1445.48 1593.03,1544.23 1595.34,1430.71 1597.65,1448.64 1599.96,1324.83 1602.26,1503.4 1604.57,1521.96 1606.88,1642.83 1609.19,1461.09 1611.5,1342.6 1613.8,1515.61 1616.11,1475.7 1618.42,1273.84 1620.73,1555.2 1623.04,1650.43 1625.34,1298.21 1627.65,1551.08 1629.96,1392.77 1632.27,1415.02 1634.58,1460.67 1636.88,1421.42 1639.19,1305.74 1641.5,1439.63 1643.81,1501.74 1646.12,1461.14 1648.42,1369.77 1650.73,1369.58 1653.04,1415.25 1655.35,1523.49 1657.65,1421.97 1659.96,1564.48 1662.27,1335.41 1664.58,1253.87 1666.89,1412.64 1669.19,1500.19 1671.5,1495.41 1673.81,1463.39 1676.12,1375.3 1678.43,1367.65 1680.73,1387.66 1683.04,1502.96 1685.35,1305.3 1687.66,1437.8 1689.97,1412.22 1692.27,1518.5 1694.58,1372.34 1696.89,1341.25 1699.2,1510.86 1701.51,1412.76 1703.81,1486.4 1706.12,1559.01 1708.43,1460.31 1710.74,1550.98 1713.04,1371.39 1715.35,1510.25 1717.66,1464.72 1719.97,1515.21 1722.28,1489.13 1724.58,1396.18 1726.89,1581.02 1729.2,1352.45 1731.51,1410.39 1733.82,1549.16 1736.12,1606.99 1738.43,1447.21 1740.74,1503.67 1743.05,1370.27 1745.36,1509.12 1747.66,1366.24 1749.97,1450.27 1752.28,1602.44 1754.59,1439.96 1756.9,1393.48 1759.2,1442.54 1761.51,1509.95 1763.82,1570.36 1766.13,1412.76 1768.43,1249.5 1770.74,1278.79 1773.05,1539.4 1775.36,1506.65 1777.67,1312.13 1779.97,1563.12 1782.28,1566.34 1784.59,1347.85 1786.9,1375.54 1789.21,1469.56 1791.51,1470.28 1793.82,1606.92 1796.13,1432.23 1798.44,1613.1 1800.75,1579.49 1803.05,1433.19 1805.36,1391.04 1807.67,1253.58 1809.98,1430.36 1812.28,1436.93 1814.59,1420.35 1816.9,1493.8 1819.21,1504.48 1821.52,1370.22 1823.82,1402.51 1826.13,1574.06 1828.44,1524.36 1830.75,1513.49 1833.06,1411.9 1835.36,1468.76 1837.67,1431.9 1839.98,1496.63 1842.29,1530.39 1844.6,1412.31 1846.9,1426.6 1849.21,1457.21 1851.52,1383.2 1853.83,1507.76 1856.14,1544.98 1858.44,1276.59 1860.75,1504.08 1863.06,1457.59 1865.37,1361.06 1867.67,1551.99 1869.98,1484.54 1872.29,1547.41 1874.6,1450.53 1876.91,1230.85 1879.21,1616.55 1881.52,1547.18 1883.83,1420.91 1886.14,1152 1888.45,1374 1890.75,1461.83 1893.06,1633.2 1895.37,1468.72 1897.68,1518.56 1899.99,1495.62 1902.29,1442.82 1904.6,1366.85 1906.91,1589.39 1909.22,1483.07 1911.53,1393.71 1913.83,1434.99 1916.14,1663.01 1918.45,1422.87 1920.76,1490.92 1923.06,1464.65 1925.37,1625.96 1927.68,1609.5 1929.99,1250.9 1932.3,1497.61 1934.6,1626.37 1936.91,1432.46 1939.22,1429.54 1941.53,1484.1 1943.84,1265.97 1946.14,1447.35 1948.45,1384.49 1950.76,1411.54 1953.07,1472.03 1955.38,1604.81 1957.68,1394.95 1959.99,1445.35 1962.3,1448.39 1964.61,1600 1966.91,1582.81 1969.22,1464.83 1971.53,1516.33 1973.84,1436.83 1976.15,1351.11 1978.45,1279.61 1980.76,1391.95 1983.07,1435.44 1985.38,1565.45 1987.69,1510.02 1989.99,1599.35 1992.3,1510.29 1994.61,1589.62 1996.92,1363.67 1999.23,1317.27 2001.53,1377.57 2003.84,1555.9 2006.15,1515.4 2008.46,1576.64 2010.77,1349.3 2013.07,1413.18 2015.38,1319.13 2017.69,1551.68 2020,1514.6 2022.3,1514.86 2024.61,1299.92 2026.92,1742.74 2029.23,1481.89 2031.54,1408.79 2033.84,1393.38 2036.15,1362.15 2038.46,1550.95 2040.77,1464.81 2043.08,1474.15 2045.38,1348.63 2047.69,1433.42 2050,1475.62 2052.31,1432.33 2054.62,1525.4 2056.92,1463.32 2059.23,1400.9 2061.54,1415.93 2063.85,1550.72 2066.16,1543.33 2068.46,1278.52 2070.77,1542.64 2073.08,1296.85 2075.39,1386.21 2077.69,1455.1 2080,1557.87 2082.31,1381.5 2084.62,1349.03 2086.93,1402.8 2089.23,1522.99 2091.54,1630.72 2093.85,1310.6 2096.16,1448.95 2098.47,1485.58 2100.77,1590.75 2103.08,1381.31 2105.39,1340.58 2107.7,1530.51 2110.01,1511.26 2112.31,1416.85 2114.62,1502.37 2116.93,1501.13 2119.24,1483.35 2121.55,1413.13 2123.85,1429.46 2126.16,1437.4 2128.47,1416.96 2130.78,1470.57 2133.08,1465.35 2135.39,1376.83 2137.7,1460.14 2140.01,1592.82 2142.32,1352.31 2144.62,1475.2 2146.93,1424.46 2149.24,1489.46 2151.55,1314.34 2153.86,1410.88 2156.16,1454.64 2158.47,1381.99 2160.78,1411.06 2163.09,1583.05 2165.4,1415.46 2167.7,1251.82 2170.01,1394.83 2172.32,1671.25 2174.63,1400.66 2176.93,1386.19 2179.24,1596.57 2181.55,1435.86 2183.86,1394.38 2186.17,1259.17 2188.47,1498 2190.78,1543.9 2193.09,1340.41 2195.4,1358.9 2197.71,1476.56 2200.01,1512.91 2202.32,1502 2204.63,1645.06 2206.94,1334.52 2209.25,1490.61 2211.55,1490.29 2213.86,1426.19 2216.17,1295.72 2218.48,1550.58 2220.79,1597.36 2223.09,1432.48 2225.4,1537.89 2227.71,1484.3 2230.02,1306.55 2232.32,1280.04 2234.63,1363.08 2236.94,1458.14 2239.25,1584.81 2241.56,1645.27 2243.86,1288.47 2246.17,1469.89 2248.48,1540.76 2250.79,1339.56 2253.1,1546 2255.4,1336.64 2257.71,1416.32 2260.02,1358.96 2262.33,1242.51 2264.64,1349.34 2266.94,1443.48 2269.25,1698.2 2271.56,1632.27 2273.87,1636.01 2276.18,1274.01 2278.48,1535.89 2280.79,1254.38 2283.1,1187.59 2285.41,1289.74 2287.71,1360.71 2290.02,1538.04 2292.33,1438.49 2294.64,1466.34 2296.95,1541.89 2299.25,1471.57 2301.56,1408.48 2303.87,1471.8 2306.18,1322.37 2308.49,1540.24 2310.79,1514.54 2313.1,1482.31 2315.41,1542.25 2317.72,1584.49 2320.03,1340.46 2322.33,1535.84 2324.64,1357.04 2326.95,1507.8 2329.26,1322.27 2331.56,1708.39 2333.87,1364.04 2336.18,1441.88 2338.49,1552.11 2340.8,1385.87 2343.1,1587.29 2345.41,1233.65 2347.72,1407.78 2350.03,1378.35 2352.34,1301.73 2354.64,1383.15 2356.95,1473.3 2359.26,1509.25 2361.57,1473.9 2363.88,1300.22 2366.18,1299.7 2368.49,1496.35 2370.8,1442.94 2373.11,1446.15 2375.42,1441.36 2377.72,1468.41 2380.03,1381.47 2382.34,1544.4 2384.65,1454.74 2386.95,1602.92 2389.26,1284.53 2391.57,1381.06 2393.88,1461.45 2396.19,1490.78 2398.49,1350.14 2400.8,1496.96 2403.11,1387.45 2405.42,1513.03 2407.73,1530.82 2410.03,1588.31 2412.34,1332.92 2414.65,1376.58 2416.96,1402.23 2419.27,1525.87 2421.57,1320.96 2423.88,1466.23 2426.19,1424.19 2428.5,1358.21 2430.81,1380.06 2433.11,1443.15 2435.42,1523.1 2437.73,1326.52 2440.04,1397.58 2442.34,1528.89 2444.65,1593.63 2446.96,1422.78 2449.27,1506.52 2451.58,1555.71 2453.88,1578.39 2456.19,1426.55 2458.5,1545.05 2460.81,1620.57 2463.12,1465.69 2465.42,1622.77 2467.73,1562.41 2470.04,1582.41 2472.35,1540.34 2474.66,1402.3 2476.96,1654.95 2479.27,1612.41 2481.58,1504.54 2483.89,1504.53 2486.2,1427.5 2488.5,1402.17 2490.81,1395.78 2493.12,1425.92 2495.43,1662.01 2497.73,1426.62 2500.04,1444.27 2502.35,1444.38 2504.66,1647.85 2506.97,1385.81 2509.27,1627.77 2511.58,1620.22 2513.89,1356.99 2516.2,1540.42 2518.51,1370.76 2520.81,1409.15 2523.12,1338.34 2525.43,1567.98 2527.74,1516.9 2530.05,1474.06 2532.35,1380.11 2534.66,1613.33 2536.97,1418.41 2539.28,1502.97 2541.58,1415.47 2543.89,1313.3 2546.2,1420.19 2548.51,1354.85 2550.82,1397.65 2553.12,1548.94 2555.43,1459.69 2557.74,1477.29 2560.05,1272.63 2562.36,1451.33 2564.66,1433.11 2566.97,1206.96 2569.28,1474.99 2571.59,1493.94 "></polyline>
<polyline clip-path="url(#clip622)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,989.959 268.292,1022.44 270.6,958.148 272.908,902.733 275.216,1071.26 277.524,1039.16 279.832,822.713 282.139,768.734 284.447,999.336 286.755,1136.82 289.063,1032.06 291.371,908.911 293.679,956.875 295.987,923.996 298.295,969.402 300.603,884.872 302.911,1128.35 305.219,985.854 307.527,1072.89 309.834,934.878 312.142,933.202 314.45,945.846 316.758,1056.72 319.066,1014.23 321.374,934.32 323.682,1016.41 325.99,933.722 328.298,1051.14 330.606,820.568 332.914,756.72 335.221,1107.16 337.529,897.897 339.837,1002.4 342.145,969.683 344.453,983.979 346.761,833.934 349.069,1003.14 351.377,937.456 353.685,1014.85 355.993,966.304 358.301,858.39 360.608,909.805 362.916,884.113 365.224,1089.98 367.532,1078.18 369.84,933.358 372.148,1082.6 374.456,1035.92 376.764,813.409 379.072,1055.74 381.38,978.102 383.688,840.751 385.996,909.836 388.303,1035.84 390.611,907.608 392.919,934.482 395.227,834.268 397.535,1000.97 399.843,964.849 402.151,1049.41 404.459,992.356 406.767,859.065 409.075,1033.35 411.383,1041.8 413.69,1229.11 415.998,923.043 418.306,915.751 420.614,1018.8 422.922,974.727 425.23,791.575 427.538,807.437 429.846,1148.63 432.154,998.993 434.462,1028.84 436.77,959.588 439.077,866.182 441.385,1049.13 443.693,1034.3 446.001,990.224 448.309,927.15 450.617,969.968 452.925,953.229 455.233,1060.67 457.541,797.52 459.849,971.852 462.157,997.06 464.465,1033 466.772,1021.75 469.08,931.758 471.388,872.357 473.696,1089.01 476.004,930.53 478.312,1035.11 480.62,1004.45 482.928,884.182 485.236,791.639 487.544,945.337 489.852,1012.77 492.159,921.39 494.467,980.822 496.775,981.935 499.083,854.255 501.391,1084.55 503.699,893.752 506.007,922.96 508.315,896.563 510.623,1038.61 512.931,983.686 515.239,999.197 517.546,1026.62 519.854,856.955 522.162,965.226 524.47,1043.91 526.778,1105.35 529.086,823.182 531.394,915.022 533.702,1049.08 536.01,843.642 538.318,1061.3 540.626,985.772 542.933,1059.64 545.241,875.48 547.549,919.567 549.857,1033.93 552.165,972.051 554.473,874.597 556.781,885.503 559.089,913.644 561.397,1076.76 563.705,762.367 566.013,956.104 568.321,1024.52 570.628,953.481 572.936,738.125 575.244,1011.67 577.552,965.014 579.86,1060.09 582.168,1029.53 584.476,1058.84 586.784,855.811 589.092,831.574 591.4,969.578 593.708,690.89 596.015,1070.58 598.323,989.924 600.631,942.738 602.939,907.488 605.247,867.194 607.555,776.158 609.863,1017.51 612.171,1044.38 614.479,994.286 616.787,915.709 619.095,1041.74 621.402,814.251 623.71,876.581 626.018,936.3 628.326,941.383 630.634,915.262 632.942,818.195 635.25,942.407 637.558,966.968 639.866,994.376 642.174,838.229 644.482,826.369 646.79,1044.93 649.097,916.458 651.405,936.401 653.713,934.628 656.021,901.086 658.329,947.946 660.637,894.742 662.945,903.171 665.253,927.362 667.561,837.619 669.869,1060.09 672.177,1053.27 674.484,952.975 676.792,939.213 679.1,1144.14 681.408,999.913 683.716,824.672 686.024,726.105 688.332,961.515 690.64,842.225 692.948,918.224 695.256,1066.73 697.564,822.988 699.871,939.203 702.179,930.295 704.487,1072.53 706.795,928.62 709.103,1055.21 711.411,964.489 713.719,1142.16 716.027,891.802 718.335,980.9 720.643,884.953 722.951,985.395 725.259,981.486 727.566,913.605 729.874,836.234 732.182,794.534 734.49,1036.46 736.798,936.458 739.106,777.978 741.414,840.625 743.722,1048.9 746.03,818.899 748.338,859.71 750.646,874.174 752.953,926.115 755.261,900.01 757.569,925.267 759.877,914.633 762.185,924.937 764.493,896.125 766.801,982.991 769.109,964.926 771.417,1006.69 773.725,902.494 776.033,868.188 778.34,961.372 780.648,974.064 782.956,992.154 785.264,974.723 787.572,874.817 789.88,1023.77 792.188,818.609 794.496,796.221 796.804,1022.69 799.112,1097.88 801.42,972.95 803.728,1004.65 806.035,828.254 808.343,927.676 810.651,1058.79 812.959,1148.32 815.267,973.963 817.575,886.818 819.883,926.154 822.191,1191.71 824.499,1018.86 826.807,928.028 829.115,953.739 831.422,881.247 833.73,903.526 836.038,1079.16 838.346,927.022 840.654,907.748 842.962,1060.26 845.27,919.745 847.578,1067.73 849.886,1006.32 852.194,975.396 854.502,883.297 856.809,1047.68 859.117,757.044 861.425,933.952 863.733,924.393 866.041,1007.08 868.349,1003.75 870.657,988.026 872.965,1193.05 875.273,783.117 877.581,951.984 879.889,959.63 882.197,679.97 884.504,883.975 886.812,788.033 889.12,948.608 891.428,1031.61 893.736,898.683 896.044,948.506 898.352,971.105 900.66,917.684 902.968,984.376 905.276,781.579 907.584,1032.53 909.891,961.191 912.199,1045.2 914.507,985.029 916.815,1067.24 919.123,902.056 921.431,924.403 923.739,678.057 926.047,848.122 928.355,979.684 930.663,1017.37 932.971,858.798 935.278,1002.06 937.586,854.143 939.894,918.565 942.202,1015.32 944.51,1108.12 946.818,876.708 949.126,956.353 951.434,940.891 953.742,867.74 956.05,968.271 958.358,956.61 960.665,960.991 962.973,863.078 965.281,989.876 967.589,1071.19 969.897,880.347 972.205,1088.86 974.513,974.614 976.821,875.039 979.129,1154.21 981.437,1155.77 983.745,981.243 986.053,887.791 988.36,1048.64 990.668,793.084 992.976,998.498 995.284,1214.16 997.592,1167.93 999.9,955.379 1002.21,878.588 1004.52,976.917 1006.82,991.705 1009.13,926.843 1011.44,811.914 1013.75,1082.95 1016.06,849.736 1018.36,1000.25 1020.67,1119.77 1022.98,879.508 1025.29,905.522 1027.59,977.129 1029.9,787.804 1032.21,850.879 1034.52,1003.27 1036.83,1075.97 1039.13,871.82 1041.44,764.199 1043.75,923.161 1046.06,923.454 1048.37,1063.43 1050.67,1060.06 1052.98,912.883 1055.29,767.329 1057.6,1066.04 1059.91,893.492 1062.21,976.453 1064.52,1190.66 1066.83,962.865 1069.14,1035.38 1071.45,792.068 1073.75,801.388 1076.06,980.886 1078.37,876.532 1080.68,990.442 1082.98,1028.15 1085.29,1016.23 1087.6,914.698 1089.91,1004.07 1092.22,1071.48 1094.52,891.203 1096.83,961.882 1099.14,934.753 1101.45,904.221 1103.76,817.582 1106.06,1037.75 1108.37,883.577 1110.68,858.723 1112.99,955.531 1115.3,1014.32 1117.6,956.526 1119.91,988.795 1122.22,985.486 1124.53,656.136 1126.84,981.676 1129.14,956.567 1131.45,944.26 1133.76,952.555 1136.07,989.085 1138.37,884.605 1140.68,1089.5 1142.99,1003.65 1145.3,933.423 1147.61,908.945 1149.91,984.351 1152.22,908.056 1154.53,921.993 1156.84,849.737 1159.15,943.136 1161.45,770.529 1163.76,1049.28 1166.07,1104.61 1168.38,1050.09 1170.69,883.853 1172.99,883.922 1175.3,970.833 1177.61,985.449 1179.92,897.478 1182.23,833.263 1184.53,1028.85 1186.84,943.78 1189.15,1205.27 1191.46,979.261 1193.76,1036.82 1196.07,940.618 1198.38,919.779 1200.69,863.227 1203,984.188 1205.3,1114.38 1207.61,1000.91 1209.92,982.513 1212.23,769.793 1214.54,740.995 1216.84,958.591 1219.15,921.802 1221.46,1023.78 1223.77,1167.91 1226.08,1041.14 1228.38,888.286 1230.69,878.846 1233,927.922 1235.31,1180.79 1237.61,974.532 1239.92,1021.34 1242.23,843.848 1244.54,899.578 1246.85,989.488 1249.15,1001.61 1251.46,925.599 1253.77,965.289 1256.08,824.943 1258.39,1225.47 1260.69,994.265 1263,877.964 1265.31,894.658 1267.62,1076.37 1269.93,735.854 1272.23,950.696 1274.54,925.837 1276.85,812.866 1279.16,1056.73 1281.47,982.661 1283.77,1121.57 1286.08,864.595 1288.39,855.999 1290.7,1115.38 1293,911.979 1295.31,1026.37 1297.62,877.219 1299.93,1068.48 1302.24,981.988 1304.54,892.064 1306.85,997.699 1309.16,786.958 1311.47,852.533 1313.78,810.564 1316.08,1128.23 1318.39,832.8 1320.7,973.486 1323.01,1005.97 1325.32,975.605 1327.62,911.596 1329.93,1083.77 1332.24,1014.92 1334.55,952.124 1336.86,893.531 1339.16,795.924 1341.47,887.408 1343.78,948.834 1346.09,874.124 1348.39,730.039 1350.7,832.987 1353.01,1151.14 1355.32,856.157 1357.63,1051.03 1359.93,1013.73 1362.24,856.536 1364.55,989.754 1366.86,964.569 1369.17,858.383 1371.47,1158.69 1373.78,933.028 1376.09,981.11 1378.4,879.878 1380.71,934.913 1383.01,1038.2 1385.32,1025.58 1387.63,983.139 1389.94,975.809 1392.24,981.949 1394.55,952.958 1396.86,733.265 1399.17,1013.2 1401.48,1019.44 1403.78,778.755 1406.09,926.636 1408.4,1044.42 1410.71,997.308 1413.02,925.868 1415.32,865.383 1417.63,1096.92 1419.94,977.557 1422.25,929.189 1424.56,856.112 1426.86,797.06 1429.17,1023.53 1431.48,908.717 1433.79,1105.7 1436.1,912.054 1438.4,787.378 1440.71,914.052 1443.02,946.545 1445.33,970.465 1447.63,953.958 1449.94,922.211 1452.25,917.62 1454.56,947.564 1456.87,945.342 1459.17,931.204 1461.48,999.07 1463.79,884.408 1466.1,906.131 1468.41,958.234 1470.71,839.476 1473.02,1033.81 1475.33,971.958 1477.64,965.299 1479.95,988.253 1482.25,896.726 1484.56,892.2 1486.87,837.111 1489.18,1070.51 1491.49,928.477 1493.79,1098.35 1496.1,1024.38 1498.41,763.555 1500.72,833.667 1503.02,767.088 1505.33,1092.94 1507.64,746.775 1509.95,797.29 1512.26,884.874 1514.56,893.147 1516.87,893.853 1519.18,1062.32 1521.49,749.869 1523.8,931.365 1526.1,829.437 1528.41,1033.06 1530.72,902.212 1533.03,761.08 1535.34,1100.08 1537.64,1084.44 1539.95,1013.54 1542.26,993.719 1544.57,940.238 1546.88,989.567 1549.18,1155.5 1551.49,1015.83 1553.8,1074.54 1556.11,1003.62 1558.41,1110.56 1560.72,930.683 1563.03,1086.94 1565.34,888.906 1567.65,815.022 1569.95,902.514 1572.26,1005.11 1574.57,946.038 1576.88,1257.95 1579.19,1026.42 1581.49,1199.43 1583.8,942.803 1586.11,958.811 1588.42,877.272 1590.73,900.136 1593.03,845.082 1595.34,1160.52 1597.65,889.927 1599.96,848.353 1602.26,1184.14 1604.57,1006.13 1606.88,953.017 1609.19,861.705 1611.5,938.672 1613.8,1012.68 1616.11,927.242 1618.42,912.882 1620.73,1028.56 1623.04,1017.63 1625.34,919.286 1627.65,970.087 1629.96,1032.09 1632.27,989.361 1634.58,942.334 1636.88,901.809 1639.19,1004.58 1641.5,967.535 1643.81,754.976 1646.12,864.257 1648.42,909.325 1650.73,866.078 1653.04,803.811 1655.35,946.046 1657.65,984.257 1659.96,1033 1662.27,1019.73 1664.58,969.995 1666.89,999.023 1669.19,1076.05 1671.5,938.742 1673.81,949.816 1676.12,939.815 1678.43,905.529 1680.73,839.346 1683.04,738.151 1685.35,1019.59 1687.66,955.323 1689.97,773.717 1692.27,1011.42 1694.58,810.596 1696.89,786.88 1699.2,901.29 1701.51,1010.85 1703.81,964.802 1706.12,781.34 1708.43,879.093 1710.74,1013.1 1713.04,921.672 1715.35,990.35 1717.66,893.243 1719.97,923.69 1722.28,1158.86 1724.58,859.708 1726.89,1098.09 1729.2,981.691 1731.51,747.824 1733.82,812.044 1736.12,968.418 1738.43,766.622 1740.74,893.486 1743.05,970.65 1745.36,913.962 1747.66,727.286 1749.97,956.964 1752.28,1004.5 1754.59,861.844 1756.9,965.801 1759.2,912.839 1761.51,905.942 1763.82,950.123 1766.13,1042.86 1768.43,1132.75 1770.74,1055.57 1773.05,1060.33 1775.36,924.949 1777.67,888.663 1779.97,1040.56 1782.28,884.738 1784.59,905.994 1786.9,976.048 1789.21,1035.83 1791.51,728.812 1793.82,977.382 1796.13,956.831 1798.44,930.181 1800.75,972.65 1803.05,867.066 1805.36,954.503 1807.67,1041.19 1809.98,975.866 1812.28,1136.45 1814.59,1034.24 1816.9,916.071 1819.21,1060.89 1821.52,843.542 1823.82,978.008 1826.13,935.764 1828.44,951.251 1830.75,1042.24 1833.06,1126.47 1835.36,1056.65 1837.67,953.685 1839.98,1044.72 1842.29,935.808 1844.6,1010.52 1846.9,983.839 1849.21,898.983 1851.52,714.782 1853.83,1018.15 1856.14,999.305 1858.44,957.794 1860.75,940.826 1863.06,947.882 1865.37,802.643 1867.67,1046.32 1869.98,947.283 1872.29,1017.96 1874.6,1047.14 1876.91,957.156 1879.21,811.2 1881.52,941.42 1883.83,865.817 1886.14,975.817 1888.45,987.324 1890.75,950.963 1893.06,987.442 1895.37,932.49 1897.68,1034.69 1899.99,938.857 1902.29,980.824 1904.6,1040.09 1906.91,1118.93 1909.22,1123.9 1911.53,995.374 1913.83,880.367 1916.14,881.457 1918.45,996.265 1920.76,968.559 1923.06,931.958 1925.37,1054.89 1927.68,1006.38 1929.99,817.854 1932.3,980.152 1934.6,1042.65 1936.91,872.689 1939.22,1184.69 1941.53,899.524 1943.84,981.341 1946.14,797.421 1948.45,1041.51 1950.76,935.081 1953.07,927.109 1955.38,1013.87 1957.68,1049.92 1959.99,891.111 1962.3,970.983 1964.61,834.344 1966.91,1101.75 1969.22,872.847 1971.53,849.092 1973.84,1021.39 1976.15,1171.55 1978.45,898.016 1980.76,916.355 1983.07,909.321 1985.38,994.915 1987.69,942.058 1989.99,926.718 1992.3,941.944 1994.61,897.3 1996.92,1107.59 1999.23,1161.29 2001.53,901.809 2003.84,767.12 2006.15,824.334 2008.46,920.454 2010.77,859.798 2013.07,1003.44 2015.38,937.299 2017.69,1131.06 2020,812.339 2022.3,993.963 2024.61,954.602 2026.92,1057.36 2029.23,982.965 2031.54,891.912 2033.84,890.078 2036.15,951.356 2038.46,1064.03 2040.77,843.33 2043.08,989.357 2045.38,969.414 2047.69,924.039 2050,841.942 2052.31,793.302 2054.62,838.47 2056.92,833.428 2059.23,1070.99 2061.54,964.084 2063.85,869.89 2066.16,1040.88 2068.46,998.453 2070.77,818.29 2073.08,894.669 2075.39,970.279 2077.69,1069.8 2080,836.987 2082.31,895.704 2084.62,1029.73 2086.93,993.992 2089.23,934.14 2091.54,918.315 2093.85,995.912 2096.16,911.853 2098.47,1013.39 2100.77,1045.39 2103.08,905.938 2105.39,1000.04 2107.7,834.826 2110.01,717.812 2112.31,845.407 2114.62,831.459 2116.93,945.265 2119.24,989.367 2121.55,865.215 2123.85,845.543 2126.16,869.196 2128.47,989.872 2130.78,949.308 2133.08,1032.38 2135.39,1135.09 2137.7,942.733 2140.01,836.759 2142.32,993.273 2144.62,958.576 2146.93,954.776 2149.24,975.233 2151.55,977.307 2153.86,786.667 2156.16,890.431 2158.47,1038.09 2160.78,1076.07 2163.09,986.556 2165.4,1110.61 2167.7,977.92 2170.01,1022.19 2172.32,966.552 2174.63,1129.5 2176.93,1039.49 2179.24,991.634 2181.55,931.963 2183.86,1009.9 2186.17,900.434 2188.47,995.183 2190.78,1053.33 2193.09,856.44 2195.4,882.238 2197.71,936.997 2200.01,936.729 2202.32,943.365 2204.63,779.958 2206.94,927.067 2209.25,869.756 2211.55,825.282 2213.86,810.317 2216.17,709.335 2218.48,885.422 2220.79,813.771 2223.09,835.251 2225.4,954.896 2227.71,880.492 2230.02,980.434 2232.32,877.046 2234.63,819.5 2236.94,808.797 2239.25,960.085 2241.56,1090.47 2243.86,778.8 2246.17,1054.97 2248.48,799.487 2250.79,930.976 2253.1,1013.94 2255.4,846.484 2257.71,850.347 2260.02,968.969 2262.33,962.773 2264.64,907.82 2266.94,845.895 2269.25,978.277 2271.56,868.068 2273.87,972.438 2276.18,874.514 2278.48,842.379 2280.79,1001.52 2283.1,928.579 2285.41,904.345 2287.71,995.588 2290.02,1165.52 2292.33,947.655 2294.64,967.797 2296.95,1026.46 2299.25,1111.33 2301.56,911.932 2303.87,903.31 2306.18,1005.29 2308.49,890.384 2310.79,965.43 2313.1,959.119 2315.41,884.434 2317.72,1016.23 2320.03,1050.08 2322.33,983.138 2324.64,1011.92 2326.95,989.322 2329.26,968.621 2331.56,962.558 2333.87,1091.35 2336.18,997.649 2338.49,886.768 2340.8,805.533 2343.1,1010.9 2345.41,1066.41 2347.72,719.783 2350.03,870.187 2352.34,912.887 2354.64,935.448 2356.95,975.43 2359.26,961.26 2361.57,924.76 2363.88,972.362 2366.18,952.707 2368.49,943.433 2370.8,1036.58 2373.11,783.907 2375.42,1007.73 2377.72,1051.1 2380.03,789.374 2382.34,808.816 2384.65,952.896 2386.95,906.548 2389.26,1040.79 2391.57,817.948 2393.88,803.894 2396.19,1056.44 2398.49,1057.01 2400.8,880.549 2403.11,901.66 2405.42,1030.96 2407.73,835.537 2410.03,1072.63 2412.34,973.31 2414.65,1223.56 2416.96,904.153 2419.27,1058.93 2421.57,948.913 2423.88,1072.87 2426.19,1053.78 2428.5,918.162 2430.81,903.431 2433.11,1106.09 2435.42,1068.07 2437.73,1134.39 2440.04,938.497 2442.34,920.277 2444.65,971.67 2446.96,944.703 2449.27,943.58 2451.58,918.265 2453.88,1094.51 2456.19,940.601 2458.5,1064.72 2460.81,1083.58 2463.12,929.265 2465.42,831.792 2467.73,924.393 2470.04,903.149 2472.35,1129.34 2474.66,906.976 2476.96,880.175 2479.27,917.026 2481.58,939.636 2483.89,915.417 2486.2,906.492 2488.5,1097.62 2490.81,1030.75 2493.12,948.795 2495.43,1037.77 2497.73,1105.24 2500.04,1063.73 2502.35,1075.82 2504.66,1044.29 2506.97,907.545 2509.27,1167.06 2511.58,799.233 2513.89,953.067 2516.2,879.227 2518.51,1059.42 2520.81,852.353 2523.12,1147.9 2525.43,927.02 2527.74,950.049 2530.05,931.498 2532.35,885.145 2534.66,832.658 2536.97,800.13 2539.28,1034.56 2541.58,849.393 2543.89,1282.98 2546.2,848.303 2548.51,1082.83 2550.82,1150.03 2553.12,1036.16 2555.43,858.293 2557.74,1157.06 2560.05,1043.65 2562.36,1025.43 2564.66,926.184 2566.97,1026.32 2569.28,926.063 2571.59,1074.47 "></polyline>
<polyline clip-path="url(#clip622)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,784.592 268.292,220.841 270.6,404.79 272.908,635.946 275.216,367.175 277.524,338.879 279.832,481.702 282.139,378.756 284.447,490.112 286.755,456.703 289.063,330.964 291.371,378.537 293.679,497.232 295.987,292.306 298.295,401.494 300.603,370.803 302.911,618.147 305.219,503.998 307.527,601 309.834,447.991 312.142,299.262 314.45,495.134 316.758,440.023 319.066,459.146 321.374,161.754 323.682,226.894 325.99,594.747 328.298,497.04 330.606,482.924 332.914,443.631 335.221,372.815 337.529,543.693 339.837,355.232 342.145,518.802 344.453,284.782 346.761,343.175 349.069,556.329 351.377,516.464 353.685,506.904 355.993,299.581 358.301,412.045 360.608,346.159 362.916,287.496 365.224,654.934 367.532,333.914 369.84,384.782 372.148,408.711 374.456,468.087 376.764,291.661 379.072,500.279 381.38,608.757 383.688,643.109 385.996,399.727 388.303,397.999 390.611,334.546 392.919,460.982 395.227,455.693 397.535,591.709 399.843,381.964 402.151,456.185 404.459,426.161 406.767,370.243 409.075,383.725 411.383,496.823 413.69,481.606 415.998,321.722 418.306,551.262 420.614,348.306 422.922,346.114 425.23,416.116 427.538,445.412 429.846,439.977 432.154,452.082 434.462,497.615 436.77,280.694 439.077,547.824 441.385,368.205 443.693,438.831 446.001,595.512 448.309,478.196 450.617,402.726 452.925,345.651 455.233,389.22 457.541,497.338 459.849,361.627 462.157,428.379 464.465,506.043 466.772,376.739 469.08,359.995 471.388,314.326 473.696,495.977 476.004,399.967 478.312,457.763 480.62,507.916 482.928,417.708 485.236,431.236 487.544,590.435 489.852,392.771 492.159,411.058 494.467,332.604 496.775,463.776 499.083,396.992 501.391,451.642 503.699,605.713 506.007,358.953 508.315,548.881 510.623,490.255 512.931,551.856 515.239,504.177 517.546,296.592 519.854,491.125 522.162,562.086 524.47,299.691 526.778,714.067 529.086,455.853 531.394,548.167 533.702,384.721 536.01,292.718 538.318,465.204 540.626,652.798 542.933,355.723 545.241,301.781 547.549,264.757 549.857,451.802 552.165,572.167 554.473,403.727 556.781,641.402 559.089,404.91 561.397,592.293 563.705,378.271 566.013,340.837 568.321,417.06 570.628,466.102 572.936,451.148 575.244,509.297 577.552,414.891 579.86,506.865 582.168,309.775 584.476,295.119 586.784,324.6 589.092,428.594 591.4,448.532 593.708,614.899 596.015,540.063 598.323,471.838 600.631,483.591 602.939,320.356 605.247,491.352 607.555,403.534 609.863,489.759 612.171,620.749 614.479,474.788 616.787,403.103 619.095,304.714 621.402,390.445 623.71,530.434 626.018,597.214 628.326,396.828 630.634,586.57 632.942,430.452 635.25,468.09 637.558,451.109 639.866,711.91 642.174,452.169 644.482,350.667 646.79,350.989 649.097,313.36 651.405,391.742 653.713,521.166 656.021,422.129 658.329,529.366 660.637,496.706 662.945,561.919 665.253,311.336 667.561,402.536 669.869,491.16 672.177,435.054 674.484,384.58 676.792,469.613 679.1,522.992 681.408,467.848 683.716,545.78 686.024,368.31 688.332,549.615 690.64,330.448 692.948,462.397 695.256,514.01 697.564,485.066 699.871,563.226 702.179,714.845 704.487,577.546 706.795,510.267 709.103,268.494 711.411,539.496 713.719,373.36 716.027,351.909 718.335,435.651 720.643,513.833 722.951,665.364 725.259,357.744 727.566,478.144 729.874,519.717 732.182,477.353 734.49,443.123 736.798,451.376 739.106,584.719 741.414,299.935 743.722,413.56 746.03,397.8 748.338,380.543 750.646,459.38 752.953,462.922 755.261,441.941 757.569,413.201 759.877,490.263 762.185,241.663 764.493,514.132 766.801,400.671 769.109,486.53 771.417,400.93 773.725,434.193 776.033,432.57 778.34,696.652 780.648,398.353 782.956,342.259 785.264,437.202 787.572,599.396 789.88,352.397 792.188,391.71 794.496,476.949 796.804,613.128 799.112,526.486 801.42,471.311 803.728,376.092 806.035,575.52 808.343,378.787 810.651,413.547 812.959,513.476 815.267,542.007 817.575,538.177 819.883,564.829 822.191,548.843 824.499,377.652 826.807,668.286 829.115,446.271 831.422,444.098 833.73,583.998 836.038,459.223 838.346,454.372 840.654,466.171 842.962,392.632 845.27,533.514 847.578,388.983 849.886,513.134 852.194,467.637 854.502,407.43 856.809,431.074 859.117,469.001 861.425,410.532 863.733,603.558 866.041,451.604 868.349,307.24 870.657,412.409 872.965,431.898 875.273,237.598 877.581,539.943 879.889,339.711 882.197,534.837 884.504,420.564 886.812,423.472 889.12,511.59 891.428,574.843 893.736,477.431 896.044,401.605 898.352,237.172 900.66,538.736 902.968,474.597 905.276,337.11 907.584,494.707 909.891,332.728 912.199,437.888 914.507,113.369 916.815,464.454 919.123,540.642 921.431,430.02 923.739,355.402 926.047,496.324 928.355,465.135 930.663,362.868 932.971,508.359 935.278,601.326 937.586,524.075 939.894,353.595 942.202,565.38 944.51,379.241 946.818,430.785 949.126,274.121 951.434,508.162 953.742,463.386 956.05,422.328 958.358,423.373 960.665,487.915 962.973,485.995 965.281,281.048 967.589,247.791 969.897,420.427 972.205,349.661 974.513,303.512 976.821,355.627 979.129,305.773 981.437,442.575 983.745,272.702 986.053,542.022 988.36,455.182 990.668,388.15 992.976,601.629 995.284,321.833 997.592,510.868 999.9,360.225 1002.21,433.69 1004.52,424.242 1006.82,577.594 1009.13,501.859 1011.44,447.393 1013.75,269.905 1016.06,526.257 1018.36,387.483 1020.67,369.15 1022.98,290.692 1025.29,450.992 1027.59,459.431 1029.9,549.795 1032.21,241.199 1034.52,385.012 1036.83,496.166 1039.13,432.315 1041.44,514.654 1043.75,465.313 1046.06,504.779 1048.37,416.965 1050.67,424.251 1052.98,483.917 1055.29,353.523 1057.6,562.205 1059.91,455.348 1062.21,546.577 1064.52,444.274 1066.83,399.224 1069.14,253.534 1071.45,282.851 1073.75,495.738 1076.06,369.56 1078.37,524.61 1080.68,383.829 1082.98,582.621 1085.29,359.432 1087.6,438.752 1089.91,313.666 1092.22,513.355 1094.52,454.118 1096.83,585.086 1099.14,503.676 1101.45,446.8 1103.76,652.815 1106.06,557.891 1108.37,434.175 1110.68,423.809 1112.99,633.063 1115.3,549.211 1117.6,244.884 1119.91,304.995 1122.22,612.044 1124.53,400.046 1126.84,410.061 1129.14,277.1 1131.45,537.283 1133.76,509.538 1136.07,527.351 1138.37,631.322 1140.68,419.573 1142.99,579.869 1145.3,610.164 1147.61,662.349 1149.91,526.104 1152.22,358.334 1154.53,482.218 1156.84,434.519 1159.15,375.093 1161.45,406.16 1163.76,303.271 1166.07,544.811 1168.38,507.482 1170.69,573.499 1172.99,388.948 1175.3,578.424 1177.61,549.179 1179.92,356.433 1182.23,450.261 1184.53,488.355 1186.84,421.215 1189.15,492.393 1191.46,516.115 1193.76,515.617 1196.07,404.764 1198.38,453.978 1200.69,423.008 1203,330.727 1205.3,523.79 1207.61,460.669 1209.92,600.433 1212.23,486.912 1214.54,493.762 1216.84,397.703 1219.15,399.393 1221.46,315.13 1223.77,410.858 1226.08,358.904 1228.38,368.076 1230.69,350.071 1233,234.804 1235.31,477.121 1237.61,578.475 1239.92,344.896 1242.23,561.751 1244.54,490.399 1246.85,426.078 1249.15,618.187 1251.46,414.007 1253.77,559.688 1256.08,602.485 1258.39,417.03 1260.69,433.887 1263,441.39 1265.31,436.389 1267.62,334.123 1269.93,476.481 1272.23,475.245 1274.54,374.302 1276.85,422.692 1279.16,563.351 1281.47,393.106 1283.77,414.342 1286.08,604.245 1288.39,356.643 1290.7,488.47 1293,343.386 1295.31,419.316 1297.62,538.133 1299.93,517.975 1302.24,485.062 1304.54,553.759 1306.85,361.578 1309.16,297.606 1311.47,534.861 1313.78,495.736 1316.08,429.124 1318.39,233.804 1320.7,451.187 1323.01,533.287 1325.32,408.446 1327.62,495.563 1329.93,285.339 1332.24,506.682 1334.55,658.988 1336.86,470.384 1339.16,340.231 1341.47,654.365 1343.78,463.524 1346.09,422.223 1348.39,356.464 1350.7,362.503 1353.01,550.254 1355.32,494.07 1357.63,294.31 1359.93,569.906 1362.24,572.601 1364.55,517.178 1366.86,480.355 1369.17,338.132 1371.47,550.516 1373.78,497.04 1376.09,360.854 1378.4,312.358 1380.71,371.09 1383.01,454.312 1385.32,330.608 1387.63,477.47 1389.94,412.769 1392.24,512.665 1394.55,427.842 1396.86,387.454 1399.17,322.295 1401.48,487.716 1403.78,419.791 1406.09,297.291 1408.4,450.617 1410.71,466.821 1413.02,306.889 1415.32,371.546 1417.63,454.884 1419.94,398.765 1422.25,403.663 1424.56,655.436 1426.86,483.519 1429.17,465.522 1431.48,362.166 1433.79,568.46 1436.1,289.932 1438.4,202.815 1440.71,431.525 1443.02,387.296 1445.33,580.145 1447.63,482.031 1449.94,426.597 1452.25,340.622 1454.56,499.63 1456.87,400.658 1459.17,270.558 1461.48,357.662 1463.79,340.46 1466.1,304.897 1468.41,494.251 1470.71,562.573 1473.02,537.332 1475.33,351.392 1477.64,363.138 1479.95,359.111 1482.25,389.779 1484.56,457.186 1486.87,489.919 1489.18,604.76 1491.49,353.251 1493.79,578.055 1496.1,571.589 1498.41,344.286 1500.72,484.407 1503.02,531.714 1505.33,526.52 1507.64,533.868 1509.95,466.683 1512.26,599.166 1514.56,491.865 1516.87,411.372 1519.18,424.986 1521.49,478.881 1523.8,557.434 1526.1,457.881 1528.41,335.54 1530.72,454.883 1533.03,417.18 1535.34,559.417 1537.64,273.84 1539.95,467.077 1542.26,506.641 1544.57,525.196 1546.88,359.504 1549.18,375.252 1551.49,465.344 1553.8,446.624 1556.11,522.732 1558.41,452.383 1560.72,575.391 1563.03,521.023 1565.34,386.05 1567.65,462.802 1569.95,484.531 1572.26,478.674 1574.57,481.588 1576.88,451.514 1579.19,578.196 1581.49,415.686 1583.8,335.199 1586.11,475.994 1588.42,458.413 1590.73,505.887 1593.03,240.556 1595.34,331.656 1597.65,463.688 1599.96,478.899 1602.26,434.747 1604.57,526.68 1606.88,574.81 1609.19,450.688 1611.5,592.517 1613.8,467.875 1616.11,589.855 1618.42,454.901 1620.73,352.338 1623.04,583.337 1625.34,342.063 1627.65,517.992 1629.96,446.65 1632.27,490.628 1634.58,445.673 1636.88,550.95 1639.19,611.356 1641.5,385.522 1643.81,488.018 1646.12,456.412 1648.42,448.077 1650.73,514.567 1653.04,590.468 1655.35,496.899 1657.65,482.828 1659.96,564.978 1662.27,296.151 1664.58,416.303 1666.89,469.267 1669.19,549.182 1671.5,472.229 1673.81,452.759 1676.12,507.981 1678.43,444.492 1680.73,423.753 1683.04,389.849 1685.35,362.127 1687.66,442.519 1689.97,419.176 1692.27,569.133 1694.58,591.8 1696.89,530.162 1699.2,588.181 1701.51,479.024 1703.81,526.134 1706.12,613.995 1708.43,459.391 1710.74,539.435 1713.04,506.709 1715.35,558.002 1717.66,298.433 1719.97,354.8 1722.28,401.396 1724.58,554.558 1726.89,469.201 1729.2,440.197 1731.51,542.108 1733.82,448 1736.12,454.805 1738.43,470.007 1740.74,250.585 1743.05,408.077 1745.36,402.102 1747.66,360.132 1749.97,259.08 1752.28,348.953 1754.59,156.137 1756.9,254.924 1759.2,539.841 1761.51,565.815 1763.82,454.708 1766.13,431.067 1768.43,569.787 1770.74,346.792 1773.05,457.559 1775.36,212.825 1777.67,592.395 1779.97,590.273 1782.28,368.503 1784.59,421.939 1786.9,225.96 1789.21,383.288 1791.51,235.477 1793.82,381.324 1796.13,487.692 1798.44,245.5 1800.75,490.75 1803.05,505.318 1805.36,505.948 1807.67,557.285 1809.98,444.52 1812.28,272.923 1814.59,449.603 1816.9,473.5 1819.21,521.466 1821.52,487.257 1823.82,441.966 1826.13,344.126 1828.44,175.292 1830.75,469.278 1833.06,537.622 1835.36,347.837 1837.67,425.63 1839.98,462.666 1842.29,408.309 1844.6,509.698 1846.9,475.135 1849.21,649.288 1851.52,383.696 1853.83,576.673 1856.14,408.014 1858.44,321.091 1860.75,493.935 1863.06,543.375 1865.37,426.788 1867.67,438.323 1869.98,550.09 1872.29,602.648 1874.6,515.984 1876.91,419.55 1879.21,578.849 1881.52,335.403 1883.83,467.182 1886.14,389.569 1888.45,313.465 1890.75,486.177 1893.06,308.912 1895.37,526.178 1897.68,397.034 1899.99,488.77 1902.29,514.801 1904.6,491.391 1906.91,420.62 1909.22,551.282 1911.53,337.292 1913.83,444.702 1916.14,508.459 1918.45,465.18 1920.76,427.366 1923.06,417.643 1925.37,258.417 1927.68,456.23 1929.99,373.309 1932.3,484.213 1934.6,502.231 1936.91,482.313 1939.22,496.918 1941.53,489.104 1943.84,361.031 1946.14,385.353 1948.45,400.396 1950.76,347.318 1953.07,387.413 1955.38,429.053 1957.68,288.79 1959.99,359.455 1962.3,477.235 1964.61,382.993 1966.91,459.753 1969.22,448.215 1971.53,397.081 1973.84,418.102 1976.15,542.635 1978.45,537.625 1980.76,512.784 1983.07,291.02 1985.38,523.73 1987.69,520.947 1989.99,386.409 1992.3,312.673 1994.61,457.56 1996.92,498.591 1999.23,409.53 2001.53,480.793 2003.84,423.842 2006.15,404.898 2008.46,367.661 2010.77,498.741 2013.07,538.034 2015.38,366.668 2017.69,477.044 2020,415.558 2022.3,550.755 2024.61,403.011 2026.92,228.034 2029.23,489.29 2031.54,574.58 2033.84,453.855 2036.15,397.149 2038.46,692.957 2040.77,456.151 2043.08,377.518 2045.38,681.389 2047.69,365.48 2050,331.748 2052.31,436.664 2054.62,484.325 2056.92,519.405 2059.23,596.941 2061.54,553.945 2063.85,325.395 2066.16,337.777 2068.46,409.162 2070.77,461.891 2073.08,502.891 2075.39,487.837 2077.69,567.901 2080,441.663 2082.31,474.917 2084.62,470.345 2086.93,562.762 2089.23,608.857 2091.54,713.927 2093.85,542.241 2096.16,458.048 2098.47,616.102 2100.77,487.934 2103.08,534.995 2105.39,556.855 2107.7,404.812 2110.01,442.483 2112.31,386.016 2114.62,416.132 2116.93,503.286 2119.24,626.693 2121.55,443.034 2123.85,603.236 2126.16,476.446 2128.47,491.922 2130.78,615.357 2133.08,316.031 2135.39,474.597 2137.7,459.817 2140.01,504.369 2142.32,568.05 2144.62,464.524 2146.93,447.631 2149.24,475.874 2151.55,379.67 2153.86,364.999 2156.16,512.434 2158.47,549.292 2160.78,338.388 2163.09,512.113 2165.4,411.503 2167.7,500.941 2170.01,426.603 2172.32,533.839 2174.63,585.535 2176.93,399.305 2179.24,472.015 2181.55,339.5 2183.86,464.416 2186.17,391.616 2188.47,482.834 2190.78,437.479 2193.09,340.312 2195.4,362.688 2197.71,96.8724 2200.01,610.588 2202.32,306.912 2204.63,559.248 2206.94,418.797 2209.25,226.636 2211.55,580.48 2213.86,392.85 2216.17,496.224 2218.48,622.511 2220.79,632.595 2223.09,408.266 2225.4,451.394 2227.71,577.172 2230.02,341.803 2232.32,549.977 2234.63,579.352 2236.94,438.827 2239.25,225.137 2241.56,425.838 2243.86,438.945 2246.17,384.999 2248.48,347.221 2250.79,560.881 2253.1,180.831 2255.4,488.354 2257.71,491.168 2260.02,346.87 2262.33,397.168 2264.64,406.926 2266.94,249.737 2269.25,571.648 2271.56,338.845 2273.87,270.506 2276.18,368.183 2278.48,393.868 2280.79,510.37 2283.1,416.003 2285.41,438.949 2287.71,407.868 2290.02,549.671 2292.33,574.602 2294.64,236.813 2296.95,319.374 2299.25,588.241 2301.56,505.728 2303.87,310.961 2306.18,475.423 2308.49,572.664 2310.79,406.763 2313.1,347.156 2315.41,504.544 2317.72,385.752 2320.03,377.703 2322.33,547.639 2324.64,380.541 2326.95,544.912 2329.26,471.507 2331.56,581.615 2333.87,495.992 2336.18,412.516 2338.49,444.547 2340.8,383.277 2343.1,530.465 2345.41,208.96 2347.72,433.637 2350.03,408.381 2352.34,516.989 2354.64,494.755 2356.95,471.383 2359.26,416.393 2361.57,649.333 2363.88,451.536 2366.18,345.76 2368.49,590.361 2370.8,452.532 2373.11,592.643 2375.42,318.901 2377.72,605.02 2380.03,436.98 2382.34,614.539 2384.65,401.831 2386.95,563.73 2389.26,449.287 2391.57,423.742 2393.88,484.132 2396.19,323.442 2398.49,389.941 2400.8,354.656 2403.11,567.795 2405.42,448.295 2407.73,482.098 2410.03,426.461 2412.34,305.401 2414.65,369.375 2416.96,434.296 2419.27,517.429 2421.57,640.58 2423.88,509.456 2426.19,167.937 2428.5,385.054 2430.81,574.058 2433.11,397.094 2435.42,726.618 2437.73,523.67 2440.04,333.827 2442.34,506.632 2444.65,593.808 2446.96,446.406 2449.27,471.581 2451.58,462.42 2453.88,494.45 2456.19,464.416 2458.5,536.4 2460.81,510.969 2463.12,567.764 2465.42,614.206 2467.73,468.228 2470.04,513.909 2472.35,529.096 2474.66,376.665 2476.96,538.161 2479.27,425.274 2481.58,525.611 2483.89,249.813 2486.2,487.496 2488.5,347.411 2490.81,518.558 2493.12,421.361 2495.43,328.542 2497.73,338.314 2500.04,254.995 2502.35,410.751 2504.66,543.598 2506.97,430.09 2509.27,576.241 2511.58,483.521 2513.89,373.996 2516.2,452.77 2518.51,637.205 2520.81,387.14 2523.12,480.696 2525.43,604.327 2527.74,366.069 2530.05,299.911 2532.35,568.293 2534.66,244.403 2536.97,426.02 2539.28,421.252 2541.58,411.124 2543.89,329.945 2546.2,394.707 2548.51,274.992 2550.82,503.875 2553.12,465.457 2555.43,489.575 2557.74,627.082 2560.05,337.283 2562.36,300.022 2564.66,465.904 2566.97,412.646 2569.28,465.137 2571.59,328.366 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -2.08864   -2.2393    -3.76508   …  -4.87596   -4.87596   -4.87596
  0.769606   0.435744  -0.486755      0.265479   0.265479   0.265479
  3.79011    4.5529     5.14789       4.19114    4.19114    4.19114

[:, :, 2] =
 -3.26623     -2.64559   -3.52046  …  -4.39279   -4.40265   -4.81288
  0.00487004  -0.185455  -1.27621      0.311524   0.207638  -0.452277
  2.39742      4.08642    5.01396      6.39229    5.74263    4.48373

[:, :, 3] =
 -2.63744  -3.96216   -3.74388  -3.93265  …  -5.45119   -5.45119   -5.45119
 -1.02719   0.823915   1.21921   1.30072      0.342894   0.342894   0.342894
  2.46826   1.85525    3.33896   3.58791      4.74004    4.74004    4.74004

[:, :, 4] =
 -2.62245  -4.94563  -4.73737   -5.6538    …  -6.20316   -6.48523   -6.97095
  1.84118   1.84046  -0.463745  -0.167497     -0.479509  -0.350779  -2.07189
  3.81239   3.84707   6.5322     4.59366       4.14005    4.4122     4.08488</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.9673     0.999693
 -0.0305629  0.987419
  5.01029    0.984699</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DynamicPPL</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">DynamicPPL.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.1 seconds
Compute duration  = 3.1 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

        x[1]   -4.9890    0.9926    0.0172   3315.7853   5486.1779    1.0000   ⋯
        x[2]   -0.0239    1.0013    0.0180   3078.3503   5455.6916    0.9999   ⋯
        x[3]    4.9846    0.9984    0.0182   3036.0574   5295.3929    1.0005   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

        x[1]   -6.9116   -5.6636   -4.9996   -4.3226   -3.0282
        x[2]   -1.9774   -0.7105   -0.0175    0.6481    1.9324
        x[3]    3.0572    4.3165    4.9661    5.6461    6.9675
</span></pre>
</div>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.84 seconds
Compute duration  = 1.84 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

           x    0.5034    0.1891    0.0028   4451.3302   6007.5641    1.0001   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.1477    0.3618    0.5031    0.6445    0.8558
</span></pre>
</div>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.17 seconds
Compute duration  = 0.17 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">   ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">    Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

           x    0.9362    0.0094    0.0001   10000.0008        NaN    1.0000   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.9362    0.9362    0.9362    0.9362    0.9362
</span></pre>
</div>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre>DomainError with -0.2987662426256582:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] <span class="ansi-bold">#371</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [2] <span class="ansi-bold">check_args</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">utils.jl:89</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [3] <span class="ansi-bold">#Normal#370</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [4] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:36</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [5] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:42</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [6] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">compiler.jl:558</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [7] <span class="ansi-bold">demo</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">__model__</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">__varinfo__</span>::DynamicPPL.ThreadSafeVarInfo<span class="ansi-bright-black-fg">{VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, Vector{Base.RefValue{Float64}}}</span>, <span class="ansi-bright-black-fg">__context__</span>::DynamicPPL.ValuesAsInModelContext<span class="ansi-bright-black-fg">{DefaultContext}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:457</span>
  [8] <span class="ansi-bold">_evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:913</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [9] <span class="ansi-bold">evaluate_threadsafe!!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">varinfo</span>::VarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}</span>, <span class="ansi-bright-black-fg">context</span>::DynamicPPL.ValuesAsInModelContext<span class="ansi-bright-black-fg">{DefaultContext}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:902</span>
 [10] <span class="ansi-bold">evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:832</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [11] <span class="ansi-bold">values_as_in_model</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">values_as_in_model.jl:173</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [12] <span class="ansi-bold">values_as_in_model</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">values_as_in_model.jl:172</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [13] <span class="ansi-bold">getparams</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">vi</span>::VarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1gxqi/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:179</span>
 [14] <span class="ansi-bold">Turing.Inference.Transition</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">vi</span>::VarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}</span>, <span class="ansi-bright-black-fg">t</span>::MALASample<span class="ansi-bright-black-fg">{Vector{Float64}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1gxqi/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:141</span>
 [15] <span class="ansi-bold">transition_to_turing</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::LogDensityFunction<span class="ansi-bright-black-fg">{Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}</span>, <span class="ansi-bright-black-fg">transition</span>::MALASample<span class="ansi-bright-black-fg">{Vector{Float64}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1gxqi/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">external_sampler.jl:82</span>
 [16] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler_wrapper</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>; <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">initial_params</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1gxqi/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">external_sampler.jl:147</span>
 [17] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/F50rb/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:0</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [18] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/F50rb/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:16</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [19] <span class="ansi-bold">mcmcsample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">progress</span>::Bool, <span class="ansi-bright-black-fg">progressname</span>::String, <span class="ansi-bright-black-fg">callback</span>::Nothing, <span class="ansi-bright-black-fg">num_warmup</span>::Int64, <span class="ansi-bright-black-fg">discard_initial</span>::Int64, <span class="ansi-bright-black-fg">thinning</span>::Int64, <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-yellow-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/F50rb/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:144</span>
 [20] <span class="ansi-bold">sample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">resume_from</span>::Nothing, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{progress::Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:102</span>
 [21] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:92</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [22] <span class="ansi-bold">#sample#101</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1gxqi/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:29</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [23] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1gxqi/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:20</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [24] <span class="ansi-bold">#sample#100</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1gxqi/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:17</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [25] top-level scope
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:459</span></pre>
</div>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.01 seconds
Compute duration  = 2.01 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.8683    0.6209    0.0380   222.2966    76.7422    1.0106     ⋯
           x    0.0239    0.9837    0.0529   477.5776   319.5666    1.0013     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.0803    0.3920    0.7316    1.2174    2.3623
           x   -1.8883   -0.4465   -0.0021    0.4228    2.3484
</span></pre>
</div>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.08 seconds
Compute duration  = 3.08 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.5062    0.0000       NaN        NaN        NaN       NaN     ⋯
           x   -3.1595    0.0000    0.0000        NaN        NaN       NaN     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.5062    0.5062    0.5062    0.5062    0.5062
           x   -3.1595   -3.1595   -3.1595   -3.1595   -3.1595
</span></pre>
</div>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/turinglang\.org\/docs\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../developers/inference/variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2018–2025 under the terms of the <a href="https://github.com/TuringLang/docs/blob/main/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>