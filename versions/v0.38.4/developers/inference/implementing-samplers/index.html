<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing Samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../developers/inference/variational-inference/index.html" rel="prev">
<link href="../../../assets/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-8ef56b68f8fa1e9d2ba328e99e439f80.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-adfd425b459c6192e2aaf302ef6f29d8.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-0c340ff1686979d72b89a501eb484056.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../../site_libs/bootstrap/bootstrap-adfd425b459c6192e2aaf302ef6f29d8.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../tutorials/coin-flipping/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.38" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.38</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.38">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/variational-inference/index.html">Inference in Detail</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../core-functionality/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">User Guide</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/automatic-differentiation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/tracking-extra-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tracking Extra Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/sampler-visualisation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/troubleshooting/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Troubleshooting</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/coin-flipping/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-neural-networks/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/hidden-markov-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/infinite-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-time-series-analysis/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-processes-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Processes: Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-process-latent-variable-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contributing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL’s Compiler</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/design-overview/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design (Outdated)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL Contexts</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contexts/submodel-condition/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conditioning and fixing in submodels</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">Variable Transformations</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/distributions/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributions and the Jacobian</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/bijectors/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bijectors in MCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/dynamicppl/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variable transformations in DynamicPPL</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference in Detail</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/variational-inference/index.html">Inference in Detail</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing Samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-25.80291639557095</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-25.80291639557095</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -3.31694    -3.5472    -4.6666    …  -4.81876  -3.62873  -4.62313
 -0.0359819   0.651482   0.682934     -1.87665  -1.01737  -0.653479
  1.76622     2.98401    3.68357       5.22332   5.941     5.29636</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.94425     1.00519
  0.00585062  0.9874
  5.00877     0.984655</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip650">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip650)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip651">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip650)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip652">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip652)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip652)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip652)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip652)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip652)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip652)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1499.78 2640.76,1499.78 "></polyline>
<polyline clip-path="url(#clip652)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1195.65 2640.76,1195.65 "></polyline>
<polyline clip-path="url(#clip652)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,891.519 2640.76,891.519 "></polyline>
<polyline clip-path="url(#clip652)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,587.387 2640.76,587.387 "></polyline>
<polyline clip-path="url(#clip652)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,283.255 2640.76,283.255 "></polyline>
<polyline clip-path="url(#clip650)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip650)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip650)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip650)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip650)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip650)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip650)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip650)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip650)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1499.78 170.644,1499.78 "></polyline>
<polyline clip-path="url(#clip650)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1195.65 170.644,1195.65 "></polyline>
<polyline clip-path="url(#clip650)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,891.519 170.644,891.519 "></polyline>
<polyline clip-path="url(#clip650)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,587.387 170.644,587.387 "></polyline>
<polyline clip-path="url(#clip650)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,283.255 170.644,283.255 "></polyline>
<path clip-path="url(#clip650)" d="M49.5521 1500.24 L79.2279 1500.24 L79.2279 1504.17 L49.5521 1504.17 L49.5521 1500.24 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M99.8991 1497.92 Q96.7509 1497.92 94.8991 1500.07 Q93.0704 1502.23 93.0704 1505.98 Q93.0704 1509.7 94.8991 1511.88 Q96.7509 1514.03 99.8991 1514.03 Q103.047 1514.03 104.876 1511.88 Q106.728 1509.7 106.728 1505.98 Q106.728 1502.23 104.876 1500.07 Q103.047 1497.92 99.8991 1497.92 M109.181 1483.27 L109.181 1487.53 Q107.422 1486.69 105.617 1486.25 Q103.834 1485.81 102.075 1485.81 Q97.4454 1485.81 94.9917 1488.94 Q92.5612 1492.06 92.2139 1498.38 Q93.5797 1496.37 95.6398 1495.3 Q97.7 1494.22 100.177 1494.22 Q105.385 1494.22 108.394 1497.39 Q111.427 1500.54 111.427 1505.98 Q111.427 1511.3 108.279 1514.52 Q105.131 1517.74 99.8991 1517.74 Q93.9037 1517.74 90.7325 1513.15 Q87.5612 1508.55 87.5612 1499.82 Q87.5612 1491.62 91.45 1486.76 Q95.3389 1481.88 101.89 1481.88 Q103.649 1481.88 105.431 1482.23 Q107.237 1482.57 109.181 1483.27 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M50.3623 1196.1 L80.0381 1196.1 L80.0381 1200.04 L50.3623 1200.04 L50.3623 1196.1 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M104.297 1194.3 Q107.654 1195.02 109.529 1197.28 Q111.427 1199.55 111.427 1202.89 Q111.427 1208 107.908 1210.8 Q104.39 1213.6 97.9083 1213.6 Q95.7324 1213.6 93.4176 1213.16 Q91.126 1212.75 88.6723 1211.89 L88.6723 1207.38 Q90.6167 1208.51 92.9315 1209.09 Q95.2463 1209.67 97.7695 1209.67 Q102.168 1209.67 104.459 1207.93 Q106.774 1206.2 106.774 1202.89 Q106.774 1199.83 104.621 1198.12 Q102.492 1196.38 98.6722 1196.38 L94.6445 1196.38 L94.6445 1192.54 L98.8574 1192.54 Q102.306 1192.54 104.135 1191.17 Q105.964 1189.78 105.964 1187.19 Q105.964 1184.53 104.066 1183.12 Q102.191 1181.68 98.6722 1181.68 Q96.7509 1181.68 94.5519 1182.1 Q92.3528 1182.52 89.7139 1183.39 L89.7139 1179.23 Q92.376 1178.49 94.6908 1178.12 Q97.0287 1177.75 99.0889 1177.75 Q104.413 1177.75 107.515 1180.18 Q110.617 1182.58 110.617 1186.7 Q110.617 1189.58 108.973 1191.57 Q107.33 1193.53 104.297 1194.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M99.4824 877.318 Q95.8713 877.318 94.0426 880.883 Q92.2371 884.425 92.2371 891.554 Q92.2371 898.661 94.0426 902.225 Q95.8713 905.767 99.4824 905.767 Q103.117 905.767 104.922 902.225 Q106.751 898.661 106.751 891.554 Q106.751 884.425 104.922 880.883 Q103.117 877.318 99.4824 877.318 M99.4824 873.614 Q105.293 873.614 108.348 878.221 Q111.427 882.804 111.427 891.554 Q111.427 900.281 108.348 904.887 Q105.293 909.471 99.4824 909.471 Q93.6723 909.471 90.5936 904.887 Q87.538 900.281 87.538 891.554 Q87.538 882.804 90.5936 878.221 Q93.6723 873.614 99.4824 873.614 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M104.297 586.033 Q107.654 586.751 109.529 589.019 Q111.427 591.288 111.427 594.621 Q111.427 599.737 107.908 602.538 Q104.39 605.338 97.9083 605.338 Q95.7324 605.338 93.4176 604.899 Q91.126 604.482 88.6723 603.626 L88.6723 599.112 Q90.6167 600.246 92.9315 600.825 Q95.2463 601.403 97.7695 601.403 Q102.168 601.403 104.459 599.667 Q106.774 597.931 106.774 594.621 Q106.774 591.565 104.621 589.852 Q102.492 588.116 98.6722 588.116 L94.6445 588.116 L94.6445 584.274 L98.8574 584.274 Q102.306 584.274 104.135 582.908 Q105.964 581.519 105.964 578.927 Q105.964 576.265 104.066 574.853 Q102.191 573.417 98.6722 573.417 Q96.7509 573.417 94.5519 573.834 Q92.3528 574.251 89.7139 575.13 L89.7139 570.964 Q92.376 570.223 94.6908 569.853 Q97.0287 569.482 99.0889 569.482 Q104.413 569.482 107.515 571.913 Q110.617 574.32 110.617 578.44 Q110.617 581.311 108.973 583.302 Q107.33 585.269 104.297 586.033 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip650)" d="M99.8991 281.392 Q96.7509 281.392 94.8991 283.544 Q93.0704 285.697 93.0704 289.447 Q93.0704 293.174 94.8991 295.35 Q96.7509 297.503 99.8991 297.503 Q103.047 297.503 104.876 295.35 Q106.728 293.174 106.728 289.447 Q106.728 285.697 104.876 283.544 Q103.047 281.392 99.8991 281.392 M109.181 266.739 L109.181 270.998 Q107.422 270.165 105.617 269.725 Q103.834 269.285 102.075 269.285 Q97.4454 269.285 94.9917 272.41 Q92.5612 275.535 92.2139 281.854 Q93.5797 279.841 95.6398 278.776 Q97.7 277.688 100.177 277.688 Q105.385 277.688 108.394 280.859 Q111.427 284.007 111.427 289.447 Q111.427 294.771 108.279 297.989 Q105.131 301.206 99.8991 301.206 Q93.9037 301.206 90.7325 296.623 Q87.5612 292.016 87.5612 283.29 Q87.5612 275.095 91.45 270.234 Q95.3389 265.35 101.89 265.35 Q103.649 265.35 105.431 265.697 Q107.237 266.044 109.181 266.739 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip652)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1227.78 224.541,1390.93 226.891,1436.24 229.242,1522.43 231.592,1500.63 233.943,1369.54 236.293,1348.57 238.644,1405.77 240.994,1237.76 243.345,1415.45 245.695,1539.74 248.046,1532.28 250.396,1581.22 252.747,1542.45 255.097,1396.78 257.448,1403.79 259.798,1378.31 262.148,1284.91 264.499,1375.81 266.849,1383.93 269.2,1395.79 271.55,1366.77 273.901,1330.72 276.251,1395.05 278.602,1400.02 280.952,1548.51 283.303,1413.69 285.653,1335.95 288.004,1407.4 290.354,1386.23 292.705,1429.34 295.055,1506.11 297.406,1244.59 299.756,1404.45 302.107,1440.59 304.457,1390.9 306.807,1368.34 309.158,1374.6 311.508,1428.43 313.859,1569.83 316.209,1217.07 318.56,1291.48 320.91,1426.46 323.261,1242.09 325.611,1469.16 327.962,1459.23 330.312,1286.83 332.663,1474.79 335.013,1457.61 337.364,1433.66 339.714,1215.76 342.065,1322.13 344.415,1321.88 346.765,1513.58 349.116,1591.94 351.466,1547.31 353.817,1442.05 356.167,1249.21 358.518,1331.06 360.868,1489.3 363.219,1306.91 365.569,1516.64 367.92,1521.98 370.27,1436.79 372.621,1389.54 374.971,1443.52 377.322,1446.83 379.672,1492.1 382.023,1504.93 384.373,1606.63 386.724,1294.8 389.074,1409.77 391.424,1255.47 393.775,1565.84 396.125,1250.7 398.476,1546.07 400.826,1314.17 403.177,1542.08 405.527,1411.13 407.878,1341.42 410.228,1438.79 412.579,1494.07 414.929,1359.27 417.28,1404.26 419.63,1444.17 421.981,1362.63 424.331,1633.94 426.682,1457.21 429.032,1206.71 431.382,1416.9 433.733,1486.52 436.083,1313.72 438.434,1220.04 440.784,1417.65 443.135,1561.71 445.485,1438.6 447.836,1344.96 450.186,1445.43 452.537,1284.6 454.887,1335.24 457.238,1321.45 459.588,1389.79 461.939,1306.18 464.289,1530.92 466.64,1473.74 468.99,1375.55 471.341,1315.99 473.691,1525.76 476.041,1376.2 478.392,1440.72 480.742,1272.93 483.093,1239.54 485.443,1328.61 487.794,1616.27 490.144,1235.75 492.495,1474.79 494.845,1454.24 497.196,1463.78 499.546,1244.9 501.897,1313.54 504.247,1320.39 506.598,1346.36 508.948,1398.67 511.299,1250.86 513.649,1350.8 515.999,1518.88 518.35,1334.07 520.7,1303.59 523.051,1455.33 525.401,1282.59 527.752,1439.27 530.102,1390.96 532.453,1337.76 534.803,1260.77 537.154,1389.33 539.504,1397.86 541.855,1603.2 544.205,1368.82 546.556,1444.59 548.906,1222.12 551.257,1487.65 553.607,1381.27 555.958,1434.33 558.308,1277.63 560.658,1222.27 563.009,1352.45 565.359,1088.12 567.71,1385.49 570.06,1211.99 572.411,1478.65 574.761,1348.9 577.112,1387.08 579.462,1100.41 581.813,1384.87 584.163,1383.34 586.514,1174.21 588.864,1351.97 591.215,1364.68 593.565,1505.22 595.916,1240.61 598.266,1269.76 600.616,1388.43 602.967,1328.03 605.317,1467.44 607.668,1426.52 610.018,1326.1 612.369,1382.08 614.719,1358.58 617.07,1352.67 619.42,1292.34 621.771,1400.32 624.121,1394.45 626.472,1464.78 628.822,1386.9 631.173,1347.32 633.523,1302.89 635.874,1502.45 638.224,1284.11 640.575,1494.19 642.925,1390.4 645.275,1419.38 647.626,1517.94 649.976,1401.12 652.327,1516.95 654.677,1348.29 657.028,1438.83 659.378,1455.13 661.729,1307.64 664.079,1550.15 666.43,1493.62 668.78,1534.05 671.131,1394.85 673.481,1303.31 675.832,1379.55 678.182,1338.42 680.533,1235.23 682.883,1236.78 685.233,1351.21 687.584,1267.83 689.934,1508.87 692.285,1331.7 694.635,1439.3 696.986,1473.59 699.336,1493.15 701.687,1430.68 704.037,1257.31 706.388,1349.83 708.738,1521.46 711.089,1402.08 713.439,1361.69 715.79,1457.5 718.14,1362.87 720.491,1417.53 722.841,1412.21 725.192,1364.3 727.542,1354.14 729.892,1282.73 732.243,1300.64 734.593,1396.37 736.944,1511.94 739.294,1191.97 741.645,1450.61 743.995,1376.33 746.346,1381.86 748.696,1523.61 751.047,1412.84 753.397,1245.19 755.748,1407.43 758.098,1287.27 760.449,1420.68 762.799,1428.23 765.15,1462.69 767.5,1223.56 769.85,1403.73 772.201,1469.22 774.551,1323.78 776.902,1503.47 779.252,1485.98 781.603,1235.03 783.953,1427.61 786.304,1405.64 788.654,1287.86 791.005,1557.89 793.355,1435.25 795.706,1487.32 798.056,1656.22 800.407,1250.92 802.757,1401 805.108,1354.91 807.458,1442.88 809.809,1334.29 812.159,1224.94 814.509,1472.65 816.86,1322.89 819.21,1392.49 821.561,1368.44 823.911,1434.36 826.262,1323.22 828.612,1499.5 830.963,1382.79 833.313,1435.11 835.664,1361.56 838.014,1336.89 840.365,1164.8 842.715,1292.63 845.066,1451.25 847.416,1524.22 849.767,1482.4 852.117,1418.22 854.467,1435.35 856.818,1499.33 859.168,1375.44 861.519,1341.63 863.869,1404.68 866.22,1165.96 868.57,1423.68 870.921,1340.32 873.271,1462.46 875.622,1434.12 877.972,1350.39 880.323,1402.33 882.673,1350.5 885.024,1312.86 887.374,1455.13 889.725,1515.09 892.075,1474.62 894.426,1104.53 896.776,1352.14 899.126,1378.1 901.477,1291.22 903.827,1240.34 906.178,1312.62 908.528,1263.71 910.879,1495.95 913.229,1402.25 915.58,1322.09 917.93,1599 920.281,1440.02 922.631,1390.37 924.982,1424.78 927.332,1481.39 929.683,1331.14 932.033,1300.19 934.384,1316.91 936.734,1454.01 939.084,1416.62 941.435,1394.81 943.785,1440.94 946.136,1405.55 948.486,1350.2 950.837,1247.34 953.187,1376.37 955.538,1253.86 957.888,1222.57 960.239,1519.62 962.589,1355.22 964.94,1346.14 967.29,1443.45 969.641,1536.28 971.991,1440.46 974.342,1366.08 976.692,1570.52 979.043,1453.84 981.393,1417.49 983.743,1383.54 986.094,1095.97 988.444,1320.05 990.795,1519.4 993.145,1407.04 995.496,1257.98 997.846,1431.07 1000.2,1235.51 1002.55,1393.34 1004.9,1492.88 1007.25,1387.38 1009.6,1462.93 1011.95,1439.97 1014.3,1346.6 1016.65,1377.7 1019,1219.96 1021.35,1416.43 1023.7,1311.26 1026.05,1425.59 1028.4,1438.58 1030.75,1417.54 1033.1,1217.94 1035.45,1259.71 1037.8,1254.04 1040.15,1332.73 1042.51,1585.61 1044.86,1393.3 1047.21,1448.15 1049.56,1215.67 1051.91,1336.17 1054.26,1395.09 1056.61,1383.99 1058.96,1353.78 1061.31,1339.92 1063.66,1507.75 1066.01,1432.62 1068.36,1431.27 1070.71,1556.24 1073.06,1422.89 1075.41,1379.87 1077.76,1388.93 1080.11,1545.4 1082.46,1363.94 1084.81,1392.8 1087.16,1418.81 1089.51,1321.49 1091.87,1400.11 1094.22,1344.89 1096.57,1408.29 1098.92,1552.51 1101.27,1154.93 1103.62,1400.09 1105.97,1329.3 1108.32,1423.13 1110.67,1422.25 1113.02,1178.73 1115.37,1330.97 1117.72,1337.4 1120.07,1363.16 1122.42,1395.03 1124.77,1316.39 1127.12,1160.95 1129.47,1226.97 1131.82,1367.67 1134.17,1502.92 1136.52,1215.85 1138.87,1370.96 1141.23,1313.34 1143.58,1311.49 1145.93,1497.4 1148.28,1615.9 1150.63,1459.83 1152.98,1177.72 1155.33,1272.19 1157.68,1407.1 1160.03,1387.39 1162.38,1326.65 1164.73,1219.88 1167.08,1462.25 1169.43,1251.81 1171.78,1389.56 1174.13,1536.76 1176.48,1260.47 1178.83,1147.01 1181.18,1201.39 1183.53,1406.63 1185.88,1398.57 1188.23,1276.25 1190.59,1409.9 1192.94,1426.87 1195.29,1417 1197.64,1301.85 1199.99,1386.63 1202.34,1208.4 1204.69,1270.15 1207.04,1229.02 1209.39,1406.2 1211.74,1421.76 1214.09,1465 1216.44,1524.96 1218.79,1297.55 1221.14,1389.62 1223.49,1403.98 1225.84,1387.52 1228.19,1280.18 1230.54,1409.85 1232.89,1434.01 1235.24,1451.92 1237.59,1576.56 1239.94,1635.03 1242.3,1276.53 1244.65,1586.08 1247,1404.41 1249.35,1305.81 1251.7,1336.04 1254.05,1464.54 1256.4,1411.7 1258.75,1532.26 1261.1,1343.19 1263.45,1440.39 1265.8,1564.72 1268.15,1313.86 1270.5,1450.29 1272.85,1156.53 1275.2,1218.67 1277.55,1310.07 1279.9,1586.72 1282.25,1321.42 1284.6,1407.37 1286.95,1491.64 1289.3,1494.14 1291.66,1393.29 1294.01,1395.86 1296.36,1077.17 1298.71,1311.64 1301.06,1451.76 1303.41,1466.74 1305.76,1242.92 1308.11,1253.26 1310.46,1517.44 1312.81,1497.75 1315.16,1466.75 1317.51,1417.19 1319.86,1386.94 1322.21,1476.69 1324.56,1592.23 1326.91,1397.17 1329.26,1378.73 1331.61,1400.9 1333.96,1529.98 1336.31,1240.71 1338.66,1359.29 1341.02,1624.41 1343.37,1575.71 1345.72,1393.02 1348.07,1337.67 1350.42,1449.07 1352.77,1440.01 1355.12,1490.7 1357.47,1506.68 1359.82,1382.4 1362.17,1503.77 1364.52,1501.43 1366.87,1236.7 1369.22,1397.59 1371.57,1405.24 1373.92,1292.56 1376.27,1311.08 1378.62,1409.75 1380.97,1415.72 1383.32,1410.33 1385.67,1269.91 1388.02,1433.69 1390.38,1481.58 1392.73,1247.63 1395.08,1428.02 1397.43,1381.66 1399.78,1438.36 1402.13,1374.31 1404.48,1468.96 1406.83,1278.69 1409.18,1396.41 1411.53,1407.67 1413.88,1403.76 1416.23,1403.19 1418.58,1281.5 1420.93,1392.42 1423.28,1536.8 1425.63,1453.06 1427.98,1288.05 1430.33,1367.37 1432.68,1418.9 1435.03,1311.3 1437.38,1477.82 1439.74,1624.02 1442.09,1451.94 1444.44,1221.99 1446.79,1332.79 1449.14,1389 1451.49,1478.17 1453.84,1391.02 1456.19,1563.01 1458.54,1390.73 1460.89,1424.62 1463.24,1265.72 1465.59,1394.26 1467.94,1443.35 1470.29,1361.48 1472.64,1141.66 1474.99,1401.75 1477.34,1359.78 1479.69,1327.15 1482.04,1463.67 1484.39,1495.21 1486.74,1441.02 1489.1,1555.35 1491.45,1334.79 1493.8,1483.64 1496.15,1398.36 1498.5,1324.75 1500.85,1387.24 1503.2,1222.13 1505.55,1505.89 1507.9,1301.65 1510.25,1424.85 1512.6,1390.93 1514.95,1394.66 1517.3,1396.58 1519.65,1532.33 1522,1264.52 1524.35,1406.45 1526.7,1548.45 1529.05,1298.34 1531.4,1471.1 1533.75,1222.08 1536.1,1275.23 1538.45,1664.17 1540.81,1345.52 1543.16,1326.26 1545.51,1562.27 1547.86,1366.88 1550.21,1171.12 1552.56,1388.24 1554.91,1349.56 1557.26,1223.62 1559.61,1391.43 1561.96,1384.95 1564.31,1387.11 1566.66,1439.05 1569.01,1408.14 1571.36,1299.72 1573.71,1424.15 1576.06,1277.41 1578.41,1435.74 1580.76,1457.32 1583.11,1459.13 1585.46,1508.29 1587.81,1372.53 1590.17,1540.85 1592.52,1341.63 1594.87,1298.69 1597.22,1373.7 1599.57,1305.01 1601.92,1321.37 1604.27,1337.37 1606.62,1485.24 1608.97,1588.5 1611.32,1350.53 1613.67,1508.01 1616.02,1212.26 1618.37,1654.88 1620.72,1349.14 1623.07,1517.7 1625.42,1392.69 1627.77,1446.32 1630.12,1424.43 1632.47,1110.24 1634.82,1408.93 1637.17,1519.27 1639.53,1319.29 1641.88,1344.27 1644.23,1345.84 1646.58,1582.27 1648.93,1490.89 1651.28,1275.31 1653.63,1501.95 1655.98,1347.69 1658.33,1488.01 1660.68,1268.85 1663.03,1368.83 1665.38,1298.64 1667.73,1423.28 1670.08,1506.94 1672.43,1338.79 1674.78,1489.19 1677.13,1426.28 1679.48,1571.12 1681.83,1337.55 1684.18,1518.57 1686.53,1342.38 1688.89,1361.65 1691.24,1268.54 1693.59,1356.44 1695.94,1302.97 1698.29,1319.69 1700.64,1457.64 1702.99,1620 1705.34,1071.52 1707.69,1529.41 1710.04,1366.66 1712.39,1428.25 1714.74,1415.55 1717.09,1440.94 1719.44,1178.11 1721.79,1570.39 1724.14,1447.76 1726.49,1226.21 1728.84,1318.25 1731.19,1273.23 1733.54,1346.02 1735.89,1415.5 1738.25,1289.15 1740.6,1176.24 1742.95,1403.8 1745.3,1321.05 1747.65,1474.17 1750,1451.99 1752.35,1292.23 1754.7,1419.27 1757.05,1423.28 1759.4,1392.22 1761.75,1340.01 1764.1,1456.96 1766.45,1348.01 1768.8,1372.1 1771.15,1434.14 1773.5,1450.52 1775.85,1447.56 1778.2,1452.18 1780.55,1317.78 1782.9,1352.69 1785.25,1478.55 1787.6,1357.33 1789.96,1327.7 1792.31,1430.17 1794.66,1462.71 1797.01,1481.83 1799.36,1530.93 1801.71,1325.26 1804.06,1536.01 1806.41,1501.79 1808.76,1402.31 1811.11,1603.37 1813.46,1381.63 1815.81,1384.38 1818.16,1450.26 1820.51,1415.04 1822.86,1477.29 1825.21,1559.87 1827.56,1355.74 1829.91,1470.34 1832.26,1327.21 1834.61,1439.05 1836.96,1357.02 1839.32,1697.7 1841.67,1380.55 1844.02,1427.35 1846.37,1522.95 1848.72,1561.89 1851.07,1332.92 1853.42,1348 1855.77,1289.89 1858.12,1440.07 1860.47,1392.27 1862.82,1219.17 1865.17,1465.45 1867.52,1439.83 1869.87,1410.21 1872.22,1455.12 1874.57,1581.7 1876.92,1408.06 1879.27,1619.41 1881.62,1441.06 1883.97,1378.18 1886.32,1321.39 1888.68,1308.73 1891.03,1415.75 1893.38,1164.02 1895.73,1424.57 1898.08,1188.26 1900.43,1339.3 1902.78,1505.74 1905.13,1344.55 1907.48,1346.98 1909.83,1383.9 1912.18,1491.27 1914.53,1343 1916.88,1344.16 1919.23,1363.51 1921.58,1326.46 1923.93,1394.99 1926.28,1559.96 1928.63,1349.68 1930.98,1414.01 1933.33,1336.32 1935.68,1481.16 1938.04,1396.84 1940.39,1588.67 1942.74,1254.87 1945.09,1422.32 1947.44,1462.25 1949.79,1281.08 1952.14,1261.19 1954.49,1751.15 1956.84,1492.44 1959.19,1401.85 1961.54,1321.96 1963.89,1423.51 1966.24,1314.86 1968.59,1362.49 1970.94,1439.15 1973.29,1439.23 1975.64,1293.76 1977.99,1563.42 1980.34,1408.06 1982.69,1452.56 1985.04,1438.64 1987.4,1496.2 1989.75,1419.51 1992.1,1180.94 1994.45,1306.59 1996.8,1415.25 1999.15,1315.42 2001.5,1391.24 2003.85,1420.04 2006.2,1292.74 2008.55,1507.45 2010.9,1551.14 2013.25,1378.47 2015.6,1591.08 2017.95,1453.53 2020.3,1349.63 2022.65,1394.19 2025,1297.23 2027.35,1309.09 2029.7,1324.91 2032.05,1550.61 2034.4,1331.69 2036.76,1583.02 2039.11,1458.32 2041.46,1395.37 2043.81,1430.59 2046.16,1402.68 2048.51,1436.39 2050.86,1400.11 2053.21,1425.51 2055.56,1460.4 2057.91,1427.4 2060.26,1173.2 2062.61,1270.41 2064.96,1486.04 2067.31,1315.73 2069.66,1406.51 2072.01,1289.12 2074.36,1302.92 2076.71,1273.66 2079.06,1428.12 2081.41,1416.1 2083.76,1472.51 2086.11,1279.09 2088.47,1375.12 2090.82,1339.32 2093.17,1536.34 2095.52,1359.52 2097.87,1326.98 2100.22,1356.37 2102.57,1546.14 2104.92,1288.49 2107.27,1663.47 2109.62,1284.62 2111.97,1344.12 2114.32,1397.69 2116.67,1360.45 2119.02,1476.01 2121.37,1364.89 2123.72,1447.24 2126.07,1518.61 2128.42,1362.75 2130.77,1419.63 2133.12,1366.2 2135.47,1439.74 2137.83,1278.77 2140.18,1523.23 2142.53,1484.52 2144.88,1342.3 2147.23,1426.87 2149.58,1306.1 2151.93,1371.53 2154.28,1432.82 2156.63,1256.59 2158.98,1387.49 2161.33,1303.28 2163.68,1415.42 2166.03,1357.54 2168.38,1415.43 2170.73,1396.09 2173.08,1363.16 2175.43,1373.84 2177.78,1548.8 2180.13,1438.37 2182.48,1336.51 2184.83,1313.7 2187.19,1524.85 2189.54,1646.81 2191.89,1368.36 2194.24,1446.61 2196.59,1281.5 2198.94,1450.34 2201.29,1368.29 2203.64,1300.85 2205.99,1607.39 2208.34,1217.45 2210.69,1351.55 2213.04,1515.1 2215.39,1430.89 2217.74,1533.83 2220.09,1587.92 2222.44,1224.81 2224.79,1629.41 2227.14,1465.34 2229.49,1422.72 2231.84,1431.41 2234.19,1436.04 2236.55,1472.5 2238.9,1436.52 2241.25,1353.01 2243.6,1457.68 2245.95,1433.35 2248.3,1287.12 2250.65,1393.15 2253,1320.98 2255.35,1184.94 2257.7,1244.48 2260.05,1546.45 2262.4,1291.33 2264.75,1282.02 2267.1,1275.2 2269.45,1477.62 2271.8,1389.93 2274.15,1434.79 2276.5,1444.4 2278.85,1484.5 2281.2,1192.17 2283.55,1502.83 2285.91,1467.36 2288.26,1384.05 2290.61,1332.47 2292.96,1400.5 2295.31,1300.16 2297.66,1339.47 2300.01,1433.14 2302.36,1368.98 2304.71,1481.7 2307.06,1463.09 2309.41,1530.56 2311.76,1343.04 2314.11,1457.04 2316.46,1369.91 2318.81,1645.76 2321.16,1363.82 2323.51,1493.96 2325.86,1329.61 2328.21,1377.3 2330.56,1368.89 2332.91,1394.89 2335.27,1463.3 2337.62,1350.86 2339.97,1467.55 2342.32,1361.18 2344.67,1238.91 2347.02,1401.43 2349.37,1518.26 2351.72,1409.95 2354.07,1505.38 2356.42,1337.95 2358.77,1255.68 2361.12,1218.93 2363.47,1241.65 2365.82,1209.13 2368.17,1139.89 2370.52,1387.66 2372.87,1554.71 2375.22,1449.8 2377.57,1605.83 2379.92,1428.16 2382.27,1538.42 2384.62,1449.09 2386.98,1248.81 2389.33,1345.36 2391.68,1379.71 2394.03,1364.07 2396.38,1457.46 2398.73,1396.51 2401.08,1232.33 2403.43,1357.34 2405.78,1366.72 2408.13,1350.37 2410.48,1284.34 2412.83,1175.84 2415.18,1521.07 2417.53,1341.64 2419.88,1249.98 2422.23,1426.84 2424.58,1346.66 2426.93,1246.21 2429.28,1430.4 2431.63,1411.03 2433.98,1329.58 2436.34,1364.87 2438.69,1288.09 2441.04,1541.68 2443.39,1414.95 2445.74,1314.07 2448.09,1239.84 2450.44,1385.18 2452.79,1476.3 2455.14,1389.63 2457.49,1234.97 2459.84,1458.78 2462.19,1299.45 2464.54,1380.74 2466.89,1537.13 2469.24,1426.62 2471.59,1597.05 2473.94,1539.5 2476.29,1485.01 2478.64,1292.6 2480.99,1486.77 2483.34,1324.82 2485.7,1456.34 2488.05,1525.25 2490.4,1429.76 2492.75,1449.35 2495.1,1460.01 2497.45,1526.6 2499.8,1301.76 2502.15,1434.72 2504.5,1401.29 2506.85,1549.48 2509.2,1509.42 2511.55,1291.08 2513.9,1311.42 2516.25,1451.35 2518.6,1487.78 2520.95,1470.45 2523.3,1520.73 2525.65,1396.55 2528,1348.51 2530.35,1382.27 2532.7,1403.84 2535.06,1479.88 2537.41,1313.25 2539.76,1318.45 2542.11,1423.32 2544.46,1278.76 2546.81,1318.11 2549.16,1506.85 2551.51,1250.96 2553.86,1135.2 2556.21,1471.78 2558.56,1527.29 2560.91,1478.07 2563.26,1356.8 2565.61,1215.38 2567.96,1571.97 2570.31,1289.17 "></polyline>
<polyline clip-path="url(#clip652)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,895.167 224.541,852.696 226.891,808.934 229.242,856.783 231.592,983.634 233.943,773.904 236.293,1066.67 238.644,897.753 240.994,898.996 243.345,863.745 245.695,978.954 248.046,776.477 250.396,728.135 252.747,944.546 255.097,746.504 257.448,1017.8 259.798,925.407 262.148,1298.23 264.499,978.631 266.849,862.733 269.2,834.259 271.55,860.517 273.901,965.52 276.251,1068.78 278.602,1062.43 280.952,899.77 283.303,893.827 285.653,804.1 288.004,677.178 290.354,858.805 292.705,957.771 295.055,701.882 297.406,841.496 299.756,841.086 302.107,675.287 304.457,687.102 306.807,926.466 309.158,1016.03 311.508,945.545 313.859,907.586 316.209,938.973 318.56,863.911 320.91,697.741 323.261,941.846 325.611,905.311 327.962,819.34 330.312,972.918 332.663,856.164 335.013,1006.92 337.364,877.473 339.714,976.908 342.065,1012.63 344.415,837.637 346.765,675.578 349.116,867.136 351.466,920.779 353.817,1022.5 356.167,950.954 358.518,878.39 360.868,937.713 363.219,1100.08 365.569,960.608 367.92,808.91 370.27,828.437 372.621,832.976 374.971,835.417 377.322,719.052 379.672,847.949 382.023,766.293 384.373,864.274 386.724,955.318 389.074,710.84 391.424,1203.76 393.775,748.552 396.125,930.025 398.476,962.601 400.826,930.472 403.177,671.887 405.527,926.506 407.878,904.957 410.228,967.517 412.579,706.656 414.929,850.37 417.28,803.645 419.63,976.758 421.981,1010.29 424.331,1110.05 426.682,1007.36 429.032,899.945 431.382,912.077 433.733,767.176 436.083,729.39 438.434,957.584 440.784,1009.7 443.135,1064.93 445.485,894.414 447.836,978.382 450.186,1004.5 452.537,986.94 454.887,865.172 457.238,1069.81 459.588,874.88 461.939,768.343 464.289,987.335 466.64,922.321 468.99,889.77 471.341,1126.17 473.691,894.817 476.041,992.351 478.392,806.419 480.742,1013.87 483.093,975.866 485.443,841.317 487.794,800.95 490.144,1051.28 492.495,822.304 494.845,746.701 497.196,1004.58 499.546,916.87 501.897,926.887 504.247,853.566 506.598,780.585 508.948,1084.21 511.299,841.243 513.649,789.114 515.999,1007.55 518.35,803.282 520.7,945.32 523.051,778.073 525.401,1062.57 527.752,996.403 530.102,817.617 532.453,830.844 534.803,786.32 537.154,932.37 539.504,905.963 541.855,999.824 544.205,1025.57 546.556,765.41 548.906,977.584 551.257,846.067 553.607,754.194 555.958,892.422 558.308,815.545 560.658,753.209 563.009,887.367 565.359,969.546 567.71,833.231 570.06,893.916 572.411,814.06 574.761,1038 577.112,929.44 579.462,923.138 581.813,869.57 584.163,727.8 586.514,876.391 588.864,910.283 591.215,781.643 593.565,772.478 595.916,1018.53 598.266,1174.58 600.616,842.655 602.967,936.23 605.317,760.767 607.668,1010.01 610.018,946.474 612.369,1040.32 614.719,675.648 617.07,715.669 619.42,816.004 621.771,911.51 624.121,738.387 626.472,946.646 628.822,849.085 631.173,776.223 633.523,947.933 635.874,933.334 638.224,833.463 640.575,957.013 642.925,923.404 645.275,775.673 647.626,821.919 649.976,905.425 652.327,993.64 654.677,993.418 657.028,650.403 659.378,895.847 661.729,871.428 664.079,859.85 666.43,857.288 668.78,1063.27 671.131,941.536 673.481,782.49 675.832,941.955 678.182,1017.12 680.533,720.725 682.883,885.314 685.233,952.869 687.584,902.748 689.934,1027.85 692.285,743.205 694.635,944.884 696.986,884.228 699.336,926.532 701.687,830.043 704.037,916.385 706.388,885.327 708.738,1014.45 711.089,936.031 713.439,945.154 715.79,803.033 718.14,874.222 720.491,953.327 722.841,910.187 725.192,960.966 727.542,1035.02 729.892,905.333 732.243,850.931 734.593,952.03 736.944,741.51 739.294,1084.63 741.645,872.8 743.995,755.764 746.346,932.73 748.696,677.916 751.047,867.395 753.397,972.949 755.748,877.641 758.098,967.19 760.449,833.402 762.799,1059.69 765.15,947.242 767.5,785.359 769.85,875.913 772.201,859.368 774.551,733.388 776.902,842.354 779.252,694.477 781.603,919.081 783.953,1067.25 786.304,956.912 788.654,866.57 791.005,920.126 793.355,923.737 795.706,1000.65 798.056,744.432 800.407,750.149 802.757,1002.31 805.108,851.233 807.458,865.627 809.809,924.6 812.159,831.695 814.509,1103.15 816.86,787.236 819.21,873.761 821.561,919.819 823.911,938.454 826.262,1037.09 828.612,855.99 830.963,827.481 833.313,1042.06 835.664,902.062 838.014,838.834 840.365,1024.96 842.715,955.623 845.066,897.695 847.416,901.831 849.767,910.664 852.117,936.468 854.467,897.171 856.818,996.826 859.168,857.065 861.519,854.271 863.869,594.326 866.22,978.984 868.57,920.358 870.921,778.01 873.271,924.505 875.622,1075.45 877.972,842.13 880.323,1065.32 882.673,952.684 885.024,855.275 887.374,980.44 889.725,872.066 892.075,1034.8 894.426,960.578 896.776,941.274 899.126,1021.59 901.477,1137.07 903.827,1030.57 906.178,855.137 908.528,1119.2 910.879,849 913.229,1055.2 915.58,943.758 917.93,764.982 920.281,787.943 922.631,878.53 924.982,763.137 927.332,800.403 929.683,874.649 932.033,893.12 934.384,925.085 936.734,870.639 939.084,979.808 941.435,885.239 943.785,987.505 946.136,782.501 948.486,1109.13 950.837,1081.77 953.187,845.38 955.538,994.579 957.888,813.931 960.239,940.341 962.589,839.918 964.94,895.494 967.29,1046.45 969.641,821.281 971.991,974.203 974.342,912.527 976.692,956.518 979.043,928.027 981.393,905.649 983.743,806.051 986.094,893.253 988.444,1073.81 990.795,1003.67 993.145,991.234 995.496,949.138 997.846,1074.05 1000.2,820.788 1002.55,869.774 1004.9,764.629 1007.25,747.527 1009.6,801.143 1011.95,651.576 1014.3,842.763 1016.65,864.72 1019,1013.07 1021.35,907.099 1023.7,1015.95 1026.05,720.378 1028.4,872.401 1030.75,910.38 1033.1,999.207 1035.45,809.073 1037.8,909.973 1040.15,704.389 1042.51,846.701 1044.86,945.111 1047.21,795.713 1049.56,938.297 1051.91,892.711 1054.26,758.997 1056.61,895.02 1058.96,1044.22 1061.31,922.252 1063.66,849.181 1066.01,820.631 1068.36,969.617 1070.71,960.235 1073.06,994.19 1075.41,847.884 1077.76,991.027 1080.11,896.279 1082.46,1005.9 1084.81,874.516 1087.16,771.219 1089.51,1066.2 1091.87,993.529 1094.22,822.254 1096.57,664.375 1098.92,807.658 1101.27,960.937 1103.62,932.015 1105.97,962.386 1108.32,952.226 1110.67,749.231 1113.02,1039.02 1115.37,1065.47 1117.72,889.843 1120.07,789.97 1122.42,903.735 1124.77,788.75 1127.12,796.085 1129.47,975.986 1131.82,1188.91 1134.17,938.374 1136.52,790.398 1138.87,751.533 1141.23,765.832 1143.58,843.646 1145.93,910.488 1148.28,818.827 1150.63,1075.17 1152.98,834.008 1155.33,1121.61 1157.68,917.18 1160.03,877.403 1162.38,992.448 1164.73,930.829 1167.08,775.202 1169.43,836.13 1171.78,982.039 1174.13,960.949 1176.48,723.035 1178.83,827.506 1181.18,963.149 1183.53,906.246 1185.88,900.994 1188.23,861.84 1190.59,660.876 1192.94,866.353 1195.29,987.568 1197.64,916.006 1199.99,862.909 1202.34,970.35 1204.69,795.425 1207.04,946.446 1209.39,1008.69 1211.74,771.576 1214.09,1059.06 1216.44,802.237 1218.79,921.673 1221.14,955.307 1223.49,708.574 1225.84,835.961 1228.19,1036.1 1230.54,717.103 1232.89,938.424 1235.24,848.333 1237.59,723.197 1239.94,800.039 1242.3,964.607 1244.65,976.335 1247,801.554 1249.35,992.837 1251.7,774.692 1254.05,935.261 1256.4,897.542 1258.75,1052.76 1261.1,909.383 1263.45,867.499 1265.8,1013.69 1268.15,790.124 1270.5,864.032 1272.85,930.634 1275.2,950.511 1277.55,1215.19 1279.9,1030 1282.25,896.411 1284.6,968.351 1286.95,743.292 1289.3,809.601 1291.66,940.332 1294.01,981.233 1296.36,1017.6 1298.71,908.06 1301.06,942.733 1303.41,847.998 1305.76,916.93 1308.11,890.201 1310.46,948.848 1312.81,946.077 1315.16,994.344 1317.51,876.701 1319.86,837.574 1322.21,1107.9 1324.56,986.257 1326.91,887.699 1329.26,945.89 1331.61,1002.22 1333.96,930.366 1336.31,983.286 1338.66,952.138 1341.02,983.083 1343.37,1006.18 1345.72,778.025 1348.07,911.095 1350.42,1013.22 1352.77,958.453 1355.12,871.879 1357.47,858.827 1359.82,819.657 1362.17,806.112 1364.52,813.061 1366.87,1003.06 1369.22,846.272 1371.57,957.848 1373.92,826.117 1376.27,1002.29 1378.62,941.961 1380.97,915.255 1383.32,1012.83 1385.67,863.735 1388.02,996.848 1390.38,951.11 1392.73,1049.81 1395.08,933.777 1397.43,771.742 1399.78,895.719 1402.13,846.705 1404.48,727.709 1406.83,953.772 1409.18,681.281 1411.53,922.418 1413.88,873.503 1416.23,937.505 1418.58,895.567 1420.93,892.749 1423.28,1041.3 1425.63,859.648 1427.98,946.23 1430.33,725.553 1432.68,918.218 1435.03,873.414 1437.38,849.612 1439.74,980.512 1442.09,939.547 1444.44,983.658 1446.79,914.318 1449.14,1048.68 1451.49,917.45 1453.84,790.194 1456.19,953.617 1458.54,846.841 1460.89,890.605 1463.24,849.704 1465.59,891.096 1467.94,791.149 1470.29,995.385 1472.64,978 1474.99,931.823 1477.34,1063.45 1479.69,829.105 1482.04,922.965 1484.39,929.563 1486.74,910.477 1489.1,869.962 1491.45,724.233 1493.8,935.148 1496.15,957.888 1498.5,1022.87 1500.85,767.191 1503.2,1022.89 1505.55,951.418 1507.9,1063.51 1510.25,882.924 1512.6,886.952 1514.95,765.595 1517.3,922.949 1519.65,835.508 1522,808.66 1524.35,925.291 1526.7,847.313 1529.05,994.897 1531.4,821.702 1533.75,983.75 1536.1,904.328 1538.45,1003.59 1540.81,789.872 1543.16,939.202 1545.51,932.04 1547.86,951.639 1550.21,1004.09 1552.56,1024.41 1554.91,1001.79 1557.26,864.615 1559.61,977.109 1561.96,960.807 1564.31,963.54 1566.66,814.707 1569.01,797.312 1571.36,912.649 1573.71,883.428 1576.06,953.438 1578.41,923.723 1580.76,928.931 1583.11,856.636 1585.46,804.759 1587.81,1050.2 1590.17,959.282 1592.52,974.406 1594.87,777.384 1597.22,789.079 1599.57,961.83 1601.92,942.471 1604.27,801.434 1606.62,949.552 1608.97,1095.55 1611.32,935.848 1613.67,960.705 1616.02,965.691 1618.37,851.449 1620.72,865.526 1623.07,782.97 1625.42,779.739 1627.77,881.177 1630.12,731.417 1632.47,982.787 1634.82,1015.31 1637.17,882.585 1639.53,712.01 1641.88,1079.1 1644.23,862.797 1646.58,913.374 1648.93,651.606 1651.28,958.127 1653.63,937.863 1655.98,885.827 1658.33,682.679 1660.68,905.748 1663.03,1025.18 1665.38,879.531 1667.73,833.24 1670.08,973.776 1672.43,800.216 1674.78,786.801 1677.13,1019.62 1679.48,906.52 1681.83,924.847 1684.18,1022.81 1686.53,701.357 1688.89,914.733 1691.24,718.943 1693.59,790.107 1695.94,1053.71 1698.29,1055.93 1700.64,1029.21 1702.99,763.984 1705.34,734.612 1707.69,956.404 1710.04,1021.78 1712.39,947.607 1714.74,897.653 1717.09,982.95 1719.44,979.522 1721.79,908.104 1724.14,883.798 1726.49,928.658 1728.84,882.341 1731.19,864.66 1733.54,796.09 1735.89,870.103 1738.25,812.036 1740.6,924.994 1742.95,802.198 1745.3,1038.76 1747.65,889.587 1750,805.375 1752.35,791.381 1754.7,914.408 1757.05,877.494 1759.4,936.081 1761.75,981.559 1764.1,1059.27 1766.45,971.928 1768.8,1025.23 1771.15,712.612 1773.5,1009.64 1775.85,863.682 1778.2,986.432 1780.55,885.387 1782.9,1016.06 1785.25,739.387 1787.6,942.682 1789.96,769.653 1792.31,806.078 1794.66,996.693 1797.01,797.282 1799.36,989.625 1801.71,969.496 1804.06,676.722 1806.41,849.297 1808.76,899.286 1811.11,982.783 1813.46,868.868 1815.81,855.664 1818.16,899.667 1820.51,782.124 1822.86,900.921 1825.21,977.751 1827.56,677.328 1829.91,848.14 1832.26,665.246 1834.61,886.908 1836.96,896.181 1839.32,931.556 1841.67,870.8 1844.02,822.146 1846.37,997.844 1848.72,1012.09 1851.07,961.924 1853.42,909.742 1855.77,724.21 1858.12,920.575 1860.47,981.949 1862.82,920.074 1865.17,1003.13 1867.52,762.875 1869.87,789.277 1872.22,890.713 1874.57,864.136 1876.92,1075.48 1879.27,924.594 1881.62,805.986 1883.97,883.959 1886.32,879.34 1888.68,901.982 1891.03,949.84 1893.38,749.226 1895.73,925.486 1898.08,802.183 1900.43,976.187 1902.78,758.741 1905.13,1168.63 1907.48,790.467 1909.83,778.215 1912.18,863.572 1914.53,885.311 1916.88,765.87 1919.23,795.385 1921.58,1035.97 1923.93,1003.7 1926.28,988.732 1928.63,902.749 1930.98,996.742 1933.33,831.388 1935.68,762.406 1938.04,922.848 1940.39,902.236 1942.74,842.931 1945.09,903.527 1947.44,854.604 1949.79,932.164 1952.14,794.196 1954.49,933.106 1956.84,1000.07 1959.19,994.894 1961.54,892.784 1963.89,656.096 1966.24,690.127 1968.59,762.003 1970.94,624.138 1973.29,735.383 1975.64,782.026 1977.99,1101.62 1980.34,859.543 1982.69,889.771 1985.04,809.486 1987.4,828.284 1989.75,1002.54 1992.1,749.927 1994.45,780.016 1996.8,1024.11 1999.15,758.946 2001.5,1045.56 2003.85,1026.46 2006.2,917.802 2008.55,802.713 2010.9,1011.94 2013.25,795.577 2015.6,674.17 2017.95,773.559 2020.3,799.827 2022.65,757.677 2025,1040.84 2027.35,1065.63 2029.7,983.968 2032.05,881.256 2034.4,936.211 2036.76,837.225 2039.11,762.957 2041.46,982.766 2043.81,953.549 2046.16,854.97 2048.51,963.156 2050.86,957.023 2053.21,924.642 2055.56,1116.71 2057.91,1040.81 2060.26,1108.52 2062.61,1008.52 2064.96,949.443 2067.31,855.005 2069.66,1050.05 2072.01,746.592 2074.36,924.675 2076.71,994.535 2079.06,850.808 2081.41,742.739 2083.76,938.876 2086.11,897.923 2088.47,911.662 2090.82,989.18 2093.17,907.184 2095.52,948.209 2097.87,852.832 2100.22,804.452 2102.57,791.2 2104.92,781.649 2107.27,1064.41 2109.62,850.539 2111.97,915.975 2114.32,827.041 2116.67,750.815 2119.02,720.446 2121.37,974.179 2123.72,860.643 2126.07,814.979 2128.42,966.581 2130.77,788.608 2133.12,872.016 2135.47,974.33 2137.83,988.04 2140.18,853.551 2142.53,927.921 2144.88,904.399 2147.23,1035.39 2149.58,875.412 2151.93,840.667 2154.28,753.052 2156.63,1068.38 2158.98,879.853 2161.33,903.457 2163.68,1028.08 2166.03,724.552 2168.38,830.596 2170.73,814.773 2173.08,976.394 2175.43,834.228 2177.78,859.696 2180.13,883.555 2182.48,1003.86 2184.83,912.986 2187.19,893.921 2189.54,739.868 2191.89,753.055 2194.24,981.582 2196.59,799.733 2198.94,916.222 2201.29,1044.38 2203.64,933.936 2205.99,1083.05 2208.34,903.461 2210.69,947.909 2213.04,963.369 2215.39,942.278 2217.74,904.06 2220.09,917.95 2222.44,910.694 2224.79,776.335 2227.14,811.674 2229.49,1065.61 2231.84,964.638 2234.19,851.142 2236.55,1051.47 2238.9,791.621 2241.25,709.237 2243.6,1045.89 2245.95,874.671 2248.3,767.416 2250.65,866.93 2253,980.863 2255.35,855.646 2257.7,795.018 2260.05,1008.96 2262.4,944.327 2264.75,776.54 2267.1,1049.09 2269.45,926.381 2271.8,1015.46 2274.15,862.836 2276.5,833.504 2278.85,964.057 2281.2,944.152 2283.55,841.838 2285.91,1000.14 2288.26,1019.18 2290.61,888.736 2292.96,989.619 2295.31,957.985 2297.66,779.225 2300.01,806.87 2302.36,834.17 2304.71,730.409 2307.06,820.114 2309.41,862.737 2311.76,834.181 2314.11,937.805 2316.46,1047.52 2318.81,1006.9 2321.16,888.738 2323.51,1086.99 2325.86,998.335 2328.21,805.42 2330.56,848.339 2332.91,869.631 2335.27,648.257 2337.62,1037.94 2339.97,756.868 2342.32,837.546 2344.67,887.399 2347.02,819.18 2349.37,946.479 2351.72,976.903 2354.07,1115.32 2356.42,894.566 2358.77,940.878 2361.12,924.061 2363.47,908.309 2365.82,772.054 2368.17,797.751 2370.52,750.096 2372.87,1047.78 2375.22,1002.54 2377.57,1010.15 2379.92,933.509 2382.27,1112.56 2384.62,697.316 2386.98,988.424 2389.33,856.594 2391.68,1072.33 2394.03,952.575 2396.38,906.818 2398.73,742.971 2401.08,931.507 2403.43,845.534 2405.78,819.004 2408.13,868.746 2410.48,819.649 2412.83,891.176 2415.18,1081.67 2417.53,835.114 2419.88,943.299 2422.23,764.73 2424.58,913.062 2426.93,962.035 2429.28,863.435 2431.63,975.907 2433.98,878.393 2436.34,926.36 2438.69,973.174 2441.04,771.053 2443.39,961.52 2445.74,900.485 2448.09,972.357 2450.44,863.237 2452.79,955.808 2455.14,932.803 2457.49,864.823 2459.84,1012.94 2462.19,925.025 2464.54,704.587 2466.89,764.87 2469.24,845.96 2471.59,868.224 2473.94,794.577 2476.29,997.451 2478.64,853.734 2480.99,953.969 2483.34,846.72 2485.7,980.323 2488.05,855.02 2490.4,1025.95 2492.75,981.599 2495.1,843.161 2497.45,941.843 2499.8,799.847 2502.15,765.916 2504.5,936.689 2506.85,1014.24 2509.2,833.585 2511.55,868.246 2513.9,1041.88 2516.25,1047.99 2518.6,841.423 2520.95,943.098 2523.3,929.784 2525.65,860.78 2528,941.82 2530.35,947.098 2532.7,804.822 2535.06,924.82 2537.41,981.255 2539.76,723.549 2542.11,964.729 2544.46,961.854 2546.81,831.084 2549.16,895.968 2551.51,811.257 2553.86,944.461 2556.21,798.59 2558.56,772.701 2560.91,1042.85 2563.26,948.623 2565.61,879.089 2567.96,871.205 2570.31,1064.18 "></polyline>
<polyline clip-path="url(#clip652)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,712.464 224.541,485.996 226.891,433.968 229.242,416.026 231.592,643.157 233.943,384.04 236.293,447.648 238.644,427.205 240.994,481.56 243.345,418.812 245.695,504.2 248.046,235.777 250.396,400.928 252.747,503.132 255.097,383.925 257.448,494.689 259.798,454.386 262.148,408.866 264.499,216.562 266.849,492.757 269.2,381.594 271.55,483.435 273.901,550.055 276.251,425.411 278.602,335.969 280.952,196.059 283.303,438.29 285.653,464.438 288.004,153.508 290.354,373.759 292.705,306.065 295.055,471.598 297.406,419.634 299.756,419.711 302.107,199.051 304.457,453.093 306.807,433.178 309.158,301.596 311.508,497.659 313.859,420.5 316.209,276.197 318.56,365.466 320.91,442.161 323.261,245.479 325.611,316.747 327.962,481.715 330.312,443.046 332.663,387.96 335.013,404.012 337.364,461.051 339.714,533.444 342.065,396.643 344.415,298.504 346.765,434.422 349.116,496.481 351.466,375.59 353.817,418.078 356.167,331.074 358.518,478.337 360.868,448.355 363.219,307.729 365.569,411.013 367.92,424.209 370.27,355.304 372.621,290.934 374.971,293.188 377.322,556.609 379.672,349.207 382.023,306.831 384.373,420.856 386.724,250.751 389.074,129.622 391.424,542.213 393.775,446.481 396.125,348.366 398.476,433.368 400.826,414.469 403.177,240.357 405.527,383.405 407.878,340.114 410.228,419.236 412.579,246.016 414.929,500.107 417.28,447.932 419.63,552.889 421.981,465.293 424.331,454.654 426.682,251.018 429.032,403.225 431.382,396.906 433.733,392.115 436.083,344.667 438.434,271.604 440.784,364.512 443.135,412.533 445.485,388.487 447.836,364.014 450.186,340.545 452.537,319.925 454.887,408.097 457.238,347.062 459.588,407.705 461.939,340.524 464.289,399.934 466.64,367.57 468.99,486.411 471.341,212.32 473.691,346.542 476.041,258.474 478.392,263.246 480.742,365.815 483.093,599.01 485.443,471.644 487.794,265.358 490.144,285.472 492.495,376.177 494.845,541.986 497.196,479.249 499.546,501.221 501.897,358.181 504.247,373.467 506.598,360.355 508.948,556.083 511.299,435.194 513.649,223.677 515.999,274.416 518.35,530.995 520.7,455.606 523.051,327.446 525.401,309.119 527.752,570.726 530.102,487.014 532.453,352.157 534.803,419.028 537.154,461.823 539.504,448.552 541.855,463.803 544.205,572.145 546.556,374.062 548.906,199.405 551.257,366.062 553.607,441.786 555.958,413.178 558.308,226.921 560.658,364.769 563.009,396.726 565.359,341.406 567.71,461.71 570.06,573.156 572.411,450.177 574.761,362.133 577.112,450.275 579.462,272.511 581.813,529.381 584.163,467.48 586.514,433.788 588.864,489.095 591.215,587.028 593.565,284.635 595.916,324.464 598.266,301.748 600.616,372.194 602.967,269.649 605.317,456.654 607.668,569.148 610.018,342.647 612.369,152.476 614.719,427.988 617.07,229.101 619.42,504.873 621.771,313.673 624.121,354.354 626.472,470.721 628.822,469.454 631.173,141.487 633.523,607.56 635.874,426.751 638.224,307.193 640.575,396.316 642.925,319.518 645.275,215.17 647.626,323.872 649.976,579.068 652.327,275.78 654.677,512.835 657.028,293.283 659.378,300.498 661.729,371.613 664.079,431.062 666.43,333.388 668.78,499.617 671.131,312.188 673.481,371.155 675.832,488.887 678.182,443.456 680.533,490.775 682.883,417.785 685.233,519.42 687.584,567.807 689.934,313.578 692.285,310.377 694.635,444.423 696.986,243.409 699.336,415.443 701.687,319.264 704.037,408.903 706.388,445.853 708.738,542.173 711.089,528.255 713.439,400.364 715.79,439.004 718.14,407.468 720.491,463.3 722.841,242.951 725.192,368.822 727.542,368.756 729.892,546.934 732.243,252.851 734.593,433.563 736.944,399.7 739.294,445.522 741.645,351.541 743.995,430.956 746.346,479.527 748.696,377.148 751.047,478.96 753.397,498.943 755.748,373.633 758.098,507.018 760.449,155.106 762.799,506.835 765.15,301.836 767.5,310.748 769.85,313.012 772.201,455.802 774.551,335.572 776.902,411.473 779.252,371.208 781.603,339.577 783.953,417.95 786.304,323.769 788.654,484.966 791.005,536.611 793.355,388.488 795.706,413.083 798.056,497.539 800.407,495.804 802.757,426.175 805.108,298.771 807.458,388.126 809.809,393.601 812.159,466.885 814.509,390.483 816.86,253.686 819.21,288.596 821.561,272.739 823.911,394.761 826.262,526.062 828.612,320.418 830.963,405.384 833.313,303.186 835.664,471.429 838.014,500.5 840.365,532.916 842.715,560.43 845.066,532.208 847.416,500.44 849.767,239.523 852.117,492.554 854.467,581.563 856.818,379.005 859.168,430.756 861.519,382.403 863.869,412.113 866.22,467.887 868.57,406.503 870.921,225.975 873.271,497.172 875.622,369.454 877.972,517.397 880.323,108.74 882.673,450.835 885.024,312.252 887.374,355.163 889.725,619.842 892.075,398.302 894.426,391.112 896.776,309.366 899.126,416.906 901.477,403.623 903.827,260.327 906.178,346.437 908.528,312.364 910.879,360.236 913.229,297.449 915.58,337.432 917.93,282.97 920.281,355.472 922.631,382.389 924.982,391.521 927.332,385.33 929.683,391.437 932.033,356.771 934.384,472.946 936.734,505.792 939.084,425.651 941.435,316.208 943.785,414.69 946.136,357.971 948.486,279.364 950.837,521.858 953.187,288.677 955.538,417.197 957.888,435.212 960.239,560.024 962.589,501.141 964.94,533.503 967.29,497.474 969.641,208.018 971.991,359.14 974.342,299.423 976.692,149.742 979.043,508.872 981.393,398.199 983.743,435.863 986.094,345.499 988.444,268.688 990.795,485.344 993.145,309.068 995.496,334.688 997.846,464.7 1000.2,537.032 1002.55,478.85 1004.9,369.103 1007.25,325.105 1009.6,471.503 1011.95,371.131 1014.3,487.523 1016.65,378.756 1019,579.885 1021.35,429.274 1023.7,516.381 1026.05,350.688 1028.4,563.678 1030.75,442.413 1033.1,266.503 1035.45,330.064 1037.8,395.41 1040.15,482.615 1042.51,308.78 1044.86,410.473 1047.21,363.22 1049.56,597.919 1051.91,465.076 1054.26,409.188 1056.61,304.907 1058.96,561.019 1061.31,429.018 1063.66,405.119 1066.01,410.769 1068.36,541.337 1070.71,401.533 1073.06,572.275 1075.41,530.56 1077.76,365.749 1080.11,312.961 1082.46,306.52 1084.81,383.713 1087.16,384.44 1089.51,520.176 1091.87,505.635 1094.22,393.2 1096.57,282.406 1098.92,350.298 1101.27,406.085 1103.62,276.46 1105.97,583.381 1108.32,373.614 1110.67,335.187 1113.02,447.664 1115.37,437.983 1117.72,319.45 1120.07,535.597 1122.42,429.135 1124.77,548.417 1127.12,343.631 1129.47,451.189 1131.82,283.147 1134.17,487.91 1136.52,479.54 1138.87,261.654 1141.23,403.558 1143.58,477.092 1145.93,565.851 1148.28,388.887 1150.63,404.243 1152.98,509.188 1155.33,247.278 1157.68,393.762 1160.03,273.539 1162.38,383.438 1164.73,554.726 1167.08,547.064 1169.43,449.203 1171.78,376.725 1174.13,452.17 1176.48,267.992 1178.83,323.138 1181.18,416.925 1183.53,375.87 1185.88,290.973 1188.23,412.803 1190.59,357.572 1192.94,466.794 1195.29,309.305 1197.64,435.031 1199.99,477.334 1202.34,244.558 1204.69,502.271 1207.04,467.376 1209.39,293.731 1211.74,342.322 1214.09,488.632 1216.44,296.68 1218.79,626.46 1221.14,350.45 1223.49,462.519 1225.84,406.343 1228.19,465.962 1230.54,386.658 1232.89,417.717 1235.24,334.987 1237.59,406.033 1239.94,517.636 1242.3,461.504 1244.65,357.549 1247,442.187 1249.35,406.057 1251.7,207.074 1254.05,236.307 1256.4,334.428 1258.75,316.482 1261.1,212.228 1263.45,371.566 1265.8,323.83 1268.15,132.535 1270.5,449.878 1272.85,395.243 1275.2,367.166 1277.55,330.492 1279.9,220.523 1282.25,503.271 1284.6,337.087 1286.95,446.986 1289.3,454.266 1291.66,404.817 1294.01,425.909 1296.36,161.054 1298.71,449.155 1301.06,349.26 1303.41,391.629 1305.76,265.782 1308.11,391.517 1310.46,428.724 1312.81,602.941 1315.16,530.913 1317.51,351.103 1319.86,313.272 1322.21,432.703 1324.56,492.298 1326.91,503.532 1329.26,420.155 1331.61,423.617 1333.96,386.609 1336.31,505.453 1338.66,315.838 1341.02,269.566 1343.37,566.125 1345.72,446.927 1348.07,405.926 1350.42,470.532 1352.77,689.636 1355.12,463.591 1357.47,261.799 1359.82,374.827 1362.17,594.678 1364.52,210.985 1366.87,406.485 1369.22,310.376 1371.57,451.938 1373.92,436.308 1376.27,219.071 1378.62,391.169 1380.97,392.641 1383.32,354.624 1385.67,319.793 1388.02,414.729 1390.38,324.872 1392.73,282.309 1395.08,499.987 1397.43,245.697 1399.78,500.958 1402.13,167.623 1404.48,394.455 1406.83,442.921 1409.18,386.133 1411.53,389.906 1413.88,431.594 1416.23,319.274 1418.58,419.963 1420.93,387.658 1423.28,225.599 1425.63,382.756 1427.98,338.75 1430.33,371.708 1432.68,442.24 1435.03,563.424 1437.38,395.811 1439.74,401.743 1442.09,412.021 1444.44,616.855 1446.79,386.891 1449.14,472.083 1451.49,494.618 1453.84,470.836 1456.19,481.519 1458.54,305.371 1460.89,337.064 1463.24,333.549 1465.59,432.545 1467.94,423.354 1470.29,209.731 1472.64,371.996 1474.99,481.961 1477.34,390.907 1479.69,488.496 1482.04,451.732 1484.39,380.465 1486.74,372.31 1489.1,354.995 1491.45,469.933 1493.8,393.047 1496.15,421.372 1498.5,366.248 1500.85,455.783 1503.2,485.229 1505.55,512.221 1507.9,456.173 1510.25,449.424 1512.6,391.022 1514.95,377.057 1517.3,391.069 1519.65,419.114 1522,492.586 1524.35,474.206 1526.7,507.418 1529.05,358.85 1531.4,480.818 1533.75,364.872 1536.1,590.223 1538.45,352.368 1540.81,200.706 1543.16,398.597 1545.51,426.841 1547.86,483.4 1550.21,431.317 1552.56,397.519 1554.91,446.016 1557.26,479.958 1559.61,442.115 1561.96,534.958 1564.31,531.6 1566.66,357.223 1569.01,277.162 1571.36,334.534 1573.71,349.454 1576.06,514.926 1578.41,345.942 1580.76,373.038 1583.11,241.722 1585.46,339.1 1587.81,331.043 1590.17,254.093 1592.52,267.487 1594.87,361.932 1597.22,431.402 1599.57,445.333 1601.92,510.946 1604.27,374.805 1606.62,423.602 1608.97,409.056 1611.32,344.198 1613.67,444.47 1616.02,411.851 1618.37,262.062 1620.72,602.852 1623.07,354.45 1625.42,406.341 1627.77,552.153 1630.12,334.412 1632.47,490.067 1634.82,532.962 1637.17,400.094 1639.53,279.211 1641.88,320.204 1644.23,412.492 1646.58,209.011 1648.93,344.366 1651.28,356.144 1653.63,214.432 1655.98,159.19 1658.33,388.292 1660.68,441.306 1663.03,481.03 1665.38,275.377 1667.73,304.018 1670.08,420.805 1672.43,393.651 1674.78,533.997 1677.13,237.232 1679.48,408.247 1681.83,401.936 1684.18,387.732 1686.53,302.88 1688.89,328.056 1691.24,417.794 1693.59,191.473 1695.94,278.811 1698.29,358.309 1700.64,451.484 1702.99,221.514 1705.34,341.388 1707.69,377.485 1710.04,362.695 1712.39,405.046 1714.74,367.427 1717.09,232.732 1719.44,366.109 1721.79,535.647 1724.14,464.924 1726.49,311.017 1728.84,369.813 1731.19,304.086 1733.54,523.711 1735.89,160.306 1738.25,329.408 1740.6,328.139 1742.95,199 1745.3,296.198 1747.65,326.518 1750,411.609 1752.35,270.233 1754.7,374.997 1757.05,460.617 1759.4,464.956 1761.75,375.949 1764.1,370.102 1766.45,456.289 1768.8,377.589 1771.15,469.896 1773.5,618.289 1775.85,496.222 1778.2,451.707 1780.55,528.096 1782.9,411.382 1785.25,100.763 1787.6,348.317 1789.96,404.052 1792.31,333.795 1794.66,359.566 1797.01,421.85 1799.36,501.431 1801.71,505.707 1804.06,471.137 1806.41,347.266 1808.76,416.724 1811.11,557.601 1813.46,319.633 1815.81,410.149 1818.16,220.774 1820.51,419.351 1822.86,317.281 1825.21,303.854 1827.56,322.701 1829.91,346.13 1832.26,373.27 1834.61,424.883 1836.96,315.955 1839.32,521.258 1841.67,378.913 1844.02,233.776 1846.37,376.253 1848.72,366.727 1851.07,347.355 1853.42,463.27 1855.77,396.21 1858.12,474.258 1860.47,370.991 1862.82,201.64 1865.17,416.512 1867.52,298.945 1869.87,418.64 1872.22,362.281 1874.57,434.714 1876.92,339.783 1879.27,205.153 1881.62,390.544 1883.97,411.117 1886.32,309.406 1888.68,399.285 1891.03,322.399 1893.38,541.086 1895.73,335.526 1898.08,474.028 1900.43,402.783 1902.78,312.88 1905.13,667.06 1907.48,425.606 1909.83,368.299 1912.18,444.219 1914.53,397.734 1916.88,312.354 1919.23,388.34 1921.58,377.345 1923.93,494.026 1926.28,356.609 1928.63,356.521 1930.98,560.383 1933.33,276.503 1935.68,362.488 1938.04,482.202 1940.39,463.575 1942.74,189.594 1945.09,415.619 1947.44,403.991 1949.79,227.797 1952.14,417.036 1954.49,250.694 1956.84,416.15 1959.19,289.915 1961.54,324.615 1963.89,440.479 1966.24,345.357 1968.59,457.656 1970.94,393.17 1973.29,477.839 1975.64,400.952 1977.99,380.134 1980.34,351.751 1982.69,321.32 1985.04,229.328 1987.4,376.962 1989.75,246.359 1992.1,274.984 1994.45,185.075 1996.8,365.242 1999.15,391.203 2001.5,355.733 2003.85,288.739 2006.2,445.428 2008.55,461.702 2010.9,316.324 2013.25,440.724 2015.6,527.22 2017.95,460.38 2020.3,316.983 2022.65,377.579 2025,402.73 2027.35,490.559 2029.7,330.29 2032.05,448.311 2034.4,446.845 2036.76,346.046 2039.11,212.057 2041.46,371.18 2043.81,476.767 2046.16,521.542 2048.51,194.848 2050.86,165.456 2053.21,96.8724 2055.56,182.775 2057.91,582.454 2060.26,279.369 2062.61,313.649 2064.96,607.64 2067.31,348.695 2069.66,337.55 2072.01,312.483 2074.36,294.908 2076.71,421.698 2079.06,325.393 2081.41,360.21 2083.76,293.79 2086.11,466.613 2088.47,342.298 2090.82,308.375 2093.17,372.761 2095.52,400.92 2097.87,326.652 2100.22,236.276 2102.57,378.008 2104.92,232.047 2107.27,443.62 2109.62,270.322 2111.97,510.238 2114.32,286.496 2116.67,256.758 2119.02,565.79 2121.37,636.871 2123.72,281.357 2126.07,267.081 2128.42,244.087 2130.77,368.027 2133.12,335.817 2135.47,475.717 2137.83,219.441 2140.18,309.703 2142.53,447.681 2144.88,555.939 2147.23,162.985 2149.58,317.299 2151.93,428.085 2154.28,528.527 2156.63,459.778 2158.98,413.148 2161.33,387.228 2163.68,344.941 2166.03,411.562 2168.38,332.362 2170.73,417.472 2173.08,191.493 2175.43,507.71 2177.78,372.075 2180.13,478.579 2182.48,512.761 2184.83,449.149 2187.19,415.46 2189.54,259.478 2191.89,525.014 2194.24,497.908 2196.59,479.349 2198.94,423.955 2201.29,499.304 2203.64,264.249 2205.99,360.964 2208.34,399.39 2210.69,332.432 2213.04,387.58 2215.39,226.318 2217.74,622.436 2220.09,404.456 2222.44,381.37 2224.79,385.929 2227.14,306.414 2229.49,293.977 2231.84,453.575 2234.19,512.935 2236.55,427.923 2238.9,332.088 2241.25,371.086 2243.6,175.206 2245.95,388.63 2248.3,518.988 2250.65,455.817 2253,358.395 2255.35,136.282 2257.7,425.944 2260.05,158.922 2262.4,290.116 2264.75,221.788 2267.1,222.113 2269.45,341.382 2271.8,321.742 2274.15,147.269 2276.5,465.867 2278.85,301.9 2281.2,272.011 2283.55,422.093 2285.91,249.101 2288.26,490.494 2290.61,375.815 2292.96,525.261 2295.31,491.736 2297.66,393.011 2300.01,409.14 2302.36,477.989 2304.71,316.257 2307.06,493.992 2309.41,267.096 2311.76,376.315 2314.11,416.127 2316.46,344.246 2318.81,444.632 2321.16,430.909 2323.51,297.322 2325.86,376.075 2328.21,534.32 2330.56,224.523 2332.91,426.476 2335.27,442.871 2337.62,455.885 2339.97,322.066 2342.32,431.135 2344.67,377.381 2347.02,439.139 2349.37,398.11 2351.72,418.972 2354.07,512.88 2356.42,414.946 2358.77,477.122 2361.12,525.822 2363.47,406.481 2365.82,416.884 2368.17,425.614 2370.52,469.219 2372.87,299.541 2375.22,468.317 2377.57,325.605 2379.92,308.935 2382.27,373.991 2384.62,376.371 2386.98,424.989 2389.33,392.938 2391.68,450.026 2394.03,277.457 2396.38,456.29 2398.73,384.534 2401.08,287.801 2403.43,411.849 2405.78,446.089 2408.13,378.519 2410.48,285.205 2412.83,267.21 2415.18,655.784 2417.53,274.598 2419.88,354.617 2422.23,561.373 2424.58,377.662 2426.93,516.151 2429.28,463.484 2431.63,380.433 2433.98,253.231 2436.34,528.847 2438.69,356.84 2441.04,593.851 2443.39,317.204 2445.74,412.006 2448.09,325.989 2450.44,357.107 2452.79,470.951 2455.14,327.817 2457.49,448.057 2459.84,251.594 2462.19,342.495 2464.54,558.383 2466.89,389.297 2469.24,384.479 2471.59,270.328 2473.94,334.486 2476.29,358.548 2478.64,445.278 2480.99,403.781 2483.34,412.559 2485.7,426.805 2488.05,507.615 2490.4,468.12 2492.75,365.086 2495.1,246.331 2497.45,467.341 2499.8,190.299 2502.15,256.334 2504.5,436.085 2506.85,391.365 2509.2,441.428 2511.55,407.713 2513.9,383.46 2516.25,423.159 2518.6,422.081 2520.95,273.967 2523.3,539.972 2525.65,351.931 2528,317.816 2530.35,219.478 2532.7,529.005 2535.06,394.43 2537.41,183.19 2539.76,377.602 2542.11,472.958 2544.46,237.283 2546.81,420.284 2549.16,365.4 2551.51,499.083 2553.86,451.793 2556.21,439.911 2558.56,261.833 2560.91,362.378 2563.26,447.402 2565.61,481.02 2567.96,293.909 2570.31,523.944 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -3.54832   -3.52564  -3.50403  -3.97374  …  -5.65059   -5.65059   -4.60577
  0.428236  -0.63185  -1.4166   -2.23831      0.627286   0.627286   0.606073
  1.54146    3.79684   3.93783   2.45185      6.05399    6.05399    4.72112

[:, :, 2] =
 -3.88522   -4.60323  -6.22641    -5.35268  …  -5.54699   -4.85404  -4.23911
 -0.333787  -1.39339   0.0480469  -2.41201     -0.888888   1.12523   1.29876
  1.31337    2.3173    3.69475     5.66896      5.36392    4.12699   4.24896

[:, :, 3] =
 -2.39041   -3.54743  -4.97678   -4.47068  …  -4.08545  -4.42388   -4.3922
 -0.104582   1.58636  -0.343288   1.3287       1.96173   0.206633  -0.0314344
  2.98811    3.47019   3.23433    3.79403      6.25028   6.58745    4.24944

[:, :, 4] =
 -3.14779   -4.66862  -4.0515    -4.0515    …  -5.72507  -6.08864   -6.08864
  0.311314  -0.13403   0.659653   0.659653      1.20672  -0.207812  -0.207812
  3.36621    3.56558   3.2334     3.2334        3.50303   3.0455     3.0455</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.02593     1.00951
 -0.00337765  0.99904
  4.99932     1.0113</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.22 seconds
Compute duration  = 3.22 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

        x[1]   -4.9824    1.0034    0.0184   2977.0353   5050.6656    1.0002   ⋯
        x[2]    0.0069    1.0074    0.0182   3056.4629   5402.0240    1.0011   ⋯
        x[3]    4.9947    0.9993    0.0173   3352.3536   5177.2143    1.0000   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

        x[1]   -6.9495   -5.6745   -4.9690   -4.2947   -3.0640
        x[2]   -1.9609   -0.6585   -0.0010    0.6893    1.9905
        x[3]    3.0170    4.3343    4.9872    5.6649    6.9393
</span></pre>
</div>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.11 seconds
Compute duration  = 2.11 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

           x    0.5001    0.1889    0.0028   4272.8934   5774.8929    0.9999   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.1455    0.3604    0.5006    0.6426    0.8514
</span></pre>
</div>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.18 seconds
Compute duration  = 0.18 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

           x    0.5018    0.1320    0.0084   218.7511   119.6273    1.0083     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.2551    0.4017    0.4988    0.6155    0.7158
</span></pre>
</div>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre>DomainError with -0.9582333168080331:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] <span class="ansi-bold">#371</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [2] <span class="ansi-bold">check_args</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">utils.jl:89</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [3] <span class="ansi-bold">#Normal#370</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [4] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:36</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [5] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:42</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [6] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/I9lST/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">compiler.jl:558</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [7] <span class="ansi-bold">demo</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">__model__</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">__varinfo__</span>::DynamicPPL.ThreadSafeVarInfo<span class="ansi-bright-black-fg">{DynamicPPL.VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, Vector{Base.RefValue{Float64}}}</span>, <span class="ansi-bright-black-fg">__context__</span>::DynamicPPL.ValuesAsInModelContext<span class="ansi-bright-black-fg">{DynamicPPL.DefaultContext}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:457</span>
  [8] <span class="ansi-bold">_evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/I9lST/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:913</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [9] <span class="ansi-bold">evaluate_threadsafe!!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">varinfo</span>::DynamicPPL.VarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}</span>, <span class="ansi-bright-black-fg">context</span>::DynamicPPL.ValuesAsInModelContext<span class="ansi-bright-black-fg">{DynamicPPL.DefaultContext}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/I9lST/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:902</span>
 [10] <span class="ansi-bold">evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/I9lST/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:832</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [11] <span class="ansi-bold">values_as_in_model</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/I9lST/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">values_as_in_model.jl:173</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [12] <span class="ansi-bold">values_as_in_model</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/I9lST/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">values_as_in_model.jl:172</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [13] <span class="ansi-bold">getparams</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">vi</span>::DynamicPPL.VarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/MwOAl/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:353</span>
 [14] <span class="ansi-bold">Turing.Inference.Transition</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">vi</span>::DynamicPPL.VarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}</span>, <span class="ansi-bright-black-fg">t</span>::MALASample<span class="ansi-bright-black-fg">{Vector{Float64}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/MwOAl/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:230</span>
 [15] <span class="ansi-bold">transition_to_turing</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::LogDensityFunction<span class="ansi-bright-black-fg">{DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, DynamicPPL.VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DynamicPPL.DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}</span>, <span class="ansi-bright-black-fg">transition</span>::MALASample<span class="ansi-bright-black-fg">{Vector{Float64}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/MwOAl/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:12</span>
 [16] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler_wrapper</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>; <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">initial_params</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/MwOAl/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:77</span>
 [17] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/kwj9g/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:0</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [18] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/kwj9g/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:16</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [19] <span class="ansi-bold">mcmcsample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">progress</span>::Bool, <span class="ansi-bright-black-fg">progressname</span>::String, <span class="ansi-bright-black-fg">callback</span>::Nothing, <span class="ansi-bright-black-fg">num_warmup</span>::Int64, <span class="ansi-bright-black-fg">discard_initial</span>::Int64, <span class="ansi-bright-black-fg">thinning</span>::Int64, <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-yellow-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/kwj9g/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:144</span>
 [20] <span class="ansi-bold">sample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::DynamicPPL.Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::DynamicPPL.Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">resume_from</span>::Nothing, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{progress::Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/I9lST/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:102</span>
 [21] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/I9lST/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:92</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [22] <span class="ansi-bold">#sample#8</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/MwOAl/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:277</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [23] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/MwOAl/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:268</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [24] <span class="ansi-bold">#sample#7</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/MwOAl/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:265</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [25] top-level scope
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:459</span></pre>
</div>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.08 seconds
Compute duration  = 2.08 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.1183    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x    1.3660    0.0000    0.0000        NaN        NaN       NaN     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.1183    0.1183    0.1183    0.1183    0.1183
           x    1.3660    1.3660    1.3660    1.3660    1.3660
</span></pre>
</div>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.92 seconds
Compute duration  = 2.92 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    1.0095    0.8691    0.1406    57.6688        NaN    1.0528     ⋯
           x    0.1891    0.9749    0.0750   167.7536   257.1769    1.0113     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.1361    0.3744    0.7800    1.2753    3.4138
           x   -1.7573   -0.4254    0.0603    0.7525    2.5343
</span></pre>
</div>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/turinglang\.org\/docs\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../developers/inference/variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/main/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>