<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.3">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../tutorials/docs-07-for-developers-variational-inference/index.html" rel="prev">
<link href="../../assets/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-81b5c3e63835cfde897ecd3d35a35a41.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-c634bf5241e7a0f0add955421922332b.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-5870358ca908ec11c7112509c02a969e.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-44ada009216185fff2c787be4097b66f.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/docs-00-getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../tutorials/00-introduction/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.35" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.35</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.35">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">Users</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-00-getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-12-using-turing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Usage Tips</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-10-using-turing-autodiff/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/usage-generated-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Generated Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-13-using-turing-performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-15-using-turing-sampler-viz/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-11-using-turing-dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-16-using-turing-external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/00-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/01-gaussian-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/02-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/03-bayesian-neural-network/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/04-hidden-markov-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/05-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/06-infinite-mixture-model/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/07-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/08-multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/09-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/10-bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/11-probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/13-seasonal-time-series/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/15-gaussian-processes/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction to Gaussian Processes</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/12-gplvm/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">Contributing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-01-contributing-guide/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How to Contribute</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL in Depth</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/dev-model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-05-for-developers-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/14-minituring/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/16-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference (note: outdated)</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-06-for-developers-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Interface Guide</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-04-for-developers-abstractmcmc-turing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How Turing implements AbstractMCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../tutorials/docs-17-implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">Developers</li><li class="breadcrumb-item"><a href="../../tutorials/docs-06-for-developers-interface/index.html">Inference (note: outdated)</a></li><li class="breadcrumb-item"><a href="../../tutorials/docs-17-implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-31.65766699388162</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-31.65766699388162</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([-0.24550697234864027, 1.1399752971357173, 0.9073854809856209]), MALAState{Vector{Float64}}([-0.24550697234864027, 1.1399752971357173, 0.9073854809856209]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -3.89021   -5.01095    -4.19438   …  -5.50822  -4.76218   -5.14364
 -0.583018   0.0199545  -0.618183     -0.15311   0.156992  -1.03541
  1.98733    3.5454      4.336         5.34078   4.78204    5.52993</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.02058    1.00305
  0.0218759  0.980575
  5.01168    1.00184</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip270">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip270)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip271">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip270)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip272">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip272)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip272)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip272)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip272)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip272)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip272)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1562.15 2640.76,1562.15 "></polyline>
<polyline clip-path="url(#clip272)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1256.79 2640.76,1256.79 "></polyline>
<polyline clip-path="url(#clip272)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,951.433 2640.76,951.433 "></polyline>
<polyline clip-path="url(#clip272)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,646.076 2640.76,646.076 "></polyline>
<polyline clip-path="url(#clip272)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,340.72 2640.76,340.72 "></polyline>
<polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip270)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1562.15 170.644,1562.15 "></polyline>
<polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1256.79 170.644,1256.79 "></polyline>
<polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,951.433 170.644,951.433 "></polyline>
<polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,646.076 170.644,646.076 "></polyline>
<polyline clip-path="url(#clip270)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,340.72 170.644,340.72 "></polyline>
<path clip-path="url(#clip270)" d="M49.5521 1562.6 L79.2279 1562.6 L79.2279 1566.53 L49.5521 1566.53 L49.5521 1562.6 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M99.8991 1560.28 Q96.7509 1560.28 94.8991 1562.44 Q93.0704 1564.59 93.0704 1568.34 Q93.0704 1572.07 94.8991 1574.24 Q96.7509 1576.39 99.8991 1576.39 Q103.047 1576.39 104.876 1574.24 Q106.728 1572.07 106.728 1568.34 Q106.728 1564.59 104.876 1562.44 Q103.047 1560.28 99.8991 1560.28 M109.181 1545.63 L109.181 1549.89 Q107.422 1549.06 105.617 1548.62 Q103.834 1548.18 102.075 1548.18 Q97.4454 1548.18 94.9917 1551.3 Q92.5612 1554.43 92.2139 1560.75 Q93.5797 1558.73 95.6398 1557.67 Q97.7 1556.58 100.177 1556.58 Q105.385 1556.58 108.394 1559.75 Q111.427 1562.9 111.427 1568.34 Q111.427 1573.66 108.279 1576.88 Q105.131 1580.1 99.8991 1580.1 Q93.9037 1580.1 90.7325 1575.51 Q87.5612 1570.91 87.5612 1562.18 Q87.5612 1553.99 91.45 1549.13 Q95.3389 1544.24 101.89 1544.24 Q103.649 1544.24 105.431 1544.59 Q107.237 1544.94 109.181 1545.63 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M50.3623 1257.24 L80.0381 1257.24 L80.0381 1261.18 L50.3623 1261.18 L50.3623 1257.24 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M104.297 1255.44 Q107.654 1256.15 109.529 1258.42 Q111.427 1260.69 111.427 1264.02 Q111.427 1269.14 107.908 1271.94 Q104.39 1274.74 97.9083 1274.74 Q95.7324 1274.74 93.4176 1274.3 Q91.126 1273.88 88.6723 1273.03 L88.6723 1268.51 Q90.6167 1269.65 92.9315 1270.23 Q95.2463 1270.81 97.7695 1270.81 Q102.168 1270.81 104.459 1269.07 Q106.774 1267.33 106.774 1264.02 Q106.774 1260.97 104.621 1259.25 Q102.492 1257.52 98.6722 1257.52 L94.6445 1257.52 L94.6445 1253.68 L98.8574 1253.68 Q102.306 1253.68 104.135 1252.31 Q105.964 1250.92 105.964 1248.33 Q105.964 1245.67 104.066 1244.26 Q102.191 1242.82 98.6722 1242.82 Q96.7509 1242.82 94.5519 1243.24 Q92.3528 1243.65 89.7139 1244.53 L89.7139 1240.37 Q92.376 1239.63 94.6908 1239.26 Q97.0287 1238.88 99.0889 1238.88 Q104.413 1238.88 107.515 1241.32 Q110.617 1243.72 110.617 1247.84 Q110.617 1250.71 108.973 1252.7 Q107.33 1254.67 104.297 1255.44 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M99.4824 937.232 Q95.8713 937.232 94.0426 940.797 Q92.2371 944.338 92.2371 951.468 Q92.2371 958.574 94.0426 962.139 Q95.8713 965.681 99.4824 965.681 Q103.117 965.681 104.922 962.139 Q106.751 958.574 106.751 951.468 Q106.751 944.338 104.922 940.797 Q103.117 937.232 99.4824 937.232 M99.4824 933.528 Q105.293 933.528 108.348 938.135 Q111.427 942.718 111.427 951.468 Q111.427 960.195 108.348 964.801 Q105.293 969.384 99.4824 969.384 Q93.6723 969.384 90.5936 964.801 Q87.538 960.195 87.538 951.468 Q87.538 942.718 90.5936 938.135 Q93.6723 933.528 99.4824 933.528 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M104.297 644.722 Q107.654 645.44 109.529 647.708 Q111.427 649.977 111.427 653.31 Q111.427 658.426 107.908 661.227 Q104.39 664.028 97.9083 664.028 Q95.7324 664.028 93.4176 663.588 Q91.126 663.171 88.6723 662.315 L88.6723 657.801 Q90.6167 658.935 92.9315 659.514 Q95.2463 660.093 97.7695 660.093 Q102.168 660.093 104.459 658.357 Q106.774 656.62 106.774 653.31 Q106.774 650.255 104.621 648.542 Q102.492 646.806 98.6722 646.806 L94.6445 646.806 L94.6445 642.963 L98.8574 642.963 Q102.306 642.963 104.135 641.597 Q105.964 640.208 105.964 637.616 Q105.964 634.954 104.066 633.542 Q102.191 632.107 98.6722 632.107 Q96.7509 632.107 94.5519 632.523 Q92.3528 632.94 89.7139 633.82 L89.7139 629.653 Q92.376 628.912 94.6908 628.542 Q97.0287 628.171 99.0889 628.171 Q104.413 628.171 107.515 630.602 Q110.617 633.009 110.617 637.13 Q110.617 640 108.973 641.991 Q107.33 643.958 104.297 644.722 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip270)" d="M99.8991 338.856 Q96.7509 338.856 94.8991 341.009 Q93.0704 343.162 93.0704 346.912 Q93.0704 350.639 94.8991 352.815 Q96.7509 354.967 99.8991 354.967 Q103.047 354.967 104.876 352.815 Q106.728 350.639 106.728 346.912 Q106.728 343.162 104.876 341.009 Q103.047 338.856 99.8991 338.856 M109.181 324.204 L109.181 328.463 Q107.422 327.63 105.617 327.19 Q103.834 326.75 102.075 326.75 Q97.4454 326.75 94.9917 329.875 Q92.5612 333 92.2139 339.319 Q93.5797 337.306 95.6398 336.241 Q97.7 335.153 100.177 335.153 Q105.385 335.153 108.394 338.324 Q111.427 341.472 111.427 346.912 Q111.427 352.236 108.279 355.454 Q105.131 358.671 99.8991 358.671 Q93.9037 358.671 90.7325 354.088 Q87.5612 349.481 87.5612 340.755 Q87.5612 332.56 91.45 327.699 Q95.3389 322.815 101.89 322.815 Q103.649 322.815 105.431 323.162 Q107.237 323.509 109.181 324.204 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip272)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1347.4 224.541,1436.95 226.891,1407.6 229.242,1542.18 231.592,1557.25 233.943,1360.72 236.293,1344.58 238.644,1463.2 240.994,1531.81 243.345,1438.88 245.695,1207.38 248.046,1411.63 250.396,1357.63 252.747,1559.58 255.097,1415.02 257.448,1370.34 259.798,1417.5 262.148,1725.46 264.499,1680.11 266.849,1561.33 269.2,1305.92 271.55,1435.83 273.901,1332.12 276.251,1414.85 278.602,1422.94 280.952,1264.5 283.303,1448.54 285.653,1422.57 288.004,1523.68 290.354,1403.6 292.705,1575.61 295.055,1545.07 297.406,1388.98 299.756,1426.24 302.107,1412.99 304.457,1445.25 306.807,1320.75 309.158,1219.76 311.508,1459.61 313.859,1312.15 316.209,1507.51 318.56,1436.39 320.91,1427.8 323.261,1482.14 325.611,1323.22 327.962,1483.43 330.312,1366.14 332.663,1259.21 335.013,1410.4 337.364,1467.75 339.714,1248.06 342.065,1349.61 344.415,1459.46 346.765,1577.12 349.116,1301.75 351.466,1454.88 353.817,1375.87 356.167,1491.4 358.518,1472.24 360.868,1303.93 363.219,1600.61 365.569,1607.71 367.92,1355.75 370.27,1426.28 372.621,1207.46 374.971,1344.01 377.322,1598.02 379.672,1422.86 382.023,1552.89 384.373,1377.28 386.724,1544.52 389.074,1604.84 391.424,1502.28 393.775,1633.08 396.125,1486.56 398.476,1494.1 400.826,1466.31 403.177,1447.51 405.527,1525.89 407.878,1491.45 410.228,1556.16 412.579,1565.43 414.929,1396.7 417.28,1507.89 419.63,1462.17 421.981,1419.7 424.331,1420.14 426.682,1418.53 429.032,1389.16 431.382,1476.79 433.733,1484.79 436.083,1467.9 438.434,1551.79 440.784,1287.79 443.135,1225.88 445.485,1519.04 447.836,1385.65 450.186,1494.26 452.537,1403.86 454.887,1336.7 457.238,1430.22 459.588,1469.18 461.939,1568.76 464.289,1626.23 466.64,1405.41 468.99,1430.08 471.341,1460.86 473.691,1493.05 476.041,1475.63 478.392,1289.9 480.742,1482.74 483.093,1404.14 485.443,1582.58 487.794,1232.92 490.144,1391.32 492.495,1724.08 494.845,1383.53 497.196,1344.87 499.546,1529.27 501.897,1503.04 504.247,1445.34 506.598,1361.24 508.948,1329.18 511.299,1547.37 513.649,1173.5 515.999,1483.2 518.35,1505.86 520.7,1499.93 523.051,1455.48 525.401,1520.66 527.752,1612.56 530.102,1689.56 532.453,1387.49 534.803,1624.05 537.154,1556.68 539.504,1382.19 541.855,1528.82 544.205,1410.27 546.556,1492.81 548.906,1559.17 551.257,1605.29 553.607,1460.55 555.958,1359.59 558.308,1446.29 560.658,1537.12 563.009,1471.33 565.359,1558.7 567.71,1262.49 570.06,1470.52 572.411,1366.84 574.761,1631.35 577.112,1393.38 579.462,1389.64 581.813,1396.07 584.163,1420.44 586.514,1597.96 588.864,1433.94 591.215,1449.09 593.565,1405.87 595.916,1514.02 598.266,1449.95 600.616,1406.4 602.967,1437.02 605.317,1394.78 607.668,1458.76 610.018,1520.31 612.369,1286.13 614.719,1269.37 617.07,1493.05 619.42,1746.86 621.771,1578.39 624.121,1307.24 626.472,1509.33 628.822,1423.82 631.173,1463.04 633.523,1364.3 635.874,1234.82 638.224,1527.4 640.575,1621.27 642.925,1665.48 645.275,1406.75 647.626,1626.68 649.976,1435.09 652.327,1446.08 654.677,1596.24 657.028,1213.61 659.378,1472.29 661.729,1560.52 664.079,1485.63 666.43,1511.98 668.78,1577.98 671.131,1646.62 673.481,1392.35 675.832,1498.4 678.182,1447.08 680.533,1336.09 682.883,1555.21 685.233,1361.92 687.584,1459.45 689.934,1573.96 692.285,1186.55 694.635,1608.25 696.986,1468.96 699.336,1519.23 701.687,1732.99 704.037,1539.57 706.388,1309.63 708.738,1407.34 711.089,1563.28 713.439,1428.47 715.79,1619.03 718.14,1242.12 720.491,1574.1 722.841,1532.93 725.192,1339.22 727.542,1516.35 729.892,1348.69 732.243,1586.05 734.593,1469.21 736.944,1447.92 739.294,1377.68 741.645,1486.76 743.995,1413.13 746.346,1460.19 748.696,1451.23 751.047,1606.87 753.397,1609.9 755.748,1494.03 758.098,1500.59 760.449,1485.47 762.799,1346.84 765.15,1379.22 767.5,1389 769.85,1468.25 772.201,1426.65 774.551,1328.87 776.902,1223.03 779.252,1260.14 781.603,1465.56 783.953,1352.2 786.304,1506.31 788.654,1446.21 791.005,1356.56 793.355,1277.55 795.706,1563.62 798.056,1383.02 800.407,1262.97 802.757,1333.85 805.108,1393.21 807.458,1509.94 809.809,1412.24 812.159,1538.54 814.509,1533.74 816.86,1430.34 819.21,1551.85 821.561,1474.45 823.911,1400.23 826.262,1514.28 828.612,1488.18 830.963,1420.31 833.313,1654.31 835.664,1575.19 838.014,1357.04 840.365,1408.96 842.715,1529.52 845.066,1614.05 847.416,1582.21 849.767,1375.71 852.117,1418.3 854.467,1481.97 856.818,1501.33 859.168,1399.42 861.519,1569.79 863.869,1372.82 866.22,1495.32 868.57,1452.5 870.921,1421.9 873.271,1433.15 875.622,1396.38 877.972,1457.62 880.323,1561.03 882.673,1514.12 885.024,1495.93 887.374,1446.85 889.725,1536.36 892.075,1580.89 894.426,1473.9 896.776,1476.4 899.126,1292.93 901.477,1598.86 903.827,1521.66 906.178,1367.84 908.528,1354.63 910.879,1468.59 913.229,1388.2 915.58,1613.45 917.93,1420.57 920.281,1420.44 922.631,1363.69 924.982,1578.89 927.332,1352.29 929.683,1287.07 932.033,1572.42 934.384,1442.61 936.734,1401.45 939.084,1506.03 941.435,1347.63 943.785,1607.67 946.136,1573.05 948.486,1365.26 950.837,1587.16 953.187,1428.6 955.538,1545.55 957.888,1509.01 960.239,1519.62 962.589,1499.03 964.94,1506.96 967.29,1499.69 969.641,1430.3 971.991,1491.31 974.342,1423.49 976.692,1366.26 979.043,1394.6 981.393,1495.84 983.743,1394.28 986.094,1274.23 988.444,1558.18 990.795,1349.98 993.145,1475.66 995.496,1460.26 997.846,1549.89 1000.2,1267.85 1002.55,1502.3 1004.9,1325.37 1007.25,1270.36 1009.6,1356.59 1011.95,1440.6 1014.3,1694.64 1016.65,1377.47 1019,1281.48 1021.35,1542.56 1023.7,1378.36 1026.05,1554.87 1028.4,1480.17 1030.75,1525.61 1033.1,1571.87 1035.45,1355.56 1037.8,1214.9 1040.15,1187.37 1042.51,1547.12 1044.86,1661.22 1047.21,1457.45 1049.56,1480.7 1051.91,1475.87 1054.26,1390.23 1056.61,1345.5 1058.96,1342.36 1061.31,1392.33 1063.66,1495.55 1066.01,1524.58 1068.36,1406.89 1070.71,1439.6 1073.06,1570.86 1075.41,1274.93 1077.76,1515.67 1080.11,1410.6 1082.46,1509.3 1084.81,1516.57 1087.16,1460.89 1089.51,1485.62 1091.87,1353.98 1094.22,1342.92 1096.57,1399.34 1098.92,1349.33 1101.27,1476.4 1103.62,1392.02 1105.97,1352.48 1108.32,1577.95 1110.67,1438.22 1113.02,1413.09 1115.37,1425.7 1117.72,1354.78 1120.07,1466.86 1122.42,1340.49 1124.77,1462.69 1127.12,1473.35 1129.47,1508.78 1131.82,1533.44 1134.17,1516.05 1136.52,1543.94 1138.87,1484.22 1141.23,1482.55 1143.58,1565.19 1145.93,1517.65 1148.28,1472.01 1150.63,1590.51 1152.98,1467 1155.33,1545.63 1157.68,1707.19 1160.03,1382.68 1162.38,1519.25 1164.73,1530.66 1167.08,1284.18 1169.43,1420.5 1171.78,1598.89 1174.13,1709.39 1176.48,1516.17 1178.83,1657.74 1181.18,1504.89 1183.53,1529.24 1185.88,1264.16 1188.23,1401.35 1190.59,1455.25 1192.94,1385.28 1195.29,1393.48 1197.64,1272.19 1199.99,1349.33 1202.34,1403.02 1204.69,1295.55 1207.04,1339.15 1209.39,1491.89 1211.74,1393.07 1214.09,1369.94 1216.44,1717.28 1218.79,1240.75 1221.14,1555.27 1223.49,1430.7 1225.84,1450.66 1228.19,1368.55 1230.54,1481.85 1232.89,1415.04 1235.24,1346.47 1237.59,1493 1239.94,1329.72 1242.3,1403.51 1244.65,1455.85 1247,1522.96 1249.35,1568.19 1251.7,1501.58 1254.05,1424.25 1256.4,1567.46 1258.75,1549.46 1261.1,1489.25 1263.45,1479.04 1265.8,1281.75 1268.15,1260.91 1270.5,1553.2 1272.85,1586.26 1275.2,1377.69 1277.55,1412.24 1279.9,1474.54 1282.25,1633.93 1284.6,1622.86 1286.95,1388.16 1289.3,1643.11 1291.66,1393.68 1294.01,1505.36 1296.36,1395.11 1298.71,1516.68 1301.06,1434.08 1303.41,1377.94 1305.76,1463.4 1308.11,1642.21 1310.46,1474.78 1312.81,1643.16 1315.16,1300.55 1317.51,1432.44 1319.86,1497.44 1322.21,1324.57 1324.56,1482.05 1326.91,1614.85 1329.26,1361.1 1331.61,1506.22 1333.96,1372.72 1336.31,1331.93 1338.66,1547.24 1341.02,1533.73 1343.37,1344.44 1345.72,1559.66 1348.07,1412.06 1350.42,1418.77 1352.77,1525.26 1355.12,1484.91 1357.47,1473.35 1359.82,1480.1 1362.17,1403.42 1364.52,1342.44 1366.87,1679.86 1369.22,1751.15 1371.57,1472.9 1373.92,1514.91 1376.27,1610.97 1378.62,1438.6 1380.97,1471.6 1383.32,1626.91 1385.67,1343.35 1388.02,1407.05 1390.38,1329.98 1392.73,1720.5 1395.08,1257.44 1397.43,1467.79 1399.78,1522.15 1402.13,1428.43 1404.48,1412.41 1406.83,1397.13 1409.18,1491.95 1411.53,1368.92 1413.88,1518.64 1416.23,1474.32 1418.58,1611.01 1420.93,1409.89 1423.28,1599.77 1425.63,1340.85 1427.98,1387.54 1430.33,1343.85 1432.68,1259.1 1435.03,1414.58 1437.38,1570.88 1439.74,1369.33 1442.09,1503.34 1444.44,1564.79 1446.79,1296.23 1449.14,1454.12 1451.49,1304.9 1453.84,1439.81 1456.19,1325.84 1458.54,1501.35 1460.89,1534.17 1463.24,1550.51 1465.59,1377.25 1467.94,1461.92 1470.29,1362.96 1472.64,1462.69 1474.99,1454.96 1477.34,1475.31 1479.69,1350.27 1482.04,1320.55 1484.39,1182.7 1486.74,1523.14 1489.1,1406.3 1491.45,1514.1 1493.8,1500.06 1496.15,1504.44 1498.5,1628.01 1500.85,1613.45 1503.2,1505.99 1505.55,1535.57 1507.9,1597.33 1510.25,1467.81 1512.6,1536.24 1514.95,1672.17 1517.3,1509.82 1519.65,1434.44 1522,1339.1 1524.35,1203.47 1526.7,1424.25 1529.05,1486.97 1531.4,1351.03 1533.75,1550.54 1536.1,1500.3 1538.45,1488.91 1540.81,1560.78 1543.16,1310.34 1545.51,1557.05 1547.86,1473.1 1550.21,1474.03 1552.56,1384.87 1554.91,1429.29 1557.26,1469.07 1559.61,1489.42 1561.96,1549.75 1564.31,1727.59 1566.66,1544.34 1569.01,1526.23 1571.36,1427.5 1573.71,1327.03 1576.06,1347.86 1578.41,1474.83 1580.76,1474.09 1583.11,1532.62 1585.46,1599.44 1587.81,1611.82 1590.17,1476.49 1592.52,1435.29 1594.87,1606.12 1597.22,1541.4 1599.57,1383.39 1601.92,1502.45 1604.27,1569.44 1606.62,1419.37 1608.97,1407.96 1611.32,1417.78 1613.67,1475.25 1616.02,1420.74 1618.37,1538.52 1620.72,1353.61 1623.07,1522.16 1625.42,1339.75 1627.77,1411.01 1630.12,1431.72 1632.47,1312.55 1634.82,1391.42 1637.17,1370.06 1639.53,1351.11 1641.88,1449.66 1644.23,1455.74 1646.58,1400.26 1648.93,1431.9 1651.28,1334.35 1653.63,1583.11 1655.98,1575.37 1658.33,1472.36 1660.68,1364.5 1663.03,1442.23 1665.38,1359.24 1667.73,1310.92 1670.08,1376.74 1672.43,1386.82 1674.78,1559.67 1677.13,1540.32 1679.48,1647.14 1681.83,1184.06 1684.18,1468.08 1686.53,1500.06 1688.89,1507.09 1691.24,1539.33 1693.59,1296.63 1695.94,1550.21 1698.29,1522.77 1700.64,1393.71 1702.99,1607.04 1705.34,1602.39 1707.69,1551.68 1710.04,1491.83 1712.39,1434.2 1714.74,1328.61 1717.09,1489.68 1719.44,1448.32 1721.79,1590.31 1724.14,1400.59 1726.49,1601.46 1728.84,1401.21 1731.19,1556.35 1733.54,1492.37 1735.89,1649.66 1738.25,1686.19 1740.6,1647.09 1742.95,1516.67 1745.3,1544.35 1747.65,1376.33 1750,1281.16 1752.35,1417.45 1754.7,1562.27 1757.05,1539.21 1759.4,1359.29 1761.75,1442.34 1764.1,1348.64 1766.45,1323.29 1768.8,1329.43 1771.15,1402.91 1773.5,1571.52 1775.85,1544.71 1778.2,1331.49 1780.55,1243.64 1782.9,1403.18 1785.25,1616.03 1787.6,1286.8 1789.96,1391 1792.31,1591.23 1794.66,1435.11 1797.01,1452.69 1799.36,1620.99 1801.71,1502.56 1804.06,1432.53 1806.41,1399.05 1808.76,1203.37 1811.11,1591.62 1813.46,1452.46 1815.81,1604.07 1818.16,1328.76 1820.51,1480.6 1822.86,1320.43 1825.21,1454.21 1827.56,1434.8 1829.91,1405.76 1832.26,1417.52 1834.61,1422.97 1836.96,1541.8 1839.32,1477.62 1841.67,1366.12 1844.02,1508.32 1846.37,1492.29 1848.72,1598.33 1851.07,1358.72 1853.42,1589.3 1855.77,1295.48 1858.12,1462.85 1860.47,1451.87 1862.82,1412.07 1865.17,1357.32 1867.52,1514.07 1869.87,1487.5 1872.22,1546.09 1874.57,1588.41 1876.92,1511.75 1879.27,1363.61 1881.62,1508.55 1883.97,1634.58 1886.32,1630.18 1888.68,1517.25 1891.03,1429.27 1893.38,1422.67 1895.73,1513.75 1898.08,1476.16 1900.43,1599.52 1902.78,1357.08 1905.13,1382.16 1907.48,1510.65 1909.83,1318.65 1912.18,1438.21 1914.53,1452.69 1916.88,1428.75 1919.23,1441.98 1921.58,1340.38 1923.93,1390.35 1926.28,1604.5 1928.63,1420.54 1930.98,1558.66 1933.33,1285.47 1935.68,1492.91 1938.04,1369.48 1940.39,1417 1942.74,1392.8 1945.09,1539.43 1947.44,1652.8 1949.79,1434.1 1952.14,1502.97 1954.49,1341.65 1956.84,1591.83 1959.19,1554.26 1961.54,1469.49 1963.89,1494.71 1966.24,1428.81 1968.59,1405.01 1970.94,1535.25 1973.29,1490.82 1975.64,1550.23 1977.99,1636.92 1980.34,1449.28 1982.69,1532.77 1985.04,1577.65 1987.4,1146.93 1989.75,1463.22 1992.1,1372.23 1994.45,1328.66 1996.8,1601.37 1999.15,1566.01 2001.5,1483.58 2003.85,1445.53 2006.2,1467.82 2008.55,1429.38 2010.9,1474.36 2013.25,1337.17 2015.6,1513.03 2017.95,1582.95 2020.3,1734.53 2022.65,1285.37 2025,1317.54 2027.35,1551.39 2029.7,1506.13 2032.05,1377.22 2034.4,1570.36 2036.76,1422.77 2039.11,1587.63 2041.46,1350.27 2043.81,1534.64 2046.16,1694.31 2048.51,1348.46 2050.86,1419.65 2053.21,1321.98 2055.56,1480.16 2057.91,1461.79 2060.26,1260.27 2062.61,1356.57 2064.96,1284.05 2067.31,1456.25 2069.66,1662.31 2072.01,1650.83 2074.36,1404.28 2076.71,1373.35 2079.06,1346.24 2081.41,1406.55 2083.76,1467.49 2086.11,1530.09 2088.47,1523.68 2090.82,1337.59 2093.17,1427.6 2095.52,1492.06 2097.87,1373.02 2100.22,1471.08 2102.57,1324.58 2104.92,1523.82 2107.27,1385.71 2109.62,1515.19 2111.97,1385.43 2114.32,1635.58 2116.67,1444.27 2119.02,1360.41 2121.37,1521.17 2123.72,1259.19 2126.07,1511.58 2128.42,1620.6 2130.77,1526.16 2133.12,1450.91 2135.47,1353.19 2137.83,1313.15 2140.18,1324.19 2142.53,1493.91 2144.88,1531.19 2147.23,1529.85 2149.58,1369.44 2151.93,1377.94 2154.28,1459.03 2156.63,1434.64 2158.98,1451.83 2161.33,1619.81 2163.68,1331.7 2166.03,1397.82 2168.38,1293.49 2170.73,1357.11 2173.08,1481.55 2175.43,1393.52 2177.78,1574.92 2180.13,1592.76 2182.48,1482.68 2184.83,1481.69 2187.19,1507.68 2189.54,1468.71 2191.89,1399.44 2194.24,1444.43 2196.59,1479.32 2198.94,1426.74 2201.29,1490.03 2203.64,1470.95 2205.99,1347.86 2208.34,1551.76 2210.69,1451.74 2213.04,1554.61 2215.39,1544.27 2217.74,1634.18 2220.09,1596.28 2222.44,1611.1 2224.79,1514.51 2227.14,1373.73 2229.49,1446.6 2231.84,1662.1 2234.19,1562.02 2236.55,1425.91 2238.9,1454.49 2241.25,1492.79 2243.6,1347.25 2245.95,1303.02 2248.3,1490.55 2250.65,1575.5 2253,1535.02 2255.35,1369.46 2257.7,1469.69 2260.05,1450.28 2262.4,1441.45 2264.75,1491.04 2267.1,1412.13 2269.45,1439.32 2271.8,1418.09 2274.15,1497.05 2276.5,1518.92 2278.85,1669.99 2281.2,1503.89 2283.55,1594.04 2285.91,1487.67 2288.26,1227.22 2290.61,1580.53 2292.96,1430.07 2295.31,1640.27 2297.66,1521.32 2300.01,1528.19 2302.36,1557.93 2304.71,1380.94 2307.06,1547.88 2309.41,1422.31 2311.76,1341.32 2314.11,1444.81 2316.46,1472.65 2318.81,1506.09 2321.16,1340.82 2323.51,1419.08 2325.86,1476.15 2328.21,1360.28 2330.56,1495.81 2332.91,1388.57 2335.27,1391.82 2337.62,1464.77 2339.97,1550.76 2342.32,1359.66 2344.67,1527.46 2347.02,1372.43 2349.37,1441.49 2351.72,1502.93 2354.07,1542.2 2356.42,1451.88 2358.77,1494.24 2361.12,1447.03 2363.47,1436.49 2365.82,1573.74 2368.17,1497.77 2370.52,1550.73 2372.87,1481.01 2375.22,1517.48 2377.57,1299.9 2379.92,1271.54 2382.27,1428.04 2384.62,1543.36 2386.98,1449.94 2389.33,1525.45 2391.68,1615.61 2394.03,1587.28 2396.38,1416.29 2398.73,1534.43 2401.08,1185.81 2403.43,1270.6 2405.78,1399.69 2408.13,1416.13 2410.48,1394.12 2412.83,1406.31 2415.18,1280.09 2417.53,1511.78 2419.88,1497.12 2422.23,1348.42 2424.58,1466.71 2426.93,1427.54 2429.28,1536.07 2431.63,1329.41 2433.98,1584.24 2436.34,1578.36 2438.69,1549.49 2441.04,1460.49 2443.39,1359.04 2445.74,1447.44 2448.09,1605.59 2450.44,1448.7 2452.79,1238.97 2455.14,1368.67 2457.49,1494.6 2459.84,1271.61 2462.19,1480.63 2464.54,1539.89 2466.89,1502.52 2469.24,1534.69 2471.59,1579.82 2473.94,1484.41 2476.29,1306.17 2478.64,1419.2 2480.99,1335.49 2483.34,1446.87 2485.7,1605.14 2488.05,1583.85 2490.4,1524.57 2492.75,1684.44 2495.1,1469.34 2497.45,1510.29 2499.8,1355.5 2502.15,1546.29 2504.5,1345.53 2506.85,1322.64 2509.2,1525.94 2511.55,1529.88 2513.9,1348.7 2516.25,1443.38 2518.6,1540.59 2520.95,1505.55 2523.3,1510.66 2525.65,1452.33 2528,1567.67 2530.35,1430.78 2532.7,1402.97 2535.06,1294.98 2537.41,1392.7 2539.76,1525.34 2542.11,1396.49 2544.46,1379.28 2546.81,1525.51 2549.16,1481.1 2551.51,1434.95 2553.86,1363.19 2556.21,1374.68 2558.56,1535.96 2560.91,1534.15 2563.26,1589.84 2565.61,1517.28 2567.96,1586.04 2570.31,1572.79 "></polyline>
<polyline clip-path="url(#clip272)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1010.78 224.541,1091.4 226.891,1109.43 229.242,970.348 231.592,931.939 233.943,900.172 236.293,882.567 238.644,913.525 240.994,908.631 243.345,872.124 245.695,1071.26 248.046,1110.83 250.396,1068.51 252.747,990.512 255.097,826.797 257.448,793.613 259.798,1299.19 262.148,1071.06 264.499,1006.92 266.849,1104.67 269.2,970.231 271.55,892.397 273.901,988.037 276.251,991.642 278.602,931.904 280.952,947.287 283.303,1058.41 285.653,868.365 288.004,928.407 290.354,834.518 292.705,1045.88 295.055,851.824 297.406,1105.27 299.756,1173.83 302.107,986.895 304.457,886.207 306.807,889.788 309.158,1013.47 311.508,1011.1 313.859,900.795 316.209,967.335 318.56,744.806 320.91,880.481 323.261,846.153 325.611,1018.66 327.962,1070.44 330.312,946.292 332.663,1006.51 335.013,958.549 337.364,842.795 339.714,1074.09 342.065,1092.23 344.415,1109.86 346.765,976.457 349.116,998.02 351.466,837.407 353.817,1027.27 356.167,804.221 358.518,907.867 360.868,1102.82 363.219,1012.67 365.569,838.585 367.92,1188.74 370.27,1049.52 372.621,927.34 374.971,1066.28 377.322,939.45 379.672,979.731 382.023,1053.31 384.373,982.164 386.724,879.748 389.074,970.796 391.424,1025.32 393.775,1131.46 396.125,961.562 398.476,1037.74 400.826,1062.79 403.177,943.661 405.527,950.971 407.878,1100.59 410.228,832.347 412.579,1067.33 414.929,1004.24 417.28,925.53 419.63,964.386 421.981,1113.22 424.331,874.401 426.682,1038.92 429.032,984.831 431.382,979.685 433.733,1011.77 436.083,883.239 438.434,1034.28 440.784,940.166 443.135,1043.62 445.485,785.906 447.836,877.193 450.186,999.35 452.537,953.224 454.887,965.892 457.238,782.438 459.588,959.689 461.939,1108.14 464.289,1119.11 466.64,838.645 468.99,861.963 471.341,934.309 473.691,1025.97 476.041,925.949 478.392,981.118 480.742,1027.76 483.093,863.717 485.443,919.379 487.794,900.74 490.144,818.407 492.495,1010.95 494.845,1072.14 497.196,897.91 499.546,892.162 501.897,796.21 504.247,920.606 506.598,1084.01 508.948,1004.48 511.299,1017.03 513.649,801.211 515.999,905.664 518.35,1064.58 520.7,813.345 523.051,1212.15 525.401,939.052 527.752,802.777 530.102,917.829 532.453,910.434 534.803,911.686 537.154,961.756 539.504,1133.59 541.855,982.26 544.205,1112.14 546.556,808.873 548.906,1011.76 551.257,912.212 553.607,1105.7 555.958,911.339 558.308,949.101 560.658,1051.88 563.009,1025.88 565.359,1068.76 567.71,986.399 570.06,745.573 572.411,1137 574.761,988.063 577.112,855.386 579.462,913.924 581.813,950.253 584.163,900.612 586.514,889.452 588.864,997.154 591.215,1013.96 593.565,818.357 595.916,917.552 598.266,857.903 600.616,1000.5 602.967,1107.73 605.317,1136.08 607.668,1105.29 610.018,931.622 612.369,1117.58 614.719,798.04 617.07,949.379 619.42,962.193 621.771,776.412 624.121,1018.34 626.472,881.439 628.822,1016.52 631.173,1028.48 633.523,813.523 635.874,891.405 638.224,755.763 640.575,1057.04 642.925,872.343 645.275,1062.87 647.626,1145.2 649.976,984.62 652.327,1017.9 654.677,969.83 657.028,960.05 659.378,867.096 661.729,1020.63 664.079,963.767 666.43,769.005 668.78,824.271 671.131,1070.48 673.481,893.016 675.832,840.746 678.182,1036.42 680.533,1112.52 682.883,735.402 685.233,963.588 687.584,818.714 689.934,1021.12 692.285,1087.48 694.635,905.379 696.986,954.045 699.336,984.567 701.687,889.508 704.037,1054.88 706.388,956.398 708.738,881.956 711.089,915.918 713.439,832.48 715.79,1025.72 718.14,968.92 720.491,805.354 722.841,925.831 725.192,901.615 727.542,818.892 729.892,819.825 732.243,858.371 734.593,913.558 736.944,990.284 739.294,808.416 741.645,857.627 743.995,1114.43 746.346,1201.17 748.696,772.475 751.047,795.44 753.397,1054.16 755.748,843.455 758.098,944.946 760.449,964.53 762.799,883.65 765.15,925.198 767.5,834.116 769.85,1037.59 772.201,935.526 774.551,1100.6 776.902,1051.84 779.252,889.399 781.603,978.47 783.953,1126.39 786.304,931.156 788.654,793.897 791.005,920.333 793.355,915.912 795.706,974.448 798.056,923.46 800.407,1063.4 802.757,1013.64 805.108,868.442 807.458,824.639 809.809,909.411 812.159,920.714 814.509,993.28 816.86,919.491 819.21,955.852 821.561,998.554 823.911,1202.02 826.262,969.848 828.612,965.155 830.963,807.815 833.313,1004.79 835.664,812.972 838.014,1067.2 840.365,1053.02 842.715,1061.11 845.066,962.3 847.416,1201.18 849.767,1143.97 852.117,865.456 854.467,879.693 856.818,911.109 859.168,1260.94 861.519,1028.57 863.869,878.724 866.22,915.152 868.57,1045.2 870.921,812.055 873.271,1014.37 875.622,942.506 877.972,984.415 880.323,897.102 882.673,1011.33 885.024,948.963 887.374,976.739 889.725,999.05 892.075,893.876 894.426,790.907 896.776,1133.71 899.126,757.084 901.477,977.469 903.827,1080.77 906.178,1182.53 908.528,979.168 910.879,896.207 913.229,1025.19 915.58,1127.11 917.93,1110.64 920.281,856.366 922.631,988.855 924.982,932.512 927.332,960.024 929.683,963.326 932.033,949.425 934.384,1107.31 936.734,1023.91 939.084,976.45 941.435,753.235 943.785,868.242 946.136,886.943 948.486,959.797 950.837,785.966 953.187,1112.79 955.538,1095.44 957.888,972.679 960.239,878.166 962.589,921.605 964.94,1073.53 967.29,876.992 969.641,887.822 971.991,870.12 974.342,816.152 976.692,916.457 979.043,1088.49 981.393,874.145 983.743,917.014 986.094,864.464 988.444,1138.03 990.795,1041.84 993.145,897.588 995.496,914.446 997.846,871.641 1000.2,952.161 1002.55,981.35 1004.9,969.746 1007.25,915.462 1009.6,759.693 1011.95,951.692 1014.3,904.549 1016.65,870.918 1019,970.485 1021.35,959.777 1023.7,954.93 1026.05,1105.63 1028.4,1045.55 1030.75,973.852 1033.1,831.032 1035.45,872.184 1037.8,1064.52 1040.15,1007.92 1042.51,892.25 1044.86,863.635 1047.21,937.096 1049.56,950.698 1051.91,1048.46 1054.26,1120.2 1056.61,1003.45 1058.96,1010.14 1061.31,955.891 1063.66,923.806 1066.01,894.687 1068.36,751.834 1070.71,766.361 1073.06,976.176 1075.41,919.712 1077.76,741.123 1080.11,1028.73 1082.46,946.235 1084.81,936.174 1087.16,817.988 1089.51,883.996 1091.87,946.188 1094.22,1069.52 1096.57,1020.34 1098.92,1074.34 1101.27,773.883 1103.62,795.926 1105.97,1129.72 1108.32,812.905 1110.67,1090.52 1113.02,926.467 1115.37,841.983 1117.72,792.793 1120.07,928.174 1122.42,955.794 1124.77,928.742 1127.12,944.955 1129.47,1116.3 1131.82,838.501 1134.17,843.426 1136.52,1061.09 1138.87,884.422 1141.23,808.801 1143.58,1025.44 1145.93,882.507 1148.28,1064.78 1150.63,853.392 1152.98,888.629 1155.33,829.83 1157.68,1032.06 1160.03,916.357 1162.38,1070.05 1164.73,884.303 1167.08,818.611 1169.43,1094.08 1171.78,989.494 1174.13,1085.94 1176.48,964.071 1178.83,1077.21 1181.18,920.201 1183.53,865.092 1185.88,844.773 1188.23,1027.7 1190.59,996.699 1192.94,866.226 1195.29,1006.17 1197.64,1047.12 1199.99,859.889 1202.34,764.08 1204.69,920.095 1207.04,979.555 1209.39,752.702 1211.74,1004.01 1214.09,693.107 1216.44,949.177 1218.79,986.673 1221.14,754.726 1223.49,971.503 1225.84,1118.56 1228.19,690.542 1230.54,1116.2 1232.89,842.422 1235.24,1049.21 1237.59,933.039 1239.94,871.014 1242.3,853.078 1244.65,855.176 1247,1031.86 1249.35,1055.83 1251.7,957.009 1254.05,858.047 1256.4,775.04 1258.75,979.626 1261.1,922.752 1263.45,1093 1265.8,973.11 1268.15,940.632 1270.5,1020.82 1272.85,1040.41 1275.2,1055.6 1277.55,808.666 1279.9,942.292 1282.25,1044.9 1284.6,1014.6 1286.95,889.975 1289.3,1048.38 1291.66,926.96 1294.01,909.396 1296.36,861.784 1298.71,849.764 1301.06,1058.73 1303.41,801.674 1305.76,1041.48 1308.11,820.524 1310.46,1029.63 1312.81,866.302 1315.16,1006.41 1317.51,755.082 1319.86,956.885 1322.21,890.936 1324.56,902.133 1326.91,932.833 1329.26,877.876 1331.61,733.147 1333.96,964.321 1336.31,987.193 1338.66,1001.37 1341.02,1043.12 1343.37,1011.36 1345.72,920.049 1348.07,1017.22 1350.42,1008.17 1352.77,1050.58 1355.12,857.774 1357.47,882.974 1359.82,697.119 1362.17,1027.16 1364.52,1120.86 1366.87,959.586 1369.22,1004.82 1371.57,895.929 1373.92,932.057 1376.27,991.962 1378.62,804.979 1380.97,1056.47 1383.32,970.034 1385.67,992.493 1388.02,944.933 1390.38,906.062 1392.73,966.529 1395.08,949.794 1397.43,1101.18 1399.78,967.619 1402.13,927.114 1404.48,891.276 1406.83,1017.54 1409.18,785.453 1411.53,806.425 1413.88,1016.43 1416.23,1042.23 1418.58,988.107 1420.93,944.55 1423.28,792.087 1425.63,954.788 1427.98,889.809 1430.33,835.406 1432.68,995.559 1435.03,907.572 1437.38,1144.31 1439.74,945.516 1442.09,1081.27 1444.44,925.865 1446.79,1011.54 1449.14,975.982 1451.49,997.391 1453.84,852.509 1456.19,827.439 1458.54,987.256 1460.89,945.629 1463.24,1243.18 1465.59,978.527 1467.94,894.817 1470.29,880.722 1472.64,1099.84 1474.99,899.218 1477.34,951.95 1479.69,1005.38 1482.04,769.132 1484.39,1007.37 1486.74,923.951 1489.1,942.878 1491.45,1089.02 1493.8,794.009 1496.15,958.817 1498.5,988.02 1500.85,959.101 1503.2,976.044 1505.55,1016.22 1507.9,889.518 1510.25,1084.84 1512.6,890.922 1514.95,1028.62 1517.3,942.567 1519.65,967.501 1522,821.955 1524.35,788.838 1526.7,1142.98 1529.05,1017.37 1531.4,931.167 1533.75,862.485 1536.1,1054.59 1538.45,1026.4 1540.81,952.884 1543.16,1079.82 1545.51,1146.57 1547.86,975.508 1550.21,962.657 1552.56,1079.76 1554.91,888.048 1557.26,933.878 1559.61,912.389 1561.96,1063.44 1564.31,918.468 1566.66,856.414 1569.01,900.041 1571.36,934.399 1573.71,901.669 1576.06,1024.03 1578.41,989.283 1580.76,1003.66 1583.11,900.496 1585.46,894.181 1587.81,1049.95 1590.17,973.061 1592.52,968.828 1594.87,963.678 1597.22,1035.87 1599.57,949.259 1601.92,937.718 1604.27,948.343 1606.62,843.037 1608.97,1004.49 1611.32,926.482 1613.67,1038.6 1616.02,989.523 1618.37,866.947 1620.72,1035.34 1623.07,902.303 1625.42,668.01 1627.77,1013.64 1630.12,848.921 1632.47,1091.1 1634.82,1155.91 1637.17,873.355 1639.53,1052.9 1641.88,916.409 1644.23,1043.91 1646.58,1033.56 1648.93,959.278 1651.28,863.966 1653.63,1095.65 1655.98,1135.27 1658.33,1037.61 1660.68,1073.14 1663.03,840.889 1665.38,885.211 1667.73,860.63 1670.08,982.835 1672.43,944.648 1674.78,772.335 1677.13,923.363 1679.48,1033.67 1681.83,913.488 1684.18,865.867 1686.53,936.274 1688.89,1020.57 1691.24,701.679 1693.59,1046.6 1695.94,938.169 1698.29,842.718 1700.64,919.778 1702.99,1006.22 1705.34,906.779 1707.69,1099.41 1710.04,880.042 1712.39,846.461 1714.74,891.812 1717.09,936.334 1719.44,1081.72 1721.79,1054.47 1724.14,850.328 1726.49,1099.93 1728.84,816.298 1731.19,937.824 1733.54,1031.69 1735.89,956.221 1738.25,1024.1 1740.6,902.611 1742.95,863.978 1745.3,1027.53 1747.65,964.619 1750,902.316 1752.35,931.035 1754.7,840.052 1757.05,960.762 1759.4,950.34 1761.75,981.822 1764.1,1037.93 1766.45,937.872 1768.8,1097.32 1771.15,782.253 1773.5,1026.76 1775.85,891.711 1778.2,1068.81 1780.55,1107.91 1782.9,920.12 1785.25,908.649 1787.6,1129.78 1789.96,1013.63 1792.31,941.237 1794.66,916.329 1797.01,798.884 1799.36,888.792 1801.71,917.933 1804.06,1122.53 1806.41,970.509 1808.76,1007.49 1811.11,982.636 1813.46,858.376 1815.81,959.182 1818.16,826.888 1820.51,1178.12 1822.86,961.732 1825.21,1024.98 1827.56,785.07 1829.91,739.922 1832.26,895.115 1834.61,962.301 1836.96,924.383 1839.32,1100.44 1841.67,899.062 1844.02,969.213 1846.37,978.205 1848.72,950.788 1851.07,973.154 1853.42,950.425 1855.77,826.15 1858.12,854.581 1860.47,1198.5 1862.82,911.562 1865.17,1184.7 1867.52,969.668 1869.87,883.553 1872.22,835.994 1874.57,1016.38 1876.92,863.324 1879.27,949.007 1881.62,1033.59 1883.97,994.888 1886.32,901.055 1888.68,840.825 1891.03,997.937 1893.38,987.906 1895.73,947.197 1898.08,956.26 1900.43,972.753 1902.78,797.284 1905.13,1062.55 1907.48,996.859 1909.83,908.701 1912.18,940.715 1914.53,764.988 1916.88,807.675 1919.23,903.355 1921.58,887.124 1923.93,958.863 1926.28,990.567 1928.63,805.607 1930.98,923.02 1933.33,1059.19 1935.68,1117.81 1938.04,880.883 1940.39,977.682 1942.74,1034.41 1945.09,976.382 1947.44,903.112 1949.79,826.042 1952.14,871.755 1954.49,1222.9 1956.84,981.83 1959.19,1079.97 1961.54,916.254 1963.89,949.384 1966.24,1086.22 1968.59,967.184 1970.94,863.373 1973.29,903.363 1975.64,937.646 1977.99,902.818 1980.34,997.267 1982.69,955.752 1985.04,962.977 1987.4,1033.37 1989.75,1137.38 1992.1,947.065 1994.45,971.158 1996.8,874.406 1999.15,1030.44 2001.5,949.363 2003.85,865.849 2006.2,1080.41 2008.55,946.071 2010.9,967.28 2013.25,991.388 2015.6,818.516 2017.95,851.292 2020.3,1032.25 2022.65,743.424 2025,1010.16 2027.35,919.967 2029.7,1014.63 2032.05,1044.99 2034.4,1043.33 2036.76,925.232 2039.11,959.633 2041.46,1036.03 2043.81,729.3 2046.16,911.649 2048.51,1069.66 2050.86,910.38 2053.21,995.506 2055.56,1026.26 2057.91,605.943 2060.26,879.838 2062.61,953.811 2064.96,879.928 2067.31,865.796 2069.66,757.672 2072.01,1033.35 2074.36,1015.79 2076.71,927.74 2079.06,967.493 2081.41,898.107 2083.76,908.982 2086.11,1118.09 2088.47,896.011 2090.82,949.668 2093.17,898.188 2095.52,761.307 2097.87,878.985 2100.22,1031.11 2102.57,933.422 2104.92,910.859 2107.27,1005.12 2109.62,834.116 2111.97,991.93 2114.32,1032.81 2116.67,881.876 2119.02,970.368 2121.37,843.444 2123.72,1088.61 2126.07,808.261 2128.42,1217.13 2130.77,926.264 2133.12,1099.49 2135.47,848.715 2137.83,935.973 2140.18,948.205 2142.53,826.288 2144.88,919.757 2147.23,985.654 2149.58,1042.71 2151.93,1003.53 2154.28,866.502 2156.63,942.798 2158.98,981.805 2161.33,895.963 2163.68,1057.87 2166.03,948.826 2168.38,886.911 2170.73,765.932 2173.08,985.868 2175.43,931.792 2177.78,889.988 2180.13,1037.4 2182.48,802.227 2184.83,852.381 2187.19,959.692 2189.54,790.721 2191.89,1033.49 2194.24,1127.61 2196.59,1042.4 2198.94,903.618 2201.29,1023.93 2203.64,1098.15 2205.99,966.169 2208.34,1076.04 2210.69,1079.91 2213.04,796.974 2215.39,915.212 2217.74,890.226 2220.09,994.987 2222.44,884.234 2224.79,964.098 2227.14,820.274 2229.49,816.257 2231.84,1023.64 2234.19,1047.92 2236.55,980.731 2238.9,1029.05 2241.25,934.301 2243.6,980.504 2245.95,894.563 2248.3,1052.13 2250.65,990.198 2253,851.428 2255.35,995.71 2257.7,883.043 2260.05,853.788 2262.4,891.419 2264.75,910.664 2267.1,912.077 2269.45,950.976 2271.8,1098.08 2274.15,1057.36 2276.5,984.539 2278.85,1050.59 2281.2,847.586 2283.55,836.972 2285.91,868.736 2288.26,947.377 2290.61,1029.03 2292.96,1014.59 2295.31,931.218 2297.66,954.061 2300.01,858.332 2302.36,935.519 2304.71,920.785 2307.06,813.106 2309.41,952.144 2311.76,1050.04 2314.11,1072.72 2316.46,748.614 2318.81,881.466 2321.16,1097.24 2323.51,769.366 2325.86,905.312 2328.21,894.138 2330.56,1038.87 2332.91,1008.7 2335.27,838.082 2337.62,985.376 2339.97,834.231 2342.32,982.334 2344.67,882.241 2347.02,902.604 2349.37,1003.13 2351.72,1102.84 2354.07,991.326 2356.42,995.283 2358.77,927.967 2361.12,809.06 2363.47,830.267 2365.82,990.321 2368.17,1168.43 2370.52,892.315 2372.87,883.15 2375.22,855.019 2377.57,1059.82 2379.92,945.018 2382.27,957.037 2384.62,972.425 2386.98,854.918 2389.33,994.97 2391.68,977.144 2394.03,860.052 2396.38,960.875 2398.73,1013.15 2401.08,903.856 2403.43,879.968 2405.78,1061.27 2408.13,963.331 2410.48,983.652 2412.83,853.349 2415.18,1136.18 2417.53,1034.97 2419.88,704.643 2422.23,841.163 2424.58,895.999 2426.93,828.945 2429.28,885.072 2431.63,925.037 2433.98,967.297 2436.34,834.839 2438.69,941.32 2441.04,1063.45 2443.39,885.48 2445.74,949.732 2448.09,968.485 2450.44,859.601 2452.79,933.948 2455.14,1041.45 2457.49,896.369 2459.84,857.828 2462.19,823.325 2464.54,894.434 2466.89,996.439 2469.24,811.942 2471.59,894.898 2473.94,856.159 2476.29,983.31 2478.64,1096.64 2480.99,964.782 2483.34,1016.43 2485.7,957.964 2488.05,919.578 2490.4,833.664 2492.75,941.287 2495.1,772.363 2497.45,868.821 2499.8,920.488 2502.15,941.104 2504.5,980.357 2506.85,1091.09 2509.2,786.721 2511.55,887.368 2513.9,886.819 2516.25,1035.3 2518.6,723.56 2520.95,955.155 2523.3,998.759 2525.65,930.379 2528,1116.9 2530.35,955.774 2532.7,894.123 2535.06,918.074 2537.41,1076.14 2539.76,1147.41 2542.11,1019.02 2544.46,811.558 2546.81,1012.13 2549.16,774.437 2551.51,923.26 2553.86,1154.19 2556.21,1025.76 2558.56,1021.2 2560.91,954.681 2563.26,992.398 2565.61,947.924 2567.96,1127.91 2570.31,777.14 "></polyline>
<polyline clip-path="url(#clip272)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,749.152 224.541,450.482 226.891,405.391 229.242,437.053 231.592,243.135 233.943,566.203 236.293,558.299 238.644,382.579 240.994,393.654 243.345,466.332 245.695,324.335 248.046,490.77 250.396,695.561 252.747,396.917 255.097,564.951 257.448,522.846 259.798,472.293 262.148,495.937 264.499,369.105 266.849,586.331 269.2,461.408 271.55,332.4 273.901,474.251 276.251,568.918 278.602,457.361 280.952,426.586 283.303,486.584 285.653,570.72 288.004,451.324 290.354,300.037 292.705,491.942 295.055,467.815 297.406,504.883 299.756,446.285 302.107,249.998 304.457,501.224 306.807,353.36 309.158,331.236 311.508,150.12 313.859,612.474 316.209,478.808 318.56,365.913 320.91,543.706 323.261,447.035 325.611,358.047 327.962,425.821 330.312,350.261 332.663,341.197 335.013,542.761 337.364,409.04 339.714,450.832 342.065,325.173 344.415,394.739 346.765,473.655 349.116,534.884 351.466,450.058 353.817,283.069 356.167,410.351 358.518,403.028 360.868,323.884 363.219,360.242 365.569,445.065 367.92,527.265 370.27,203.947 372.621,325.119 374.971,354.43 377.322,450.863 379.672,361.352 382.023,319.359 384.373,419.68 386.724,317.607 389.074,641.718 391.424,537.019 393.775,332.806 396.125,701.25 398.476,527.283 400.826,333.053 403.177,295.053 405.527,425.337 407.878,513.662 410.228,416.739 412.579,476.056 414.929,540.32 417.28,566.125 419.63,394.002 421.981,491.523 424.331,514.046 426.682,511.363 429.032,420.197 431.382,462.54 433.733,690.048 436.083,374.732 438.434,562.127 440.784,540.426 443.135,375.823 445.485,448.888 447.836,358.876 450.186,389.998 452.537,461.821 454.887,434.535 457.238,374.287 459.588,328.404 461.939,392.037 464.289,527.495 466.64,356.55 468.99,316.16 471.341,459.264 473.691,364.523 476.041,549.794 478.392,596.371 480.742,395.433 483.093,413.083 485.443,358.324 487.794,201.53 490.144,517.992 492.495,419.821 494.845,534.169 497.196,235.513 499.546,282.724 501.897,417.145 504.247,662.695 506.598,457.561 508.948,573.502 511.299,561.887 513.649,406.21 515.999,454.745 518.35,627.756 520.7,525.168 523.051,329.766 525.401,407.521 527.752,349.985 530.102,516.226 532.453,354.896 534.803,580.542 537.154,466.394 539.504,390.499 541.855,475.239 544.205,509.003 546.556,302.774 548.906,401.705 551.257,386.126 553.607,251.198 555.958,304.152 558.308,443.862 560.658,501.435 563.009,494.164 565.359,420.55 567.71,465.383 570.06,291.713 572.411,457.725 574.761,445.34 577.112,641.495 579.462,238.474 581.813,419.767 584.163,335.715 586.514,487.925 588.864,453.836 591.215,337.922 593.565,676.017 595.916,213.875 598.266,322.883 600.616,306.133 602.967,399.813 605.317,323.9 607.668,237.759 610.018,593.04 612.369,407.359 614.719,526.717 617.07,505.761 619.42,506.377 621.771,391.83 624.121,462.257 626.472,614.436 628.822,330.304 631.173,372.763 633.523,533.445 635.874,484.626 638.224,521.307 640.575,387.19 642.925,544.08 645.275,514.357 647.626,352.357 649.976,327.294 652.327,354.536 654.677,236.876 657.028,418.543 659.378,464.046 661.729,722.314 664.079,295.942 666.43,227.627 668.78,566.471 671.131,521.206 673.481,395.408 675.832,573.556 678.182,455.032 680.533,647.393 682.883,743.484 685.233,394.678 687.584,412.625 689.934,582.653 692.285,556.091 694.635,405.15 696.986,446.887 699.336,313.946 701.687,433.163 704.037,464.221 706.388,361.147 708.738,399.538 711.089,369.453 713.439,401.645 715.79,478.681 718.14,412.525 720.491,497.717 722.841,335.402 725.192,359.112 727.542,449.299 729.892,495.988 732.243,489.765 734.593,348.134 736.944,433.787 739.294,363.295 741.645,542.244 743.995,466.101 746.346,502.178 748.696,363.512 751.047,499.865 753.397,480.576 755.748,415.307 758.098,290.847 760.449,414.058 762.799,396.262 765.15,324.072 767.5,445.894 769.85,317.726 772.201,315.264 774.551,343.681 776.902,333.816 779.252,485.065 781.603,433.047 783.953,370.435 786.304,599.013 788.654,381.51 791.005,483.49 793.355,480.588 795.706,426.462 798.056,301.058 800.407,576.102 802.757,379.004 805.108,413.935 807.458,383.172 809.809,625.028 812.159,221.943 814.509,414.121 816.86,365.705 819.21,534.555 821.561,425.217 823.911,249.401 826.262,533.626 828.612,533.953 830.963,318.974 833.313,571.912 835.664,413.93 838.014,291.184 840.365,410.531 842.715,391.787 845.066,514.176 847.416,304.421 849.767,430.283 852.117,256.057 854.467,397.77 856.818,645.118 859.168,459.181 861.519,416.791 863.869,530.307 866.22,411.407 868.57,450.461 870.921,560.111 873.271,518.502 875.622,406.021 877.972,329.369 880.323,378.628 882.673,501.271 885.024,571.211 887.374,255.6 889.725,339.252 892.075,485.709 894.426,425.284 896.776,567.326 899.126,320.063 901.477,534.317 903.827,394.77 906.178,413.069 908.528,417.871 910.879,559.747 913.229,424.702 915.58,375.01 917.93,239.959 920.281,373.076 922.631,604.93 924.982,480.309 927.332,325.123 929.683,385.599 932.033,499.641 934.384,476.749 936.734,387.729 939.084,494.657 941.435,529.834 943.785,251.661 946.136,264.641 948.486,684.419 950.837,470.944 953.187,343.8 955.538,322.292 957.888,337.781 960.239,442.615 962.589,520.628 964.94,412.77 967.29,358.781 969.641,413.275 971.991,447.383 974.342,520.297 976.692,408.685 979.043,454.437 981.393,417.079 983.743,352.314 986.094,425.541 988.444,353.416 990.795,316.624 993.145,442.077 995.496,431.429 997.846,561.046 1000.2,434.524 1002.55,322.786 1004.9,482.155 1007.25,434.872 1009.6,448.927 1011.95,392.633 1014.3,477.28 1016.65,476.078 1019,443.08 1021.35,513.392 1023.7,216.754 1026.05,307.162 1028.4,380.887 1030.75,471.244 1033.1,412.501 1035.45,354.34 1037.8,601.681 1040.15,572.09 1042.51,291.437 1044.86,473.442 1047.21,451.65 1049.56,485.888 1051.91,499.026 1054.26,246.615 1056.61,481.882 1058.96,550.802 1061.31,358.367 1063.66,425.79 1066.01,591.914 1068.36,232.146 1070.71,330.669 1073.06,217.002 1075.41,427.262 1077.76,332.066 1080.11,286.459 1082.46,381.982 1084.81,296.505 1087.16,403.579 1089.51,427.356 1091.87,405.967 1094.22,379.596 1096.57,464.926 1098.92,446.28 1101.27,362.784 1103.62,380.035 1105.97,529.839 1108.32,428.847 1110.67,385.051 1113.02,513.894 1115.37,404.74 1117.72,422.882 1120.07,231.515 1122.42,477.009 1124.77,366.973 1127.12,605.124 1129.47,483.562 1131.82,359.122 1134.17,558.936 1136.52,361.576 1138.87,397.286 1141.23,404.545 1143.58,412.848 1145.93,443.043 1148.28,452.977 1150.63,466.502 1152.98,387.302 1155.33,392.72 1157.68,425.164 1160.03,602.966 1162.38,606.781 1164.73,358.509 1167.08,370.902 1169.43,520.002 1171.78,435.373 1174.13,371.213 1176.48,562.991 1178.83,358.524 1181.18,317.703 1183.53,546.68 1185.88,369.471 1188.23,326.152 1190.59,366.509 1192.94,279.657 1195.29,298.796 1197.64,311.809 1199.99,340.188 1202.34,262.398 1204.69,407.398 1207.04,516.601 1209.39,480.247 1211.74,405.45 1214.09,596.102 1216.44,430.286 1218.79,450.811 1221.14,509.779 1223.49,427.767 1225.84,466.581 1228.19,270.445 1230.54,617.986 1232.89,283.163 1235.24,499.023 1237.59,395.974 1239.94,366.613 1242.3,452.67 1244.65,533.338 1247,413.012 1249.35,507.103 1251.7,480.313 1254.05,472.015 1256.4,536.33 1258.75,368.278 1261.1,690.32 1263.45,427.04 1265.8,320.545 1268.15,373.522 1270.5,373.278 1272.85,441.531 1275.2,395.55 1277.55,400.395 1279.9,303.007 1282.25,333.404 1284.6,474.976 1286.95,505.575 1289.3,355.835 1291.66,565.748 1294.01,407.668 1296.36,280.294 1298.71,310.018 1301.06,564.069 1303.41,435.329 1305.76,547.093 1308.11,558.379 1310.46,447.815 1312.81,530.243 1315.16,420.848 1317.51,492.875 1319.86,435.098 1322.21,374.323 1324.56,301.844 1326.91,418.835 1329.26,295.531 1331.61,655.408 1333.96,124.98 1336.31,389.161 1338.66,337.064 1341.02,475.151 1343.37,463.602 1345.72,221.913 1348.07,317.481 1350.42,287.007 1352.77,431.01 1355.12,392.681 1357.47,325.662 1359.82,127.019 1362.17,470.744 1364.52,368.43 1366.87,571.219 1369.22,513.787 1371.57,366.252 1373.92,578.872 1376.27,396.103 1378.62,461.158 1380.97,652.024 1383.32,322.403 1385.67,455.896 1388.02,438.562 1390.38,427.156 1392.73,491.486 1395.08,381.007 1397.43,273.314 1399.78,315.126 1402.13,397.771 1404.48,390.935 1406.83,415.886 1409.18,412.647 1411.53,536.806 1413.88,371.339 1416.23,460.471 1418.58,593.443 1420.93,537.777 1423.28,566.432 1425.63,425.613 1427.98,287.848 1430.33,623.008 1432.68,368.666 1435.03,200.774 1437.38,397.74 1439.74,548.223 1442.09,458.705 1444.44,425.883 1446.79,415.939 1449.14,393.292 1451.49,573.618 1453.84,553.178 1456.19,358.033 1458.54,453.254 1460.89,432.706 1463.24,433.894 1465.59,438.051 1467.94,420.619 1470.29,578.375 1472.64,302.682 1474.99,568.995 1477.34,659.862 1479.69,642.624 1482.04,259.402 1484.39,501.186 1486.74,574.1 1489.1,495.218 1491.45,511.86 1493.8,309.117 1496.15,377.043 1498.5,262.526 1500.85,406.391 1503.2,479.239 1505.55,382.365 1507.9,510.849 1510.25,447.857 1512.6,392.888 1514.95,583.945 1517.3,485.784 1519.65,455.942 1522,568.879 1524.35,525.712 1526.7,423.28 1529.05,263.502 1531.4,402.333 1533.75,490.744 1536.1,233.922 1538.45,356.105 1540.81,409.784 1543.16,423.119 1545.51,391.248 1547.86,379.451 1550.21,274.615 1552.56,382.117 1554.91,345.183 1557.26,598.141 1559.61,482.846 1561.96,524.188 1564.31,304.255 1566.66,310.685 1569.01,491.393 1571.36,471.075 1573.71,424.632 1576.06,435.746 1578.41,217.23 1580.76,389.826 1583.11,346.281 1585.46,326.179 1587.81,321.357 1590.17,439.423 1592.52,488.559 1594.87,190.559 1597.22,393.501 1599.57,369.693 1601.92,578.437 1604.27,441.985 1606.62,412.93 1608.97,581.515 1611.32,483.683 1613.67,372.41 1616.02,618.303 1618.37,487.338 1620.72,279.058 1623.07,440.251 1625.42,468.633 1627.77,408.326 1630.12,403.907 1632.47,469.64 1634.82,334.087 1637.17,513.917 1639.53,368.372 1641.88,617.403 1644.23,299.384 1646.58,337.126 1648.93,378.559 1651.28,602.44 1653.63,432.881 1655.98,474.489 1658.33,463.87 1660.68,534.566 1663.03,607.198 1665.38,467.244 1667.73,486.765 1670.08,499.4 1672.43,388.526 1674.78,387.744 1677.13,440.012 1679.48,419.595 1681.83,370.136 1684.18,464.276 1686.53,242.735 1688.89,387.118 1691.24,352.612 1693.59,421.529 1695.94,527.246 1698.29,428.293 1700.64,309.047 1702.99,474.015 1705.34,544.211 1707.69,489.279 1710.04,302.944 1712.39,593.104 1714.74,307.773 1717.09,371.946 1719.44,483.419 1721.79,387.568 1724.14,362.793 1726.49,435.467 1728.84,355.216 1731.19,475.097 1733.54,492.841 1735.89,563.018 1738.25,481.934 1740.6,365.937 1742.95,489.625 1745.3,475.694 1747.65,502.697 1750,340.644 1752.35,474.932 1754.7,364.964 1757.05,282.834 1759.4,221.88 1761.75,555.235 1764.1,391.25 1766.45,486.547 1768.8,353.829 1771.15,306.054 1773.5,684.306 1775.85,364.818 1778.2,352.084 1780.55,527.791 1782.9,692.406 1785.25,368.959 1787.6,282.792 1789.96,537.299 1792.31,618.701 1794.66,487.797 1797.01,573.911 1799.36,447.89 1801.71,491.695 1804.06,442.833 1806.41,456.628 1808.76,502.059 1811.11,460.81 1813.46,492.447 1815.81,336.536 1818.16,440.013 1820.51,322.698 1822.86,174.127 1825.21,303.943 1827.56,488.365 1829.91,556.395 1832.26,515.572 1834.61,547.884 1836.96,397.068 1839.32,375.48 1841.67,511.985 1844.02,528.17 1846.37,560.744 1848.72,431.941 1851.07,409.625 1853.42,499.65 1855.77,343.109 1858.12,484.217 1860.47,427.646 1862.82,584.316 1865.17,351.223 1867.52,485.017 1869.87,384.436 1872.22,263.221 1874.57,360.928 1876.92,616.184 1879.27,479.132 1881.62,458.595 1883.97,554.204 1886.32,430.397 1888.68,541.916 1891.03,522.768 1893.38,493.649 1895.73,459.531 1898.08,399.764 1900.43,471.785 1902.78,494.813 1905.13,214.874 1907.48,383.688 1909.83,486.589 1912.18,487.1 1914.53,406.259 1916.88,343.069 1919.23,329.016 1921.58,439.783 1923.93,657.672 1926.28,391.35 1928.63,448.789 1930.98,165.148 1933.33,357.267 1935.68,563.085 1938.04,470.828 1940.39,491.156 1942.74,404.35 1945.09,568.211 1947.44,439.358 1949.79,388.367 1952.14,524.321 1954.49,583.209 1956.84,453.762 1959.19,318.416 1961.54,311.869 1963.89,489.778 1966.24,287.252 1968.59,423.712 1970.94,580.182 1973.29,584.679 1975.64,443.501 1977.99,449.239 1980.34,230.094 1982.69,419.344 1985.04,505.14 1987.4,311.345 1989.75,513.224 1992.1,610.076 1994.45,443.459 1996.8,264.574 1999.15,425.78 2001.5,395.132 2003.85,256.068 2006.2,396.664 2008.55,466.28 2010.9,571.485 2013.25,570.74 2015.6,393.112 2017.95,375.39 2020.3,401.506 2022.65,342.778 2025,418.072 2027.35,429.572 2029.7,500.119 2032.05,399.538 2034.4,734.963 2036.76,464.646 2039.11,440.589 2041.46,419.279 2043.81,437.271 2046.16,465.769 2048.51,541.387 2050.86,245.182 2053.21,333.217 2055.56,494.885 2057.91,285.603 2060.26,412.683 2062.61,117.88 2064.96,371.006 2067.31,319.471 2069.66,289.578 2072.01,405.198 2074.36,231.415 2076.71,493.416 2079.06,527.455 2081.41,361.429 2083.76,349.984 2086.11,536.051 2088.47,552.907 2090.82,564.487 2093.17,368.048 2095.52,411.946 2097.87,396.622 2100.22,408.069 2102.57,563.754 2104.92,342.554 2107.27,523.159 2109.62,502.779 2111.97,370.638 2114.32,500.082 2116.67,536.23 2119.02,444.959 2121.37,424.6 2123.72,485.338 2126.07,560.416 2128.42,356.29 2130.77,355.333 2133.12,558.683 2135.47,324.811 2137.83,298.753 2140.18,425.827 2142.53,519.471 2144.88,565.948 2147.23,683.349 2149.58,381.755 2151.93,269.082 2154.28,411.346 2156.63,597.617 2158.98,426.401 2161.33,418.111 2163.68,396.751 2166.03,96.8724 2168.38,412.713 2170.73,396.61 2173.08,504.333 2175.43,438.769 2177.78,155.254 2180.13,380.309 2182.48,407.264 2184.83,347.97 2187.19,508.318 2189.54,616.303 2191.89,436.474 2194.24,320.605 2196.59,304.327 2198.94,486.635 2201.29,412.742 2203.64,386.015 2205.99,528.878 2208.34,606.167 2210.69,226.428 2213.04,374.522 2215.39,462.319 2217.74,353.094 2220.09,295.721 2222.44,452.96 2224.79,434.521 2227.14,434.873 2229.49,610.171 2231.84,404.973 2234.19,504.204 2236.55,367.859 2238.9,662.155 2241.25,427.594 2243.6,520.043 2245.95,369.655 2248.3,399.834 2250.65,385.039 2253,427.978 2255.35,430.693 2257.7,347.264 2260.05,573.72 2262.4,462.739 2264.75,353.769 2267.1,495.674 2269.45,503.326 2271.8,391.201 2274.15,355.418 2276.5,447.313 2278.85,485.402 2281.2,499.485 2283.55,418.442 2285.91,419.925 2288.26,381.501 2290.61,326.941 2292.96,308.363 2295.31,413.83 2297.66,273.815 2300.01,501.484 2302.36,619.879 2304.71,451.463 2307.06,446.663 2309.41,458.724 2311.76,557.81 2314.11,502.198 2316.46,390.442 2318.81,381.287 2321.16,441.046 2323.51,591.047 2325.86,310.974 2328.21,472.344 2330.56,281.734 2332.91,350.476 2335.27,555.411 2337.62,393.454 2339.97,522.01 2342.32,392.129 2344.67,529.143 2347.02,347.107 2349.37,443.883 2351.72,327.457 2354.07,616.284 2356.42,510.492 2358.77,247.186 2361.12,521.958 2363.47,335.475 2365.82,593.143 2368.17,498.074 2370.52,473.81 2372.87,412.183 2375.22,473.904 2377.57,476.925 2379.92,247.225 2382.27,468.024 2384.62,416.026 2386.98,532.68 2389.33,433.319 2391.68,363.41 2394.03,405.277 2396.38,388.939 2398.73,375.643 2401.08,397.536 2403.43,577.201 2405.78,520.322 2408.13,469.691 2410.48,599.243 2412.83,520.287 2415.18,492.687 2417.53,354.282 2419.88,377.699 2422.23,529.559 2424.58,429.43 2426.93,397.741 2429.28,577.168 2431.63,322.292 2433.98,430.597 2436.34,432.44 2438.69,478.549 2441.04,470.33 2443.39,442.691 2445.74,404.151 2448.09,344.273 2450.44,434.325 2452.79,371.545 2455.14,393.421 2457.49,462.119 2459.84,463.884 2462.19,455.856 2464.54,541.672 2466.89,378.098 2469.24,551.918 2471.59,438.624 2473.94,464.414 2476.29,469.23 2478.64,437.486 2480.99,341.656 2483.34,275.513 2485.7,318.072 2488.05,451.539 2490.4,256.391 2492.75,501.611 2495.1,338.166 2497.45,396.277 2499.8,526.049 2502.15,449.318 2504.5,259.654 2506.85,573.102 2509.2,522.005 2511.55,494.567 2513.9,518.145 2516.25,421.873 2518.6,580.269 2520.95,597.697 2523.3,452.563 2525.65,626.093 2528,308.532 2530.35,578.466 2532.7,499.786 2535.06,440.435 2537.41,414.502 2539.76,610.804 2542.11,395.445 2544.46,332.675 2546.81,389.762 2549.16,429.636 2551.51,444.752 2553.86,635.9 2556.21,485.5 2558.56,505.643 2560.91,453.681 2563.26,338.074 2565.61,392.793 2567.96,623.05 2570.31,442.397 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -4.89696   -3.18041   -4.49948   …  -5.61653   -5.61653   -3.85855
  0.789087   0.222055   0.842666      0.543158   0.543158  -0.690469
  2.39493    4.67169    4.62214       5.03711    5.03711    4.49118

[:, :, 2] =
 -2.94781   -4.23622  -5.44644   …  -5.13208   -4.22034   -5.61447
 -0.400581   1.77912   0.820888      0.738352   0.100589   0.0678674
  3.8796     4.30646   4.44349       4.57918    5.66361    5.02168

[:, :, 3] =
 -2.64816  -3.48161  -5.36487   -5.36487   …  -3.50982   -3.93505   -3.93505
 -1.29487  -0.15228   0.156322   0.156322      0.619145   0.116417   0.116417
  2.03507   3.5836    3.97822    3.97822       4.88379    3.53236    3.53236

[:, :, 4] =
 -1.14814   -3.99344   -4.68254  -4.68254  …  -3.42104  -4.02364   -5.49846
 -0.569014  -0.700326   0.44858   0.44858      1.2329   -0.712071   0.250144
  3.43864    4.03912    4.79      4.79         6.28837   5.07578    4.90755</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.98062     1.00132
 -0.00168116  1.00447
  5.00231     0.984661</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Turing.jl.</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">Turing.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.7 seconds
Compute duration  = 2.7 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

        x[1]   -4.9723    1.0167    0.0174   3399.4270   5381.3962    1.0013   ⋯
        x[2]    0.0194    1.0076    0.0175   3306.8204   4568.6474    1.0005   ⋯
        x[3]    4.9917    1.0144    0.0179   3224.9440   5197.8759    0.9999   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

        x[1]   -6.9574   -5.6426   -4.9638   -4.2829   -3.0131
        x[2]   -1.9568   -0.6542    0.0247    0.6983    1.9599
        x[3]    3.0359    4.2917    5.0071    5.6950    6.9224</code></pre>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.81 seconds
Compute duration  = 1.81 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse    ess_bulk    ess_tail      rhat   ⋯
      Symbol   Float64   Float64   Float64     Float64     Float64   Float64   ⋯

           x    0.5015    0.1863    0.0029   4159.1302   4711.7072    1.0002   ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.1533    0.3645    0.5014    0.6381    0.8567</code></pre>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.16 seconds
Compute duration  = 0.16 seconds
parameters        = x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

           x    0.9387    0.0000    0.0000        NaN        NaN       NaN     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           x    0.9387    0.9387    0.9387    0.9387    0.9387</code></pre>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>DomainError: DomainError(-0.19937710083694676, "Normal: the condition σ &gt;= zero(σ) is not satisfied.")
DomainError with -0.19937710083694676:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] #371
    @ ~/.julia/packages/Distributions/gGoCk/src/univariate/continuous/normal.jl:37 [inlined]
  [2] check_args
    @ ~/.julia/packages/Distributions/gGoCk/src/utils.jl:89 [inlined]
  [3] #Normal#370
    @ ~/.julia/packages/Distributions/gGoCk/src/univariate/continuous/normal.jl:37 [inlined]
  [4] Normal
    @ ~/.julia/packages/Distributions/gGoCk/src/univariate/continuous/normal.jl:36 [inlined]
  [5] Normal
    @ ~/.julia/packages/Distributions/gGoCk/src/univariate/continuous/normal.jl:42 [inlined]
  [6] macro expansion
    @ ~/.julia/packages/DynamicPPL/Jf0cM/src/compiler.jl:584 [inlined]
  [7] demo
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:593 [inlined]
  [8] _evaluate!!
    @ ~/.julia/packages/DynamicPPL/Jf0cM/src/model.jl:914 [inlined]
  [9] evaluate_threadsafe!!(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, varinfo::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, context::DynamicPPL.ValuesAsInModelContext{OrderedDict{Any, Any}, DynamicPPL.DefaultContext})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/Jf0cM/src/model.jl:903
 [10] evaluate!!
    @ ~/.julia/packages/DynamicPPL/Jf0cM/src/model.jl:833 [inlined]
 [11] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/Jf0cM/src/values_as_in_model.jl:196 [inlined]
 [12] values_as_in_model
    @ ~/.julia/packages/DynamicPPL/Jf0cM/src/values_as_in_model.jl:195 [inlined]
 [13] getparams(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64})
    @ Turing.Inference ~/.julia/packages/Turing/nwmUC/src/mcmc/Inference.jl:383
 [14] Turing.Inference.Transition(model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, vi::DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, t::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/nwmUC/src/mcmc/Inference.jl:258
 [15] transition_to_turing
    @ ~/.julia/packages/Turing/nwmUC/src/mcmc/abstractmcmc.jl:12 [inlined]
 [16] transition_to_turing(f::LogDensityProblemsADForwardDiffExt.ForwardDiffLogDensity{LogDensityFunction{DynamicPPL.TypedVarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{AbstractPPL.VarName{:σ², typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}, x::DynamicPPL.Metadata{Dict{AbstractPPL.VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{AbstractPPL.VarName{:x, typeof(identity)}}, Vector{Float64}, Vector{Set{DynamicPPL.Selector}}}}, Float64}, DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, Nothing}, ForwardDiff.Chunk{2}, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, transition::MALASample{Vector{Float64}})
    @ Turing.Inference ~/.julia/packages/Turing/nwmUC/src/mcmc/abstractmcmc.jl:17
 [17] step(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler_wrapper::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}; initial_state::Nothing, initial_params::Nothing, kwargs::@Kwargs{})
    @ Turing.Inference ~/.julia/packages/Turing/nwmUC/src/mcmc/abstractmcmc.jl:147
 [18] macro expansion
    @ ~/.julia/packages/AbstractMCMC/FSyVk/src/sample.jl:0 [inlined]
 [19] macro expansion
    @ ~/.julia/packages/AbstractMCMC/FSyVk/src/logging.jl:16 [inlined]
 [20] mcmcsample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; progress::Bool, progressname::String, callback::Nothing, num_warmup::Int64, discard_initial::Int64, thinning::Int64, chain_type::Type, initial_state::Nothing, kwargs::@Kwargs{})
    @ AbstractMCMC ~/.julia/packages/AbstractMCMC/FSyVk/src/sample.jl:142
 [21] sample(rng::TaskLocalRNG, model::DynamicPPL.Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DynamicPPL.DefaultContext}, sampler::DynamicPPL.Sampler{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}, N::Int64; chain_type::Type, resume_from::Nothing, initial_state::Nothing, kwargs::@Kwargs{progress::Bool})
    @ DynamicPPL ~/.julia/packages/DynamicPPL/Jf0cM/src/sampler.jl:107
 [22] sample
    @ ~/.julia/packages/DynamicPPL/Jf0cM/src/sampler.jl:97 [inlined]
 [23] #sample#4
    @ ~/.julia/packages/Turing/nwmUC/src/mcmc/Inference.jl:305 [inlined]
 [24] sample
    @ ~/.julia/packages/Turing/nwmUC/src/mcmc/Inference.jl:296 [inlined]
 [25] #sample#3
    @ ~/.julia/packages/Turing/nwmUC/src/mcmc/Inference.jl:293 [inlined]
 [26] top-level scope
    @ ~/work/docs/docs/tutorials/docs-17-implementing-samplers/index.qmd:595</code></pre>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.9 seconds
Compute duration  = 1.9 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8152    0.5884    0.0288   201.4072    47.4911    1.0031     ⋯
           x   -0.1012    0.9181    0.0417   613.4637   439.7986    1.0054     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1262    0.3295    0.6755    1.1780    2.1949
           x   -2.4628   -0.3903    0.0214    0.2985    1.6132</code></pre>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.56 seconds
Compute duration  = 3.56 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
  parameters      mean       std      mcse   ess_bulk   ess_tail      rhat   e ⋯
      Symbol   Float64   Float64   Float64    Float64    Float64   Float64     ⋯

          σ²    0.8822    0.5664    0.0232   475.3090   222.4996    1.0004     ⋯
           x    0.0445    1.0614    0.0525   570.7694   462.0554    1.0034     ⋯
                                                                1 column omitted

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

          σ²    0.1406    0.4313    0.7759    1.2427    2.2154
           x   -2.2094   -0.3629    0.0112    0.4629    2.4362</code></pre>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/turinglang\.org\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../tutorials/docs-07-for-developers-variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2024 under the terms of the <a href="https://github.com/TuringLang/Turing.jl/blob/master/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/master/tutorials/docs-17-implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>