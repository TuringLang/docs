name: Check Turing.jl Version

on:
  pull_request:
    paths:
      - 'VERSION'

jobs:
  check-version:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Get the current version from VERSION file
        id: get_current_version
        run: |
          current_version=$(cat VERSION)
          echo "Current version: $current_version"
          echo "current_version=$current_version" >> $GITHUB_ENV

      - name: Get the latest version of Turing.jl
        id: get_latest_version
        run: |
          latest_version=$(curl -s https://api.github.com/repos/TuringLang/Turing.jl/releases/latest | jq -r .tag_name)
          echo "Latest version: $latest_version"
          echo "latest_version=$latest_version" >> $GITHUB_ENV

      - name: Compare versions
        id: compare_versions
        run: |
          if [ "$current_version" != "$latest_version" ]; then
            echo "The VERSION file is outdated."
            echo "update_needed=true" >> $GITHUB_ENV
          else
            echo "The VERSION file is up-to-date."
            echo "update_needed=false" >> $GITHUB_ENV

      - name: Add PR comment
        if: env.update_needed == 'true'
        uses: peter-evans/create-or-update-comment@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          issue-number: ${{ github.event.pull_request.number }}
          body: |
            The VERSION file is outdated.
            Please update it to the latest version: ${{ env.latest_version }}.
            You can update the VERSION file directly in this PR.
