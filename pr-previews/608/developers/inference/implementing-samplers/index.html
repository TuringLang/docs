<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing Samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../developers/inference/variational-inference/index.html" rel="prev">
<link href="../../../assets/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-2fef5ea3f8957b3e4ecc936fc74692ca.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-14dc5392180f5c4faa7436b3aeaea7e7.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-c8f8ffa7f5fdcebfcbd390a6d0cab8fd.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../../site_libs/bootstrap/bootstrap-14dc5392180f5c4faa7436b3aeaea7e7.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../tutorials/coin-flipping/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../faq/"> 
<span class="menu-text">FAQ</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.39" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.39</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.39">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/variational-inference/index.html">Inference in Detail</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../core-functionality/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">User Guide</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/automatic-differentiation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/tracking-extra-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tracking Extra Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/sampler-visualisation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/troubleshooting/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Troubleshooting</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/coin-flipping/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-neural-networks/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/hidden-markov-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/infinite-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-time-series-analysis/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-processes-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Processes: Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-process-latent-variable-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contributing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL’s Compiler</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/design-overview/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design (Outdated)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL Contexts</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contexts/submodel-condition/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conditioning and fixing in submodels</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">Variable Transformations</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/distributions/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributions and the Jacobian</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/bijectors/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bijectors in MCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/dynamicppl/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variable transformations in DynamicPPL</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference in Detail</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/variational-inference/index.html">Inference in Detail</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing Samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-36.03839067108329</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-36.03839067108329</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -3.04486   -3.52769   -4.98597   …  -5.29371   -5.15046   -4.80326
  0.276894   0.140258   0.308711     -0.806362  -0.617839  -0.957009
  2.72566    2.79622    2.53053       3.66312    5.30028    5.47743</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.9934     1.02237
  0.0143591  1.01104
  5.00098    1.00981</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip790">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip790)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip791">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip790)" d="M196.816 1800.78 L2640.76 1800.78 L2640.76 47.2441 L196.816 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip792">
    <rect x="196" y="47" width="2445" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip792)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="263.676,1800.78 263.676,47.2441 "></polyline>
<polyline clip-path="url(#clip792)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="840.654,1800.78 840.654,47.2441 "></polyline>
<polyline clip-path="url(#clip792)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1417.63,1800.78 1417.63,47.2441 "></polyline>
<polyline clip-path="url(#clip792)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1994.61,1800.78 1994.61,47.2441 "></polyline>
<polyline clip-path="url(#clip792)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2571.59,1800.78 2571.59,47.2441 "></polyline>
<polyline clip-path="url(#clip792)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1618.99 2640.76,1618.99 "></polyline>
<polyline clip-path="url(#clip792)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1374.31 2640.76,1374.31 "></polyline>
<polyline clip-path="url(#clip792)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,1129.63 2640.76,1129.63 "></polyline>
<polyline clip-path="url(#clip792)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,884.948 2640.76,884.948 "></polyline>
<polyline clip-path="url(#clip792)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,640.266 2640.76,640.266 "></polyline>
<polyline clip-path="url(#clip792)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,395.583 2640.76,395.583 "></polyline>
<polyline clip-path="url(#clip792)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="196.816,150.901 2640.76,150.901 "></polyline>
<polyline clip-path="url(#clip790)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip790)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="263.676,1800.78 263.676,1781.88 "></polyline>
<polyline clip-path="url(#clip790)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="840.654,1800.78 840.654,1781.88 "></polyline>
<polyline clip-path="url(#clip790)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1417.63,1800.78 1417.63,1781.88 "></polyline>
<polyline clip-path="url(#clip790)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1994.61,1800.78 1994.61,1781.88 "></polyline>
<polyline clip-path="url(#clip790)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2571.59,1800.78 2571.59,1781.88 "></polyline>
<path clip-path="url(#clip790)" d="M263.676 1834 Q260.065 1834 258.236 1837.57 Q256.431 1841.11 256.431 1848.24 Q256.431 1855.34 258.236 1858.91 Q260.065 1862.45 263.676 1862.45 Q267.31 1862.45 269.116 1858.91 Q270.945 1855.34 270.945 1848.24 Q270.945 1841.11 269.116 1837.57 Q267.31 1834 263.676 1834 M263.676 1830.3 Q269.486 1830.3 272.542 1834.9 Q275.621 1839.49 275.621 1848.24 Q275.621 1856.96 272.542 1861.57 Q269.486 1866.15 263.676 1866.15 Q257.866 1866.15 254.787 1861.57 Q251.732 1856.96 251.732 1848.24 Q251.732 1839.49 254.787 1834.9 Q257.866 1830.3 263.676 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M804.346 1861.55 L820.666 1861.55 L820.666 1865.48 L798.721 1865.48 L798.721 1861.55 Q801.383 1858.79 805.967 1854.16 Q810.573 1849.51 811.754 1848.17 Q813.999 1845.65 814.879 1843.91 Q815.782 1842.15 815.782 1840.46 Q815.782 1837.71 813.837 1835.97 Q811.916 1834.23 808.814 1834.23 Q806.615 1834.23 804.161 1835 Q801.731 1835.76 798.953 1837.31 L798.953 1832.59 Q801.777 1831.46 804.231 1830.88 Q806.684 1830.3 808.721 1830.3 Q814.092 1830.3 817.286 1832.98 Q820.481 1835.67 820.481 1840.16 Q820.481 1842.29 819.67 1844.21 Q818.883 1846.11 816.777 1848.7 Q816.198 1849.37 813.096 1852.59 Q809.995 1855.78 804.346 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M830.527 1830.92 L848.883 1830.92 L848.883 1834.86 L834.809 1834.86 L834.809 1843.33 Q835.828 1842.98 836.846 1842.82 Q837.865 1842.64 838.883 1842.64 Q844.67 1842.64 848.05 1845.81 Q851.43 1848.98 851.43 1854.4 Q851.43 1859.97 847.957 1863.08 Q844.485 1866.15 838.166 1866.15 Q835.99 1866.15 833.721 1865.78 Q831.476 1865.41 829.069 1864.67 L829.069 1859.97 Q831.152 1861.11 833.374 1861.66 Q835.596 1862.22 838.073 1862.22 Q842.078 1862.22 844.416 1860.11 Q846.754 1858.01 846.754 1854.4 Q846.754 1850.78 844.416 1848.68 Q842.078 1846.57 838.073 1846.57 Q836.198 1846.57 834.323 1846.99 Q832.471 1847.4 830.527 1848.28 L830.527 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M870.642 1834 Q867.031 1834 865.203 1837.57 Q863.397 1841.11 863.397 1848.24 Q863.397 1855.34 865.203 1858.91 Q867.031 1862.45 870.642 1862.45 Q874.277 1862.45 876.082 1858.91 Q877.911 1855.34 877.911 1848.24 Q877.911 1841.11 876.082 1837.57 Q874.277 1834 870.642 1834 M870.642 1830.3 Q876.453 1830.3 879.508 1834.9 Q882.587 1839.49 882.587 1848.24 Q882.587 1856.96 879.508 1861.57 Q876.453 1866.15 870.642 1866.15 Q864.832 1866.15 861.754 1861.57 Q858.698 1856.96 858.698 1848.24 Q858.698 1839.49 861.754 1834.9 Q864.832 1830.3 870.642 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M1377.25 1830.92 L1395.61 1830.92 L1395.61 1834.86 L1381.53 1834.86 L1381.53 1843.33 Q1382.55 1842.98 1383.57 1842.82 Q1384.59 1842.64 1385.61 1842.64 Q1391.39 1842.64 1394.77 1845.81 Q1398.15 1848.98 1398.15 1854.4 Q1398.15 1859.97 1394.68 1863.08 Q1391.21 1866.15 1384.89 1866.15 Q1382.71 1866.15 1380.44 1865.78 Q1378.2 1865.41 1375.79 1864.67 L1375.79 1859.97 Q1377.88 1861.11 1380.1 1861.66 Q1382.32 1862.22 1384.8 1862.22 Q1388.8 1862.22 1391.14 1860.11 Q1393.48 1858.01 1393.48 1854.4 Q1393.48 1850.78 1391.14 1848.68 Q1388.8 1846.57 1384.8 1846.57 Q1382.92 1846.57 1381.05 1846.99 Q1379.19 1847.4 1377.25 1848.28 L1377.25 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M1417.37 1834 Q1413.75 1834 1411.93 1837.57 Q1410.12 1841.11 1410.12 1848.24 Q1410.12 1855.34 1411.93 1858.91 Q1413.75 1862.45 1417.37 1862.45 Q1421 1862.45 1422.81 1858.91 Q1424.63 1855.34 1424.63 1848.24 Q1424.63 1841.11 1422.81 1837.57 Q1421 1834 1417.37 1834 M1417.37 1830.3 Q1423.18 1830.3 1426.23 1834.9 Q1429.31 1839.49 1429.31 1848.24 Q1429.31 1856.96 1426.23 1861.57 Q1423.18 1866.15 1417.37 1866.15 Q1411.56 1866.15 1408.48 1861.57 Q1405.42 1856.96 1405.42 1848.24 Q1405.42 1839.49 1408.48 1834.9 Q1411.56 1830.3 1417.37 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M1447.53 1834 Q1443.92 1834 1442.09 1837.57 Q1440.28 1841.11 1440.28 1848.24 Q1440.28 1855.34 1442.09 1858.91 Q1443.92 1862.45 1447.53 1862.45 Q1451.16 1862.45 1452.97 1858.91 Q1454.8 1855.34 1454.8 1848.24 Q1454.8 1841.11 1452.97 1837.57 Q1451.16 1834 1447.53 1834 M1447.53 1830.3 Q1453.34 1830.3 1456.39 1834.9 Q1459.47 1839.49 1459.47 1848.24 Q1459.47 1856.96 1456.39 1861.57 Q1453.34 1866.15 1447.53 1866.15 Q1441.72 1866.15 1438.64 1861.57 Q1435.58 1856.96 1435.58 1848.24 Q1435.58 1839.49 1438.64 1834.9 Q1441.72 1830.3 1447.53 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M1952.89 1830.92 L1975.11 1830.92 L1975.11 1832.91 L1962.56 1865.48 L1957.68 1865.48 L1969.48 1834.86 L1952.89 1834.86 L1952.89 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M1984.27 1830.92 L2002.63 1830.92 L2002.63 1834.86 L1988.56 1834.86 L1988.56 1843.33 Q1989.58 1842.98 1990.59 1842.82 Q1991.61 1842.64 1992.63 1842.64 Q1998.42 1842.64 2001.8 1845.81 Q2005.18 1848.98 2005.18 1854.4 Q2005.18 1859.97 2001.7 1863.08 Q1998.23 1866.15 1991.91 1866.15 Q1989.74 1866.15 1987.47 1865.78 Q1985.22 1865.41 1982.82 1864.67 L1982.82 1859.97 Q1984.9 1861.11 1987.12 1861.66 Q1989.34 1862.22 1991.82 1862.22 Q1995.83 1862.22 1998.16 1860.11 Q2000.5 1858.01 2000.5 1854.4 Q2000.5 1850.78 1998.16 1848.68 Q1995.83 1846.57 1991.82 1846.57 Q1989.95 1846.57 1988.07 1846.99 Q1986.22 1847.4 1984.27 1848.28 L1984.27 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M2024.39 1834 Q2020.78 1834 2018.95 1837.57 Q2017.14 1841.11 2017.14 1848.24 Q2017.14 1855.34 2018.95 1858.91 Q2020.78 1862.45 2024.39 1862.45 Q2028.02 1862.45 2029.83 1858.91 Q2031.66 1855.34 2031.66 1848.24 Q2031.66 1841.11 2029.83 1837.57 Q2028.02 1834 2024.39 1834 M2024.39 1830.3 Q2030.2 1830.3 2033.26 1834.9 Q2036.33 1839.49 2036.33 1848.24 Q2036.33 1856.96 2033.26 1861.57 Q2030.2 1866.15 2024.39 1866.15 Q2018.58 1866.15 2015.5 1861.57 Q2012.45 1856.96 2012.45 1848.24 Q2012.45 1839.49 2015.5 1834.9 Q2018.58 1830.3 2024.39 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M2516.11 1861.55 L2523.75 1861.55 L2523.75 1835.18 L2515.44 1836.85 L2515.44 1832.59 L2523.71 1830.92 L2528.38 1830.92 L2528.38 1861.55 L2536.02 1861.55 L2536.02 1865.48 L2516.11 1865.48 L2516.11 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M2555.47 1834 Q2551.85 1834 2550.03 1837.57 Q2548.22 1841.11 2548.22 1848.24 Q2548.22 1855.34 2550.03 1858.91 Q2551.85 1862.45 2555.47 1862.45 Q2559.1 1862.45 2560.9 1858.91 Q2562.73 1855.34 2562.73 1848.24 Q2562.73 1841.11 2560.9 1837.57 Q2559.1 1834 2555.47 1834 M2555.47 1830.3 Q2561.28 1830.3 2564.33 1834.9 Q2567.41 1839.49 2567.41 1848.24 Q2567.41 1856.96 2564.33 1861.57 Q2561.28 1866.15 2555.47 1866.15 Q2549.66 1866.15 2546.58 1861.57 Q2543.52 1856.96 2543.52 1848.24 Q2543.52 1839.49 2546.58 1834.9 Q2549.66 1830.3 2555.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M2585.63 1834 Q2582.02 1834 2580.19 1837.57 Q2578.38 1841.11 2578.38 1848.24 Q2578.38 1855.34 2580.19 1858.91 Q2582.02 1862.45 2585.63 1862.45 Q2589.26 1862.45 2591.07 1858.91 Q2592.9 1855.34 2592.9 1848.24 Q2592.9 1841.11 2591.07 1837.57 Q2589.26 1834 2585.63 1834 M2585.63 1830.3 Q2591.44 1830.3 2594.49 1834.9 Q2597.57 1839.49 2597.57 1848.24 Q2597.57 1856.96 2594.49 1861.57 Q2591.44 1866.15 2585.63 1866.15 Q2579.82 1866.15 2576.74 1861.57 Q2573.68 1856.96 2573.68 1848.24 Q2573.68 1839.49 2576.74 1834.9 Q2579.82 1830.3 2585.63 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M2615.79 1834 Q2612.18 1834 2610.35 1837.57 Q2608.54 1841.11 2608.54 1848.24 Q2608.54 1855.34 2610.35 1858.91 Q2612.18 1862.45 2615.79 1862.45 Q2619.42 1862.45 2621.23 1858.91 Q2623.06 1855.34 2623.06 1848.24 Q2623.06 1841.11 2621.23 1837.57 Q2619.42 1834 2615.79 1834 M2615.79 1830.3 Q2621.6 1830.3 2624.65 1834.9 Q2627.73 1839.49 2627.73 1848.24 Q2627.73 1856.96 2624.65 1861.57 Q2621.6 1866.15 2615.79 1866.15 Q2609.98 1866.15 2606.9 1861.57 Q2603.84 1856.96 2603.84 1848.24 Q2603.84 1839.49 2606.9 1834.9 Q2609.98 1830.3 2615.79 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip790)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1800.78 196.816,47.2441 "></polyline>
<polyline clip-path="url(#clip790)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1618.99 215.714,1618.99 "></polyline>
<polyline clip-path="url(#clip790)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1374.31 215.714,1374.31 "></polyline>
<polyline clip-path="url(#clip790)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,1129.63 215.714,1129.63 "></polyline>
<polyline clip-path="url(#clip790)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,884.948 215.714,884.948 "></polyline>
<polyline clip-path="url(#clip790)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,640.266 215.714,640.266 "></polyline>
<polyline clip-path="url(#clip790)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,395.583 215.714,395.583 "></polyline>
<polyline clip-path="url(#clip790)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="196.816,150.901 215.714,150.901 "></polyline>
<path clip-path="url(#clip790)" d="M50.5475 1619.45 L80.2233 1619.45 L80.2233 1623.38 L50.5475 1623.38 L50.5475 1619.45 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M89.1352 1601.71 L111.357 1601.71 L111.357 1603.71 L98.8111 1636.27 L93.9269 1636.27 L105.732 1605.65 L89.1352 1605.65 L89.1352 1601.71 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M120.478 1630.4 L125.362 1630.4 L125.362 1636.27 L120.478 1636.27 L120.478 1630.4 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M135.593 1601.71 L153.95 1601.71 L153.95 1605.65 L139.876 1605.65 L139.876 1614.12 Q140.894 1613.77 141.913 1613.61 Q142.931 1613.43 143.95 1613.43 Q149.737 1613.43 153.116 1616.6 Q156.496 1619.77 156.496 1625.19 Q156.496 1630.77 153.024 1633.87 Q149.552 1636.95 143.232 1636.95 Q141.056 1636.95 138.788 1636.58 Q136.542 1636.21 134.135 1635.46 L134.135 1630.77 Q136.218 1631.9 138.441 1632.46 Q140.663 1633.01 143.14 1633.01 Q147.144 1633.01 149.482 1630.9 Q151.82 1628.8 151.82 1625.19 Q151.82 1621.58 149.482 1619.47 Q147.144 1617.36 143.14 1617.36 Q141.265 1617.36 139.39 1617.78 Q137.538 1618.2 135.593 1619.08 L135.593 1601.71 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M49.5521 1374.76 L79.2279 1374.76 L79.2279 1378.7 L49.5521 1378.7 L49.5521 1374.76 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M89.3667 1357.03 L107.723 1357.03 L107.723 1360.97 L93.6491 1360.97 L93.6491 1369.44 Q94.6676 1369.09 95.6861 1368.93 Q96.7047 1368.75 97.7232 1368.75 Q103.51 1368.75 106.89 1371.92 Q110.269 1375.09 110.269 1380.5 Q110.269 1386.08 106.797 1389.19 Q103.325 1392.26 97.0056 1392.26 Q94.8297 1392.26 92.5612 1391.89 Q90.3158 1391.52 87.9084 1390.78 L87.9084 1386.08 Q89.9917 1387.22 92.2139 1387.77 Q94.4361 1388.33 96.913 1388.33 Q100.918 1388.33 103.256 1386.22 Q105.593 1384.12 105.593 1380.5 Q105.593 1376.89 103.256 1374.79 Q100.918 1372.68 96.913 1372.68 Q95.038 1372.68 93.163 1373.1 Q91.3112 1373.51 89.3667 1374.39 L89.3667 1357.03 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M119.482 1385.71 L124.367 1385.71 L124.367 1391.59 L119.482 1391.59 L119.482 1385.71 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M144.552 1360.11 Q140.941 1360.11 139.112 1363.68 Q137.306 1367.22 137.306 1374.35 Q137.306 1381.45 139.112 1385.02 Q140.941 1388.56 144.552 1388.56 Q148.186 1388.56 149.991 1385.02 Q151.82 1381.45 151.82 1374.35 Q151.82 1367.22 149.991 1363.68 Q148.186 1360.11 144.552 1360.11 M144.552 1356.41 Q150.362 1356.41 153.417 1361.01 Q156.496 1365.6 156.496 1374.35 Q156.496 1383.07 153.417 1387.68 Q150.362 1392.26 144.552 1392.26 Q138.741 1392.26 135.663 1387.68 Q132.607 1383.07 132.607 1374.35 Q132.607 1365.6 135.663 1361.01 Q138.741 1356.41 144.552 1356.41 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M50.5475 1130.08 L80.2233 1130.08 L80.2233 1134.02 L50.5475 1134.02 L50.5475 1130.08 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M94.3436 1142.98 L110.663 1142.98 L110.663 1146.91 L88.7186 1146.91 L88.7186 1142.98 Q91.3806 1140.22 95.9639 1135.59 Q100.57 1130.94 101.751 1129.6 Q103.996 1127.07 104.876 1125.34 Q105.779 1123.58 105.779 1121.89 Q105.779 1119.13 103.834 1117.4 Q101.913 1115.66 98.8111 1115.66 Q96.6121 1115.66 94.1584 1116.42 Q91.7278 1117.19 88.9501 1118.74 L88.9501 1114.02 Q91.7741 1112.88 94.2278 1112.3 Q96.6815 1111.73 98.7185 1111.73 Q104.089 1111.73 107.283 1114.41 Q110.478 1117.1 110.478 1121.59 Q110.478 1123.72 109.668 1125.64 Q108.881 1127.54 106.774 1130.13 Q106.195 1130.8 103.094 1134.02 Q99.9917 1137.21 94.3436 1142.98 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M120.478 1141.03 L125.362 1141.03 L125.362 1146.91 L120.478 1146.91 L120.478 1141.03 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M135.593 1112.35 L153.95 1112.35 L153.95 1116.29 L139.876 1116.29 L139.876 1124.76 Q140.894 1124.41 141.913 1124.25 Q142.931 1124.06 143.95 1124.06 Q149.737 1124.06 153.116 1127.23 Q156.496 1130.41 156.496 1135.82 Q156.496 1141.4 153.024 1144.5 Q149.552 1147.58 143.232 1147.58 Q141.056 1147.58 138.788 1147.21 Q136.542 1146.84 134.135 1146.1 L134.135 1141.4 Q136.218 1142.54 138.441 1143.09 Q140.663 1143.65 143.14 1143.65 Q147.144 1143.65 149.482 1141.54 Q151.82 1139.43 151.82 1135.82 Q151.82 1132.21 149.482 1130.1 Q147.144 1128 143.14 1128 Q141.265 1128 139.39 1128.41 Q137.538 1128.83 135.593 1129.71 L135.593 1112.35 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M99.3204 870.747 Q95.7093 870.747 93.8806 874.311 Q92.075 877.853 92.075 884.983 Q92.075 892.089 93.8806 895.654 Q95.7093 899.196 99.3204 899.196 Q102.955 899.196 104.76 895.654 Q106.589 892.089 106.589 884.983 Q106.589 877.853 104.76 874.311 Q102.955 870.747 99.3204 870.747 M99.3204 867.043 Q105.131 867.043 108.186 871.649 Q111.265 876.233 111.265 884.983 Q111.265 893.709 108.186 898.316 Q105.131 902.899 99.3204 902.899 Q93.5102 902.899 90.4315 898.316 Q87.376 893.709 87.376 884.983 Q87.376 876.233 90.4315 871.649 Q93.5102 867.043 99.3204 867.043 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M119.482 896.348 L124.367 896.348 L124.367 902.228 L119.482 902.228 L119.482 896.348 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M144.552 870.747 Q140.941 870.747 139.112 874.311 Q137.306 877.853 137.306 884.983 Q137.306 892.089 139.112 895.654 Q140.941 899.196 144.552 899.196 Q148.186 899.196 149.991 895.654 Q151.82 892.089 151.82 884.983 Q151.82 877.853 149.991 874.311 Q148.186 870.747 144.552 870.747 M144.552 867.043 Q150.362 867.043 153.417 871.649 Q156.496 876.233 156.496 884.983 Q156.496 893.709 153.417 898.316 Q150.362 902.899 144.552 902.899 Q138.741 902.899 135.663 898.316 Q132.607 893.709 132.607 884.983 Q132.607 876.233 135.663 871.649 Q138.741 867.043 144.552 867.043 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M94.3436 653.61 L110.663 653.61 L110.663 657.546 L88.7186 657.546 L88.7186 653.61 Q91.3806 650.856 95.9639 646.226 Q100.57 641.574 101.751 640.231 Q103.996 637.708 104.876 635.972 Q105.779 634.212 105.779 632.523 Q105.779 629.768 103.834 628.032 Q101.913 626.296 98.8111 626.296 Q96.6121 626.296 94.1584 627.06 Q91.7278 627.824 88.9501 629.375 L88.9501 624.652 Q91.7741 623.518 94.2278 622.939 Q96.6815 622.361 98.7185 622.361 Q104.089 622.361 107.283 625.046 Q110.478 627.731 110.478 632.222 Q110.478 634.351 109.668 636.273 Q108.881 638.171 106.774 640.763 Q106.195 641.435 103.094 644.652 Q99.9917 647.847 94.3436 653.61 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M120.478 651.666 L125.362 651.666 L125.362 657.546 L120.478 657.546 L120.478 651.666 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M135.593 622.986 L153.95 622.986 L153.95 626.921 L139.876 626.921 L139.876 635.393 Q140.894 635.046 141.913 634.884 Q142.931 634.699 143.95 634.699 Q149.737 634.699 153.116 637.87 Q156.496 641.041 156.496 646.458 Q156.496 652.036 153.024 655.138 Q149.552 658.217 143.232 658.217 Q141.056 658.217 138.788 657.847 Q136.542 657.476 134.135 656.735 L134.135 652.036 Q136.218 653.171 138.441 653.726 Q140.663 654.282 143.14 654.282 Q147.144 654.282 149.482 652.175 Q151.82 650.069 151.82 646.458 Q151.82 642.847 149.482 640.74 Q147.144 638.634 143.14 638.634 Q141.265 638.634 139.39 639.05 Q137.538 639.467 135.593 640.347 L135.593 622.986 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M89.3667 378.303 L107.723 378.303 L107.723 382.239 L93.6491 382.239 L93.6491 390.711 Q94.6676 390.363 95.6861 390.201 Q96.7047 390.016 97.7232 390.016 Q103.51 390.016 106.89 393.188 Q110.269 396.359 110.269 401.775 Q110.269 407.354 106.797 410.456 Q103.325 413.535 97.0056 413.535 Q94.8297 413.535 92.5612 413.164 Q90.3158 412.794 87.9084 412.053 L87.9084 407.354 Q89.9917 408.488 92.2139 409.044 Q94.4361 409.599 96.913 409.599 Q100.918 409.599 103.256 407.493 Q105.593 405.387 105.593 401.775 Q105.593 398.164 103.256 396.058 Q100.918 393.951 96.913 393.951 Q95.038 393.951 93.163 394.368 Q91.3112 394.785 89.3667 395.664 L89.3667 378.303 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M119.482 406.984 L124.367 406.984 L124.367 412.863 L119.482 412.863 L119.482 406.984 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M144.552 381.382 Q140.941 381.382 139.112 384.947 Q137.306 388.488 137.306 395.618 Q137.306 402.725 139.112 406.289 Q140.941 409.831 144.552 409.831 Q148.186 409.831 149.991 406.289 Q151.82 402.725 151.82 395.618 Q151.82 388.488 149.991 384.947 Q148.186 381.382 144.552 381.382 M144.552 377.678 Q150.362 377.678 153.417 382.285 Q156.496 386.868 156.496 395.618 Q156.496 404.345 153.417 408.951 Q150.362 413.535 144.552 413.535 Q138.741 413.535 135.663 408.951 Q132.607 404.345 132.607 395.618 Q132.607 386.868 135.663 382.285 Q138.741 377.678 144.552 377.678 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M89.1352 133.621 L111.357 133.621 L111.357 135.612 L98.8111 168.181 L93.9269 168.181 L105.732 137.556 L89.1352 137.556 L89.1352 133.621 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M120.478 162.301 L125.362 162.301 L125.362 168.181 L120.478 168.181 L120.478 162.301 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip790)" d="M135.593 133.621 L153.95 133.621 L153.95 137.556 L139.876 137.556 L139.876 146.028 Q140.894 145.681 141.913 145.519 Q142.931 145.334 143.95 145.334 Q149.737 145.334 153.116 148.505 Q156.496 151.677 156.496 157.093 Q156.496 162.672 153.024 165.774 Q149.552 168.852 143.232 168.852 Q141.056 168.852 138.788 168.482 Q136.542 168.112 134.135 167.371 L134.135 162.672 Q136.218 163.806 138.441 164.362 Q140.663 164.917 143.14 164.917 Q147.144 164.917 149.482 162.811 Q151.82 160.704 151.82 157.093 Q151.82 153.482 149.482 151.376 Q147.144 149.269 143.14 149.269 Q141.265 149.269 139.39 149.686 Q137.538 150.102 135.593 150.982 L135.593 133.621 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip792)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,1182.96 268.292,1174.9 270.6,1423.33 272.908,1268.28 275.216,1463.61 277.524,1250.4 279.832,1456.3 282.139,1496.09 284.447,1280.43 286.755,1259.23 289.063,1278.54 291.371,1328.98 293.679,1256.42 295.987,1243.87 298.295,1255.51 300.603,1452.83 302.911,1557.25 305.219,1384.52 307.527,1355.32 309.834,1364.59 312.142,1355.76 314.45,1366.48 316.758,1268.63 319.066,1525.94 321.374,1599.89 323.682,1230.89 325.99,1302.84 328.298,1316.52 330.606,1244.15 332.914,1208.04 335.221,1338.85 337.529,1287.1 339.837,1386.97 342.145,1392.84 344.453,1423.55 346.761,1421.79 349.069,1389.66 351.377,1502.54 353.685,1257.95 355.993,1408.42 358.301,1426.21 360.608,1509.36 362.916,1437 365.224,1386.62 367.532,1378.22 369.84,1496.59 372.148,1148.54 374.456,1552.25 376.764,1251.27 379.072,1265.89 381.38,1325.72 383.688,1478.12 385.996,1327.08 388.303,1526.91 390.611,1460.51 392.919,1344.76 395.227,1393.33 397.535,1352.87 399.843,1374.49 402.151,1389.63 404.459,1223.13 406.767,1390.26 409.075,1603.66 411.383,1365.13 413.69,1267.23 415.998,1436.52 418.306,1384.74 420.614,1217.92 422.922,1581.77 425.23,1538.01 427.538,1507.76 429.846,1373.73 432.154,1346.03 434.462,1325.79 436.77,1306.71 439.077,1277.56 441.385,1352.87 443.693,1381.72 446.001,1375.78 448.309,1300.44 450.617,1433.23 452.925,1473.28 455.233,1355.28 457.541,1343.41 459.849,1298.35 462.157,1413.53 464.465,1333.46 466.772,1195.66 469.08,1466.22 471.388,1355.12 473.696,1316.81 476.004,1395.78 478.312,1318.81 480.62,1478.31 482.928,1530.32 485.236,1437.01 487.544,1282.34 489.852,1548.72 492.159,1295.9 494.467,1517.61 496.775,1318.56 499.083,1341.79 501.391,1452.94 503.699,1412.21 506.007,1418.55 508.315,1268.16 510.623,1402.53 512.931,1291.94 515.239,1217.73 517.546,1285.51 519.854,1399.91 522.162,1470.4 524.47,1642.16 526.778,1265 529.086,1418.6 531.394,1273.94 533.702,1306.02 536.01,1439.08 538.318,1236.81 540.626,1339.8 542.933,1385.88 545.241,1510.71 547.549,1320.93 549.857,1330.97 552.165,1263.53 554.473,1461.35 556.781,1353.62 559.089,1326.69 561.397,1310.2 563.705,1394.15 566.013,1318.72 568.321,1484.52 570.628,1189.86 572.936,1552.94 575.244,1359.83 577.552,1751.15 579.86,1256.57 582.168,1320.49 584.476,1480.25 586.784,1381.71 589.092,1383.87 591.4,1440.44 593.708,1443.9 596.015,1498.8 598.323,1292.15 600.631,1556.12 602.939,1409.09 605.247,1211.5 607.555,1447.12 609.863,1379.91 612.171,1414.55 614.479,1317.84 616.787,1447.58 619.095,1338.1 621.402,1357.64 623.71,1372.13 626.018,1675.99 628.326,1302.64 630.634,1296.92 632.942,1389.22 635.25,1331.8 637.558,1488.45 639.866,1544.45 642.174,1193.92 644.482,1415.02 646.79,1354.46 649.097,1395.4 651.405,1433.32 653.713,1470.21 656.021,1246.39 658.329,1355.36 660.637,1423.49 662.945,1332.81 665.253,1283.04 667.561,1445.96 669.869,1397.07 672.177,1505.23 674.484,1457.96 676.792,1266.67 679.1,1715.36 681.408,1281.43 683.716,1355.27 686.024,1320.67 688.332,1400.23 690.64,1560.79 692.948,1339.08 695.256,1135.08 697.564,1321.2 699.871,1389.52 702.179,1339.12 704.487,1347.82 706.795,1348.66 709.103,1243.98 711.411,1326.4 713.719,1363.11 716.027,1313.27 718.335,1446.57 720.643,1362.15 722.951,1262.73 725.259,1252.74 727.566,1530.42 729.874,1416.08 732.182,1443.66 734.49,1262.66 736.798,1343.97 739.106,1412.64 741.414,1280.25 743.722,1409.68 746.03,1397.18 748.338,1286.85 750.646,1500.63 752.953,1565.99 755.261,1444.13 757.569,1475.7 759.877,1452.36 762.185,1348.13 764.493,1295.94 766.801,1339.36 769.109,1446.64 771.417,1319.8 773.725,1323.06 776.033,1513.02 778.34,1308.04 780.648,1365.01 782.956,1418.87 785.264,1493.61 787.572,1406.98 789.88,1400.13 792.188,1279.89 794.496,1365.93 796.804,1361.64 799.112,1354.02 801.42,1454.38 803.728,1293.48 806.035,1214.87 808.343,1285.18 810.651,1477 812.959,1388.37 815.267,1396.72 817.575,1289.16 819.883,1607.57 822.191,1467.85 824.499,1403.8 826.807,1379.89 829.115,1370.31 831.422,1542.61 833.73,1490.55 836.038,1497.72 838.346,1252.88 840.654,1424.34 842.962,1326.89 845.27,1394.07 847.578,1459.11 849.886,1235.56 852.194,1371.44 854.502,1378.43 856.809,1354.94 859.117,1292.37 861.425,1326.93 863.733,1341.68 866.041,1242.35 868.349,1406.47 870.657,1512.34 872.965,1615.4 875.273,1243.46 877.581,1298.55 879.889,1451.08 882.197,1474.69 884.504,1198.37 886.812,1290.08 889.12,1307.34 891.428,1507.09 893.736,1308.34 896.044,1402.31 898.352,1433.23 900.66,1633.01 902.968,1347.51 905.276,1421.61 907.584,1375 909.891,1367.43 912.199,1447.47 914.507,1476.5 916.815,1262.53 919.123,1399.61 921.431,1396.74 923.739,1241.71 926.047,1293.2 928.355,1207.26 930.663,1278.43 932.971,1338.96 935.278,1247.52 937.586,1368.46 939.894,1376.13 942.202,1184.06 944.51,1295.6 946.818,1455.03 949.126,1366.71 951.434,1414.23 953.742,1382.1 956.05,1368.18 958.358,1289.62 960.665,1411.13 962.973,1337.21 965.281,1319.91 967.589,1221.71 969.897,1431.23 972.205,1293.15 974.513,1222.32 976.821,1367.03 979.129,1414.53 981.437,1409.58 983.745,1287.96 986.053,1298.47 988.36,1427.08 990.668,1394.56 992.976,1449.36 995.284,1402.79 997.592,1328.68 999.9,1420.02 1002.21,1223.15 1004.52,1317.27 1006.82,1357.91 1009.13,1431.34 1011.44,1505.61 1013.75,1340.36 1016.06,1189.71 1018.36,1368.97 1020.67,1361.96 1022.98,1362.26 1025.29,1387.01 1027.59,1443.25 1029.9,1319.16 1032.21,1414.59 1034.52,1470.82 1036.83,1481.06 1039.13,1449.82 1041.44,1354.17 1043.75,1336.42 1046.06,1317.69 1048.37,1277.57 1050.67,1455.77 1052.98,1469.58 1055.29,1328.36 1057.6,1520.22 1059.91,1369.26 1062.21,1315.12 1064.52,1446.67 1066.83,1267.11 1069.14,1299.08 1071.45,1382.67 1073.75,1423.83 1076.06,1440.96 1078.37,1279.11 1080.68,1209.68 1082.98,1412.14 1085.29,1206.5 1087.6,1357.24 1089.91,1258.54 1092.22,1539.31 1094.52,1431.42 1096.83,1389.96 1099.14,1479.8 1101.45,1473.53 1103.76,1312.44 1106.06,1555.62 1108.37,1395.36 1110.68,1355.49 1112.99,1478.21 1115.3,1331.62 1117.6,1250.93 1119.91,1549.37 1122.22,1249.69 1124.53,1397.73 1126.84,1376.05 1129.14,1523.32 1131.45,1359.01 1133.76,1384.51 1136.07,1395.66 1138.37,1485.16 1140.68,1274.53 1142.99,1366.38 1145.3,1273.4 1147.61,1351.6 1149.91,1486.41 1152.22,1422.29 1154.53,1433.16 1156.84,1419.23 1159.15,1494.14 1161.45,1494.96 1163.76,1224.14 1166.07,1382.87 1168.38,1423.08 1170.69,1433.74 1172.99,1381.96 1175.3,1343.26 1177.61,1283.75 1179.92,1349.35 1182.23,1241.14 1184.53,1646.78 1186.84,1362.75 1189.15,1462.92 1191.46,1460.07 1193.76,1382.11 1196.07,1496.92 1198.38,1376.88 1200.69,1233.51 1203,1428.44 1205.3,1408.17 1207.61,1416.28 1209.92,1501.74 1212.23,1523.22 1214.54,1283.7 1216.84,1328.47 1219.15,1437.72 1221.46,1622.23 1223.77,1389.78 1226.08,1244.61 1228.38,1384.55 1230.69,1446.25 1233,1354.12 1235.31,1330.69 1237.61,1437.19 1239.92,1329.25 1242.23,1478.13 1244.54,1345.9 1246.85,1509.52 1249.15,1399.72 1251.46,1295.38 1253.77,1274.19 1256.08,1430.83 1258.39,1377.26 1260.69,1374.78 1263,1288.58 1265.31,1397.95 1267.62,1499.83 1269.93,1275.83 1272.23,1266.93 1274.54,1253.35 1276.85,1436.54 1279.16,1443.13 1281.47,1255.8 1283.77,1378.14 1286.08,1381.46 1288.39,1272.64 1290.7,1244.04 1293,1136.1 1295.31,1416.83 1297.62,1299.81 1299.93,1331.93 1302.24,1456.16 1304.54,1409.77 1306.85,1451.75 1309.16,1186.17 1311.47,1216.76 1313.78,1418.31 1316.08,1321.52 1318.39,1223.59 1320.7,1451.73 1323.01,1334.24 1325.32,1299.16 1327.62,1404.52 1329.93,1405.23 1332.24,1527 1334.55,1451.31 1336.86,1414.03 1339.16,1432.97 1341.47,1485.61 1343.78,1253.85 1346.09,1299.41 1348.39,1294.09 1350.7,1384.54 1353.01,1306.51 1355.32,1314.32 1357.63,1253.78 1359.93,1374.72 1362.24,1554.77 1364.55,1395.01 1366.86,1328.08 1369.17,1434.42 1371.47,1333.7 1373.78,1446.79 1376.09,1602.32 1378.4,1309.83 1380.71,1310.93 1383.01,1168.82 1385.32,1400.01 1387.63,1378.86 1389.94,1493.15 1392.24,1375.83 1394.55,1435.7 1396.86,1431.06 1399.17,1427.35 1401.48,1430.47 1403.78,1314.77 1406.09,1318.33 1408.4,1408.12 1410.71,1384.9 1413.02,1306.54 1415.32,1239.03 1417.63,1171.52 1419.94,1401.05 1422.25,1321.05 1424.56,1325.44 1426.86,1407.2 1429.17,1456.86 1431.48,1453.71 1433.79,1522.37 1436.1,1416.09 1438.4,1371.11 1440.71,1230.45 1443.02,1214.72 1445.33,1480.47 1447.63,1287.08 1449.94,1457.42 1452.25,1300.52 1454.56,1535.36 1456.87,1446.6 1459.17,1334.57 1461.48,1398.45 1463.79,1353.33 1466.1,1198.79 1468.41,1458.04 1470.71,1394.38 1473.02,1408.71 1475.33,1321.76 1477.64,1282.6 1479.95,1327.91 1482.25,1488.61 1484.56,1395.08 1486.87,1598.36 1489.18,1453.57 1491.49,1395.71 1493.79,1428.87 1496.1,1400.79 1498.41,1421.66 1500.72,1264.97 1503.02,1425.78 1505.33,1260.41 1507.64,1336.28 1509.95,1290.38 1512.26,1643.26 1514.56,1425.44 1516.87,1327.44 1519.18,1288.17 1521.49,1314.14 1523.8,1312.04 1526.1,1254.46 1528.41,1180.01 1530.72,1285.43 1533.03,1440.54 1535.34,1293.95 1537.64,1323.6 1539.95,1330.1 1542.26,1359.38 1544.57,1328.64 1546.88,1439.36 1549.18,1354.03 1551.49,1479.69 1553.8,1438.36 1556.11,1498.54 1558.41,1376.99 1560.72,1439.4 1563.03,1424.55 1565.34,1323.88 1567.65,1364.08 1569.95,1532.15 1572.26,1255.63 1574.57,1341.96 1576.88,1268.55 1579.19,1260.74 1581.49,1212.69 1583.8,1414.12 1586.11,1342.69 1588.42,1257 1590.73,1388.93 1593.03,1526.58 1595.34,1456.35 1597.65,1474.88 1599.96,1199.3 1602.26,1421.41 1604.57,1440.78 1606.88,1492.79 1609.19,1248.41 1611.5,1246.56 1613.8,1355.76 1616.11,1411.54 1618.42,1385.9 1620.73,1272.05 1623.04,1489.72 1625.34,1525.86 1627.65,1354.99 1629.96,1373.56 1632.27,1315.26 1634.58,1360.87 1636.88,1316.78 1639.19,1508.44 1641.5,1344.17 1643.81,1328.25 1646.12,1397.35 1648.42,1384.32 1650.73,1253.45 1653.04,1251.71 1655.35,1393.06 1657.65,1267.48 1659.96,1317.42 1662.27,1643.43 1664.58,1333.5 1666.89,1419.8 1669.19,1302.32 1671.5,1232.75 1673.81,1343.02 1676.12,1575.25 1678.43,1281.7 1680.73,1198.25 1683.04,1441.08 1685.35,1243.64 1687.66,1362.18 1689.97,1305.77 1692.27,1202.92 1694.58,1412.92 1696.89,1216.59 1699.2,1410.62 1701.51,1549.48 1703.81,1394.11 1706.12,1274.57 1708.43,1581.33 1710.74,1451.09 1713.04,1379 1715.35,1458.45 1717.66,1451.84 1719.97,1317.76 1722.28,1442.73 1724.58,1438.36 1726.89,1398.12 1729.2,1194.56 1731.51,1457.64 1733.82,1428.5 1736.12,1320.19 1738.43,1286.11 1740.74,1347.58 1743.05,1374.84 1745.36,1322.88 1747.66,1384.23 1749.97,1432.22 1752.28,1345.57 1754.59,1428.53 1756.9,1345.18 1759.2,1381.15 1761.51,1403.11 1763.82,1525.78 1766.13,1265.08 1768.43,1411.41 1770.74,1321.02 1773.05,1348.47 1775.36,1456.37 1777.67,1244.44 1779.97,1101.01 1782.28,1493.58 1784.59,1414.49 1786.9,1615.56 1789.21,1230.39 1791.51,1298.93 1793.82,1392.89 1796.13,1356.36 1798.44,1496.81 1800.75,1337.48 1803.05,1400.11 1805.36,1361.79 1807.67,1522.84 1809.98,1336.27 1812.28,1281.56 1814.59,1437.24 1816.9,1346.24 1819.21,1469.69 1821.52,1554.26 1823.82,1566.86 1826.13,1377.2 1828.44,1325.27 1830.75,1274.77 1833.06,1342.6 1835.36,1165.43 1837.67,1383.39 1839.98,1324.53 1842.29,1388.03 1844.6,1367.68 1846.9,1297.34 1849.21,1284.98 1851.52,1108.48 1853.83,1399.28 1856.14,1421.23 1858.44,1359.6 1860.75,1293.87 1863.06,1437.67 1865.37,1411.63 1867.67,1332.34 1869.98,1439.18 1872.29,1335 1874.6,1317.91 1876.91,1396.62 1879.21,1297.53 1881.52,1371.02 1883.83,1370.32 1886.14,1227.73 1888.45,1244.13 1890.75,1298.22 1893.06,1361.93 1895.37,1230.89 1897.68,1411.4 1899.99,1394.96 1902.29,1414.45 1904.6,1312.14 1906.91,1507.67 1909.22,1305.22 1911.53,1240.1 1913.83,1239.02 1916.14,1265.86 1918.45,1616.55 1920.76,1674.25 1923.06,1265.63 1925.37,1370.62 1927.68,1341.05 1929.99,1468.32 1932.3,1505.19 1934.6,1211.03 1936.91,1403.67 1939.22,1346.85 1941.53,1417.09 1943.84,1351.23 1946.14,1449.39 1948.45,1325.8 1950.76,1331.92 1953.07,1377.77 1955.38,1204.12 1957.68,1379.83 1959.99,1466.78 1962.3,1311.71 1964.61,1506.93 1966.91,1338.09 1969.22,1433.93 1971.53,1357.15 1973.84,1397.68 1976.15,1403.22 1978.45,1360 1980.76,1387.01 1983.07,1409.6 1985.38,1424.03 1987.69,1558.14 1989.99,1166.86 1992.3,1440.21 1994.61,1466.44 1996.92,1357.1 1999.23,1417.9 2001.53,1403.96 2003.84,1333.17 2006.15,1425.82 2008.46,1392.52 2010.77,1405.51 2013.07,1352.21 2015.38,1479.98 2017.69,1315.13 2020,1376.24 2022.3,1391.58 2024.61,1344.8 2026.92,1527.02 2029.23,1635.69 2031.54,1510.31 2033.84,1199.29 2036.15,1324.56 2038.46,1385.43 2040.77,1258.07 2043.08,1412.38 2045.38,1495.28 2047.69,1491.21 2050,1443 2052.31,1273.79 2054.62,1366.12 2056.92,1496.17 2059.23,1540.09 2061.54,1284.51 2063.85,1444.4 2066.16,1465.1 2068.46,1225.9 2070.77,1496.46 2073.08,1427.78 2075.39,1243.78 2077.69,1335.04 2080,1359.15 2082.31,1229.4 2084.62,1236.06 2086.93,1242.89 2089.23,1520.74 2091.54,1246.52 2093.85,1550.43 2096.16,1299.88 2098.47,1254.06 2100.77,1379.8 2103.08,1450.96 2105.39,1399.78 2107.7,1380.32 2110.01,1437.99 2112.31,1384.93 2114.62,1337.86 2116.93,1374.62 2119.24,1425.43 2121.55,1311.47 2123.85,1518.16 2126.16,1543.54 2128.47,1178.89 2130.78,1253.51 2133.08,1289.25 2135.39,1492.86 2137.7,1365.94 2140.01,1313.57 2142.32,1375.18 2144.62,1345.89 2146.93,1341.72 2149.24,1333.56 2151.55,1479.1 2153.86,1460.41 2156.16,1218.97 2158.47,1379.37 2160.78,1230.08 2163.09,1537.44 2165.4,1503.84 2167.7,1341.43 2170.01,1430.84 2172.32,1075.79 2174.63,1496.48 2176.93,1355.65 2179.24,1527.34 2181.55,1341.71 2183.86,1453 2186.17,1542.95 2188.47,1445.71 2190.78,1408.1 2193.09,1301.85 2195.4,1199.05 2197.71,1319.8 2200.01,1373.97 2202.32,1358.34 2204.63,1434.93 2206.94,1267.73 2209.25,1431.72 2211.55,1305.77 2213.86,1120.02 2216.17,1349.51 2218.48,1309.22 2220.79,1435.95 2223.09,1159.26 2225.4,1236.18 2227.71,1269.36 2230.02,1221.36 2232.32,1303.54 2234.63,1495.18 2236.94,1299.17 2239.25,1167.62 2241.56,1381.29 2243.86,1316.34 2246.17,1318.6 2248.48,1277.46 2250.79,1342.86 2253.1,1349.72 2255.4,1269.8 2257.71,1339.91 2260.02,1538.24 2262.33,1442.21 2264.64,1361.04 2266.94,1441.33 2269.25,1495.96 2271.56,1432.37 2273.87,1403.56 2276.18,1217.82 2278.48,1324.95 2280.79,1317.98 2283.1,1403.69 2285.41,1318.57 2287.71,1485.37 2290.02,1425.95 2292.33,1528.92 2294.64,1523.64 2296.95,1292.55 2299.25,1171.84 2301.56,1299.88 2303.87,1395.56 2306.18,1393.05 2308.49,1260.82 2310.79,1516.82 2313.1,1416.25 2315.41,1326.66 2317.72,1503.36 2320.03,1346.15 2322.33,1396.63 2324.64,1563.51 2326.95,1449.81 2329.26,1444.35 2331.56,1521.24 2333.87,1331.29 2336.18,1403.32 2338.49,1400.44 2340.8,1407.56 2343.1,1231.88 2345.41,1296.88 2347.72,1312.17 2350.03,1318.13 2352.34,1444.26 2354.64,1385.03 2356.95,1262.26 2359.26,1340.99 2361.57,1387.29 2363.88,1289.24 2366.18,1364.59 2368.49,1354.31 2370.8,1437.51 2373.11,1494.43 2375.42,1527.95 2377.72,1542.4 2380.03,1260.95 2382.34,1399.02 2384.65,1207.27 2386.95,1152.94 2389.26,1378.15 2391.57,1394.49 2393.88,1506.7 2396.19,1298.08 2398.49,1294.35 2400.8,1537.76 2403.11,1429.27 2405.42,1518.15 2407.73,1349.08 2410.03,1174.4 2412.34,1551.2 2414.65,1300.59 2416.96,1559.94 2419.27,1385.1 2421.57,1587.63 2423.88,1472.89 2426.19,1448.01 2428.5,1385.78 2430.81,1567.74 2433.11,1458.47 2435.42,1236.14 2437.73,1422.43 2440.04,1447.62 2442.34,1426.91 2444.65,1277.95 2446.96,1281.03 2449.27,1443.31 2451.58,1405.69 2453.88,1326.7 2456.19,1327.2 2458.5,1284.38 2460.81,1305.19 2463.12,1412.39 2465.42,1429.25 2467.73,1145.87 2470.04,1334.55 2472.35,1413.76 2474.66,1388.03 2476.96,1350.86 2479.27,1411.97 2481.58,1300.19 2483.89,1191.7 2486.2,1431.84 2488.5,1486.19 2490.81,1391.82 2493.12,1250.24 2495.43,1154.34 2497.73,1375.68 2500.04,1433.46 2502.35,1294.89 2504.66,1256.15 2506.97,1373.39 2509.27,1219.43 2511.58,1442.2 2513.89,1322.66 2516.2,1273.47 2518.51,1278.58 2520.81,1440.81 2523.12,1263.85 2525.43,1263.57 2527.74,1499.58 2530.05,1447.74 2532.35,1471.15 2534.66,1467.7 2536.97,1485.89 2539.28,1430.23 2541.58,1429.45 2543.89,1331.95 2546.2,1302.31 2548.51,1256.91 2550.82,1519.83 2553.12,1232.14 2555.43,1528.44 2557.74,1386.03 2560.05,1379.78 2562.36,1374.39 2564.66,1373.74 2566.97,1375.73 2569.28,1141.65 2571.59,1306.95 "></polyline>
<polyline clip-path="url(#clip792)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,857.848 268.292,1059.24 270.6,915.909 272.908,717.353 275.216,897.338 277.524,1003.62 279.832,821.909 282.139,873.479 284.447,976.437 286.755,779.806 289.063,1003.44 291.371,874.955 293.679,1044.56 295.987,701.622 298.295,1031.02 300.603,998.549 302.911,905.363 305.219,723.042 307.527,819.677 309.834,906.967 312.142,1014.28 314.45,850.323 316.758,930.343 319.066,931.95 321.374,722.972 323.682,959.079 325.99,839.733 328.298,697.888 330.606,971.775 332.914,768.079 335.221,1055.7 337.529,831.952 339.837,1014.14 342.145,986.097 344.453,903.375 346.761,883.27 349.069,914.368 351.377,621.432 353.685,957.392 355.993,831.409 358.301,943.085 360.608,680.402 362.916,913.221 365.224,1129.93 367.532,913.635 369.84,967.792 372.148,776.938 374.456,899.222 376.764,952.721 379.072,961.324 381.38,838.972 383.688,878.481 385.996,896.31 388.303,967.278 390.611,808.108 392.919,1029.54 395.227,930.608 397.535,880.701 399.843,957.561 402.151,732.315 404.459,844.279 406.767,791.511 409.075,780.016 411.383,958.659 413.69,881.027 415.998,815.57 418.306,1052.88 420.614,1123.7 422.922,972.134 425.23,799.422 427.538,949.477 429.846,913.866 432.154,869.812 434.462,777.288 436.77,765.213 439.077,1054.12 441.385,1062.33 443.693,1097.56 446.001,754.785 448.309,745.336 450.617,808.983 452.925,880.87 455.233,900.848 457.541,1021.87 459.849,816.752 462.157,837.45 464.465,950.814 466.772,886.03 469.08,966.169 471.388,824.419 473.696,894.256 476.004,941.948 478.312,918.612 480.62,828.834 482.928,873.217 485.236,716.012 487.544,1026.43 489.852,790.954 492.159,857.892 494.467,942.497 496.775,900.474 499.083,808.492 501.391,910.016 503.699,825.112 506.007,1065.39 508.315,843.004 510.623,854.188 512.931,860.961 515.239,791.992 517.546,950.7 519.854,1019.53 522.162,744.738 524.47,858.95 526.778,854.126 529.086,804.248 531.394,885.214 533.702,801.939 536.01,776.43 538.318,851.444 540.626,940.77 542.933,990.55 545.241,733.06 547.549,905.808 549.857,974.964 552.165,833.04 554.473,977.13 556.781,918.701 559.089,938.643 561.397,893.359 563.705,781.731 566.013,1007.66 568.321,762.764 570.628,1034.47 572.936,799.819 575.244,944.124 577.552,1082.51 579.86,1056.21 582.168,984.919 584.476,851.612 586.784,860.123 589.092,944.607 591.4,863.425 593.708,911.078 596.015,990.301 598.323,864.891 600.631,1124.45 602.939,893.798 605.247,885.319 607.555,908.319 609.863,858.483 612.171,887.369 614.479,799.402 616.787,1007.69 619.095,622.594 621.402,915.725 623.71,821.269 626.018,1017.8 628.326,810.809 630.634,775.855 632.942,864.457 635.25,800.45 637.558,874.839 639.866,788.792 642.174,768.748 644.482,1032.66 646.79,970.786 649.097,762.201 651.405,751.177 653.713,822.042 656.021,1085.02 658.329,769.798 660.637,776.888 662.945,695.231 665.253,894.338 667.561,779.998 669.869,890.666 672.177,693.526 674.484,782.034 676.792,635.216 679.1,882.61 681.408,1045.86 683.716,783.359 686.024,852.947 688.332,877.352 690.64,890.743 692.948,956.953 695.256,961 697.564,877.716 699.871,949.144 702.179,711.772 704.487,816.908 706.795,804.82 709.103,1018.41 711.411,887.754 713.719,1107.02 716.027,881.448 718.335,1194.51 720.643,1042.54 722.951,708.614 725.259,879.779 727.566,725.133 729.874,794.459 732.182,961.646 734.49,905.732 736.798,864.546 739.106,1016.25 741.414,737.364 743.722,963.625 746.03,931.722 748.338,956.752 750.646,812.879 752.953,933.671 755.261,936.501 757.569,706.47 759.877,963.631 762.185,872.665 764.493,772.861 766.801,816.045 769.109,916.086 771.417,780.035 773.725,893.245 776.033,810.952 778.34,825.479 780.648,860.856 782.956,1094.67 785.264,982.487 787.572,624.478 789.88,888.35 792.188,945.566 794.496,886.285 796.804,1067.37 799.112,943.77 801.42,680.387 803.728,882.547 806.035,749.422 808.343,932.585 810.651,914.621 812.959,816.826 815.267,869.705 817.575,735.508 819.883,1036.83 822.191,795.474 824.499,824.396 826.807,824.854 829.115,856.439 831.422,912.956 833.73,885.695 836.038,738.117 838.346,849.941 840.654,840.46 842.962,815.127 845.27,786.881 847.578,995.658 849.886,1165.69 852.194,886.8 854.502,800.738 856.809,794.11 859.117,753.504 861.425,1008.62 863.733,744.852 866.041,845.142 868.349,805.509 870.657,792.328 872.965,710.588 875.273,899.058 877.581,868.144 879.889,960.665 882.197,831.393 884.504,1024.2 886.812,824.172 889.12,1061.7 891.428,964.021 893.736,729.322 896.044,1029.76 898.352,925 900.66,934.558 902.968,916.307 905.276,972.51 907.584,954.324 909.891,724.571 912.199,904.485 914.507,886.132 916.815,873.946 919.123,871.968 921.431,852.181 923.739,920.637 926.047,782.75 928.355,906.205 930.663,933.309 932.971,711.941 935.278,595.505 937.586,804.576 939.894,879.119 942.202,747.813 944.51,838.988 946.818,876.173 949.126,1009.28 951.434,1101.04 953.742,967.598 956.05,811.528 958.358,958.995 960.665,810.798 962.973,928.914 965.281,935.349 967.589,855.188 969.897,970.945 972.205,957.625 974.513,706.693 976.821,886.108 979.129,855.913 981.437,983.972 983.745,913.323 986.053,1066.11 988.36,1042.1 990.668,898.086 992.976,1014.21 995.284,963.468 997.592,743.506 999.9,819.763 1002.21,1017.5 1004.52,815.888 1006.82,756.187 1009.13,1072 1011.44,719.53 1013.75,780.951 1016.06,893.475 1018.36,880.927 1020.67,847.629 1022.98,762.467 1025.29,781.942 1027.59,863.011 1029.9,1021.42 1032.21,866.62 1034.52,824.671 1036.83,961.14 1039.13,865.545 1041.44,806.122 1043.75,941.238 1046.06,748.596 1048.37,833.158 1050.67,826.557 1052.98,982.65 1055.29,1024.87 1057.6,1015.29 1059.91,976.77 1062.21,729.876 1064.52,1041.16 1066.83,857.149 1069.14,953.132 1071.45,922.442 1073.75,893.723 1076.06,683.51 1078.37,749.278 1080.68,848.131 1082.98,983.905 1085.29,853.136 1087.6,965.604 1089.91,802.08 1092.22,902.486 1094.52,924.526 1096.83,829.621 1099.14,1028.52 1101.45,769.784 1103.76,809.506 1106.06,908.021 1108.37,1011.54 1110.68,868.016 1112.99,980.083 1115.3,800.986 1117.6,1056.07 1119.91,1034.03 1122.22,1004.9 1124.53,957 1126.84,889.3 1129.14,956.094 1131.45,910.027 1133.76,832.705 1136.07,967.21 1138.37,899.932 1140.68,891.84 1142.99,948.218 1145.3,665.925 1147.61,1092.18 1149.91,984.514 1152.22,729.158 1154.53,922.44 1156.84,1033.26 1159.15,1014.78 1161.45,866.322 1163.76,921.949 1166.07,744.623 1168.38,1028.7 1170.69,786.594 1172.99,993.159 1175.3,1034.14 1177.61,922.725 1179.92,983.541 1182.23,946.162 1184.53,817.892 1186.84,855.13 1189.15,1117.65 1191.46,947.69 1193.76,797.287 1196.07,742.406 1198.38,913.558 1200.69,938.914 1203,945.616 1205.3,1007.91 1207.61,798.202 1209.92,835.22 1212.23,1068.04 1214.54,847.289 1216.84,1000.92 1219.15,801.939 1221.46,787.481 1223.77,824.925 1226.08,925.361 1228.38,1009.38 1230.69,903.047 1233,931.231 1235.31,906.305 1237.61,780.718 1239.92,871.592 1242.23,846.914 1244.54,749.961 1246.85,804.418 1249.15,979.692 1251.46,773.123 1253.77,785.974 1256.08,858.542 1258.39,869.932 1260.69,903.585 1263,997.446 1265.31,980.939 1267.62,873.931 1269.93,768.916 1272.23,893.489 1274.54,891.671 1276.85,947.067 1279.16,1001.33 1281.47,950.551 1283.77,906.971 1286.08,945.588 1288.39,813.868 1290.7,863.163 1293,1015.4 1295.31,874.731 1297.62,884.541 1299.93,885.346 1302.24,793.527 1304.54,905.238 1306.85,1043.33 1309.16,970.321 1311.47,885.067 1313.78,866.258 1316.08,925.507 1318.39,753.517 1320.7,810.28 1323.01,952.389 1325.32,969.332 1327.62,882.597 1329.93,990.456 1332.24,925.742 1334.55,877.815 1336.86,869.107 1339.16,864.768 1341.47,917.832 1343.78,843.476 1346.09,810.302 1348.39,740.523 1350.7,1001.98 1353.01,890.025 1355.32,1078.17 1357.63,819.33 1359.93,909.325 1362.24,804.123 1364.55,983.11 1366.86,869.172 1369.17,936.605 1371.47,902.874 1373.78,872.493 1376.09,957.656 1378.4,748.094 1380.71,835.455 1383.01,1120.88 1385.32,771.917 1387.63,734.482 1389.94,1098.97 1392.24,891.131 1394.55,848.333 1396.86,630.851 1399.17,913.988 1401.48,788.418 1403.78,883.466 1406.09,1009 1408.4,871.032 1410.71,680.405 1413.02,869.491 1415.32,885.995 1417.63,744.409 1419.94,891.987 1422.25,920.953 1424.56,793.712 1426.86,984.046 1429.17,1028.81 1431.48,1001.83 1433.79,686.967 1436.1,964.467 1438.4,711.365 1440.71,1020.09 1443.02,1014.66 1445.33,925.046 1447.63,893.076 1449.94,870.559 1452.25,897.561 1454.56,865.811 1456.87,752.86 1459.17,831.891 1461.48,857.829 1463.79,737.998 1466.1,1032.48 1468.41,794.421 1470.71,976.506 1473.02,944.23 1475.33,811.388 1477.64,942.687 1479.95,763.549 1482.25,873.786 1484.56,914.914 1486.87,846.845 1489.18,952.839 1491.49,965.293 1493.79,973.062 1496.1,875.437 1498.41,785.268 1500.72,936.845 1503.02,768.927 1505.33,888.264 1507.64,845.538 1509.95,894.61 1512.26,906.248 1514.56,905.68 1516.87,753.824 1519.18,948.142 1521.49,864.425 1523.8,829.56 1526.1,838.694 1528.41,938.298 1530.72,707.128 1533.03,959.846 1535.34,922.999 1537.64,997.132 1539.95,686.618 1542.26,1047.66 1544.57,968.549 1546.88,967.025 1549.18,741.252 1551.49,865.677 1553.8,841.671 1556.11,816.883 1558.41,723.778 1560.72,958.952 1563.03,815.914 1565.34,1008.93 1567.65,853.926 1569.95,871.331 1572.26,811.348 1574.57,784.436 1576.88,943.259 1579.19,788.696 1581.49,721.263 1583.8,1139.37 1586.11,886.515 1588.42,749.259 1590.73,974.291 1593.03,887.009 1595.34,866.618 1597.65,823.942 1599.96,920.151 1602.26,1012.11 1604.57,919.369 1606.88,875.698 1609.19,891.863 1611.5,932.836 1613.8,846.591 1616.11,768.188 1618.42,877.75 1620.73,732.426 1623.04,820.827 1625.34,1019.89 1627.65,776.384 1629.96,822.475 1632.27,909.977 1634.58,851.961 1636.88,1004.63 1639.19,752.475 1641.5,846.945 1643.81,925.179 1646.12,931.723 1648.42,890.16 1650.73,878.768 1653.04,749.028 1655.35,890.907 1657.65,885.454 1659.96,834.8 1662.27,779.577 1664.58,809.469 1666.89,880.834 1669.19,848.138 1671.5,980.6 1673.81,788.308 1676.12,893.327 1678.43,969.567 1680.73,813.081 1683.04,836.637 1685.35,1050.57 1687.66,1039.91 1689.97,856.362 1692.27,781.923 1694.58,932.926 1696.89,767.493 1699.2,953.51 1701.51,777.743 1703.81,773.222 1706.12,852.076 1708.43,874.216 1710.74,920.446 1713.04,958.154 1715.35,871.712 1717.66,862.53 1719.97,771.687 1722.28,849 1724.58,905.145 1726.89,1002.75 1729.2,881.8 1731.51,849.203 1733.82,891.14 1736.12,983.135 1738.43,964.883 1740.74,910.425 1743.05,715.512 1745.36,880.438 1747.66,730.487 1749.97,865.254 1752.28,789.15 1754.59,887.226 1756.9,928.889 1759.2,795.158 1761.51,917.634 1763.82,805.611 1766.13,1193.19 1768.43,680.787 1770.74,929.41 1773.05,828.262 1775.36,834.448 1777.67,855.562 1779.97,775.836 1782.28,793.934 1784.59,727.958 1786.9,790.816 1789.21,897.417 1791.51,922.802 1793.82,1038.66 1796.13,906.685 1798.44,1047.34 1800.75,924.917 1803.05,1019.46 1805.36,812.344 1807.67,801.985 1809.98,970.986 1812.28,968.279 1814.59,918.08 1816.9,923.372 1819.21,809.943 1821.52,888.995 1823.82,824.932 1826.13,969.797 1828.44,945.52 1830.75,1012.86 1833.06,864.877 1835.36,945.033 1837.67,821.576 1839.98,907.983 1842.29,862.189 1844.6,1224.32 1846.9,854.862 1849.21,979.732 1851.52,1100.64 1853.83,998.895 1856.14,859.214 1858.44,863.38 1860.75,1024.88 1863.06,774.523 1865.37,882.326 1867.67,936.905 1869.98,888.132 1872.29,822.017 1874.6,962.007 1876.91,877.763 1879.21,955.456 1881.52,887.509 1883.83,764.287 1886.14,791.933 1888.45,860.244 1890.75,951.01 1893.06,919.013 1895.37,919.424 1897.68,763.07 1899.99,807.47 1902.29,1072.34 1904.6,759.911 1906.91,1033.52 1909.22,684.623 1911.53,814.232 1913.83,809.141 1916.14,933.745 1918.45,953.422 1920.76,831.435 1923.06,892.797 1925.37,835.245 1927.68,760.389 1929.99,952.512 1932.3,830.631 1934.6,818.141 1936.91,631.595 1939.22,988.582 1941.53,690.819 1943.84,754.279 1946.14,848.132 1948.45,826.602 1950.76,852.976 1953.07,823.658 1955.38,950.321 1957.68,891.122 1959.99,774.952 1962.3,744.898 1964.61,954.066 1966.91,870.903 1969.22,801.341 1971.53,947.852 1973.84,885.427 1976.15,759.117 1978.45,953.154 1980.76,992.101 1983.07,956.735 1985.38,807.995 1987.69,909.79 1989.99,1012.42 1992.3,891.168 1994.61,833.796 1996.92,978.225 1999.23,763.085 2001.53,892.953 2003.84,855.558 2006.15,833.138 2008.46,995.777 2010.77,927.786 2013.07,748.13 2015.38,867.252 2017.69,1034.14 2020,990.18 2022.3,859.028 2024.61,836.776 2026.92,868.172 2029.23,926.863 2031.54,999.812 2033.84,914.209 2036.15,828.719 2038.46,833.622 2040.77,940.967 2043.08,700.406 2045.38,850.931 2047.69,857.58 2050,958.027 2052.31,937.358 2054.62,822.832 2056.92,890.846 2059.23,774.879 2061.54,1106.48 2063.85,1011.42 2066.16,1049.87 2068.46,970.371 2070.77,893.761 2073.08,956.618 2075.39,1013.53 2077.69,784.294 2080,977.064 2082.31,966.303 2084.62,909.972 2086.93,723.579 2089.23,874.517 2091.54,756.016 2093.85,1055.68 2096.16,899.111 2098.47,942.523 2100.77,876.737 2103.08,1104.53 2105.39,754.753 2107.7,882.533 2110.01,963.102 2112.31,892.916 2114.62,965.842 2116.93,895.974 2119.24,805.625 2121.55,917.36 2123.85,1125.91 2126.16,1001.61 2128.47,1117.93 2130.78,935.756 2133.08,896.446 2135.39,917.4 2137.7,901.753 2140.01,805.822 2142.32,763.869 2144.62,933.808 2146.93,867.583 2149.24,806.061 2151.55,817.493 2153.86,1024.67 2156.16,962.036 2158.47,832.075 2160.78,794.743 2163.09,925.205 2165.4,818.551 2167.7,1047.65 2170.01,922.619 2172.32,1069.18 2174.63,1150.76 2176.93,935.543 2179.24,863.993 2181.55,913.941 2183.86,919.333 2186.17,1099.04 2188.47,809.544 2190.78,1010.65 2193.09,858.574 2195.4,902.227 2197.71,866.74 2200.01,670.787 2202.32,858.923 2204.63,781.193 2206.94,947.302 2209.25,1060.43 2211.55,959.28 2213.86,973.231 2216.17,920.379 2218.48,896.576 2220.79,879.164 2223.09,877.006 2225.4,941.099 2227.71,887.566 2230.02,884.028 2232.32,702.148 2234.63,1007.85 2236.94,867.722 2239.25,922.57 2241.56,1048.97 2243.86,877.047 2246.17,942.32 2248.48,858.54 2250.79,955.875 2253.1,789.903 2255.4,838.565 2257.71,851.954 2260.02,879.207 2262.33,960.771 2264.64,1009.25 2266.94,808.724 2269.25,861.332 2271.56,746.114 2273.87,744.072 2276.18,981.98 2278.48,771.989 2280.79,606.301 2283.1,819.044 2285.41,844.618 2287.71,780.871 2290.02,987.537 2292.33,913.738 2294.64,806.715 2296.95,989.342 2299.25,938.419 2301.56,857.366 2303.87,872.037 2306.18,890.424 2308.49,731.571 2310.79,849.232 2313.1,839.341 2315.41,647.397 2317.72,735.981 2320.03,847.978 2322.33,841.903 2324.64,1001.77 2326.95,671.48 2329.26,750.337 2331.56,952.404 2333.87,871.544 2336.18,796.655 2338.49,855.823 2340.8,889.249 2343.1,952.292 2345.41,965.63 2347.72,692.635 2350.03,869.784 2352.34,941.116 2354.64,904.975 2356.95,870.744 2359.26,740.78 2361.57,731.209 2363.88,876.684 2366.18,756.677 2368.49,977.017 2370.8,830.968 2373.11,738.02 2375.42,956.938 2377.72,923.363 2380.03,968.596 2382.34,830.487 2384.65,839.218 2386.95,753.639 2389.26,784.006 2391.57,1091.48 2393.88,758.966 2396.19,1045.51 2398.49,897.355 2400.8,992.845 2403.11,1003.81 2405.42,763.764 2407.73,1010.7 2410.03,802.803 2412.34,706.743 2414.65,900.864 2416.96,1117.22 2419.27,955.281 2421.57,911.561 2423.88,1010.38 2426.19,1024.58 2428.5,899.33 2430.81,852.693 2433.11,831.38 2435.42,665.942 2437.73,851.734 2440.04,767.887 2442.34,883.279 2444.65,772.909 2446.96,796.429 2449.27,951.731 2451.58,872.375 2453.88,861.702 2456.19,935.922 2458.5,826.775 2460.81,811.874 2463.12,940.426 2465.42,850.585 2467.73,747.994 2470.04,802.686 2472.35,829.838 2474.66,986.067 2476.96,836.337 2479.27,870.068 2481.58,867.048 2483.89,880.975 2486.2,874.964 2488.5,1011.86 2490.81,1017.94 2493.12,1002.13 2495.43,860.233 2497.73,871.797 2500.04,753.662 2502.35,817.16 2504.66,896.885 2506.97,980.207 2509.27,966.582 2511.58,799.793 2513.89,749.106 2516.2,807.731 2518.51,960.435 2520.81,859.713 2523.12,926.358 2525.43,928.631 2527.74,838.057 2530.05,998.39 2532.35,830.743 2534.66,974.962 2536.97,678.884 2539.28,980.073 2541.58,790.095 2543.89,893.823 2546.2,860.876 2548.51,987.239 2550.82,811.225 2553.12,966.401 2555.43,952.038 2557.74,806.491 2560.05,942.859 2562.36,959.693 2564.66,862.237 2566.97,732.005 2569.28,621.95 2571.59,990.283 "></polyline>
<polyline clip-path="url(#clip792)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="265.984,618.18 268.292,416.929 270.6,482.211 272.908,503.353 275.216,441.188 277.524,400.063 279.832,385.399 282.139,287.105 284.447,331.303 286.755,355.574 289.063,571.206 291.371,317.395 293.679,423.051 295.987,208.361 298.295,453.503 300.603,470.517 302.911,415.168 305.219,612.458 307.527,318.203 309.834,553.887 312.142,405.403 314.45,408.566 316.758,507.432 319.066,416.339 321.374,192.636 323.682,543.107 325.99,204.475 328.298,472.129 330.606,414.228 332.914,429.837 335.221,360.787 337.529,343.322 339.837,351.123 342.145,386.852 344.453,444.618 346.761,210.202 349.069,470.905 351.377,498.745 353.685,686.55 355.993,271.595 358.301,576.343 360.608,442.573 362.916,371.772 365.224,506.552 367.532,392.76 369.84,405.091 372.148,592.541 374.456,441.077 376.764,248.708 379.072,485.581 381.38,408.895 383.688,561.779 385.996,569.507 388.303,219.013 390.611,442.218 392.919,484.187 395.227,249.513 397.535,525.777 399.843,324.969 402.151,392.315 404.459,503.624 406.767,370.512 409.075,398.234 411.383,422.752 413.69,506.124 415.998,251.757 418.306,603.984 420.614,405.861 422.922,394.775 425.23,481.12 427.538,505.308 429.846,344.807 432.154,464.547 434.462,476.07 436.77,328.659 439.077,328.056 441.385,288.183 443.693,413.561 446.001,391.741 448.309,536.267 450.617,314.657 452.925,234.751 455.233,511.369 457.541,364.529 459.849,391.497 462.157,375.909 464.465,723.585 466.772,399.524 469.08,318.112 471.388,310.576 473.696,237.839 476.004,466.81 478.312,454.79 480.62,526.256 482.928,322.006 485.236,425.558 487.544,476.444 489.852,362.216 492.159,530.205 494.467,281.856 496.775,300.757 499.083,410.528 501.391,626.196 503.699,404.477 506.007,406.344 508.315,416.023 510.623,343.865 512.931,552.978 515.239,518.35 517.546,401.495 519.854,580.222 522.162,471.58 524.47,277.191 526.778,265.403 529.086,542.283 531.394,458.994 533.702,338.91 536.01,340.209 538.318,326.76 540.626,344.833 542.933,354.461 545.241,386.64 547.549,242.998 549.857,415.868 552.165,519.736 554.473,427.876 556.781,256.535 559.089,289.415 561.397,326.552 563.705,465.58 566.013,323.637 568.321,295.167 570.628,199.281 572.936,454.376 575.244,245.431 577.552,360.028 579.86,342.663 582.168,626.195 584.476,423.503 586.784,282.791 589.092,336.87 591.4,268.851 593.708,387.949 596.015,326.466 598.323,419.916 600.631,513.552 602.939,427.047 605.247,435.208 607.555,304.496 609.863,284.503 612.171,358.548 614.479,414.442 616.787,401.752 619.095,264.483 621.402,398.965 623.71,543.452 626.018,281.366 628.326,262.138 630.634,291.806 632.942,366.478 635.25,526.552 637.558,452.019 639.866,460.672 642.174,495.505 644.482,548.54 646.79,346.245 649.097,396.438 651.405,224.27 653.713,476.078 656.021,431.752 658.329,382.607 660.637,309.333 662.945,465.635 665.253,408.761 667.561,262.387 669.869,335.713 672.177,409.83 674.484,272.398 676.792,276.832 679.1,448.929 681.408,384.765 683.716,546.33 686.024,464.41 688.332,378.892 690.64,381.581 692.948,234.403 695.256,377.754 697.564,312.038 699.871,271.019 702.179,444.632 704.487,399.51 706.795,396.496 709.103,329.521 711.411,445.699 713.719,326.515 716.027,408.831 718.335,529.192 720.643,321.384 722.951,417.834 725.259,486.455 727.566,447.587 729.874,489.542 732.182,308.747 734.49,266.793 736.798,298.678 739.106,253.421 741.414,272.99 743.722,565.538 746.03,532.393 748.338,288.338 750.646,265.209 752.953,299.292 755.261,283.037 757.569,486.287 759.877,482.308 762.185,435.832 764.493,427.702 766.801,220.269 769.109,282.232 771.417,298.599 773.725,311.822 776.033,419.156 778.34,408.369 780.648,404.939 782.956,349.983 785.264,433.969 787.572,477.611 789.88,478.015 792.188,413.331 794.496,262.631 796.804,498.068 799.112,189.747 801.42,341.511 803.728,400.697 806.035,428.903 808.343,402.054 810.651,258.648 812.959,553.423 815.267,510.878 817.575,275.411 819.883,348.691 822.191,356.789 824.499,367.615 826.807,486.537 829.115,276.983 831.422,456.983 833.73,420.544 836.038,258.873 838.346,368.457 840.654,329.683 842.962,433.668 845.27,391.826 847.578,465.299 849.886,363.473 852.194,238.757 854.502,657.236 856.809,408.427 859.117,326.74 861.425,408.447 863.733,455.484 866.041,509.538 868.349,423.57 870.657,442.454 872.965,518.48 875.273,339.81 877.581,405.936 879.889,227.688 882.197,527.06 884.504,423.967 886.812,399.349 889.12,484.294 891.428,313.295 893.736,312.859 896.044,398.758 898.352,503.701 900.66,376.556 902.968,507.725 905.276,291.338 907.584,344.66 909.891,449.545 912.199,362.159 914.507,325.917 916.815,429.302 919.123,438.442 921.431,382.236 923.739,445.607 926.047,377.915 928.355,425.699 930.663,611.895 932.971,432.03 935.278,453.027 937.586,264.07 939.894,467.312 942.202,419.238 944.51,315.594 946.818,596.137 949.126,411.316 951.434,162.979 953.742,397.353 956.05,125.68 958.358,352.042 960.665,194.541 962.973,482.807 965.281,465.738 967.589,517.651 969.897,418.645 972.205,533.44 974.513,650.153 976.821,515.019 979.129,384.818 981.437,386.2 983.745,476.815 986.053,375.771 988.36,502.077 990.668,510.316 992.976,488.377 995.284,502.116 997.592,321.651 999.9,478.097 1002.21,380.435 1004.52,198.917 1006.82,340.426 1009.13,394.445 1011.44,433.308 1013.75,336.924 1016.06,375.262 1018.36,462.262 1020.67,543.056 1022.98,477.209 1025.29,446.593 1027.59,367.379 1029.9,308.006 1032.21,509.211 1034.52,393.041 1036.83,210.339 1039.13,198.185 1041.44,385.44 1043.75,519.877 1046.06,501.994 1048.37,363.483 1050.67,390.641 1052.98,402.72 1055.29,661.618 1057.6,411.793 1059.91,280.777 1062.21,398.436 1064.52,304.636 1066.83,398.262 1069.14,259.778 1071.45,350.163 1073.75,383.426 1076.06,589.361 1078.37,487.62 1080.68,500.804 1082.98,470.622 1085.29,534.345 1087.6,348.013 1089.91,394.696 1092.22,484.906 1094.52,369.501 1096.83,457.907 1099.14,326.956 1101.45,498.765 1103.76,429.097 1106.06,510.731 1108.37,390.334 1110.68,417.412 1112.99,334.398 1115.3,408.595 1117.6,206.056 1119.91,381.466 1122.22,432.248 1124.53,363.369 1126.84,338.034 1129.14,291.904 1131.45,442.168 1133.76,264.091 1136.07,432.633 1138.37,322.284 1140.68,490.488 1142.99,265.132 1145.3,235.742 1147.61,424.143 1149.91,449.239 1152.22,480.002 1154.53,457.845 1156.84,439.83 1159.15,440.089 1161.45,377.212 1163.76,449.096 1166.07,493.715 1168.38,400.632 1170.69,296.1 1172.99,505.11 1175.3,391.404 1177.61,331.506 1179.92,403.742 1182.23,415.288 1184.53,437.694 1186.84,505.165 1189.15,426.823 1191.46,474.215 1193.76,169.989 1196.07,313.84 1198.38,393.572 1200.69,183.024 1203,302.241 1205.3,358.981 1207.61,483.835 1209.92,216.34 1212.23,360.357 1214.54,410.375 1216.84,490.647 1219.15,605.232 1221.46,312.335 1223.77,608.363 1226.08,612.001 1228.38,420.242 1230.69,346.322 1233,480.621 1235.31,381.465 1237.61,405.743 1239.92,341.727 1242.23,531.353 1244.54,322.388 1246.85,355.039 1249.15,294.44 1251.46,267.623 1253.77,417.657 1256.08,581.098 1258.39,433.323 1260.69,355.634 1263,395.495 1265.31,347.331 1267.62,339.225 1269.93,487.866 1272.23,297.885 1274.54,475.592 1276.85,378.765 1279.16,677.315 1281.47,602.07 1283.77,266.419 1286.08,287.582 1288.39,151.008 1290.7,248.971 1293,651.304 1295.31,430.048 1297.62,244.306 1299.93,213.344 1302.24,348.447 1304.54,320.775 1306.85,357.298 1309.16,463.031 1311.47,389.392 1313.78,556.211 1316.08,435.428 1318.39,349.689 1320.7,131.658 1323.01,493.57 1325.32,238.138 1327.62,425.688 1329.93,502.514 1332.24,416.961 1334.55,264.508 1336.86,203.437 1339.16,320.905 1341.47,577.15 1343.78,328.952 1346.09,544.08 1348.39,499.141 1350.7,303.523 1353.01,392.93 1355.32,495.294 1357.63,304.318 1359.93,365.576 1362.24,607.954 1364.55,531.694 1366.86,327.802 1369.17,407.168 1371.47,476.855 1373.78,325.032 1376.09,319.136 1378.4,377.665 1380.71,500.715 1383.01,413.801 1385.32,385.68 1387.63,300.75 1389.94,439.755 1392.24,364.064 1394.55,480.134 1396.86,450.46 1399.17,369.575 1401.48,465.967 1403.78,465.024 1406.09,335.268 1408.4,367.527 1410.71,417.7 1413.02,384.909 1415.32,430.136 1417.63,390.742 1419.94,331.586 1422.25,334.688 1424.56,351.145 1426.86,522.562 1429.17,611.75 1431.48,406.433 1433.79,243.671 1436.1,476.465 1438.4,409.54 1440.71,545.837 1443.02,474.127 1445.33,285.274 1447.63,502.158 1449.94,329.449 1452.25,517.106 1454.56,351.344 1456.87,220.333 1459.17,328.842 1461.48,466.116 1463.79,279.334 1466.1,412.213 1468.41,349.058 1470.71,306.037 1473.02,594.597 1475.33,463.853 1477.64,442.422 1479.95,426.417 1482.25,591.486 1484.56,331.556 1486.87,360.507 1489.18,436.14 1491.49,345.879 1493.79,317.66 1496.1,406.869 1498.41,407.023 1500.72,450.57 1503.02,135.073 1505.33,357.389 1507.64,444.123 1509.95,323.29 1512.26,570.884 1514.56,524.103 1516.87,352.122 1519.18,439.803 1521.49,415.926 1523.8,539.022 1526.1,501.833 1528.41,532.371 1530.72,450.254 1533.03,408.322 1535.34,279.689 1537.64,366.364 1539.95,479.41 1542.26,303.372 1544.57,395.963 1546.88,433.737 1549.18,355.888 1551.49,282.587 1553.8,603.035 1556.11,338.934 1558.41,362.823 1560.72,396.421 1563.03,274.589 1565.34,580.443 1567.65,499.69 1569.95,383.225 1572.26,317.586 1574.57,472.968 1576.88,380 1579.19,346.749 1581.49,322.044 1583.8,447.16 1586.11,424.095 1588.42,458.266 1590.73,510.488 1593.03,375.844 1595.34,417.541 1597.65,253.575 1599.96,297.418 1602.26,266.1 1604.57,560.924 1606.88,428.12 1609.19,336.732 1611.5,401.026 1613.8,103.287 1616.11,381.043 1618.42,317.284 1620.73,475.835 1623.04,145.897 1625.34,451.371 1627.65,571.51 1629.96,388.068 1632.27,410.625 1634.58,277.293 1636.88,469.65 1639.19,205.801 1641.5,585.486 1643.81,269.131 1646.12,301.739 1648.42,413.662 1650.73,369.723 1653.04,360.192 1655.35,404.514 1657.65,364.17 1659.96,380.052 1662.27,273.079 1664.58,464.367 1666.89,313.763 1669.19,522.433 1671.5,307.7 1673.81,526.547 1676.12,375.188 1678.43,511.176 1680.73,498.863 1683.04,432.261 1685.35,446.639 1687.66,368.596 1689.97,438.624 1692.27,554.448 1694.58,219.861 1696.89,459.004 1699.2,400.879 1701.51,270.64 1703.81,449.101 1706.12,391.105 1708.43,211.746 1710.74,476.323 1713.04,329.788 1715.35,349.175 1717.66,263.733 1719.97,246.933 1722.28,352.191 1724.58,328.958 1726.89,506.301 1729.2,335.893 1731.51,233.608 1733.82,358.005 1736.12,280.804 1738.43,340.438 1740.74,250.032 1743.05,588.455 1745.36,330.307 1747.66,297.796 1749.97,268.568 1752.28,544.244 1754.59,554.445 1756.9,316.458 1759.2,223.151 1761.51,430.125 1763.82,226.668 1766.13,345.085 1768.43,369.88 1770.74,406.458 1773.05,314.33 1775.36,510.773 1777.67,227.402 1779.97,515.932 1782.28,295.888 1784.59,185.014 1786.9,218.693 1789.21,264.016 1791.51,427.437 1793.82,287.989 1796.13,499.515 1798.44,434.595 1800.75,371.536 1803.05,443.354 1805.36,399.418 1807.67,193.789 1809.98,351.791 1812.28,429.447 1814.59,369.633 1816.9,505.136 1819.21,400.524 1821.52,396.405 1823.82,530.928 1826.13,408.509 1828.44,542.726 1830.75,387.059 1833.06,491.42 1835.36,575.531 1837.67,343.803 1839.98,244.711 1842.29,459.863 1844.6,500.074 1846.9,284.435 1849.21,619.06 1851.52,526.87 1853.83,423.582 1856.14,391.924 1858.44,324.525 1860.75,427.881 1863.06,427.184 1865.37,253.723 1867.67,465.372 1869.98,423.838 1872.29,306.386 1874.6,360.109 1876.91,193.442 1879.21,482.351 1881.52,510.295 1883.83,415.006 1886.14,341.367 1888.45,393.431 1890.75,379.337 1893.06,213.996 1895.37,408.065 1897.68,505.163 1899.99,360.007 1902.29,552.387 1904.6,354.198 1906.91,420.301 1909.22,420.032 1911.53,414.168 1913.83,472.552 1916.14,300.728 1918.45,423.029 1920.76,475.267 1923.06,405.973 1925.37,362.643 1927.68,433.976 1929.99,433.177 1932.3,677.214 1934.6,431.32 1936.91,481.399 1939.22,417.242 1941.53,433.947 1943.84,576.689 1946.14,454.868 1948.45,446.8 1950.76,295.765 1953.07,424.429 1955.38,454.752 1957.68,301.708 1959.99,288.005 1962.3,435.117 1964.61,426.283 1966.91,392.015 1969.22,249.385 1971.53,406.108 1973.84,337.387 1976.15,263.776 1978.45,473.043 1980.76,390.411 1983.07,190.06 1985.38,409.345 1987.69,408.566 1989.99,399.983 1992.3,410.288 1994.61,278.643 1996.92,482.424 1999.23,326.23 2001.53,392.723 2003.84,352.867 2006.15,531.179 2008.46,537.634 2010.77,478.26 2013.07,405.956 2015.38,235.5 2017.69,237.872 2020,356.405 2022.3,387.955 2024.61,583.14 2026.92,605.912 2029.23,153.626 2031.54,479.705 2033.84,223.977 2036.15,364.875 2038.46,433.693 2040.77,287.649 2043.08,395.312 2045.38,496.148 2047.69,199.093 2050,400.811 2052.31,384.896 2054.62,259.517 2056.92,407.659 2059.23,277.613 2061.54,382.576 2063.85,592.561 2066.16,371.444 2068.46,225.469 2070.77,335.997 2073.08,354.43 2075.39,520.384 2077.69,353.081 2080,469.817 2082.31,406.016 2084.62,468.433 2086.93,377.271 2089.23,366.622 2091.54,451.078 2093.85,271.754 2096.16,432.038 2098.47,381.427 2100.77,393.509 2103.08,397.146 2105.39,461.924 2107.7,381.551 2110.01,497.332 2112.31,575.045 2114.62,414.621 2116.93,446.6 2119.24,358.264 2121.55,376.685 2123.85,406.084 2126.16,434.396 2128.47,450.093 2130.78,425.398 2133.08,566.175 2135.39,336.951 2137.7,372.471 2140.01,435.943 2142.32,364.097 2144.62,335.1 2146.93,447.961 2149.24,450.246 2151.55,415.652 2153.86,444.457 2156.16,376.56 2158.47,96.8724 2160.78,325.546 2163.09,249.159 2165.4,415.455 2167.7,370.312 2170.01,376.469 2172.32,440.848 2174.63,377.743 2176.93,521.066 2179.24,397.928 2181.55,424.888 2183.86,539.876 2186.17,308.234 2188.47,337.279 2190.78,271.53 2193.09,391.45 2195.4,455.296 2197.71,358.044 2200.01,495.47 2202.32,396.702 2204.63,336.007 2206.94,449.014 2209.25,284.618 2211.55,430.004 2213.86,376.343 2216.17,436.801 2218.48,331.156 2220.79,462.779 2223.09,425.978 2225.4,318.076 2227.71,237.879 2230.02,210.674 2232.32,419.846 2234.63,213.935 2236.94,428.772 2239.25,626.948 2241.56,323.094 2243.86,300.822 2246.17,344.097 2248.48,468.575 2250.79,309.836 2253.1,258.164 2255.4,481.85 2257.71,544.125 2260.02,429.257 2262.33,503.441 2264.64,460.584 2266.94,446.552 2269.25,261.646 2271.56,262.076 2273.87,523.489 2276.18,506.304 2278.48,410.892 2280.79,347.063 2283.1,490.145 2285.41,456.08 2287.71,340.123 2290.02,520.101 2292.33,493.724 2294.64,310.973 2296.95,380.858 2299.25,399.971 2301.56,288.143 2303.87,213.336 2306.18,311.373 2308.49,334.442 2310.79,441.468 2313.1,555.918 2315.41,312.415 2317.72,336.631 2320.03,275.979 2322.33,206.341 2324.64,598.715 2326.95,399.385 2329.26,514.621 2331.56,367.747 2333.87,488.493 2336.18,590.501 2338.49,332.305 2340.8,358.387 2343.1,526.26 2345.41,562.811 2347.72,668.584 2350.03,444.86 2352.34,307.632 2354.64,360.648 2356.95,488.063 2359.26,451.195 2361.57,542.278 2363.88,496.894 2366.18,450.075 2368.49,621.105 2370.8,221.294 2373.11,560.142 2375.42,525.36 2377.72,248.893 2380.03,520.816 2382.34,161.236 2384.65,276.531 2386.95,186.219 2389.26,364.348 2391.57,385.789 2393.88,579.701 2396.19,390.441 2398.49,447.58 2400.8,248.772 2403.11,370.258 2405.42,572.746 2407.73,408.43 2410.03,366.825 2412.34,335.05 2414.65,379.47 2416.96,362.705 2419.27,307.159 2421.57,490.053 2423.88,261.91 2426.19,455.749 2428.5,420.522 2430.81,361.116 2433.11,409.556 2435.42,364.601 2437.73,341.081 2440.04,471.842 2442.34,267.649 2444.65,418.734 2446.96,445.65 2449.27,271.615 2451.58,431.072 2453.88,452.422 2456.19,435.615 2458.5,320.036 2460.81,458.752 2463.12,286.572 2465.42,526.382 2467.73,422.865 2470.04,443.881 2472.35,572.087 2474.66,230.401 2476.96,537.786 2479.27,392.028 2481.58,347.967 2483.89,679.25 2486.2,398.838 2488.5,537.129 2490.81,389.095 2493.12,479.69 2495.43,324.986 2497.73,298.165 2500.04,332.24 2502.35,377.941 2504.66,368.472 2506.97,176.001 2509.27,254.895 2511.58,348.193 2513.89,399.5 2516.2,467.916 2518.51,279.906 2520.81,516.293 2523.12,386.986 2525.43,456.961 2527.74,467.286 2530.05,330.765 2532.35,363.425 2534.66,256.927 2536.97,269.503 2539.28,515.236 2541.58,387.857 2543.89,315.236 2546.2,416.17 2548.51,406.069 2550.82,436.465 2553.12,468.429 2555.43,310.288 2557.74,496.079 2560.05,474.932 2562.36,410.503 2564.66,566.84 2566.97,422.468 2569.28,410.328 2571.59,646.596 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -2.29977   -4.39704    -5.99237    …  -5.38788   -4.97262  -5.15073
  0.545881   0.0736592   0.0832472     -0.336041  -2.12815  -1.54458
  2.1847     3.79435     3.16654        4.43306    4.83136   5.63985

[:, :, 2] =
 -0.892695  -4.35434  -6.32764  -6.58886  …  -4.41283  -5.67914  -5.67914
 -0.842015  -1.23505  -1.17432  -1.92998      1.3298    0.31834   0.31834
  1.1933     2.35495   4.2204    5.37763      5.56041   5.46753   5.46753

[:, :, 3] =
 -1.94441   -2.42046   -2.05738   -4.74344   …  -5.62388  -6.20763   -5.55827
  0.396319   0.376933   0.600206   0.481695     -0.37568  -0.621594  -1.20958
  5.3427     4.00919    4.48124    5.04504       3.30134   4.0552     3.47565

[:, :, 4] =
 -3.47062   -4.46872   -6.00114   -5.95883   …  -6.01229  -4.7737   -5.72008
 -0.382311  -0.763169  -0.233938   0.786961      1.3313    1.32492  -0.844148
  2.05143    3.3455     4.94307    7.08566       5.05168   5.31311   3.82591</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.038      1.01214
  0.0111823  0.999851
  4.99628    0.99456</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DynamicPPL</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">DynamicPPL.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.02 seconds
Compute duration  = 3.02 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

        x[1]   -5.0028    0.9868    0.0179   3033.2163   5428.4203    0.9999   ⋯
        x[2]    0.0052    1.0167    0.0187   2964.0120   4836.7585    1.0002   ⋯
        x[3]    4.9868    0.9991    0.0172   3393.4145   5006.8136    1.0004   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

        x[1]   -6.9604   -5.6642   -5.0089   -4.3429   -3.0986
        x[2]   -1.9887   -0.6729   -0.0026    0.6729    1.9886
        x[3]    3.0361    4.3101    4.9770    5.6655    6.9653
</span></pre>
</div>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.8 seconds
Compute duration  = 1.8 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

           x    0.5046    0.1882    0.0027   4772.0643   6120.9811    1.0002   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.1525    0.3641    0.5038    0.6438    0.8561
</span></pre>
</div>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.2 seconds
Compute duration  = 0.2 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold">  ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  ⋯

           x    0.0644    0.0331    0.0010   1153.7299        NaN    1.0007    ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.0653    0.0653    0.0653    0.0653    0.0653
</span></pre>
</div>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre>DomainError with Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}(-0.8004131422015529,1.0,0.0):
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] <span class="ansi-bold">#371</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [2] <span class="ansi-bold">check_args</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">utils.jl:89</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [3] <span class="ansi-bold">#Normal#370</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [4] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:36</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [5] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:42</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [6] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">compiler.jl:558</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [7] <span class="ansi-bold">demo</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">__model__</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">__varinfo__</span>::DynamicPPL.ThreadSafeVarInfo<span class="ansi-bright-black-fg">{VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}, Vector{Base.RefValue{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}</span>, <span class="ansi-bright-black-fg">__context__</span>::DefaultContext<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:457</span>
  [8] <span class="ansi-bold">_evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:913</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [9] <span class="ansi-bold">evaluate_threadsafe!!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">varinfo</span>::VarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}}, ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}</span>, <span class="ansi-bright-black-fg">context</span>::DefaultContext<span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:902</span>
 [10] <span class="ansi-bold">evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:832</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [11] <span class="ansi-bold">logdensity_at</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logdensityfunction.jl:183</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [12] <span class="ansi-bold">FixTail</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DifferentiationInterface/sPszY/src/utils/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">context.jl:169</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [13] <span class="ansi-bold">vector_mode_dual_eval!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::DifferentiationInterface.FixTail<span class="ansi-bright-black-fg">{typeof(DynamicPPL.logdensity_at), Tuple{Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DefaultContext}}</span>, <span class="ansi-bright-black-fg">cfg</span>::ForwardDiff.GradientConfig<span class="ansi-bright-black-fg">{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">ForwardDiff</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/UBbGT/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">apiutils.jl:24</span>
 [14] <span class="ansi-bold">vector_mode_gradient!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/UBbGT/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">gradient.jl:98</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [15] <span class="ansi-bold">gradient!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">result</span>::DiffResults.MutableDiffResult<span class="ansi-bright-black-fg">{1, Float64, Tuple{Vector{Float64}}}</span>, <span class="ansi-bright-black-fg">f</span>::DifferentiationInterface.FixTail<span class="ansi-bright-black-fg">{typeof(DynamicPPL.logdensity_at), Tuple{Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DefaultContext}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">cfg</span>::ForwardDiff.GradientConfig<span class="ansi-bright-black-fg">{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}</span>, ::Val<span class="ansi-bright-black-fg">{false}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">ForwardDiff</span> <span class="ansi-bright-black-fg">~/.julia/packages/ForwardDiff/UBbGT/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">gradient.jl:39</span>
 [16] <span class="ansi-bold">value_and_gradient</span><span class="ansi-bold">(</span>::typeof(DynamicPPL.logdensity_at), ::DifferentiationInterfaceForwardDiffExt.ForwardDiffGradientPrep<span class="ansi-bright-black-fg">{Tuple{typeof(DynamicPPL.logdensity_at), AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}, Vector{Float64}, Tuple{DifferentiationInterface.Constant{Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}}, DifferentiationInterface.Constant{VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}}, DifferentiationInterface.Constant{DefaultContext}}}, ForwardDiff.GradientConfig{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2, Vector{ForwardDiff.Dual{ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}, Float64, 2}}}, Tuple{Nothing, Nothing, Nothing}}</span>, ::AutoForwardDiff<span class="ansi-bright-black-fg">{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}</span>, ::Vector<span class="ansi-bright-black-fg">{Float64}</span>, ::DifferentiationInterface.Constant<span class="ansi-bright-black-fg">{Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}}</span>, ::DifferentiationInterface.Constant<span class="ansi-bright-black-fg">{VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}}</span>, ::DifferentiationInterface.Constant<span class="ansi-bright-black-fg">{DefaultContext}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-yellow-fg">DifferentiationInterfaceForwardDiffExt</span> <span class="ansi-bright-black-fg">~/.julia/packages/DifferentiationInterface/sPszY/ext/DifferentiationInterfaceForwardDiffExt/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">onearg.jl:417</span>
 [17] <span class="ansi-bold">logdensity_and_gradient</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::LogDensityFunction<span class="ansi-bright-black-fg">{Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logdensityfunction.jl:234</span>
 [18] <span class="ansi-bold">leapfrog_step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::LogDensityFunction<span class="ansi-bright-black-fg">{Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}</span>, <span class="ansi-bright-black-fg">x</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">p</span>::Vector<span class="ansi-bright-black-fg">{Float64}</span>, <span class="ansi-bright-black-fg">ϵ</span>::Int64, <span class="ansi-bright-black-fg">M</span>::UniformScaling<span class="ansi-bright-black-fg">{Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:305</span>
 [19] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model_wrapper</span>::AbstractMCMC.LogDensityModel<span class="ansi-bright-black-fg">{LogDensityFunction{Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}}</span>, <span class="ansi-bright-black-fg">sampler</span>::MALA<span class="ansi-bright-black-fg">{Int64, UniformScaling{Bool}}</span>, <span class="ansi-bright-black-fg">state</span>::MALAState<span class="ansi-bright-black-fg">{Vector{Float64}}</span>; <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:276</span>
 [20] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model_wrapper</span>::AbstractMCMC.LogDensityModel<span class="ansi-bright-black-fg">{LogDensityFunction{Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}}</span>, <span class="ansi-bright-black-fg">sampler</span>::MALA<span class="ansi-bright-black-fg">{Int64, UniformScaling{Bool}}</span>, <span class="ansi-bright-black-fg">state</span>::MALAState<span class="ansi-bright-black-fg">{Vector{Float64}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:258</span>
 [21] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler_wrapper</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">state</span>::Turing.Inference.TuringState<span class="ansi-bright-black-fg">{MALAState{Vector{Float64}}, Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DefaultContext}</span>; <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1gxqi/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">external_sampler.jl:161</span>
 [22] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler_wrapper</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">state</span>::Turing.Inference.TuringState<span class="ansi-bright-black-fg">{MALAState{Vector{Float64}}, Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DefaultContext}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1gxqi/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">external_sampler.jl:150</span>
 [23] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/F50rb/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:219</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [24] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/F50rb/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:16</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [25] <span class="ansi-bold">mcmcsample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">progress</span>::Bool, <span class="ansi-bright-black-fg">progressname</span>::String, <span class="ansi-bright-black-fg">callback</span>::Nothing, <span class="ansi-bright-black-fg">num_warmup</span>::Int64, <span class="ansi-bright-black-fg">discard_initial</span>::Int64, <span class="ansi-bright-black-fg">thinning</span>::Int64, <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/F50rb/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:144</span>
 [26] <span class="ansi-bold">sample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">resume_from</span>::Nothing, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{progress::Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:102</span>
 [27] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/nxcz4/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:92</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [28] <span class="ansi-bold">#sample#101</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1gxqi/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:29</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [29] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1gxqi/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:20</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [30] <span class="ansi-bold">#sample#100</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/1gxqi/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:17</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [31] top-level scope
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:459</span></pre>
</div>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.6 seconds
Compute duration  = 0.6 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.8866    0.6033    0.0279   295.4331    97.8220    1.0025     ⋯
           x   -0.0657    0.9425    0.0429   754.3506   319.8072    0.9999     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.1230    0.4215    0.7513    1.2141    2.3768
           x   -2.3008   -0.4389   -0.0235    0.3996    1.8354
</span></pre>
</div>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.93 seconds
Compute duration  = 2.93 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.0947    0.0000    0.0000        NaN        NaN       NaN     ⋯
           x   -1.1108    0.0000    0.0000        NaN        NaN       NaN     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.0947    0.0947    0.0947    0.0947    0.0947
           x   -1.1108   -1.1108   -1.1108   -1.1108   -1.1108
</span></pre>
</div>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/turinglang\.org\/docs\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../developers/inference/variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2018–2025 under the terms of the <a href="https://github.com/TuringLang/docs/blob/main/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>