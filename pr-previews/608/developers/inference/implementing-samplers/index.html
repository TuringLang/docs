<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Implementing Samplers – Turing.jl</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<link href="../../../developers/inference/variational-inference/index.html" rel="prev">
<link href="../../../assets/favicon.ico" rel="icon">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-dark-2fef5ea3f8957b3e4ecc936fc74692ca.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" class="quarto-color-scheme-extra" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-14dc5392180f5c4faa7436b3aeaea7e7.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../../site_libs/bootstrap/bootstrap-dark-c8f8ffa7f5fdcebfcbd390a6d0cab8fd.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<link href="../../../site_libs/bootstrap/bootstrap-14dc5392180f5c4faa7436b3aeaea7e7.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme-extra" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<style>
  a {
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }
</style>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../../theming/styles.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light"><script id="quarto-html-before-body" type="application/javascript">
    const toggleBodyColorMode = (bsSheetEl) => {
      const mode = bsSheetEl.getAttribute("data-mode");
      const bodyEl = window.document.querySelector("body");
      if (mode === "dark") {
        bodyEl.classList.add("quarto-dark");
        bodyEl.classList.remove("quarto-light");
      } else {
        bodyEl.classList.add("quarto-light");
        bodyEl.classList.remove("quarto-dark");
      }
    }
    const toggleBodyColorPrimary = () => {
      const bsSheetEl = window.document.querySelector("link#quarto-bootstrap:not([rel=disabled-stylesheet])");
      if (bsSheetEl) {
        toggleBodyColorMode(bsSheetEl);
      }
    }
    const setColorSchemeToggle = (alternate) => {
      const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
      for (let i=0; i < toggles.length; i++) {
        const toggle = toggles[i];
        if (toggle) {
          if (alternate) {
            toggle.classList.add("alternate");
          } else {
            toggle.classList.remove("alternate");
          }
        }
      }
    };
    const toggleColorMode = (alternate) => {
      // Switch the stylesheets
      const primaryStylesheets = window.document.querySelectorAll('link.quarto-color-scheme:not(.quarto-color-alternate)');
      const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
      manageTransitions('#quarto-margin-sidebar .nav-link', false);
      if (alternate) {
        // note: dark is layered on light, we don't disable primary!
        enableStylesheet(alternateStylesheets);
        for (const sheetNode of alternateStylesheets) {
          if (sheetNode.id === "quarto-bootstrap") {
            toggleBodyColorMode(sheetNode);
          }
        }
      } else {
        disableStylesheet(alternateStylesheets);
        enableStylesheet(primaryStylesheets)
        toggleBodyColorPrimary();
      }
      manageTransitions('#quarto-margin-sidebar .nav-link', true);
      // Switch the toggles
      setColorSchemeToggle(alternate)
      // Hack to workaround the fact that safari doesn't
      // properly recolor the scrollbar when toggling (#1455)
      if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
        manageTransitions("body", false);
        window.scrollTo(0, 1);
        setTimeout(() => {
          window.scrollTo(0, 0);
          manageTransitions("body", true);
        }, 40);
      }
    }
    const disableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        stylesheet.rel = 'disabled-stylesheet';
      }
    }
    const enableStylesheet = (stylesheets) => {
      for (let i=0; i < stylesheets.length; i++) {
        const stylesheet = stylesheets[i];
        if(stylesheet.rel !== 'stylesheet') { // for Chrome, which will still FOUC without this check
          stylesheet.rel = 'stylesheet';
        }
      }
    }
    const manageTransitions = (selector, allowTransitions) => {
      const els = window.document.querySelectorAll(selector);
      for (let i=0; i < els.length; i++) {
        const el = els[i];
        if (allowTransitions) {
          el.classList.remove('notransition');
        } else {
          el.classList.add('notransition');
        }
      }
    }
    const isFileUrl = () => {
      return window.location.protocol === 'file:';
    }
    const hasAlternateSentinel = () => {
      let styleSentinel = getColorSchemeSentinel();
      if (styleSentinel !== null) {
        return styleSentinel === "alternate";
      } else {
        return false;
      }
    }
    const setStyleSentinel = (alternate) => {
      const value = alternate ? "alternate" : "default";
      if (!isFileUrl()) {
        window.localStorage.setItem("quarto-color-scheme", value);
      } else {
        localAlternateSentinel = value;
      }
    }
    const getColorSchemeSentinel = () => {
      if (!isFileUrl()) {
        const storageValue = window.localStorage.getItem("quarto-color-scheme");
        return storageValue != null ? storageValue : localAlternateSentinel;
      } else {
        return localAlternateSentinel;
      }
    }
    const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
      const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
      const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
      let newTheme = '';
      if(authorPrefersDark) {
        newTheme = isAlternate ? baseTheme : alternateTheme;
      } else {
        newTheme = isAlternate ? alternateTheme : baseTheme;
      }
      const changeGiscusTheme = () => {
        // From: https://github.com/giscus/giscus/issues/336
        const sendMessage = (message) => {
          const iframe = document.querySelector('iframe.giscus-frame');
          if (!iframe) return;
          iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
        }
        sendMessage({
          setConfig: {
            theme: newTheme
          }
        });
      }
      const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
      if (isGiscussLoaded) {
        changeGiscusTheme();
      }
    };
    const authorPrefersDark = false;
    const darkModeDefault = authorPrefersDark;
      document.querySelector('link#quarto-text-highlighting-styles.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
      document.querySelector('link#quarto-bootstrap.quarto-color-scheme-extra').rel = 'disabled-stylesheet';
    let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
    // Dark / light mode switch
    window.quartoToggleColorScheme = () => {
      // Read the current dark / light value
      let toAlternate = !hasAlternateSentinel();
      toggleColorMode(toAlternate);
      setStyleSentinel(toAlternate);
      toggleGiscusIfUsed(toAlternate, darkModeDefault);
      window.dispatchEvent(new Event('resize'));
    };
    // Switch to dark mode if need be
    if (hasAlternateSentinel()) {
      toggleColorMode(true);
    } else {
      toggleColorMode(false);
    }
  </script>

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://turinglang.org/" class="navbar-brand navbar-brand-logo">
    <img src="../../../assets/images/turing-logo.svg" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="https://turinglang.org/">
    <span class="navbar-title">Turing.jl</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../getting-started/"> 
<span class="menu-text">Get Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../tutorials/coin-flipping/"> 
<span class="menu-text">Tutorials</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../faq/"> 
<span class="menu-text">FAQ</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/library/"> 
<span class="menu-text">Libraries</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/news/"> 
<span class="menu-text">News</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://turinglang.org/team/"> 
<span class="menu-text">Team</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-v0.39" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">v0.39</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-v0.39">    
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/changelog.html">
 <span class="dropdown-text">Changelog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://turinglang.org/docs/versions.html">
 <span class="dropdown-text">All Versions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools tools-wide">
    <a href="https://x.com/TuringLang" title="Turing Twitter" class="quarto-navigation-tool px-1" aria-label="Turing Twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://github.com/TuringLang/Turing.jl" title="Turing GitHub" class="quarto-navigation-tool px-1" aria-label="Turing GitHub"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/variational-inference/index.html">Inference in Detail</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../getting-started/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../core-functionality/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Core Functionality</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false">
 <span class="menu-text">User Guide</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/automatic-differentiation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Automatic Differentiation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/custom-distribution/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Custom Distributions</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/probability-interface/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Querying Model Probabilities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/modifying-logprob/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Modifying the Log Probability</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/tracking-extra-quantities/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tracking Extra Quantities</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/mode-estimation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mode Estimation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/performance-tips/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Performance Tips</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/sampler-visualisation/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sampler Visualization</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/dynamichmc/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using DynamicHMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/external-samplers/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Using External Samplers</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../usage/troubleshooting/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Troubleshooting</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Tutorials</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/coin-flipping/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Introduction: Coin Flipping</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-neural-networks/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Neural Networks</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/hidden-markov-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Hidden Markov Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-linear-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/infinite-mixture-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Infinite Mixture Models</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-poisson-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Poisson Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/multinomial-logistic-regression/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Multinomial Logistic Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-differential-equations/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Differential Equations</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/probabilistic-pca/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probabilistic PCA</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/bayesian-time-series-analysis/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bayesian Time Series Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-processes-introduction/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Processes: Introduction</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../tutorials/gaussian-process-latent-variable-models/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gaussian Process Latent Variable Models</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Developers</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contributing/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Contributing</span></a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL’s Compiler</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/model-manual/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Manually Defining a Model</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-compiler/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation I: Compiler</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/minituring-contexts/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">A Mini Turing Implementation II: Contexts</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/compiler/design-overview/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Turing Compiler Design (Outdated)</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false">
 <span class="menu-text">DynamicPPL Contexts</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/contexts/submodel-condition/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Conditioning and fixing in submodels</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false">
 <span class="menu-text">Variable Transformations</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/distributions/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Distributions and the Jacobian</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/bijectors/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Bijectors in MCMC</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/transforms/dynamicppl/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variable transformations in DynamicPPL</span></a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true">
 <span class="menu-text">Inference in Detail</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth2 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/variational-inference/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variational Inference</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../developers/inference/implementing-samplers/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Implementing Samplers</span></a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of Contents</h2>
   
  <ul>
  <li><a href="#quick-overview-of-mala" id="toc-quick-overview-of-mala" class="nav-link active" data-scroll-target="#quick-overview-of-mala">Quick overview of MALA</a></li>
  <li><a href="#what-we-need-from-a-model-logdensityproblems.jl" id="toc-what-we-need-from-a-model-logdensityproblems.jl" class="nav-link" data-scroll-target="#what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: LogDensityProblems.jl</a></li>
  <li><a href="#implementing-mala-in-abstractmcmc.jl" id="toc-implementing-mala-in-abstractmcmc.jl" class="nav-link" data-scroll-target="#implementing-mala-in-abstractmcmc.jl">Implementing MALA in AbstractMCMC.jl</a></li>
  <li><a href="#using-our-sampler-with-turing.jl" id="toc-using-our-sampler-with-turing.jl" class="nav-link" data-scroll-target="#using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</a>
  <ul class="collapse">
  <li><a href="#models-with-constrained-parameters" id="toc-models-with-constrained-parameters" class="nav-link" data-scroll-target="#models-with-constrained-parameters">Models with constrained parameters</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">


<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../developers/contributing/index.html">Developers</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/variational-inference/index.html">Inference in Detail</a></li><li class="breadcrumb-item"><a href="../../../developers/inference/implementing-samplers/index.html">Implementing Samplers</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Implementing Samplers</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this tutorial, we’ll go through step-by-step how to implement a “simple” sampler in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> in such a way that it can be easily applied to Turing.jl models.</p>
<p>In particular, we’re going to implement a version of <strong>Metropolis-adjusted Langevin (MALA)</strong>.</p>
<p>Note that we will implement this sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> framework, completely “ignoring” Turing.jl until the very end of the tutorial, at which point we’ll use a single line of code to make the resulting sampler available to Turing.jl. This is to really drive home the point that one can implement samplers in a way that is accessible to all of Turing.jl’s users without having to use Turing.jl yourself.</p>
<section id="quick-overview-of-mala" class="level2">
<h2 class="anchored" data-anchor-id="quick-overview-of-mala">Quick overview of MALA</h2>
<p>We can view MALA as a single step of the leapfrog intergrator with resampling of momentum <span class="math inline">\(p\)</span> at every step.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To make that statement a bit more concrete, we first define the <em>extended</em> target <span class="math inline">\(\bar{\gamma}(x, p)\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\log \bar{\gamma}(x, p) \propto \log \gamma(x) + \log \gamma_{\mathcal{N}(0, M)}(p)
\end{equation*}\]</span></p>
<p>where <span class="math inline">\(\gamma_{\mathcal{N}(0, M)}\)</span> denotes the density for a zero-centered Gaussian with covariance matrix <span class="math inline">\(M\)</span>. We then consider targeting this joint distribution over both <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> as follows. First we define the map</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  L_{\epsilon}: \quad &amp; \mathbb{R}^d \times \mathbb{R}^d \to \mathbb{R}^d \times \mathbb{R}^d \\
  &amp; (x, p) \mapsto (\tilde{x}, \tilde{p}) := L_{\epsilon}(x, p)
\end{split}
\end{equation*}\]</span></p>
<p>as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p_{1 / 2} &amp;:= p + \frac{\epsilon}{2} \nabla \log \gamma(x) \\
  \tilde{x} &amp;:= x + \epsilon M^{-1} p_{1 /2 } \\
  p_1 &amp;:= p_{1 / 2} + \frac{\epsilon}{2} \nabla \log \gamma(\tilde{x}) \\
  \tilde{p} &amp;:= - p_1
\end{split}
\end{equation*}\]</span></p>
<p>This might be familiar for some readers as a single step of the Leapfrog integrator. We then define the MALA kernel as follows: given the current iterate <span class="math inline">\(x_i\)</span>, we sample the next iterate <span class="math inline">\(x_{i + 1}\)</span> as</p>
<p><span class="math display">\[\begin{equation*}
\begin{split}
  p &amp;\sim \mathcal{N}(0, M) \\
  (\tilde{x}, \tilde{p}) &amp;:= L_{\epsilon}(x_i, p) \\
  \alpha &amp;:= \min \left\{ 1, \frac{\bar{\gamma}(\tilde{x}, \tilde{p})}{\bar{\gamma}(x_i, p)} \right\} \\
  x_{i + 1} &amp;:=
  \begin{cases}
    \tilde{x} \quad &amp; \text{ with prob. } \alpha \\
    x_i       \quad &amp; \text{ with prob. } 1 - \alpha
  \end{cases}
\end{split}
\end{equation*}\]</span></p>
<p>i.e.&nbsp;we accept the proposal <span class="math inline">\(\tilde{x}\)</span> with probability <span class="math inline">\(\alpha\)</span> and reject it, thus sticking with our current iterate, with probability <span class="math inline">\(1 - \alpha\)</span>.</p>
</section>
<section id="what-we-need-from-a-model-logdensityproblems.jl" class="level2">
<h2 class="anchored" data-anchor-id="what-we-need-from-a-model-logdensityproblems.jl">What we need from a model: <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a></h2>
<p>There are a few things we need from the “target” / “model” / density that we want to sample from:</p>
<ol type="1">
<li>We need access to log-density <em>evaluations</em> <span class="math inline">\(\log \gamma(x)\)</span> so we can compute the acceptance ratio involving <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>We need access to log-density <em>gradients</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span> so we can compute the Leapfrog steps <span class="math inline">\(L_{\epsilon}(x, p)\)</span>.</li>
<li>We also need access to the “size” of the model so we can determine the size of <span class="math inline">\(M\)</span>.</li>
</ol>
<p>Luckily for us, there is a package called <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> which provides an interface for <em>exactly</em> this!</p>
<p>To demonstrate how one can implement the “<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface”<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> we will use a simple Gaussian model as an example:</p>
<div id="4" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblems</span>: LogDensityProblems;</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's define some type that represents the model.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> IsotropicNormalModel{M<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"mean of the isotropic Gaussian"</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    mean<span class="op">::</span><span class="dt">M</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Specifies what input length the model expects.</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">dimension</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> <span class="fu">length</span>(model.mean)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Implementation of the log-density evaluation of the model.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x<span class="op">::</span><span class="dt">AbstractVector{&lt;:Real}</span>)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span> <span class="fu">sum</span>(abs2, x <span class="op">.-</span> model.mean) <span class="op">/</span> <span class="fl">2</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This gives us all of the properties we want for our MALA sampler with the exception of the computation of the <em>gradient</em> <span class="math inline">\(\nabla \log \gamma(x)\)</span>. There is the method <code>LogDensityProblems.logdensity_and_gradient</code> which should return a 2-tuple where the first entry is the evaluation of the logdensity <span class="math inline">\(\log \gamma(x)\)</span> and the second entry is the gradient <span class="math inline">\(\nabla \log \gamma(x)\)</span>.</p>
<p>There are two ways to “implement” this method: 1) we implement it by hand, which is feasible in the case of our <code>IsotropicNormalModel</code>, or b) we defer the implementation of this to a automatic differentiation backend.</p>
<p>To implement it by hand we can simply do</p>
<div id="6" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl that first-order, i.e. gradient information, is available.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{1}</span>()</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Implement `logdensity_and_gradient`.</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>, x)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    logγ_x <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="op">-</span>x <span class="op">.*</span> (x <span class="op">-</span> model.mean)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> logγ_x, ∇logγ_x</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s just try it out:</p>
<div id="8" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the problem.</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> <span class="fu">IsotropicNormalModel</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.])</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create some example input that we can test on.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>x_example <span class="op">=</span> <span class="fu">randn</span>(LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate!</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-24.09155412938653</code></pre>
</div>
</div>
<p>To defer it to an automatic differentiation backend, we can do</p>
<div id="10" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tell LogDensityProblems.jl we only have access to 0-th order information.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">capabilities</span>(model<span class="op">::</span><span class="dt">IsotropicNormalModel</span>) <span class="op">=</span> LogDensityProblems.<span class="fu">LogDensityOrder</span><span class="dt">{0}</span>()</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use `LogDensityProblemsAD`'s `ADgradient` in combination with some AD backend to implement `logdensity_and_gradient`.</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LogDensityProblemsAD</span>, <span class="bu">ADTypes</span>, <span class="bu">ForwardDiff</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>model_with_grad <span class="op">=</span> <span class="fu">ADgradient</span>(<span class="fu">AutoForwardDiff</span>(), model)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>LogDensityProblems.<span class="fu">logdensity</span>(model_with_grad, x_example)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-24.09155412938653</code></pre>
</div>
</div>
<p>We’ll continue with the second approach in this tutorial since this is typically what one does in practice, because there are better hobbies to spend time on than deriving gradients by hand.</p>
<p>At this point, one might wonder how we’re going to tie this back to Turing.jl in the end. Effectively, when working with inference methods that only require log-density evaluations and / or higher-order information of the log-density, Turing.jl actually converts the user-provided <code>Model</code> into an object implementing the above methods for <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>. As a result, most samplers provided by Turing.jl are actually implemented to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, enabling their use both <em>within</em> Turing.jl and <em>outside</em> of Turing.jl! Morever, there exists similar conversions for Stan through BridgeStan and Stan<a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a>, which means that a sampler supporting the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface can easily be used on both Turing.jl <em>and</em> Stan models (in addition to user-provided models, as our <code>IsotropicNormalModel</code> above)!</p>
<p>Anyways, let’s move on to actually implementing the sampler.</p>
</section>
<section id="implementing-mala-in-abstractmcmc.jl" class="level2">
<h2 class="anchored" data-anchor-id="implementing-mala-in-abstractmcmc.jl">Implementing MALA in <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a></h2>
<p>Now that we’ve established that a model implementing the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface provides us with all the information we need from <span class="math inline">\(\log \gamma(x)\)</span>, we can address the question: given an object that implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, how can we define a sampler for it?</p>
<p>We’re going to do this by making our sampler a sub-type of <code>AbstractMCMC.AbstractSampler</code> in addition to implementing a few methods from <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>. Why? Because it gets us <em>a lot</em> of functionality for free, as we will see later.</p>
<p>Moreover, <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> provides a very natural interface for MCMC algorithms.</p>
<p>First, we’ll define our <code>MALA</code> type</p>
<div id="12" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">AbstractMCMC</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALA{T,A} <span class="op">&lt;:</span><span class="dt"> AbstractMCMC.AbstractSampler</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"stepsize used in the leapfrog step"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    ϵ_init<span class="op">::</span><span class="dt">T</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"covariance matrix used for the momentum"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    M_init<span class="op">::</span><span class="dt">A</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Notice how we’ve added the suffix <code>_init</code> to both the stepsize and the covariance matrix. We’ve done this because a <code>AbstractMCMC.AbstractSampler</code> should be <em>immutable</em>. Of course there might be many scenarios where we want to allow something like the stepsize and / or the covariance matrix to vary between iterations, e.g.&nbsp;during the burn-in / adaptation phase of the sampling process we might want to adjust the parameters using statistics computed from these initial iterations. But information which can change between iterations <em>should not go in the sampler itself</em>! Instead, this information should go in the sampler <em>state</em>.</p>
<p>The sampler state should at the very least contain all the necessary information to perform the next MCMC iteration, but usually contains further information, e.g.&nbsp;quantities and statistics useful for evaluating whether the sampler has converged.</p>
<p>We will use the following sampler state for our <code>MALA</code> sampler:</p>
<div id="14" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALAState{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This might seem overly redundant: we’re defining a type <code>MALAState</code> and it only contains a simple vector of reals. In this particular case we indeed could have dropped this and simply used a <code>AbstractVector{&lt;:Real}</code> as our sampler state, but typically, as we will see later, one wants to include other quantities in the sampler state. For example, if we also wanted to adapt the parameters of our <code>MALA</code>, e.g.&nbsp;alter the stepsize depending on acceptance rates, in which case we should also put <code>ϵ</code> in the state, but for now we’ll keep things simple.</p>
<p>Moreover, we also want a <em>sample</em> type, which is a type meant for “public consumption”, i.e.&nbsp;the end-user. This is generally going to contain a subset of the information present in the state. But in such a simple scenario as this, we similarly only have a <code>AbstractVector{&lt;:Real}</code>:</p>
<div id="16" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> MALASample{A<span class="op">&lt;:</span><span class="dt">AbstractVector{&lt;:Real}</span>}</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"current position"</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    x<span class="op">::</span><span class="dt">A</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We currently have three things:</p>
<ol type="1">
<li>A <code>AbstractMCMC.AbstractSampler</code> implementation called <code>MALA</code>.</li>
<li>A state <code>MALAState</code> for our sampler <code>MALA</code>.</li>
<li>A sample <code>MALASample</code> for our sampler <code>MALA</code>.</li>
</ol>
<p>That means that we’re ready to implement the only thing that really matters: <code>AbstractMCMC.step</code>.</p>
<p><code>AbstractMCMC.step</code> defines the MCMC iteration of our <code>MALA</code> given the current <code>MALAState</code>. Specifically, the signature of the function is as follows:</p>
<div id="18" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The RNG to ensure reproducibility.</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The model that defines our target.</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.AbstractModel</span>,</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The sampler for which we're taking a `step`.</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">AbstractMCMC.AbstractSampler</span>,</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The current sampler `state`.</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    state;</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Additional keyword arguments that we may or may not need.</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Moreover, there is a specific <code>AbstractMCMC.AbstractModel</code> which is used to indicate that the model that is provided implements the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface: <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Since, as we discussed earlier, in our case we’re indeed going to work with types that support the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface, we’ll define <code>AbstractMCMC.step</code> for such a <code>AbstractMCMC.LogDensityModel</code>.</p>
<p>Note that <code>AbstractMCMC.LogDensityModel</code> has no other purpose; it has a single field called <code>logdensity</code>, and it does nothing else. But by wrapping the model in <code>AbstractMCMC.LogDensityModel</code>, it allows samplers that want to work with <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> to define their <code>AbstractMCMC.step</code> on this type without running into method ambiguities.</p>
<p>All in all, that means that the signature for our <code>AbstractMCMC.step</code> is going to be the following:</p>
<div id="20" class="cell" data-execution_count="0">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># `LogDensityModel` so we know we're working with LogDensityProblems.jl model.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    model<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler.</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Our sampler state.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Great! Now let’s actually implement the full <code>AbstractMCMC.step</code> for our <code>MALA</code>.</p>
<p>Let’s remind ourselves what we’re going to do:</p>
<ol type="1">
<li>Sample a new momentum <span class="math inline">\(p\)</span>.</li>
<li>Compute the log-density of the extended target <span class="math inline">\(\log \bar{\gamma}(x, p)\)</span>.</li>
<li>Take a single leapfrog step <span class="math inline">\((\tilde{x}, \tilde{p}) = L_{\epsilon}(x, p)\)</span>.</li>
<li>Accept or reject the proposed <span class="math inline">\((\tilde{x}, \tilde{p})\)</span>.</li>
</ol>
<p>All in all, this results in the following:</p>
<div id="22" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>: Random</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Distributions</span>  <span class="co"># so we get the `MvNormal`</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    sampler<span class="op">::</span><span class="dt">MALA</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    state<span class="op">::</span><span class="dt">MALAState</span>;</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the wrapped model which implements LogDensityProblems.jl.</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just extract the sampler parameters to make our lives easier.</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ϵ <span class="op">=</span> sampler.ϵ_init</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    M <span class="op">=</span> sampler.M_init</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract the current parameters.</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> state.x</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample the momentum.</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    p_dist <span class="op">=</span> <span class="fu">MvNormal</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)), M)</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="fu">rand</span>(rng, p_dist)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Propose using a single leapfrog step.</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    x̃, p̃ <span class="op">=</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Accept or reject proposal.</span></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    logp <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    logp̃ <span class="op">=</span> LogDensityProblems.<span class="fu">logdensity</span>(model, x̃) <span class="op">+</span> <span class="fu">logpdf</span>(p_dist, p̃)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    logα <span class="op">=</span> logp̃ <span class="op">-</span> logp</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    state_new <span class="op">=</span> <span class="cf">if</span> <span class="fu">log</span>(<span class="fu">rand</span>(rng)) <span class="op">&lt;</span> logα</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Accept.</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x̃)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Reject.</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">MALAState</span>(x)</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">end</span></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Return the "sample" and the sampler state.</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(state_new.x), state_new</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fairly straight-forward.</p>
<p>Of course, we haven’t defined the <code>leapfrog_step</code> method yet, so let’s do that:</p>
<div id="24" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">leapfrog_step</span>(model, x, p, ϵ, M)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p` using "position" `x`.</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    p1 <span class="op">=</span> p <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update the "position" `x` using momentum `p1`.</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    x̃ <span class="op">=</span> x <span class="op">+</span> ϵ <span class="op">.*</span> (M <span class="op">\</span> p1)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update momentum `p1` using position `x̃`</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    ∇logγ_x̃ <span class="op">=</span> <span class="fu">last</span>(LogDensityProblems.<span class="fu">logdensity_and_gradient</span>(model, x̃))</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    p2 <span class="op">=</span> p1 <span class="op">+</span> (ϵ <span class="op">/</span> <span class="fl">2</span>) <span class="op">.*</span> ∇logγ_x̃</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flip momentum `p2`.</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    p̃ <span class="op">=</span> <span class="op">-</span>p2</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x̃, p̃</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>leapfrog_step (generic function with 1 method)</code></pre>
</div>
</div>
<p>With all of this, we’re technically ready to sample!</p>
<div id="26" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Random</span>, <span class="bu">LinearAlgebra</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>rng <span class="op">=</span> <span class="bu">Random</span>.<span class="fu">default_rng</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>sampler <span class="op">=</span> <span class="fu">MALA</span>(<span class="fl">1</span>, I)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>state <span class="op">=</span> <span class="fu">MALAState</span>(<span class="fu">zeros</span>(LogDensityProblems.<span class="fu">dimension</span>(model)))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>x_next, state_next <span class="op">=</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    rng,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    AbstractMCMC.<span class="fu">LogDensityModel</span>(model),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    state</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>(MALASample{Vector{Float64}}([0.0, 0.0, 0.0]), MALAState{Vector{Float64}}([0.0, 0.0, 0.0]))</code></pre>
</div>
</div>
<p>Great, it works!</p>
<p>And I promised we would get quite some functionality for free if we implemented <code>AbstractMCMC.step</code>, and so we can now simply call <code>sample</code> to perform standard MCMC sampling:</p>
<div id="28" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform 1000 iterations with our `MALA` sampler.</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; initial_state<span class="op">=</span>state, progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate into a matrix.</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000 Matrix{Float64}:
 -1.63911  -3.05682  -4.33512  -4.34332  …  -4.26306   -4.26306   -4.56813
 -2.33216  -3.014    -2.28757  -1.51738      0.362041   0.362041  -0.487183
  2.12003   3.5737    3.16031   4.81583      6.47158    6.47158    5.74741</code></pre>
</div>
</div>
<div id="30" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the marginal means and standard deviations.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -4.9771      1.00361
  0.00919367  0.99412
  5.0031      0.991621</code></pre>
</div>
</div>
<p>Let’s visualize the samples</p>
<div id="32" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StatsPlots</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">transpose</span>(samples_matrix[<span class="op">:</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">:</span><span class="kw">end</span>]), alpha<span class="op">=</span><span class="fl">0.5</span>, legend<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<!--?xml version="1.0" encoding="utf-8"?-->
<svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" width="672" height="480" viewbox="0 0 2688 1920">
<defs>
  <clippath id="clip190">
    <rect x="0" y="0" width="2688" height="1920"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip190)" d="M0 1920 L2688 1920 L2688 0 L0 0  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip191">
    <rect x="537" y="0" width="1883" height="1883"></rect>
  </clippath>
</defs>
<path clip-path="url(#clip190)" d="M151.747 1800.78 L2640.76 1800.78 L2640.76 47.2441 L151.747 47.2441  Z" fill="#ffffff" fill-rule="evenodd" fill-opacity="1"></path>
<defs>
  <clippath id="clip192">
    <rect x="151" y="47" width="2490" height="1755"></rect>
  </clippath>
</defs>
<polyline clip-path="url(#clip192)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="219.84,1800.78 219.84,47.2441 "></polyline>
<polyline clip-path="url(#clip192)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="807.458,1800.78 807.458,47.2441 "></polyline>
<polyline clip-path="url(#clip192)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1395.08,1800.78 1395.08,47.2441 "></polyline>
<polyline clip-path="url(#clip192)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="1982.69,1800.78 1982.69,47.2441 "></polyline>
<polyline clip-path="url(#clip192)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="2570.31,1800.78 2570.31,47.2441 "></polyline>
<polyline clip-path="url(#clip192)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1538.46 2640.76,1538.46 "></polyline>
<polyline clip-path="url(#clip192)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,1233.05 2640.76,1233.05 "></polyline>
<polyline clip-path="url(#clip192)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,927.636 2640.76,927.636 "></polyline>
<polyline clip-path="url(#clip192)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,622.222 2640.76,622.222 "></polyline>
<polyline clip-path="url(#clip192)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:2; stroke-opacity:0.1; fill:none" points="151.747,316.809 2640.76,316.809 "></polyline>
<polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 2640.76,1800.78 "></polyline>
<polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="219.84,1800.78 219.84,1781.88 "></polyline>
<polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="807.458,1800.78 807.458,1781.88 "></polyline>
<polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1395.08,1800.78 1395.08,1781.88 "></polyline>
<polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="1982.69,1800.78 1982.69,1781.88 "></polyline>
<polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="2570.31,1800.78 2570.31,1781.88 "></polyline>
<path clip-path="url(#clip190)" d="M219.84 1834 Q216.229 1834 214.4 1837.57 Q212.595 1841.11 212.595 1848.24 Q212.595 1855.34 214.4 1858.91 Q216.229 1862.45 219.84 1862.45 Q223.474 1862.45 225.28 1858.91 Q227.108 1855.34 227.108 1848.24 Q227.108 1841.11 225.28 1837.57 Q223.474 1834 219.84 1834 M219.84 1830.3 Q225.65 1830.3 228.706 1834.9 Q231.784 1839.49 231.784 1848.24 Q231.784 1856.96 228.706 1861.57 Q225.65 1866.15 219.84 1866.15 Q214.03 1866.15 210.951 1861.57 Q207.896 1856.96 207.896 1848.24 Q207.896 1839.49 210.951 1834.9 Q214.03 1830.3 219.84 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M771.15 1861.55 L787.47 1861.55 L787.47 1865.48 L765.525 1865.48 L765.525 1861.55 Q768.187 1858.79 772.771 1854.16 Q777.377 1849.51 778.558 1848.17 Q780.803 1845.65 781.683 1843.91 Q782.585 1842.15 782.585 1840.46 Q782.585 1837.71 780.641 1835.97 Q778.72 1834.23 775.618 1834.23 Q773.419 1834.23 770.965 1835 Q768.535 1835.76 765.757 1837.31 L765.757 1832.59 Q768.581 1831.46 771.035 1830.88 Q773.488 1830.3 775.525 1830.3 Q780.896 1830.3 784.09 1832.98 Q787.285 1835.67 787.285 1840.16 Q787.285 1842.29 786.474 1844.21 Q785.687 1846.11 783.581 1848.7 Q783.002 1849.37 779.9 1852.59 Q776.798 1855.78 771.15 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M797.331 1830.92 L815.687 1830.92 L815.687 1834.86 L801.613 1834.86 L801.613 1843.33 Q802.632 1842.98 803.65 1842.82 Q804.669 1842.64 805.687 1842.64 Q811.474 1842.64 814.854 1845.81 Q818.233 1848.98 818.233 1854.4 Q818.233 1859.97 814.761 1863.08 Q811.289 1866.15 804.97 1866.15 Q802.794 1866.15 800.525 1865.78 Q798.28 1865.41 795.872 1864.67 L795.872 1859.97 Q797.956 1861.11 800.178 1861.66 Q802.4 1862.22 804.877 1862.22 Q808.882 1862.22 811.22 1860.11 Q813.558 1858.01 813.558 1854.4 Q813.558 1850.78 811.22 1848.68 Q808.882 1846.57 804.877 1846.57 Q803.002 1846.57 801.127 1846.99 Q799.275 1847.4 797.331 1848.28 L797.331 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M837.446 1834 Q833.835 1834 832.007 1837.57 Q830.201 1841.11 830.201 1848.24 Q830.201 1855.34 832.007 1858.91 Q833.835 1862.45 837.446 1862.45 Q841.081 1862.45 842.886 1858.91 Q844.715 1855.34 844.715 1848.24 Q844.715 1841.11 842.886 1837.57 Q841.081 1834 837.446 1834 M837.446 1830.3 Q843.256 1830.3 846.312 1834.9 Q849.391 1839.49 849.391 1848.24 Q849.391 1856.96 846.312 1861.57 Q843.256 1866.15 837.446 1866.15 Q831.636 1866.15 828.557 1861.57 Q825.502 1856.96 825.502 1848.24 Q825.502 1839.49 828.557 1834.9 Q831.636 1830.3 837.446 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M1354.69 1830.92 L1373.05 1830.92 L1373.05 1834.86 L1358.98 1834.86 L1358.98 1843.33 Q1360 1842.98 1361.01 1842.82 Q1362.03 1842.64 1363.05 1842.64 Q1368.84 1842.64 1372.22 1845.81 Q1375.6 1848.98 1375.6 1854.4 Q1375.6 1859.97 1372.12 1863.08 Q1368.65 1866.15 1362.33 1866.15 Q1360.16 1866.15 1357.89 1865.78 Q1355.64 1865.41 1353.24 1864.67 L1353.24 1859.97 Q1355.32 1861.11 1357.54 1861.66 Q1359.76 1862.22 1362.24 1862.22 Q1366.25 1862.22 1368.58 1860.11 Q1370.92 1858.01 1370.92 1854.4 Q1370.92 1850.78 1368.58 1848.68 Q1366.25 1846.57 1362.24 1846.57 Q1360.37 1846.57 1358.49 1846.99 Q1356.64 1847.4 1354.69 1848.28 L1354.69 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M1394.81 1834 Q1391.2 1834 1389.37 1837.57 Q1387.56 1841.11 1387.56 1848.24 Q1387.56 1855.34 1389.37 1858.91 Q1391.2 1862.45 1394.81 1862.45 Q1398.44 1862.45 1400.25 1858.91 Q1402.08 1855.34 1402.08 1848.24 Q1402.08 1841.11 1400.25 1837.57 Q1398.44 1834 1394.81 1834 M1394.81 1830.3 Q1400.62 1830.3 1403.68 1834.9 Q1406.75 1839.49 1406.75 1848.24 Q1406.75 1856.96 1403.68 1861.57 Q1400.62 1866.15 1394.81 1866.15 Q1389 1866.15 1385.92 1861.57 Q1382.87 1856.96 1382.87 1848.24 Q1382.87 1839.49 1385.92 1834.9 Q1389 1830.3 1394.81 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M1424.97 1834 Q1421.36 1834 1419.53 1837.57 Q1417.73 1841.11 1417.73 1848.24 Q1417.73 1855.34 1419.53 1858.91 Q1421.36 1862.45 1424.97 1862.45 Q1428.61 1862.45 1430.41 1858.91 Q1432.24 1855.34 1432.24 1848.24 Q1432.24 1841.11 1430.41 1837.57 Q1428.61 1834 1424.97 1834 M1424.97 1830.3 Q1430.78 1830.3 1433.84 1834.9 Q1436.92 1839.49 1436.92 1848.24 Q1436.92 1856.96 1433.84 1861.57 Q1430.78 1866.15 1424.97 1866.15 Q1419.16 1866.15 1416.08 1861.57 Q1413.03 1856.96 1413.03 1848.24 Q1413.03 1839.49 1416.08 1834.9 Q1419.16 1830.3 1424.97 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M1940.97 1830.92 L1963.19 1830.92 L1963.19 1832.91 L1950.65 1865.48 L1945.76 1865.48 L1957.57 1834.86 L1940.97 1834.86 L1940.97 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M1972.36 1830.92 L1990.71 1830.92 L1990.71 1834.86 L1976.64 1834.86 L1976.64 1843.33 Q1977.66 1842.98 1978.68 1842.82 Q1979.7 1842.64 1980.72 1842.64 Q1986.5 1842.64 1989.88 1845.81 Q1993.26 1848.98 1993.26 1854.4 Q1993.26 1859.97 1989.79 1863.08 Q1986.32 1866.15 1980 1866.15 Q1977.82 1866.15 1975.55 1865.78 Q1973.31 1865.41 1970.9 1864.67 L1970.9 1859.97 Q1972.98 1861.11 1975.21 1861.66 Q1977.43 1862.22 1979.9 1862.22 Q1983.91 1862.22 1986.25 1860.11 Q1988.59 1858.01 1988.59 1854.4 Q1988.59 1850.78 1986.25 1848.68 Q1983.91 1846.57 1979.9 1846.57 Q1978.03 1846.57 1976.15 1846.99 Q1974.3 1847.4 1972.36 1848.28 L1972.36 1830.92 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M2012.47 1834 Q2008.86 1834 2007.03 1837.57 Q2005.23 1841.11 2005.23 1848.24 Q2005.23 1855.34 2007.03 1858.91 Q2008.86 1862.45 2012.47 1862.45 Q2016.11 1862.45 2017.91 1858.91 Q2019.74 1855.34 2019.74 1848.24 Q2019.74 1841.11 2017.91 1837.57 Q2016.11 1834 2012.47 1834 M2012.47 1830.3 Q2018.28 1830.3 2021.34 1834.9 Q2024.42 1839.49 2024.42 1848.24 Q2024.42 1856.96 2021.34 1861.57 Q2018.28 1866.15 2012.47 1866.15 Q2006.66 1866.15 2003.59 1861.57 Q2000.53 1856.96 2000.53 1848.24 Q2000.53 1839.49 2003.59 1834.9 Q2006.66 1830.3 2012.47 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M2514.84 1861.55 L2522.48 1861.55 L2522.48 1835.18 L2514.17 1836.85 L2514.17 1832.59 L2522.43 1830.92 L2527.11 1830.92 L2527.11 1861.55 L2534.75 1861.55 L2534.75 1865.48 L2514.84 1865.48 L2514.84 1861.55 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M2554.19 1834 Q2550.58 1834 2548.75 1837.57 Q2546.94 1841.11 2546.94 1848.24 Q2546.94 1855.34 2548.75 1858.91 Q2550.58 1862.45 2554.19 1862.45 Q2557.82 1862.45 2559.63 1858.91 Q2561.46 1855.34 2561.46 1848.24 Q2561.46 1841.11 2559.63 1837.57 Q2557.82 1834 2554.19 1834 M2554.19 1830.3 Q2560 1830.3 2563.06 1834.9 Q2566.13 1839.49 2566.13 1848.24 Q2566.13 1856.96 2563.06 1861.57 Q2560 1866.15 2554.19 1866.15 Q2548.38 1866.15 2545.3 1861.57 Q2542.25 1856.96 2542.25 1848.24 Q2542.25 1839.49 2545.3 1834.9 Q2548.38 1830.3 2554.19 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M2584.35 1834 Q2580.74 1834 2578.91 1837.57 Q2577.11 1841.11 2577.11 1848.24 Q2577.11 1855.34 2578.91 1858.91 Q2580.74 1862.45 2584.35 1862.45 Q2587.99 1862.45 2589.79 1858.91 Q2591.62 1855.34 2591.62 1848.24 Q2591.62 1841.11 2589.79 1837.57 Q2587.99 1834 2584.35 1834 M2584.35 1830.3 Q2590.16 1830.3 2593.22 1834.9 Q2596.3 1839.49 2596.3 1848.24 Q2596.3 1856.96 2593.22 1861.57 Q2590.16 1866.15 2584.35 1866.15 Q2578.54 1866.15 2575.46 1861.57 Q2572.41 1856.96 2572.41 1848.24 Q2572.41 1839.49 2575.46 1834.9 Q2578.54 1830.3 2584.35 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M2614.51 1834 Q2610.9 1834 2609.07 1837.57 Q2607.27 1841.11 2607.27 1848.24 Q2607.27 1855.34 2609.07 1858.91 Q2610.9 1862.45 2614.51 1862.45 Q2618.15 1862.45 2619.95 1858.91 Q2621.78 1855.34 2621.78 1848.24 Q2621.78 1841.11 2619.95 1837.57 Q2618.15 1834 2614.51 1834 M2614.51 1830.3 Q2620.32 1830.3 2623.38 1834.9 Q2626.46 1839.49 2626.46 1848.24 Q2626.46 1856.96 2623.38 1861.57 Q2620.32 1866.15 2614.51 1866.15 Q2608.7 1866.15 2605.62 1861.57 Q2602.57 1856.96 2602.57 1848.24 Q2602.57 1839.49 2605.62 1834.9 Q2608.7 1830.3 2614.51 1830.3 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1800.78 151.747,47.2441 "></polyline>
<polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1538.46 170.644,1538.46 "></polyline>
<polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,1233.05 170.644,1233.05 "></polyline>
<polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,927.636 170.644,927.636 "></polyline>
<polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,622.222 170.644,622.222 "></polyline>
<polyline clip-path="url(#clip190)" style="stroke:#000000; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:1; fill:none" points="151.747,316.809 170.644,316.809 "></polyline>
<path clip-path="url(#clip190)" d="M49.5521 1538.91 L79.2279 1538.91 L79.2279 1542.85 L49.5521 1542.85 L49.5521 1538.91 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M99.8991 1536.6 Q96.7509 1536.6 94.8991 1538.75 Q93.0704 1540.9 93.0704 1544.65 Q93.0704 1548.38 94.8991 1550.56 Q96.7509 1552.71 99.8991 1552.71 Q103.047 1552.71 104.876 1550.56 Q106.728 1548.38 106.728 1544.65 Q106.728 1540.9 104.876 1538.75 Q103.047 1536.6 99.8991 1536.6 M109.181 1521.95 L109.181 1526.21 Q107.422 1525.37 105.617 1524.93 Q103.834 1524.49 102.075 1524.49 Q97.4454 1524.49 94.9917 1527.62 Q92.5612 1530.74 92.2139 1537.06 Q93.5797 1535.05 95.6398 1533.98 Q97.7 1532.9 100.177 1532.9 Q105.385 1532.9 108.394 1536.07 Q111.427 1539.21 111.427 1544.65 Q111.427 1549.98 108.279 1553.2 Q105.131 1556.41 99.8991 1556.41 Q93.9037 1556.41 90.7325 1551.83 Q87.5612 1547.22 87.5612 1538.5 Q87.5612 1530.3 91.45 1525.44 Q95.3389 1520.56 101.89 1520.56 Q103.649 1520.56 105.431 1520.9 Q107.237 1521.25 109.181 1521.95 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M50.3623 1233.5 L80.0381 1233.5 L80.0381 1237.44 L50.3623 1237.44 L50.3623 1233.5 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M104.297 1231.69 Q107.654 1232.41 109.529 1234.68 Q111.427 1236.95 111.427 1240.28 Q111.427 1245.4 107.908 1248.2 Q104.39 1251 97.9083 1251 Q95.7324 1251 93.4176 1250.56 Q91.126 1250.14 88.6723 1249.29 L88.6723 1244.77 Q90.6167 1245.91 92.9315 1246.49 Q95.2463 1247.07 97.7695 1247.07 Q102.168 1247.07 104.459 1245.33 Q106.774 1243.59 106.774 1240.28 Q106.774 1237.23 104.621 1235.51 Q102.492 1233.78 98.6722 1233.78 L94.6445 1233.78 L94.6445 1229.94 L98.8574 1229.94 Q102.306 1229.94 104.135 1228.57 Q105.964 1227.18 105.964 1224.59 Q105.964 1221.93 104.066 1220.51 Q102.191 1219.08 98.6722 1219.08 Q96.7509 1219.08 94.5519 1219.5 Q92.3528 1219.91 89.7139 1220.79 L89.7139 1216.63 Q92.376 1215.88 94.6908 1215.51 Q97.0287 1215.14 99.0889 1215.14 Q104.413 1215.14 107.515 1217.57 Q110.617 1219.98 110.617 1224.1 Q110.617 1226.97 108.973 1228.96 Q107.33 1230.93 104.297 1231.69 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M99.4824 913.434 Q95.8713 913.434 94.0426 916.999 Q92.2371 920.541 92.2371 927.67 Q92.2371 934.777 94.0426 938.342 Q95.8713 941.883 99.4824 941.883 Q103.117 941.883 104.922 938.342 Q106.751 934.777 106.751 927.67 Q106.751 920.541 104.922 916.999 Q103.117 913.434 99.4824 913.434 M99.4824 909.731 Q105.293 909.731 108.348 914.337 Q111.427 918.92 111.427 927.67 Q111.427 936.397 108.348 941.004 Q105.293 945.587 99.4824 945.587 Q93.6723 945.587 90.5936 941.004 Q87.538 936.397 87.538 927.67 Q87.538 918.92 90.5936 914.337 Q93.6723 909.731 99.4824 909.731 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M104.297 620.868 Q107.654 621.586 109.529 623.854 Q111.427 626.123 111.427 629.456 Q111.427 634.572 107.908 637.373 Q104.39 640.174 97.9083 640.174 Q95.7324 640.174 93.4176 639.734 Q91.126 639.317 88.6723 638.461 L88.6723 633.947 Q90.6167 635.081 92.9315 635.66 Q95.2463 636.239 97.7695 636.239 Q102.168 636.239 104.459 634.502 Q106.774 632.766 106.774 629.456 Q106.774 626.401 104.621 624.688 Q102.492 622.952 98.6722 622.952 L94.6445 622.952 L94.6445 619.109 L98.8574 619.109 Q102.306 619.109 104.135 617.743 Q105.964 616.354 105.964 613.762 Q105.964 611.1 104.066 609.688 Q102.191 608.253 98.6722 608.253 Q96.7509 608.253 94.5519 608.669 Q92.3528 609.086 89.7139 609.966 L89.7139 605.799 Q92.376 605.058 94.6908 604.688 Q97.0287 604.317 99.0889 604.317 Q104.413 604.317 107.515 606.748 Q110.617 609.155 110.617 613.276 Q110.617 616.146 108.973 618.137 Q107.33 620.104 104.297 620.868 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><path clip-path="url(#clip190)" d="M99.8991 314.946 Q96.7509 314.946 94.8991 317.098 Q93.0704 319.251 93.0704 323.001 Q93.0704 326.728 94.8991 328.904 Q96.7509 331.057 99.8991 331.057 Q103.047 331.057 104.876 328.904 Q106.728 326.728 106.728 323.001 Q106.728 319.251 104.876 317.098 Q103.047 314.946 99.8991 314.946 M109.181 300.293 L109.181 304.552 Q107.422 303.719 105.617 303.279 Q103.834 302.839 102.075 302.839 Q97.4454 302.839 94.9917 305.964 Q92.5612 309.089 92.2139 315.409 Q93.5797 313.395 95.6398 312.33 Q97.7 311.242 100.177 311.242 Q105.385 311.242 108.394 314.413 Q111.427 317.561 111.427 323.001 Q111.427 328.325 108.279 331.543 Q105.131 334.76 99.8991 334.76 Q93.9037 334.76 90.7325 330.177 Q87.5612 325.571 87.5612 316.844 Q87.5612 308.649 91.45 303.788 Q95.3389 298.904 101.89 298.904 Q103.649 298.904 105.431 299.251 Q107.237 299.599 109.181 300.293 Z" fill="#000000" fill-rule="nonzero" fill-opacity="1"></path><polyline clip-path="url(#clip192)" style="stroke:#009af9; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1094.5 224.541,1440.2 226.891,1331.12 229.242,1435.42 231.592,1558.2 233.943,1441.98 236.293,1532.7 238.644,1490.26 240.994,1537.97 243.345,1483.52 245.695,1435.91 248.046,1439.67 250.396,1323.03 252.747,1493.12 255.097,1364.35 257.448,1415.28 259.798,1438.68 262.148,1468.48 264.499,1476.39 266.849,1668.42 269.2,1300.41 271.55,1522.04 273.901,1330.98 276.251,1327.41 278.602,1369.17 280.952,1343.88 283.303,1394.38 285.653,1431.53 288.004,1228.73 290.354,1231.88 292.705,1439.39 295.055,1751.15 297.406,1244.83 299.756,1331.13 302.107,1589.57 304.457,1394.3 306.807,1577.71 309.158,1426.27 311.508,1442.08 313.859,1410.04 316.209,1519.29 318.56,1439.96 320.91,1493.03 323.261,1390.29 325.611,1524.63 327.962,1399.04 330.312,1345.38 332.663,1297.04 335.013,1402.41 337.364,1586.34 339.714,1409.16 342.065,1320 344.415,1622.47 346.765,1327.95 349.116,1428.66 351.466,1429.93 353.817,1443.16 356.167,1228.12 358.518,1508.01 360.868,1517.89 363.219,1468.37 365.569,1570.48 367.92,1453.69 370.27,1433.2 372.621,1596.04 374.971,1491.81 377.322,1410.35 379.672,1248.6 382.023,1411.19 384.373,1372.77 386.724,1467.44 389.074,1510.06 391.424,1373.51 393.775,1352.48 396.125,1569.49 398.476,1453.44 400.826,1412.58 403.177,1575.52 405.527,1420.41 407.878,1594.47 410.228,1482.91 412.579,1566.6 414.929,1450.95 417.28,1414.79 419.63,1530.12 421.981,1455.28 424.331,1532.85 426.682,1424.99 429.032,1338.31 431.382,1378.71 433.733,1490.76 436.083,1392.45 438.434,1473.52 440.784,1654.35 443.135,1441.24 445.485,1430.08 447.836,1363.93 450.186,1464.44 452.537,1434.25 454.887,1225.91 457.238,1383.93 459.588,1611.71 461.939,1278.09 464.289,1450.1 466.64,1560.42 468.99,1418.48 471.341,1472.86 473.691,1508.4 476.041,1350.37 478.392,1432.17 480.742,1602.67 483.093,1471.22 485.443,1404.45 487.794,1352.9 490.144,1357.85 492.495,1331.62 494.845,1488.29 497.196,1605.59 499.546,1528.39 501.897,1382.19 504.247,1384.68 506.598,1526.11 508.948,1322.17 511.299,1583.15 513.649,1302.1 515.999,1304.58 518.35,1589.26 520.7,1540.87 523.051,1563.33 525.401,1468.56 527.752,1550.88 530.102,1494.69 532.453,1506.75 534.803,1463.71 537.154,1493.54 539.504,1476.67 541.855,1349.61 544.205,1324.89 546.556,1386.46 548.906,1341.53 551.257,1653.72 553.607,1616.13 555.958,1491 558.308,1372.55 560.658,1351.72 563.009,1418.76 565.359,1396.86 567.71,1365.01 570.06,1385.43 572.411,1320.95 574.761,1449.23 577.112,1557.65 579.462,1619.77 581.813,1369.09 584.163,1425.08 586.514,1394.31 588.864,1514.74 591.215,1479.69 593.565,1345.4 595.916,1444.16 598.266,1280.41 600.616,1491.78 602.967,1297 605.317,1503.53 607.668,1482.51 610.018,1473.38 612.369,1487.99 614.719,1345.78 617.07,1565.05 619.42,1553.03 621.771,1463.09 624.121,1438.46 626.472,1405.09 628.822,1421.55 631.173,1320.13 633.523,1497.33 635.874,1378.93 638.224,1372.21 640.575,1389.13 642.925,1405.84 645.275,1447.6 647.626,1388.68 649.976,1485.42 652.327,1290.9 654.677,1469.05 657.028,1503.49 659.378,1272.05 661.729,1292.06 664.079,1366.95 666.43,1647.23 668.78,1634.03 671.131,1569.59 673.481,1485.24 675.832,1436.06 678.182,1425.36 680.533,1338.38 682.883,1460.85 685.233,1444.8 687.584,1563.81 689.934,1516.93 692.285,1351.73 694.635,1295.97 696.986,1462.76 699.336,1500.84 701.687,1214.06 704.037,1518.98 706.388,1400.99 708.738,1392.92 711.089,1334.8 713.439,1469.67 715.79,1412.16 718.14,1344.66 720.491,1282.82 722.841,1483.79 725.192,1534.9 727.542,1391.32 729.892,1491.35 732.243,1529.5 734.593,1387.51 736.944,1463.36 739.294,1541.92 741.645,1436.06 743.995,1524.08 746.346,1315.49 748.696,1538.96 751.047,1329.43 753.397,1391.91 755.748,1448.38 758.098,1506.57 760.449,1295.88 762.799,1420.44 765.15,1306.39 767.5,1445.9 769.85,1417.91 772.201,1344.37 774.551,1220.67 776.902,1448.97 779.252,1467.24 781.603,1392.88 783.953,1452.63 786.304,1385.52 788.654,1537.41 791.005,1473.98 793.355,1289.12 795.706,1457.51 798.056,1534.28 800.407,1334.83 802.757,1471.05 805.108,1500.82 807.458,1339.96 809.809,1302.03 812.159,1403.37 814.509,1389.79 816.86,1518.43 819.21,1395.54 821.561,1278.92 823.911,1514.53 826.262,1387.13 828.612,1548.15 830.963,1372.55 833.313,1375.16 835.664,1348.41 838.014,1289.54 840.365,1373.98 842.715,1396.68 845.066,1398.66 847.416,1573.35 849.767,1346.69 852.117,1343.61 854.467,1634.07 856.818,1462.11 859.168,1384.22 861.519,1381.72 863.869,1559.53 866.22,1367.75 868.57,1442.84 870.921,1424.45 873.271,1397.37 875.622,1374.39 877.972,1315.12 880.323,1381.05 882.673,1614.26 885.024,1372.81 887.374,1524.85 889.725,1499.18 892.075,1406.59 894.426,1577.65 896.776,1539.25 899.126,1668.27 901.477,1482.88 903.827,1468.43 906.178,1360.21 908.528,1438.12 910.879,1700.81 913.229,1325.22 915.58,1364.63 917.93,1364.79 920.281,1392.81 922.631,1570.05 924.982,1467.29 927.332,1513.36 929.683,1522.43 932.033,1361.12 934.384,1489.61 936.734,1426.24 939.084,1322.22 941.435,1316.59 943.785,1523.98 946.136,1440.21 948.486,1410.62 950.837,1447.56 953.187,1511.07 955.538,1524.92 957.888,1445.12 960.239,1145.83 962.589,1227.6 964.94,1352.78 967.29,1591.74 969.641,1568 971.991,1381.01 974.342,1478.28 976.692,1489.08 979.043,1319.15 981.393,1384.99 983.743,1508.48 986.094,1597.18 988.444,1415.48 990.795,1551.8 993.145,1488.53 995.496,1497.87 997.846,1547.75 1000.2,1299.16 1002.55,1306.17 1004.9,1475.26 1007.25,1424.39 1009.6,1375.36 1011.95,1439.79 1014.3,1511.08 1016.65,1435.67 1019,1424.1 1021.35,1420.66 1023.7,1506.57 1026.05,1298.65 1028.4,1411.08 1030.75,1504.95 1033.1,1538.08 1035.45,1462.91 1037.8,1525.74 1040.15,1466.6 1042.51,1586.63 1044.86,1376.69 1047.21,1332.65 1049.56,1478.64 1051.91,1467.5 1054.26,1652.51 1056.61,1475.37 1058.96,1416.17 1061.31,1366.98 1063.66,1283.11 1066.01,1425.71 1068.36,1404.03 1070.71,1536.22 1073.06,1362.92 1075.41,1410.81 1077.76,1245.92 1080.11,1254.4 1082.46,1451.72 1084.81,1331.76 1087.16,1422.89 1089.51,1621.06 1091.87,1646.96 1094.22,1502.82 1096.57,1412.93 1098.92,1200.2 1101.27,1389.33 1103.62,1313.27 1105.97,1564.61 1108.32,1498.93 1110.67,1570.19 1113.02,1544.74 1115.37,1501.14 1117.72,1337.24 1120.07,1430.36 1122.42,1614.27 1124.77,1378.47 1127.12,1439.21 1129.47,1552.16 1131.82,1613.52 1134.17,1565.92 1136.52,1331.56 1138.87,1437.83 1141.23,1491.04 1143.58,1581.77 1145.93,1329.59 1148.28,1526.76 1150.63,1225.19 1152.98,1372.08 1155.33,1189.98 1157.68,1579.89 1160.03,1452.27 1162.38,1586.02 1164.73,1442.95 1167.08,1495.33 1169.43,1392.4 1171.78,1474.69 1174.13,1638.97 1176.48,1699.1 1178.83,1284.45 1181.18,1222.19 1183.53,1374.62 1185.88,1434.99 1188.23,1344.43 1190.59,1159.46 1192.94,1440.09 1195.29,1480.5 1197.64,1497.88 1199.99,1428.26 1202.34,1433.3 1204.69,1444.07 1207.04,1463.75 1209.39,1487.46 1211.74,1267.02 1214.09,1273.71 1216.44,1470.72 1218.79,1520.05 1221.14,1624.34 1223.49,1554.76 1225.84,1385.62 1228.19,1411.53 1230.54,1405.7 1232.89,1620.49 1235.24,1425.07 1237.59,1480.76 1239.94,1449.95 1242.3,1277.3 1244.65,1474.66 1247,1343.16 1249.35,1608.41 1251.7,1388.95 1254.05,1352.33 1256.4,1272.81 1258.75,1384.75 1261.1,1414.65 1263.45,1347.58 1265.8,1668.11 1268.15,1384.63 1270.5,1423.45 1272.85,1284.14 1275.2,1276.7 1277.55,1363.1 1279.9,1329.17 1282.25,1348.84 1284.6,1620.76 1286.95,1478.75 1289.3,1548.88 1291.66,1592 1294.01,1410.63 1296.36,1363.51 1298.71,1371.44 1301.06,1401.83 1303.41,1411.79 1305.76,1517.31 1308.11,1522.63 1310.46,1583.3 1312.81,1542.08 1315.16,1413.06 1317.51,1472.38 1319.86,1424.73 1322.21,1530.86 1324.56,1315.21 1326.91,1251.57 1329.26,1485.22 1331.61,1447.6 1333.96,1478.16 1336.31,1478.04 1338.66,1315.43 1341.02,1549.69 1343.37,1449.24 1345.72,1296.81 1348.07,1412.77 1350.42,1422.15 1352.77,1436.78 1355.12,1545.33 1357.47,1222.63 1359.82,1501.55 1362.17,1394.21 1364.52,1648.1 1366.87,1413.41 1369.22,1437.29 1371.57,1493.39 1373.92,1407.65 1376.27,1433.39 1378.62,1380.35 1380.97,1419.33 1383.32,1417.82 1385.67,1500.94 1388.02,1452.52 1390.38,1355.37 1392.73,1461.63 1395.08,1252.74 1397.43,1389.44 1399.78,1557.58 1402.13,1353.81 1404.48,1649.88 1406.83,1598.86 1409.18,1172.23 1411.53,1282.19 1413.88,1424.48 1416.23,1590.13 1418.58,1453.64 1420.93,1356.18 1423.28,1585.9 1425.63,1490.19 1427.98,1440.33 1430.33,1382.99 1432.68,1391.18 1435.03,1437.29 1437.38,1346.86 1439.74,1541.42 1442.09,1504.88 1444.44,1344.38 1446.79,1446.18 1449.14,1482.61 1451.49,1438.69 1453.84,1343.61 1456.19,1401.15 1458.54,1444.09 1460.89,1483.39 1463.24,1354.2 1465.59,1477.98 1467.94,1388.97 1470.29,1518.39 1472.64,1586.14 1474.99,1308.25 1477.34,1416.13 1479.69,1332.87 1482.04,1241.6 1484.39,1407.25 1486.74,1458.57 1489.1,1439.42 1491.45,1260.88 1493.8,1407.94 1496.15,1545.4 1498.5,1438.01 1500.85,1583.89 1503.2,1529.7 1505.55,1428.37 1507.9,1335.55 1510.25,1465.7 1512.6,1349.72 1514.95,1174.72 1517.3,1351.32 1519.65,1342.1 1522,1426.74 1524.35,1420.55 1526.7,1446.35 1529.05,1422.4 1531.4,1320.26 1533.75,1414.56 1536.1,1363.1 1538.45,1429.63 1540.81,1393.53 1543.16,1348.47 1545.51,1523.78 1547.86,1351.98 1550.21,1353.5 1552.56,1453.07 1554.91,1432.3 1557.26,1391.37 1559.61,1438.77 1561.96,1271.21 1564.31,1610.39 1566.66,1490.62 1569.01,1397.81 1571.36,1368.34 1573.71,1499.01 1576.06,1401.49 1578.41,1563.19 1580.76,1518.41 1583.11,1381.06 1585.46,1438.74 1587.81,1215.46 1590.17,1543.62 1592.52,1389.18 1594.87,1425.93 1597.22,1409.71 1599.57,1320.82 1601.92,1444.83 1604.27,1511.58 1606.62,1397.63 1608.97,1427.1 1611.32,1470.31 1613.67,1575.41 1616.02,1487.25 1618.37,1560.39 1620.72,1451.06 1623.07,1363.34 1625.42,1520.57 1627.77,1571.95 1630.12,1347.88 1632.47,1440.44 1634.82,1579.26 1637.17,1610.03 1639.53,1444.18 1641.88,1270.3 1644.23,1459.02 1646.58,1511.35 1648.93,1455.18 1651.28,1590.79 1653.63,1326.79 1655.98,1568.93 1658.33,1457.51 1660.68,1489.66 1663.03,1352.58 1665.38,1378.16 1667.73,1463.82 1670.08,1668.17 1672.43,1315.67 1674.78,1367.88 1677.13,1358.89 1679.48,1452.76 1681.83,1417.76 1684.18,1689.31 1686.53,1492.72 1688.89,1340.92 1691.24,1451.73 1693.59,1296.16 1695.94,1427.32 1698.29,1395.29 1700.64,1414.34 1702.99,1460.09 1705.34,1391.01 1707.69,1441.9 1710.04,1495.96 1712.39,1603.02 1714.74,1286.35 1717.09,1447.62 1719.44,1281.51 1721.79,1337.71 1724.14,1267.63 1726.49,1515.84 1728.84,1493.05 1731.19,1207.03 1733.54,1495.02 1735.89,1401.72 1738.25,1506.7 1740.6,1400.8 1742.95,1496.95 1745.3,1229.07 1747.65,1370.75 1750,1329.61 1752.35,1587.1 1754.7,1282.39 1757.05,1640 1759.4,1408.48 1761.75,1288.22 1764.1,1359.77 1766.45,1363.74 1768.8,1442.93 1771.15,1321.67 1773.5,1223.12 1775.85,1476.32 1778.2,1390.57 1780.55,1188.42 1782.9,1402.3 1785.25,1496.31 1787.6,1527.58 1789.96,1268.01 1792.31,1570.79 1794.66,1325.32 1797.01,1577.19 1799.36,1402.59 1801.71,1463.61 1804.06,1557.41 1806.41,1446.46 1808.76,1324.73 1811.11,1462.61 1813.46,1410.34 1815.81,1335.03 1818.16,1424.77 1820.51,1371.29 1822.86,1505.12 1825.21,1441.07 1827.56,1194.69 1829.91,1452.83 1832.26,1490.2 1834.61,1312.88 1836.96,1449.62 1839.32,1462.12 1841.67,1477.95 1844.02,1630.93 1846.37,1328.03 1848.72,1294.01 1851.07,1491.98 1853.42,1401.25 1855.77,1565.75 1858.12,1574.98 1860.47,1314.75 1862.82,1295.03 1865.17,1331.59 1867.52,1463.85 1869.87,1389.54 1872.22,1635.58 1874.57,1231.83 1876.92,1414.25 1879.27,1467.8 1881.62,1390.28 1883.97,1168.04 1886.32,1348.84 1888.68,1355 1891.03,1365.55 1893.38,1472.13 1895.73,1478.35 1898.08,1561.03 1900.43,1378.26 1902.78,1430.23 1905.13,1357.55 1907.48,1306.92 1909.83,1581.08 1912.18,1285.73 1914.53,1398.74 1916.88,1606.26 1919.23,1328.16 1921.58,1555.2 1923.93,1650.27 1926.28,1334.83 1928.63,1371.65 1930.98,1425.59 1933.33,1381.48 1935.68,1450.1 1938.04,1488.4 1940.39,1446.47 1942.74,1417.98 1945.09,1489.23 1947.44,1321.08 1949.79,1277.61 1952.14,1489.32 1954.49,1402.79 1956.84,1520.89 1959.19,1554.64 1961.54,1577.67 1963.89,1337.07 1966.24,1420.1 1968.59,1484.55 1970.94,1307.24 1973.29,1480.59 1975.64,1375.95 1977.99,1526.3 1980.34,1451.97 1982.69,1451.95 1985.04,1346.87 1987.4,1378.01 1989.75,1418.64 1992.1,1628.61 1994.45,1288.44 1996.8,1483.64 1999.15,1302.48 2001.5,1309.44 2003.85,1540.06 2006.2,1439.9 2008.55,1361.47 2010.9,1571.25 2013.25,1436.92 2015.6,1276.57 2017.95,1293.81 2020.3,1461.9 2022.65,1463.93 2025,1413.61 2027.35,1443.48 2029.7,1500.75 2032.05,1550.97 2034.4,1600.12 2036.76,1264.97 2039.11,1348.27 2041.46,1384.86 2043.81,1389.73 2046.16,1336.23 2048.51,1516.67 2050.86,1372.25 2053.21,1486.62 2055.56,1306.81 2057.91,1652.31 2060.26,1330.05 2062.61,1664.74 2064.96,1507.15 2067.31,1403.72 2069.66,1436.71 2072.01,1414.24 2074.36,1418.71 2076.71,1440.46 2079.06,1313.87 2081.41,1506.01 2083.76,1613.88 2086.11,1387.16 2088.47,1604.47 2090.82,1513.9 2093.17,1419.56 2095.52,1363.02 2097.87,1462.94 2100.22,1425.08 2102.57,1358.78 2104.92,1428.18 2107.27,1306.34 2109.62,1381.14 2111.97,1455.85 2114.32,1311.03 2116.67,1181.95 2119.02,1440.69 2121.37,1487.37 2123.72,1422.74 2126.07,1606.5 2128.42,1596.01 2130.77,1475.32 2133.12,1452.68 2135.47,1482.08 2137.83,1368.17 2140.18,1128.46 2142.53,1541.32 2144.88,1571.19 2147.23,1510.14 2149.58,1276.91 2151.93,1521.28 2154.28,1492 2156.63,1396.75 2158.98,1533.78 2161.33,1434.86 2163.68,1704.29 2166.03,1442.03 2168.38,1609.69 2170.73,1452.73 2173.08,1479.44 2175.43,1385.65 2177.78,1378.51 2180.13,1547.39 2182.48,1396.34 2184.83,1421.36 2187.19,1444.33 2189.54,1494.11 2191.89,1323.15 2194.24,1505.27 2196.59,1440.09 2198.94,1278.67 2201.29,1458.29 2203.64,1438.41 2205.99,1314.74 2208.34,1416.44 2210.69,1534.3 2213.04,1468.89 2215.39,1341.32 2217.74,1398.37 2220.09,1331.66 2222.44,1294.38 2224.79,1450.81 2227.14,1430.17 2229.49,1442.49 2231.84,1353.52 2234.19,1466.01 2236.55,1545.55 2238.9,1436.99 2241.25,1524.3 2243.6,1448.43 2245.95,1404.72 2248.3,1373.88 2250.65,1385.61 2253,1413.06 2255.35,1386.06 2257.7,1493.59 2260.05,1409.67 2262.4,1196.46 2264.75,1225.22 2267.1,1249.79 2269.45,1453.31 2271.8,1341.12 2274.15,1488.99 2276.5,1471.92 2278.85,1548 2281.2,1581.1 2283.55,1241.73 2285.91,1262.38 2288.26,1673.06 2290.61,1694.59 2292.96,1473.27 2295.31,1323.66 2297.66,1435.82 2300.01,1502.6 2302.36,1450.36 2304.71,1292.38 2307.06,1517.67 2309.41,1436.42 2311.76,1493.01 2314.11,1435.3 2316.46,1291.89 2318.81,1437.31 2321.16,1523.11 2323.51,1511.77 2325.86,1504.14 2328.21,1382.34 2330.56,1410.54 2332.91,1453.71 2335.27,1484.4 2337.62,1365.23 2339.97,1534.54 2342.32,1351.58 2344.67,1612.53 2347.02,1457.69 2349.37,1390.27 2351.72,1353.24 2354.07,1332.38 2356.42,1521.78 2358.77,1548.02 2361.12,1336.19 2363.47,1652.69 2365.82,1511.44 2368.17,1536.74 2370.52,1441.34 2372.87,1494.59 2375.22,1388.45 2377.57,1389.76 2379.92,1425.36 2382.27,1438.59 2384.62,1542.02 2386.98,1604.59 2389.33,1331.1 2391.68,1639.69 2394.03,1324.97 2396.38,1395.73 2398.73,1321.45 2401.08,1489.07 2403.43,1435.35 2405.78,1433.79 2408.13,1504.28 2410.48,1502.43 2412.83,1319.54 2415.18,1517.06 2417.53,1550.58 2419.88,1365.86 2422.23,1374.28 2424.58,1542.36 2426.93,1448.25 2429.28,1438.65 2431.63,1371.69 2433.98,1442.95 2436.34,1383.74 2438.69,1253.41 2441.04,1549.14 2443.39,1384.69 2445.74,1485.4 2448.09,1331.64 2450.44,1294.61 2452.79,1495.89 2455.14,1458.46 2457.49,1423.94 2459.84,1442.04 2462.19,1556.83 2464.54,1388.84 2466.89,1310.37 2469.24,1616.14 2471.59,1418.58 2473.94,1330.7 2476.29,1457.76 2478.64,1281.98 2480.99,1385.13 2483.34,1408.61 2485.7,1359.89 2488.05,1422.79 2490.4,1588.09 2492.75,1201.5 2495.1,1447.36 2497.45,1386.23 2499.8,1492.32 2502.15,1416.84 2504.5,1632.38 2506.85,1436.44 2509.2,1471.23 2511.55,1348.56 2513.9,1520.79 2516.25,1607.24 2518.6,1343.77 2520.95,1536.22 2523.3,1428.31 2525.65,1401.04 2528,1391.26 2530.35,1213.44 2532.7,1455.03 2535.06,1523.32 2537.41,1425.97 2539.76,1375.26 2542.11,1489.68 2544.46,1446.56 2546.81,1410.38 2549.16,1297.67 2551.51,1340.8 2553.86,1326.46 2556.21,1399.08 2558.56,1591.63 2560.91,1376.91 2563.26,1349.71 2565.61,1443.36 2567.96,1471.18 2570.31,1454.89 "></polyline>
<polyline clip-path="url(#clip192)" style="stroke:#e26f46; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,1165.06 224.541,814.96 226.891,988.911 229.242,839.514 231.592,892.367 233.943,788.589 236.293,849.164 238.644,803.833 240.994,864.099 243.345,1033.15 245.695,1051.97 248.046,942.192 250.396,909.405 252.747,915.059 255.097,1015.81 257.448,770.858 259.798,953.783 262.148,898.699 264.499,850.698 266.849,1119.63 269.2,730.107 271.55,1065.14 273.901,933.262 276.251,799.776 278.602,814.878 280.952,825.251 283.303,994.002 285.653,960.684 288.004,815.51 290.354,851.143 292.705,916.679 295.055,956.243 297.406,920.938 299.756,1089.57 302.107,1016.13 304.457,983.959 306.807,858.988 309.158,736.171 311.508,820.676 313.859,781.115 316.209,950.194 318.56,1005.41 320.91,882.962 323.261,996.284 325.611,1038.41 327.962,886.274 330.312,1049.87 332.663,995.067 335.013,936.663 337.364,1046.23 339.714,963.212 342.065,898.186 344.415,924.248 346.765,753.073 349.116,801.635 351.466,766.62 353.817,871.754 356.167,760.359 358.518,881.433 360.868,1040.79 363.219,909.081 365.569,879.1 367.92,977.533 370.27,671.291 372.621,902.805 374.971,787.361 377.322,960.5 379.672,1032.11 382.023,877.966 384.373,850.468 386.724,1010.12 389.074,888.51 391.424,1048.52 393.775,1086.62 396.125,899.357 398.476,838.705 400.826,845.104 403.177,958.105 405.527,796.588 407.878,986.485 410.228,868.578 412.579,853.637 414.929,948.608 417.28,750.9 419.63,985.907 421.981,843.027 424.331,916.333 426.682,990.445 429.032,785.139 431.382,858.563 433.733,870.663 436.083,747.776 438.434,848.057 440.784,913.97 443.135,896.538 445.485,956.843 447.836,960.753 450.186,1015.59 452.537,1001.2 454.887,1085.87 457.238,779.79 459.588,918.356 461.939,935.948 464.289,928.456 466.64,1080.08 468.99,834.644 471.341,867.178 473.691,997.819 476.041,967.534 478.392,968.172 480.742,1042.97 483.093,886.393 485.443,884.553 487.794,909.195 490.144,979.814 492.495,734.436 494.845,965.132 497.196,872.294 499.546,824.842 501.897,817.756 504.247,764.475 506.598,887.507 508.948,950.833 511.299,847.172 513.649,830.381 515.999,827.426 518.35,850.716 520.7,855 523.051,939.681 525.401,933.876 527.752,873.41 530.102,901.27 532.453,955.869 534.803,853.386 537.154,872.976 539.504,913.652 541.855,916.314 544.205,984.019 546.556,1045.85 548.906,1011.93 551.257,1128.07 553.607,1242.53 555.958,1034.39 558.308,952.495 560.658,793.857 563.009,847.812 565.359,828.724 567.71,1058.57 570.06,1097.47 572.411,945.387 574.761,1034.43 577.112,1055.05 579.462,1023.05 581.813,1003.74 584.163,966.595 586.514,1074.02 588.864,957.431 591.215,827.493 593.565,821.239 595.916,934.132 598.266,847.048 600.616,840.264 602.967,978.187 605.317,872.491 607.668,1141.28 610.018,888.319 612.369,800.244 614.719,919.317 617.07,1091.82 619.42,895.205 621.771,893.344 624.121,801.244 626.472,1155.61 628.822,894.55 631.173,840.183 633.523,828.912 635.874,1006.86 638.224,819.432 640.575,862.564 642.925,884.108 645.275,997.025 647.626,759.864 649.976,994.307 652.327,1000.67 654.677,1115.6 657.028,965.219 659.378,988.757 661.729,981.028 664.079,970.881 666.43,948.258 668.78,1041.44 671.131,892.991 673.481,829.133 675.832,1035.29 678.182,765.903 680.533,982.461 682.883,1020.29 685.233,969.13 687.584,926.561 689.934,932.402 692.285,1090.59 694.635,1194.25 696.986,857.711 699.336,908.619 701.687,753.742 704.037,952.465 706.388,992.281 708.738,1039.88 711.089,736.035 713.439,770.707 715.79,1026.91 718.14,813.814 720.491,1027.85 722.841,892.596 725.192,1042.09 727.542,1055.83 729.892,938.733 732.243,1012.46 734.593,980.047 736.944,948.114 739.294,872.86 741.645,813.967 743.995,1095.24 746.346,1039.04 748.696,813.753 751.047,1032.55 753.397,918.052 755.748,871.71 758.098,834.345 760.449,949.584 762.799,1016.85 765.15,773.047 767.5,956.141 769.85,1003.15 772.201,759.066 774.551,846.207 776.902,879.498 779.252,900.244 781.603,954.159 783.953,1053.15 786.304,984.08 788.654,847.695 791.005,836.81 793.355,1037.63 795.706,820.477 798.056,1090.04 800.407,1053.75 802.757,926.996 805.108,1062.04 807.458,916.617 809.809,929.376 812.159,879.229 814.509,969.404 816.86,1161.16 819.21,967.623 821.561,905.865 823.911,947.236 826.262,1090.13 828.612,881.03 830.963,803.717 833.313,1047.35 835.664,803.604 838.014,819.897 840.365,1151.91 842.715,1091.25 845.066,1101.8 847.416,1062.56 849.767,913.044 852.117,1039.95 854.467,977.853 856.818,790.688 859.168,803.131 861.519,836.007 863.869,1095.48 866.22,964.338 868.57,978.686 870.921,702.734 873.271,833.635 875.622,777.779 877.972,1091.51 880.323,833.835 882.673,922.462 885.024,906.929 887.374,882.695 889.725,1069.3 892.075,1085.8 894.426,915.03 896.776,1003.78 899.126,1037.45 901.477,865.409 903.827,821.961 906.178,923.79 908.528,818.43 910.879,1061.12 913.229,884.373 915.58,1090.02 917.93,972.889 920.281,955.496 922.631,910.841 924.982,896.825 927.332,894.501 929.683,897.201 932.033,859.691 934.384,941.99 936.734,954.348 939.084,737.556 941.435,941.613 943.785,890.132 946.136,701.203 948.486,939.149 950.837,937.207 953.187,755.206 955.538,914.706 957.888,953.255 960.239,1014.8 962.589,859.519 964.94,835.747 967.29,921.301 969.641,968.172 971.991,938.138 974.342,1080.59 976.692,1095.53 979.043,1013.45 981.393,725.344 983.743,989.897 986.094,870.167 988.444,926.348 990.795,891.597 993.145,1035.28 995.496,987.368 997.846,867.122 1000.2,960.721 1002.55,916.838 1004.9,829.495 1007.25,718.985 1009.6,1099.68 1011.95,873.603 1014.3,853.37 1016.65,893.899 1019,1158.43 1021.35,985.819 1023.7,928.426 1026.05,816.642 1028.4,840.4 1030.75,962.938 1033.1,857.628 1035.45,895.624 1037.8,860.829 1040.15,850.391 1042.51,1232.75 1044.86,948.603 1047.21,773.852 1049.56,933.353 1051.91,885.111 1054.26,978.28 1056.61,871.153 1058.96,967.985 1061.31,705.249 1063.66,942.195 1066.01,872.031 1068.36,792.751 1070.71,976.907 1073.06,677.776 1075.41,775.086 1077.76,1032.13 1080.11,998.078 1082.46,874.99 1084.81,1057.77 1087.16,970.823 1089.51,901.432 1091.87,955.44 1094.22,880.02 1096.57,1171.46 1098.92,941.627 1101.27,913.457 1103.62,1025.66 1105.97,915.195 1108.32,892.627 1110.67,738.207 1113.02,767.954 1115.37,853.326 1117.72,999.588 1120.07,1027.56 1122.42,920.446 1124.77,849.922 1127.12,770.199 1129.47,884.164 1131.82,867.03 1134.17,1021.18 1136.52,796.298 1138.87,996.217 1141.23,742.185 1143.58,1001.36 1145.93,818.246 1148.28,812.519 1150.63,959.034 1152.98,840.392 1155.33,906.863 1157.68,868.222 1160.03,1032.77 1162.38,872.523 1164.73,840.03 1167.08,763.602 1169.43,840.52 1171.78,960.972 1174.13,980.107 1176.48,868.423 1178.83,788.008 1181.18,1002.7 1183.53,988.975 1185.88,1002.94 1188.23,873.266 1190.59,1150.91 1192.94,1040.62 1195.29,915.048 1197.64,810.162 1199.99,698.111 1202.34,946.803 1204.69,1003.34 1207.04,942.291 1209.39,951.861 1211.74,944.88 1214.09,1051.46 1216.44,925.795 1218.79,1007.45 1221.14,816.738 1223.49,1011.32 1225.84,904.207 1228.19,802.779 1230.54,976.421 1232.89,909.854 1235.24,798.51 1237.59,878.265 1239.94,993.196 1242.3,801.822 1244.65,966.965 1247,829.71 1249.35,967.713 1251.7,939.609 1254.05,916.432 1256.4,1103.15 1258.75,940.049 1261.1,1103.54 1263.45,783.119 1265.8,873.255 1268.15,899.218 1270.5,972.641 1272.85,1070.6 1275.2,1129.46 1277.55,944.495 1279.9,845.339 1282.25,981.772 1284.6,901.746 1286.95,999.903 1289.3,917.412 1291.66,827.573 1294.01,887.917 1296.36,1007.78 1298.71,984.097 1301.06,807.267 1303.41,1076.71 1305.76,887.72 1308.11,996.763 1310.46,837.861 1312.81,915.377 1315.16,767.325 1317.51,995.669 1319.86,869.259 1322.21,909.864 1324.56,1016.97 1326.91,981.999 1329.26,955.448 1331.61,717.529 1333.96,1010.87 1336.31,1080.46 1338.66,871.881 1341.02,946.839 1343.37,906.547 1345.72,1071.22 1348.07,867.557 1350.42,855.204 1352.77,884.496 1355.12,992.704 1357.47,806.241 1359.82,811.269 1362.17,914.393 1364.52,898.073 1366.87,980.836 1369.22,908.188 1371.57,861.941 1373.92,899.448 1376.27,800.296 1378.62,842.381 1380.97,1008.66 1383.32,975.985 1385.67,928.355 1388.02,910.24 1390.38,1039 1392.73,736.387 1395.08,1087.7 1397.43,880.654 1399.78,904.243 1402.13,1013.84 1404.48,911.36 1406.83,857.911 1409.18,1004.76 1411.53,816.288 1413.88,1124.44 1416.23,1061.45 1418.58,1012.73 1420.93,875.191 1423.28,895.547 1425.63,971.411 1427.98,979.929 1430.33,732.079 1432.68,627.319 1435.03,944.928 1437.38,951.387 1439.74,906.056 1442.09,822.465 1444.44,869.58 1446.79,854.914 1449.14,991.212 1451.49,777.408 1453.84,878.153 1456.19,1057.48 1458.54,990.416 1460.89,877.943 1463.24,932.743 1465.59,801.106 1467.94,968.142 1470.29,971.773 1472.64,1002.22 1474.99,1052.08 1477.34,1126.93 1479.69,1047.71 1482.04,914.861 1484.39,1011.62 1486.74,946.429 1489.1,974.993 1491.45,808.203 1493.8,829.442 1496.15,956.678 1498.5,1122.46 1500.85,1058.47 1503.2,910.746 1505.55,1053.48 1507.9,837.648 1510.25,1013.21 1512.6,985.79 1514.95,902.72 1517.3,896.418 1519.65,938.662 1522,960.26 1524.35,1112.48 1526.7,832.012 1529.05,981.252 1531.4,993.21 1533.75,872.931 1536.1,937.879 1538.45,891.16 1540.81,1002.53 1543.16,860.803 1545.51,869.635 1547.86,1044.18 1550.21,999.989 1552.56,974.628 1554.91,891.066 1557.26,1032.55 1559.61,886.465 1561.96,919.976 1564.31,824.586 1566.66,1098.16 1569.01,844.724 1571.36,1048.85 1573.71,950.368 1576.06,798.904 1578.41,918.9 1580.76,1020.23 1583.11,842.716 1585.46,920.823 1587.81,1003.45 1590.17,869.385 1592.52,1050.41 1594.87,954.776 1597.22,788.674 1599.57,1043.27 1601.92,955.528 1604.27,915.778 1606.62,860.059 1608.97,758.56 1611.32,932.292 1613.67,1025.72 1616.02,1052.97 1618.37,1114.25 1620.72,1056.32 1623.07,860.235 1625.42,936.966 1627.77,911.436 1630.12,977.717 1632.47,778.516 1634.82,1000.14 1637.17,890.207 1639.53,930.029 1641.88,918.379 1644.23,953.019 1646.58,946.335 1648.93,1003.4 1651.28,788.796 1653.63,971.572 1655.98,998.379 1658.33,1065.03 1660.68,844.592 1663.03,1129.27 1665.38,988.221 1667.73,851.051 1670.08,857.092 1672.43,821.669 1674.78,1009.82 1677.13,869.476 1679.48,958.682 1681.83,961.731 1684.18,805.087 1686.53,745.209 1688.89,1056.98 1691.24,894.137 1693.59,836.897 1695.94,910.982 1698.29,1010.22 1700.64,1050.75 1702.99,1000.15 1705.34,957.594 1707.69,847.919 1710.04,1066.77 1712.39,811.055 1714.74,950.641 1717.09,830.201 1719.44,976.127 1721.79,1068.84 1724.14,841.119 1726.49,921.458 1728.84,928.39 1731.19,793.784 1733.54,857.338 1735.89,863.79 1738.25,797.424 1740.6,976.813 1742.95,726.588 1745.3,711.952 1747.65,872.073 1750,1001.53 1752.35,921.321 1754.7,823.393 1757.05,1028.79 1759.4,983.816 1761.75,849.121 1764.1,935.31 1766.45,1043.55 1768.8,979.798 1771.15,730.72 1773.5,1064.7 1775.85,820.693 1778.2,1009.47 1780.55,942.147 1782.9,847.847 1785.25,1020.56 1787.6,1049.39 1789.96,1128.97 1792.31,1179.65 1794.66,1056.41 1797.01,779.834 1799.36,976.734 1801.71,974.315 1804.06,1004.56 1806.41,999.722 1808.76,822.76 1811.11,981.926 1813.46,920.351 1815.81,779.549 1818.16,956.854 1820.51,830.512 1822.86,760.392 1825.21,1090.89 1827.56,900.843 1829.91,904.462 1832.26,1167.39 1834.61,799.995 1836.96,958.594 1839.32,1208.81 1841.67,915.441 1844.02,895.015 1846.37,970.749 1848.72,831.025 1851.07,866.84 1853.42,990.191 1855.77,885.939 1858.12,858.379 1860.47,893.084 1862.82,833.859 1865.17,1042.48 1867.52,922.965 1869.87,1016.16 1872.22,771.663 1874.57,881.283 1876.92,876.826 1879.27,927.928 1881.62,949.911 1883.97,853.488 1886.32,1043.9 1888.68,914.37 1891.03,1067.09 1893.38,774.14 1895.73,1031.47 1898.08,1067.88 1900.43,796.065 1902.78,902.568 1905.13,928.799 1907.48,986.484 1909.83,887.959 1912.18,857.832 1914.53,764.073 1916.88,999.998 1919.23,1037.17 1921.58,801.001 1923.93,1059.61 1926.28,940.373 1928.63,875.735 1930.98,978.798 1933.33,798.176 1935.68,925.976 1938.04,1134.48 1940.39,1025.2 1942.74,938.509 1945.09,825.729 1947.44,1016.81 1949.79,809.281 1952.14,748.355 1954.49,963.738 1956.84,1066.61 1959.19,910.64 1961.54,1046.96 1963.89,822.184 1966.24,845.253 1968.59,590.167 1970.94,908.126 1973.29,862.137 1975.64,803.532 1977.99,1016.43 1980.34,958.18 1982.69,846.683 1985.04,938.288 1987.4,970.122 1989.75,939.829 1992.1,978.611 1994.45,942.494 1996.8,1030.34 1999.15,1107.77 2001.5,1008.52 2003.85,1172.96 2006.2,967.369 2008.55,1096.21 2010.9,799.985 2013.25,810.158 2015.6,1078.92 2017.95,1025.23 2020.3,822.373 2022.65,1035.1 2025,865.17 2027.35,801.497 2029.7,1035.64 2032.05,951.833 2034.4,889.808 2036.76,897.061 2039.11,1202.31 2041.46,935.874 2043.81,786.862 2046.16,945.63 2048.51,929.428 2050.86,956.009 2053.21,995.841 2055.56,805.692 2057.91,880.24 2060.26,929.137 2062.61,1073.69 2064.96,849.724 2067.31,856.398 2069.66,868.542 2072.01,952.187 2074.36,847.232 2076.71,879.378 2079.06,931.494 2081.41,758.399 2083.76,841.603 2086.11,886.431 2088.47,908.107 2090.82,805.696 2093.17,856.503 2095.52,1140.59 2097.87,858.131 2100.22,797.41 2102.57,977.874 2104.92,945.29 2107.27,1048.98 2109.62,803.792 2111.97,857.259 2114.32,788.466 2116.67,846.718 2119.02,813.766 2121.37,925.442 2123.72,952.463 2126.07,808.882 2128.42,1005.22 2130.77,925.351 2133.12,942.127 2135.47,928.545 2137.83,813.071 2140.18,748.12 2142.53,942.02 2144.88,994.86 2147.23,870.774 2149.58,887.224 2151.93,1021.57 2154.28,1042.62 2156.63,987.507 2158.98,763.912 2161.33,978.75 2163.68,879.111 2166.03,928.162 2168.38,990.056 2170.73,1088.78 2173.08,957.229 2175.43,731.87 2177.78,840.296 2180.13,1007.65 2182.48,995.591 2184.83,929.481 2187.19,962.238 2189.54,1083.78 2191.89,723.56 2194.24,847.189 2196.59,930.507 2198.94,862.957 2201.29,889.344 2203.64,954.154 2205.99,1016.8 2208.34,740.149 2210.69,1003.31 2213.04,989.821 2215.39,813.467 2217.74,1039.42 2220.09,955.435 2222.44,725.551 2224.79,865.496 2227.14,996.352 2229.49,835.871 2231.84,994.314 2234.19,910.381 2236.55,1053.01 2238.9,1009.46 2241.25,861.904 2243.6,894.959 2245.95,903.683 2248.3,923.716 2250.65,713.774 2253,902.698 2255.35,735.1 2257.7,809.158 2260.05,972.009 2262.4,1008.98 2264.75,816.377 2267.1,1001.47 2269.45,912.722 2271.8,969.402 2274.15,864.664 2276.5,990.603 2278.85,872.879 2281.2,953.531 2283.55,1024.63 2285.91,1030.02 2288.26,845.876 2290.61,1061.1 2292.96,860.268 2295.31,758.68 2297.66,808.633 2300.01,944.562 2302.36,1033.77 2304.71,974.848 2307.06,869.173 2309.41,960.471 2311.76,838.851 2314.11,876.64 2316.46,914.842 2318.81,717.922 2321.16,993.966 2323.51,879.153 2325.86,890.468 2328.21,995.056 2330.56,878.383 2332.91,956.032 2335.27,855.513 2337.62,1039.83 2339.97,974.53 2342.32,808.047 2344.67,777.996 2347.02,815.286 2349.37,1027.24 2351.72,1059.38 2354.07,876.619 2356.42,889.661 2358.77,865.926 2361.12,901.497 2363.47,769.065 2365.82,714.78 2368.17,916.002 2370.52,820.775 2372.87,1042.35 2375.22,976.292 2377.57,934.988 2379.92,844.212 2382.27,1139.26 2384.62,935.592 2386.98,784.734 2389.33,875.312 2391.68,758.117 2394.03,1154.45 2396.38,904.894 2398.73,884.498 2401.08,995.436 2403.43,797.846 2405.78,809.705 2408.13,1171.49 2410.48,1088.87 2412.83,945.784 2415.18,954.053 2417.53,648.276 2419.88,1002.9 2422.23,976.274 2424.58,996.101 2426.93,932.694 2429.28,958.584 2431.63,934.82 2433.98,965.473 2436.34,982.621 2438.69,796.771 2441.04,1014.34 2443.39,867.436 2445.74,1051.28 2448.09,962.248 2450.44,1001.27 2452.79,906.235 2455.14,909.329 2457.49,857.321 2459.84,807.362 2462.19,714.786 2464.54,1022.83 2466.89,1037.57 2469.24,1191.6 2471.59,922.429 2473.94,845.168 2476.29,744.208 2478.64,1140.75 2480.99,932.882 2483.34,983.857 2485.7,972.638 2488.05,884.605 2490.4,699.211 2492.75,995.428 2495.1,815.281 2497.45,896.607 2499.8,798.689 2502.15,816.789 2504.5,891.41 2506.85,942.963 2509.2,757.395 2511.55,935.658 2513.9,877.8 2516.25,937.602 2518.6,910.243 2520.95,1062.3 2523.3,968.881 2525.65,920.22 2528,848.576 2530.35,1088.32 2532.7,766.968 2535.06,939.361 2537.41,981.787 2539.76,902.73 2542.11,1052.97 2544.46,1079.87 2546.81,1080.23 2549.16,971.894 2551.51,825.854 2553.86,716.029 2556.21,944.044 2558.56,841.358 2560.91,959.555 2563.26,933.794 2565.61,864.405 2567.96,784.103 2570.31,833.177 "></polyline>
<polyline clip-path="url(#clip192)" style="stroke:#3da44d; stroke-linecap:round; stroke-linejoin:round; stroke-width:4; stroke-opacity:0.5; fill:none" points="222.19,711.807 224.541,401.462 226.891,253.691 229.242,307.398 231.592,405.299 233.943,469.276 236.293,441.846 238.644,340.739 240.994,205.481 243.345,375.989 245.695,519.311 248.046,445.655 250.396,432.94 252.747,417.602 255.097,298.287 257.448,464.374 259.798,377.545 262.148,528.127 264.499,341.68 266.849,494.589 269.2,401.333 271.55,529.073 273.901,497.271 276.251,527.254 278.602,480.601 280.952,536.641 283.303,510.717 285.653,234.745 288.004,473.578 290.354,374.003 292.705,372.313 295.055,421.706 297.406,529.328 299.756,531.207 302.107,454.404 304.457,598.364 306.807,369.934 309.158,458.804 311.508,307.159 313.859,383.655 316.209,439.551 318.56,396.953 320.91,471.685 323.261,379.386 325.611,440.851 327.962,322.934 330.312,360.436 332.663,372.444 335.013,316.179 337.364,550.501 339.714,420.683 342.065,350.182 344.415,342.101 346.765,455.104 349.116,517.572 351.466,536.146 353.817,234.302 356.167,207.321 358.518,388.089 360.868,197.658 363.219,400.337 365.569,349.26 367.92,317.679 370.27,392.682 372.621,478.594 374.971,342.309 377.322,364.392 379.672,335.822 382.023,479.253 384.373,382.066 386.724,390.848 389.074,562.508 391.424,211.49 393.775,460.287 396.125,403.864 398.476,247.902 400.826,212.3 403.177,431.909 405.527,299.769 407.878,531.254 410.228,434.048 412.579,549.078 414.929,366.864 417.28,424.596 419.63,376.984 421.981,459.346 424.331,524.668 426.682,532.033 429.032,300.725 431.382,601.226 433.733,293.372 436.083,344.73 438.434,374.502 440.784,528.674 443.135,375.403 445.485,427.042 447.836,410.496 450.186,466.695 452.537,252.365 454.887,498.802 457.238,596.841 459.588,491.919 461.939,594.405 464.289,321.594 466.64,459.32 468.99,279.78 471.341,280.708 473.691,337.365 476.041,310.45 478.392,308.985 480.742,576.285 483.093,592.391 485.443,344.586 487.794,449.498 490.144,438.252 492.495,255.841 494.845,331.072 497.196,539.041 499.546,328.26 501.897,509.472 504.247,427.234 506.598,496.779 508.948,448.973 511.299,299.501 513.649,563.661 515.999,452.024 518.35,361.27 520.7,509.703 523.051,418.782 525.401,540.609 527.752,366.837 530.102,488.793 532.453,571.121 534.803,292.127 537.154,277.687 539.504,330.352 541.855,466.691 544.205,296.374 546.556,438.79 548.906,519.092 551.257,431.063 553.607,442.45 555.958,409.107 558.308,377.969 560.658,444.615 563.009,455.873 565.359,501.37 567.71,305.45 570.06,346.024 572.411,397.838 574.761,576.737 577.112,444.46 579.462,509.547 581.813,457.982 584.163,399.596 586.514,316.185 588.864,509.108 591.215,446.214 593.565,472.893 595.916,407.364 598.266,516.457 600.616,606.171 602.967,547.599 605.317,496.503 607.668,298.952 610.018,279.756 612.369,239.9 614.719,269.595 617.07,545.499 619.42,516.639 621.771,302.225 624.121,393.732 626.472,276.003 628.822,536.125 631.173,357.684 633.523,376.22 635.874,522.18 638.224,491.034 640.575,254.016 642.925,330.565 645.275,413.636 647.626,459.645 649.976,308.085 652.327,486.587 654.677,445.993 657.028,414.266 659.378,419.225 661.729,388.356 664.079,422.622 666.43,281.796 668.78,382.214 671.131,336.01 673.481,280.034 675.832,476.345 678.182,359.875 680.533,473.221 682.883,541.598 685.233,339.124 687.584,395.782 689.934,435.891 692.285,587.149 694.635,389.553 696.986,365.553 699.336,576.136 701.687,454.187 704.037,503.033 706.388,510.459 708.738,549.44 711.089,102.498 713.439,412.669 715.79,479.637 718.14,287.444 720.491,497.714 722.841,463.854 725.192,525.351 727.542,420.165 729.892,515.396 732.243,498.991 734.593,394.648 736.944,441.627 739.294,535.997 741.645,478.206 743.995,487.783 746.346,274.988 748.696,580.955 751.047,538.952 753.397,465.451 755.748,360.766 758.098,300.839 760.449,318.094 762.799,453.27 765.15,516.386 767.5,444.292 769.85,520.921 772.201,388.994 774.551,480.27 776.902,439.631 779.252,382.458 781.603,353.018 783.953,387.201 786.304,585.208 788.654,484.519 791.005,347.543 793.355,346.425 795.706,442.406 798.056,450.457 800.407,373.292 802.757,372.093 805.108,464.803 807.458,276.851 809.809,498.454 812.159,470.432 814.509,405.132 816.86,420.359 819.21,420.77 821.561,353.707 823.911,407.142 826.262,567.435 828.612,414.836 830.963,444.334 833.313,354.519 835.664,613.088 838.014,496.349 840.365,368.792 842.715,212.737 845.066,497.684 847.416,435.915 849.767,381.749 852.117,480.1 854.467,331.531 856.818,479.789 859.168,428.148 861.519,530.771 863.869,382.091 866.22,387.092 868.57,454.373 870.921,452.694 873.271,418.034 875.622,587.091 877.972,390.969 880.323,570.448 882.673,479.029 885.024,423.017 887.374,287.802 889.725,271.407 892.075,432.242 894.426,468.846 896.776,669.436 899.126,320.974 901.477,398.957 903.827,582.635 906.178,271.353 908.528,473.31 910.879,481.333 913.229,384.57 915.58,438.842 917.93,290.638 920.281,473.825 922.631,423.713 924.982,383.046 927.332,383.699 929.683,501.687 932.033,506.39 934.384,329.934 936.734,411.116 939.084,479.342 941.435,557.319 943.785,362.734 946.136,345.193 948.486,359.743 950.837,485.269 953.187,418.977 955.538,484.702 957.888,467.594 960.239,303.805 962.589,468.651 964.94,458.263 967.29,312.442 969.641,449.388 971.991,481.183 974.342,340.025 976.692,500.011 979.043,457.022 981.393,324.637 983.743,358.688 986.094,322.126 988.444,450.23 990.795,610.821 993.145,425.25 995.496,355.53 997.846,407.606 1000.2,482.371 1002.55,536.36 1004.9,454.814 1007.25,344.969 1009.6,446.616 1011.95,287.931 1014.3,437.278 1016.65,473.503 1019,446.395 1021.35,345.746 1023.7,282.538 1026.05,493.166 1028.4,603.919 1030.75,500.705 1033.1,419.301 1035.45,480.206 1037.8,506.394 1040.15,600.074 1042.51,308.111 1044.86,515.838 1047.21,304.878 1049.56,390.326 1051.91,344.689 1054.26,412.511 1056.61,402.141 1058.96,383.46 1061.31,452.207 1063.66,491.164 1066.01,370.542 1068.36,477.849 1070.71,463.205 1073.06,378.84 1075.41,255.982 1077.76,491.857 1080.11,231.309 1082.46,343.437 1084.81,334.392 1087.16,390.077 1089.51,373.364 1091.87,368.335 1094.22,344.264 1096.57,457.916 1098.92,406.227 1101.27,592.233 1103.62,359.923 1105.97,377.169 1108.32,484.057 1110.67,473.505 1113.02,311.864 1115.37,501.394 1117.72,475.311 1120.07,405.258 1122.42,589.928 1124.77,407.512 1127.12,342.789 1129.47,583.501 1131.82,300.011 1134.17,364.283 1136.52,145.126 1138.87,451.414 1141.23,626.667 1143.58,149.718 1145.93,497.714 1148.28,558.211 1150.63,377.69 1152.98,414.251 1155.33,292.435 1157.68,437.355 1160.03,534.01 1162.38,233.41 1164.73,244.314 1167.08,321.194 1169.43,575.045 1171.78,362.956 1174.13,499.14 1176.48,307.339 1178.83,316.576 1181.18,564.515 1183.53,539.937 1185.88,430.904 1188.23,420.986 1190.59,338.707 1192.94,488.426 1195.29,382.535 1197.64,298.041 1199.99,403.319 1202.34,553.961 1204.69,372.745 1207.04,327.101 1209.39,335.091 1211.74,412.193 1214.09,487.706 1216.44,316.849 1218.79,550.044 1221.14,637.179 1223.49,447.729 1225.84,233.677 1228.19,410.56 1230.54,444.702 1232.89,448.329 1235.24,451.157 1237.59,447.07 1239.94,379.511 1242.3,377.133 1244.65,248.418 1247,360.692 1249.35,459.991 1251.7,497.673 1254.05,411.941 1256.4,357.794 1258.75,357.831 1261.1,199.997 1263.45,430.513 1265.8,201.048 1268.15,273.763 1270.5,371.861 1272.85,308.305 1275.2,440.202 1277.55,324.151 1279.9,351.558 1282.25,249.329 1284.6,283.044 1286.95,435.378 1289.3,314.101 1291.66,466.864 1294.01,351.257 1296.36,362.307 1298.71,401.436 1301.06,394.442 1303.41,555.91 1305.76,458.752 1308.11,356.201 1310.46,488.525 1312.81,406.081 1315.16,515.008 1317.51,521.982 1319.86,478.186 1322.21,379.291 1324.56,490.691 1326.91,280.018 1329.26,427.482 1331.61,452.303 1333.96,353.518 1336.31,432.837 1338.66,527.143 1341.02,283.713 1343.37,401.885 1345.72,326.092 1348.07,575.594 1350.42,575.522 1352.77,366.2 1355.12,526.942 1357.47,304.01 1359.82,435.18 1362.17,627.983 1364.52,305.72 1366.87,375.988 1369.22,371.613 1371.57,381.18 1373.92,369.059 1376.27,502.471 1378.62,569.154 1380.97,419.582 1383.32,518.056 1385.67,410.611 1388.02,502.575 1390.38,531.155 1392.73,383.081 1395.08,450.107 1397.43,457.133 1399.78,330.535 1402.13,340.207 1404.48,322.354 1406.83,349.153 1409.18,505.736 1411.53,507.333 1413.88,474.919 1416.23,432.952 1418.58,636.33 1420.93,602.716 1423.28,498.212 1425.63,396.348 1427.98,485.949 1430.33,682.22 1432.68,624.414 1435.03,450.487 1437.38,436.766 1439.74,368.215 1442.09,417.924 1444.44,403.553 1446.79,367.184 1449.14,547.672 1451.49,402.835 1453.84,376.409 1456.19,445.708 1458.54,398.912 1460.89,369.767 1463.24,293.457 1465.59,334.1 1467.94,318.984 1470.29,570.623 1472.64,496.097 1474.99,326.001 1477.34,301.925 1479.69,250.919 1482.04,506.164 1484.39,332.699 1486.74,289.174 1489.1,539.279 1491.45,494.409 1493.8,464.817 1496.15,475.584 1498.5,543.345 1500.85,427.008 1503.2,548.464 1505.55,396.724 1507.9,473.138 1510.25,428.557 1512.6,537.617 1514.95,398.927 1517.3,629.03 1519.65,367.907 1522,444.502 1524.35,503.389 1526.7,368.127 1529.05,519.805 1531.4,328.866 1533.75,575.739 1536.1,369.339 1538.45,488.092 1540.81,449.521 1543.16,665.869 1545.51,558.097 1547.86,611.994 1550.21,512.077 1552.56,346.115 1554.91,535.366 1557.26,366.243 1559.61,317.564 1561.96,141.065 1564.31,420.219 1566.66,318.823 1569.01,253.821 1571.36,427.125 1573.71,249.228 1576.06,391.892 1578.41,295.113 1580.76,441.266 1583.11,608.248 1585.46,251.127 1587.81,368.35 1590.17,439.855 1592.52,443.913 1594.87,695.143 1597.22,247.516 1599.57,420.797 1601.92,637.132 1604.27,421.235 1606.62,464.945 1608.97,381.759 1611.32,409.109 1613.67,420.472 1616.02,410.025 1618.37,419.933 1620.72,469.32 1623.07,482.203 1625.42,407.453 1627.77,442.407 1630.12,568.506 1632.47,619.142 1634.82,415.002 1637.17,268.277 1639.53,439.491 1641.88,442.21 1644.23,279.433 1646.58,281.71 1648.93,465.847 1651.28,627.343 1653.63,284.386 1655.98,384.593 1658.33,479.123 1660.68,421.461 1663.03,376.978 1665.38,350.531 1667.73,484.076 1670.08,494.877 1672.43,496.403 1674.78,511.053 1677.13,432.788 1679.48,458.539 1681.83,281.2 1684.18,466.049 1686.53,472.127 1688.89,439.5 1691.24,450 1693.59,339.025 1695.94,498.909 1698.29,299.587 1700.64,326.782 1702.99,511.516 1705.34,445.673 1707.69,263.266 1710.04,295.28 1712.39,507.977 1714.74,476.685 1717.09,464.523 1719.44,404.893 1721.79,323.496 1724.14,314.33 1726.49,411.275 1728.84,532.675 1731.19,383.934 1733.54,392.587 1735.89,586.589 1738.25,491.564 1740.6,430.803 1742.95,488.043 1745.3,269.786 1747.65,313.733 1750,391.902 1752.35,313.88 1754.7,386.37 1757.05,363.054 1759.4,340.122 1761.75,489.667 1764.1,495.309 1766.45,513.71 1768.8,395.64 1771.15,470.481 1773.5,446.612 1775.85,179.387 1778.2,336.33 1780.55,405.067 1782.9,289.32 1785.25,222.242 1787.6,437.077 1789.96,462.637 1792.31,463.429 1794.66,486.236 1797.01,566.444 1799.36,309.372 1801.71,319.489 1804.06,310.064 1806.41,420.075 1808.76,373.536 1811.11,371.976 1813.46,326.805 1815.81,453.141 1818.16,523.032 1820.51,393.444 1822.86,411.271 1825.21,292.81 1827.56,437.056 1829.91,580.219 1832.26,344.28 1834.61,300.397 1836.96,422.256 1839.32,405.167 1841.67,302.425 1844.02,446.537 1846.37,565.889 1848.72,541.308 1851.07,375.974 1853.42,384.093 1855.77,697.809 1858.12,553.59 1860.47,582.487 1862.82,224.768 1865.17,418.085 1867.52,472.092 1869.87,391.936 1872.22,578.513 1874.57,457.381 1876.92,376.257 1879.27,474.992 1881.62,536.757 1883.97,463.608 1886.32,375.487 1888.68,593.902 1891.03,313.373 1893.38,268.132 1895.73,437.95 1898.08,638.371 1900.43,362.413 1902.78,560.951 1905.13,465.018 1907.48,485.865 1909.83,315.723 1912.18,529.338 1914.53,234.327 1916.88,421.744 1919.23,366.899 1921.58,234.946 1923.93,428.799 1926.28,468.317 1928.63,537.501 1930.98,351.748 1933.33,461.288 1935.68,368.695 1938.04,433.325 1940.39,476.894 1942.74,480.188 1945.09,558.795 1947.44,503.497 1949.79,568.435 1952.14,449.371 1954.49,334.267 1956.84,602.051 1959.19,505.365 1961.54,499.396 1963.89,428.263 1966.24,374.413 1968.59,442.84 1970.94,470.9 1973.29,338.187 1975.64,292.211 1977.99,387.398 1980.34,264.512 1982.69,512.918 1985.04,364.599 1987.4,459.416 1989.75,398.445 1992.1,414.301 1994.45,371.444 1996.8,418.386 1999.15,426.26 2001.5,229.02 2003.85,471.209 2006.2,454.341 2008.55,479.46 2010.9,472.078 2013.25,122.556 2015.6,461.476 2017.95,482.923 2020.3,480.638 2022.65,560.036 2025,440.97 2027.35,395.771 2029.7,101.397 2032.05,379.849 2034.4,447.04 2036.76,481.83 2039.11,371.7 2041.46,482.702 2043.81,486.784 2046.16,412.479 2048.51,491.11 2050.86,369.487 2053.21,439.709 2055.56,369.016 2057.91,441.278 2060.26,336.849 2062.61,247.81 2064.96,385.318 2067.31,464.202 2069.66,277.868 2072.01,435.362 2074.36,445.632 2076.71,445.513 2079.06,401.427 2081.41,501.001 2083.76,457.907 2086.11,624.749 2088.47,509.735 2090.82,430.529 2093.17,637.754 2095.52,375.166 2097.87,521.035 2100.22,616.059 2102.57,482.31 2104.92,544.745 2107.27,452.317 2109.62,303.346 2111.97,634.446 2114.32,577.844 2116.67,433.785 2119.02,459.902 2121.37,392.111 2123.72,372.147 2126.07,331.262 2128.42,516.877 2130.77,339.675 2133.12,189.426 2135.47,318.412 2137.83,408.739 2140.18,366.611 2142.53,435.258 2144.88,268.443 2147.23,305.623 2149.58,423.954 2151.93,186.185 2154.28,432.256 2156.63,277.487 2158.98,400.588 2161.33,325.248 2163.68,240.716 2166.03,338.394 2168.38,409.935 2170.73,367.196 2173.08,415.146 2175.43,409.501 2177.78,344.182 2180.13,375.414 2182.48,550.689 2184.83,483.387 2187.19,562.891 2189.54,470.908 2191.89,229.112 2194.24,445.565 2196.59,500.573 2198.94,376.132 2201.29,433.377 2203.64,432.991 2205.99,392.821 2208.34,325.023 2210.69,283.382 2213.04,297.618 2215.39,481.798 2217.74,372.604 2220.09,556.422 2222.44,341.779 2224.79,446.489 2227.14,389.523 2229.49,482.41 2231.84,516.634 2234.19,417.545 2236.55,475.481 2238.9,510.393 2241.25,329.433 2243.6,412.817 2245.95,527.639 2248.3,482.186 2250.65,222.046 2253,279.366 2255.35,445.195 2257.7,488.655 2260.05,243.004 2262.4,573.738 2264.75,549.12 2267.1,568.696 2269.45,403.073 2271.8,368.354 2274.15,498.025 2276.5,444.077 2278.85,401.585 2281.2,409.518 2283.55,469.477 2285.91,360.656 2288.26,286.422 2290.61,571.315 2292.96,533.769 2295.31,182.905 2297.66,519.301 2300.01,348.634 2302.36,544.244 2304.71,523.948 2307.06,537.911 2309.41,460.356 2311.76,365.379 2314.11,543.709 2316.46,487.492 2318.81,551.706 2321.16,547.061 2323.51,310.766 2325.86,364.38 2328.21,507.652 2330.56,303.632 2332.91,347.54 2335.27,509.544 2337.62,193.861 2339.97,489.578 2342.32,403.406 2344.67,362.183 2347.02,435.007 2349.37,315.384 2351.72,396.992 2354.07,370.326 2356.42,348.478 2358.77,250.59 2361.12,457.869 2363.47,516.949 2365.82,269.762 2368.17,402.804 2370.52,559.48 2372.87,504.246 2375.22,328.05 2377.57,475.6 2379.92,456.716 2382.27,427.974 2384.62,517.544 2386.98,483.471 2389.33,567.625 2391.68,559.113 2394.03,456.548 2396.38,341.429 2398.73,426.211 2401.08,498.107 2403.43,487.638 2405.78,365.861 2408.13,440.751 2410.48,487.321 2412.83,347.016 2415.18,468.528 2417.53,359.024 2419.88,485.594 2422.23,552.101 2424.58,414.45 2426.93,322.72 2429.28,339.633 2431.63,554.364 2433.98,310.221 2436.34,450.864 2438.69,342.153 2441.04,469.013 2443.39,441.534 2445.74,446.669 2448.09,484.704 2450.44,499.751 2452.79,197.696 2455.14,472.509 2457.49,391.199 2459.84,487.835 2462.19,245.331 2464.54,358.813 2466.89,406.46 2469.24,399.02 2471.59,360.857 2473.94,456.036 2476.29,384.345 2478.64,430.118 2480.99,531.38 2483.34,312.988 2485.7,323.57 2488.05,312.054 2490.4,353.187 2492.75,413.794 2495.1,443.818 2497.45,707.444 2499.8,442.725 2502.15,392.238 2504.5,591.832 2506.85,486.787 2509.2,322.049 2511.55,451.721 2513.9,283.647 2516.25,439.045 2518.6,488.175 2520.95,399.453 2523.3,274.186 2525.65,495.848 2528,301.711 2530.35,635.24 2532.7,96.8724 2535.06,591.924 2537.41,236.767 2539.76,689.292 2542.11,432.089 2544.46,248.264 2546.81,507.66 2549.16,173.823 2551.51,483.011 2553.86,431.546 2556.21,412.184 2558.56,407.076 2560.91,373.947 2563.26,456.954 2565.61,275.079 2567.96,373.969 2570.31,357.869 "></polyline>
</svg>
</div>
</div>
<p>Look at that! Things are working; amazin’.</p>
<p>We can also exploit <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a>’s parallel sampling capabilities:</p>
<div id="34" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Run separate 4 chains for 10 000 iterations using threads to parallelize.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>num_chains <span class="op">=</span> <span class="fl">4</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    model_with_grad,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    sampler,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">MCMCThreads</span>(),</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    num_chains;</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Note we need to provide an initial state for every chain.</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    initial_state<span class="op">=</span><span class="fu">fill</span>(state, num_chains),</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>samples_array <span class="op">=</span> <span class="fu">stack</span>(<span class="fu">map</span>(<span class="bu">Base</span>.<span class="fu">Fix1</span>(stack, sample <span class="op">-&gt;</span> sample.x), samples))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×10000×4 Array{Float64, 3}:
[:, :, 1] =
 -0.821521  -2.73594   -4.51447   -4.26192  …  -6.06642  -5.13128   -5.13128
 -2.04338   -0.540175   0.721975   1.09296      2.06282  -0.144062  -0.144062
  3.61984    3.80118    4.23429    6.82133      5.09417   5.03875    5.03875

[:, :, 2] =
 -2.92146  -4.12432   -4.95886   -3.54495   …  -6.06081   -4.37421  -3.98541
 -1.22722  -0.597489   0.114903  -0.586271      0.986112   1.10932   1.33663
  3.23535   4.08498    4.49057    4.68594       5.28809    4.94191   5.05704

[:, :, 3] =
 -2.71094    -5.66943   -5.61052    …  -6.32257  -5.79857   -4.56447
  0.0369831   0.992909   0.0564383     -1.56081  -0.707139  -0.978092
  1.40654     1.2294     4.77933        5.25609   6.64339    6.35995

[:, :, 4] =
 -1.58046   -5.06595   -6.91385  -6.09267  …  -5.14682  -6.50054   -6.56927
 -0.236898  -0.818762  -1.58959  -1.27036      0.78907  -0.958611  -1.37802
  3.08648    4.14493    3.02493   4.02928      4.47183   4.00841    7.18066</code></pre>
</div>
</div>
<p>But the fact that we have to provide the <code>AbstractMCMC.sample</code> call, etc. with an <code>initial_state</code> to get started is a bit annoying. We can avoid this by also defining a <code>AbstractMCMC.step</code> <em>without</em> the <code>state</code> argument:</p>
<div id="36" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> AbstractMCMC.<span class="fu">step</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    rng<span class="op">::</span><span class="dt">Random.AbstractRNG</span>,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    model_wrapper<span class="op">::</span><span class="dt">AbstractMCMC.LogDensityModel</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">::</span><span class="dt">MALA</span>;</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">NOTE</span><span class="co">: No state provided!</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    kwargs<span class="op">...</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> model_wrapper.logdensity</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Let's just create the initial state by sampling using  a Gaussian.</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="fu">randn</span>(rng, LogDensityProblems.<span class="fu">dimension</span>(model))</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">MALASample</span>(x), <span class="fu">MALAState</span>(x)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Equipped with this, we no longer need to provide the <code>initial_state</code> everywhere:</p>
<div id="38" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>samples <span class="op">=</span> <span class="fu">sample</span>(model_with_grad, sampler, <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>samples_matrix <span class="op">=</span> <span class="fu">stack</span>(sample <span class="op">-&gt;</span> sample.x, samples)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">hcat</span>(<span class="fu">mean</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>), <span class="fu">std</span>(samples_matrix; dims<span class="op">=</span><span class="fl">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>3×2 Matrix{Float64}:
 -5.00563    1.00356
  0.0139813  0.998909
  5.00769    0.989255</code></pre>
</div>
</div>
</section>
<section id="using-our-sampler-with-turing.jl" class="level2">
<h2 class="anchored" data-anchor-id="using-our-sampler-with-turing.jl">Using our sampler with Turing.jl</h2>
<p>As we promised, all of this hassle of implementing our <code>MALA</code> sampler in a way that uses <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> and <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> gets us something more than <em>just</em> an “automatic” implementation of <code>AbstractMCMC.sample</code>.</p>
<p>It also enables use with Turing.jl through the <code>externalsampler</code>, but we need to do one final thing first: we need to tell Turing.jl how to extract a vector of parameters from the “sample” returned in our implementation of <code>AbstractMCMC.step</code>. In our case, the “sample” is a <code>MALASample</code>, so we just need the following line:</p>
<div id="40" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">Turing</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">DynamicPPL</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Overload the `getparams` method for our "sample" type, which is just a vector.</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>Turing.Inference.<span class="fu">getparams</span>(<span class="op">::</span><span class="dt">DynamicPPL.Model</span>, sample<span class="op">::</span><span class="dt">MALASample</span>) <span class="op">=</span> sample.x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And with that, we’re good to go!</p>
<div id="42" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Our previous model defined as a Turing.jl model.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">mvnormal_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">MvNormal</span>([<span class="op">-</span><span class="fl">5</span>., <span class="fl">0</span>., <span class="fl">5</span>.], I)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate our model.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">mvnormal_model</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Call `sample` but now we're passing in a Turing.jl `model` and wrapping</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># our `MALA` sampler in the `externalsampler` to tell Turing.jl that the sampler</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># expects something that implements LogDensityProblems.jl.</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×4×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 3.02 seconds
Compute duration  = 3.02 seconds
parameters        = x[1], x[2], x[3]
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

        x[1]   -4.9736    1.0084    0.0184   3006.4249   5017.3035    1.0002   ⋯
        x[2]    0.0014    1.0102    0.0178   3222.0305   4963.4786    1.0007   ⋯
        x[3]    4.9922    1.0201    0.0181   3162.6713   5183.2420    1.0012   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

        x[1]   -6.9588   -5.6425   -4.9905   -4.2789   -3.0106
        x[2]   -1.9971   -0.6984    0.0117    0.6962    1.9935
        x[3]    3.0328    4.3009    4.9926    5.6867    6.9932
</span></pre>
</div>
</div>
</div>
<p>Pretty neat, eh?</p>
<section id="models-with-constrained-parameters" class="level3">
<h3 class="anchored" data-anchor-id="models-with-constrained-parameters">Models with constrained parameters</h3>
<p>One thing we’ve sort of glossed over in all of the above is that MALA, at least how we’ve implemented it, requires <span class="math inline">\(x\)</span> to live in <span class="math inline">\(\mathbb{R}^d\)</span> for some <span class="math inline">\(d &gt; 0\)</span>. If some of the parameters were in fact constrained, e.g.&nbsp;we were working with a <code>Beta</code> distribution which has support on the interval <span class="math inline">\((0, 1)\)</span>, <em>not</em> on <span class="math inline">\(\mathbb{R}^d\)</span>, we could easily end up outside of the valid range <span class="math inline">\((0, 1)\)</span>.</p>
<div id="44" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="fu">beta_model</span>() <span class="op">=</span> x <span class="op">~</span> <span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>turing_model <span class="op">=</span> <span class="fu">beta_model</span>()</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 1.78 seconds
Compute duration  = 1.78 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold">  ess_bulk  </span><span class="ansi-bold">  ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold">   Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> ⋯

           x    0.4974    0.1860    0.0027   4529.9621   5921.6738    1.0001   ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.1588    0.3570    0.4966    0.6352    0.8440
</span></pre>
</div>
</div>
</div>
<p>Yep, that still works, but only because Turing.jl actually <em>transforms</em> the <code>turing_model</code> from constrained to unconstrained, so that the <code>sampler</code> provided to <code>externalsampler</code> is actually always working in unconstrained space! This is not always desirable, so we can turn this off:</p>
<div id="46" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>chain <span class="op">=</span> <span class="fu">sample</span>(turing_model, <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×2×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 0.17 seconds
Compute duration  = 0.17 seconds
parameters        = x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

           x    0.4561    0.1634    0.0204    59.3339    24.1416    1.0282     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

           x    0.1966    0.3194    0.4555    0.5788    0.7367
</span></pre>
</div>
</div>
</div>
<p>The fun thing is that this still sort of works because</p>
<div id="48" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logpdf</span>(<span class="fu">Beta</span>(<span class="fl">3</span>, <span class="fl">3</span>), <span class="fl">10.0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<pre><code>-Inf</code></pre>
</div>
</div>
<p>and so the samples that fall outside of the range are always rejected. But do notice how much worse all the diagnostics are, e.g.&nbsp;<code>ess_tail</code> is very poor compared to when we use <code>unconstrained=true</code>. Moreover, in more complex cases this won’t just result in a “nice” <code>-Inf</code> log-density value, but instead will error:</p>
<div id="50" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="pp">@model</span> <span class="kw">function</span> <span class="fu">demo</span>()</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    σ² <span class="op">~</span> <span class="fu">truncated</span>(<span class="fu">Normal</span>(), lower<span class="op">=</span><span class="fl">0</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If we end up with negative values for `σ²`, the `Normal` will error.</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">~</span> <span class="fu">Normal</span>(<span class="fl">0</span>, σ²)</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">false</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre>DomainError with -0.5833612639496205:
Normal: the condition σ &gt;= zero(σ) is not satisfied.
Stacktrace:
  [1] <span class="ansi-bold">#371</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [2] <span class="ansi-bold">check_args</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">utils.jl:89</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [3] <span class="ansi-bold">#Normal#370</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:37</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [4] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:36</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [5] <span class="ansi-bold">Normal</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Distributions/YQSrn/src/univariate/continuous/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">normal.jl:42</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [6] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/JwgrD/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">compiler.jl:558</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [7] <span class="ansi-bold">demo</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">__model__</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">__varinfo__</span>::DynamicPPL.ThreadSafeVarInfo<span class="ansi-bright-black-fg">{VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, Vector{Base.RefValue{Float64}}}</span>, <span class="ansi-bright-black-fg">__context__</span>::DynamicPPL.ValuesAsInModelContext<span class="ansi-bright-black-fg">{DefaultContext}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-magenta-fg">Main.Notebook</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:457</span>
  [8] <span class="ansi-bold">_evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/JwgrD/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:913</span><span class="ansi-bright-black-fg"> [inlined]</span>
  [9] <span class="ansi-bold">evaluate_threadsafe!!</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">varinfo</span>::VarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}</span>, <span class="ansi-bright-black-fg">context</span>::DynamicPPL.ValuesAsInModelContext<span class="ansi-bright-black-fg">{DefaultContext}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/JwgrD/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:902</span>
 [10] <span class="ansi-bold">evaluate!!</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/JwgrD/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">model.jl:832</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [11] <span class="ansi-bold">values_as_in_model</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/JwgrD/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">values_as_in_model.jl:173</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [12] <span class="ansi-bold">values_as_in_model</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/JwgrD/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">values_as_in_model.jl:172</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [13] <span class="ansi-bold">getparams</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">vi</span>::VarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/Phj9t/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:179</span>
 [14] <span class="ansi-bold">Turing.Inference.Transition</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">vi</span>::VarInfo<span class="ansi-bright-black-fg">{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}</span>, <span class="ansi-bright-black-fg">t</span>::MALASample<span class="ansi-bright-black-fg">{Vector{Float64}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/Phj9t/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">Inference.jl:141</span>
 [15] <span class="ansi-bold">transition_to_turing</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">f</span>::LogDensityFunction<span class="ansi-bright-black-fg">{Model{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}, VarInfo{@NamedTuple{σ²::DynamicPPL.Metadata{Dict{VarName{:σ², typeof(identity)}, Int64}, Vector{Truncated{Normal{Float64}, Continuous, Float64, Float64, Nothing}}, Vector{VarName{:σ², typeof(identity)}}, Vector{Float64}}, x::DynamicPPL.Metadata{Dict{VarName{:x, typeof(identity)}, Int64}, Vector{Normal{Float64}}, Vector{VarName{:x, typeof(identity)}}, Vector{Float64}}}, Float64}, DefaultContext, AutoForwardDiff{2, ForwardDiff.Tag{DynamicPPL.DynamicPPLTag, Float64}}}</span>, <span class="ansi-bright-black-fg">transition</span>::MALASample<span class="ansi-bright-black-fg">{Vector{Float64}}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/Phj9t/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">external_sampler.jl:80</span>
 [16] <span class="ansi-bold">step</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler_wrapper</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>; <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">initial_params</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-green-fg">Turing.Inference</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/Phj9t/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">external_sampler.jl:145</span>
 [17] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/F50rb/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:0</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [18] <span class="ansi-bold">macro expansion</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/F50rb/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">logging.jl:16</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [19] <span class="ansi-bold">mcmcsample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">progress</span>::Bool, <span class="ansi-bright-black-fg">progressname</span>::String, <span class="ansi-bright-black-fg">callback</span>::Nothing, <span class="ansi-bright-black-fg">num_warmup</span>::Int64, <span class="ansi-bright-black-fg">discard_initial</span>::Int64, <span class="ansi-bright-black-fg">thinning</span>::Int64, <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-yellow-fg">AbstractMCMC</span> <span class="ansi-bright-black-fg">~/.julia/packages/AbstractMCMC/F50rb/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sample.jl:144</span>
 [20] <span class="ansi-bold">sample</span><span class="ansi-bold">(</span><span class="ansi-bright-black-fg">rng</span>::TaskLocalRNG, <span class="ansi-bright-black-fg">model</span>::Model<span class="ansi-bright-black-fg">{typeof(demo), (), (), (), Tuple{}, Tuple{}, DefaultContext}</span>, <span class="ansi-bright-black-fg">sampler</span>::Sampler<span class="ansi-bright-black-fg">{Turing.Inference.ExternalSampler{MALA{Int64, UniformScaling{Bool}}, AutoForwardDiff{nothing, Nothing}, false}}</span>, <span class="ansi-bright-black-fg">N</span>::Int64; <span class="ansi-bright-black-fg">chain_type</span>::Type, <span class="ansi-bright-black-fg">resume_from</span>::Nothing, <span class="ansi-bright-black-fg">initial_state</span>::Nothing, <span class="ansi-bright-black-fg">kwargs</span>::@Kwargs<span class="ansi-bright-black-fg">{progress::Bool}</span><span class="ansi-bold">)</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-cyan-fg">DynamicPPL</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/JwgrD/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:102</span>
 [21] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/DynamicPPL/JwgrD/src/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">sampler.jl:92</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [22] <span class="ansi-bold">#sample#101</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/Phj9t/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:29</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [23] <span class="ansi-bold">sample</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/Phj9t/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:20</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [24] <span class="ansi-bold">#sample#100</span>
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/.julia/packages/Turing/Phj9t/src/mcmc/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">abstractmcmc.jl:17</span><span class="ansi-bright-black-fg"> [inlined]</span>
 [25] top-level scope
<span class="ansi-bright-black-fg">    @</span> <span class="ansi-bright-black-fg">~/work/docs/docs/developers/inference/implementing-samplers/</span><span style="text-decoration:underline" class="ansi-bright-black-fg">index.qmd:459</span></pre>
</div>
</div>
</div>
<p>As expected, we run into a <code>DomainError</code> at some point, while if we set <code>unconstrained=true</code>, letting Turing.jl transform the model to a unconstrained form behind the scenes, everything works as expected:</p>
<div id="52" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(<span class="fu">demo</span>(), <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>), <span class="fl">10_000</span>; progress<span class="op">=</span><span class="cn">false</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.1 seconds
Compute duration  = 2.1 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.8970    0.6802    0.0586   178.0427    71.4493    1.0204     ⋯
           x    0.0639    0.9704    0.0579   356.9981   118.6438    1.0097     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.0891    0.3758    0.7390    1.2525    2.9850
           x   -2.1371   -0.3256    0.0238    0.4542    2.0978
</span></pre>
</div>
</div>
</div>
<p>Neat!</p>
<p>Similarly, which automatic differentiation backend one should use can be specified through the <code>adtype</code> keyword argument too. For example, if we want to use <a href="https://github.com/JuliaDiff/ReverseDiff.jl">ReverseDiff.jl</a> instead of the default <a href="https://github.com/JuliaDiff/ForwardDiff.jl">ForwardDiff.jl</a>:</p>
<div id="54" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode julia code-with-copy"><code class="sourceCode julia"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">ReverseDiff</span>: ReverseDiff</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify that we want to use `AutoReverseDiff`.</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">demo</span>(),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">externalsampler</span>(sampler; unconstrained<span class="op">=</span><span class="cn">true</span>, adtype<span class="op">=</span><span class="fu">AutoReverseDiff</span>()),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="fl">10_000</span>;</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    progress<span class="op">=</span><span class="cn">false</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="1">
<div class="ansi-escaped-output">
<pre>Chains MCMC chain (10000×3×1 Array{Float64, 3}):

Iterations        = 1:1:10000
Number of chains  = 1
Samples per chain = 10000
Wall duration     = 2.83 seconds
Compute duration  = 2.83 seconds
parameters        = σ², x
internals         = lp

Summary Statistics
 <span class="ansi-bold"> parameters  </span><span class="ansi-bold">    mean  </span><span class="ansi-bold">     std  </span><span class="ansi-bold">    mcse  </span><span class="ansi-bold"> ess_bulk  </span><span class="ansi-bold"> ess_tail  </span><span class="ansi-bold">    rhat  </span><span class="ansi-bold"> e ⋯
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold">  Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold">   ⋯

          σ²    0.8470    0.5445    0.0256   308.8471   243.3936    1.0032     ⋯
           x   -0.0032    0.9559    0.0384   749.2352   539.9704    1.0004     ⋯
</span><span class="ansi-cyan-fg ansi-bold">                                                                1 column omitted

Quantiles
 </span><span class="ansi-cyan-fg ansi-bold"> parameters  </span><span class="ansi-cyan-fg ansi-bold">    2.5%  </span><span class="ansi-cyan-fg ansi-bold">   25.0%  </span><span class="ansi-cyan-fg ansi-bold">   50.0%  </span><span class="ansi-cyan-fg ansi-bold">   75.0%  </span><span class="ansi-cyan-fg ansi-bold">   97.5%
 </span><span class="ansi-bright-black-fg ansi-bold">     Symbol  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64  </span><span class="ansi-bright-black-fg ansi-bold"> Float64

          σ²    0.1401    0.4130    0.7342    1.2033    2.1317
           x   -2.1676   -0.4196    0.0114    0.4060    2.0666
</span></pre>
</div>
</div>
</div>
<p>Double-neat.</p>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>At this point it’s worth maybe reminding ourselves what we did and also <em>why</em> we did it:</p>
<ol type="1">
<li>We define our models in the <a href="https://github.com/tpapp/LogDensityProblems.jl">LogDensityProblems.jl</a> interface because it makes the sampler agnostic to how the underlying model is implemented.</li>
<li>We implement our sampler in the <a href="https://github.com/TuringLang/AbstractMCMC.jl">AbstractMCMC.jl</a> interface, which just means that our sampler is a subtype of <code>AbstractMCMC.AbstractSampler</code> and we implement the MCMC transition in <code>AbstractMCMC.step</code>.</li>
<li>Points 1 and 2 makes it so our sampler can be used with a wide range of model implementations, amongst them being models implemented in both Turing.jl and Stan. This gives you, the inference implementer, a large collection of models to test your inference method on, in addition to allowing users of Turing.jl and Stan to try out your inference method with minimal effort.</li>
</ol>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>We’re going with the leapfrog formulation because in a future version of this tutorial we’ll add a section extending this simple “baseline” MALA sampler to more complex versions. See <a href="https://github.com/TuringLang/docs/issues/479">issue #479</a> for progress on this.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>There is no such thing as a proper interface in Julia (at least not officially), and so we use the word “interface” here to mean a few minimal methods that needs to be implemented by any type that we treat as a target model.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    // Ensure there is a toggle, if there isn't float one in the top right
    if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
      const a = window.document.createElement('a');
      a.classList.add('top-right');
      a.classList.add('quarto-color-scheme-toggle');
      a.href = "";
      a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
      const i = window.document.createElement("i");
      i.classList.add('bi');
      a.appendChild(i);
      window.document.body.appendChild(a);
    }
    setColorSchemeToggle(hasAlternateSentinel())
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/turinglang\.org\/docs\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../../developers/inference/variational-inference/index.html" class="pagination-link" aria-label="Variational Inference">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Variational Inference</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Turing is created by <a href="http://mlg.eng.cam.ac.uk/hong/" target="_blank">Hong Ge</a>, and lovingly maintained by the <a href="https://github.com/TuringLang/Turing.jl/graphs/contributors" target="_blank">core team</a> of volunteers. <br> The contents of this website are © 2018–2025 under the terms of the <a href="https://github.com/TuringLang/docs/blob/main/LICENCE" target="_blank">MIT License</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/TuringLang/docs/edit/main/developers/inference/implementing-samplers/index.qmd" target="_blank" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/TuringLang/docs/issues/new" target="_blank" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://x.com/TuringLang">
      <i class="bi bi-twitter" role="img" aria-label="Turing Twitter">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/TuringLang/Turing.jl">
      <i class="bi bi-github" role="img" aria-label="Turing GitHub">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>